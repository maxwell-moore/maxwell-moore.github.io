pvArrayHelper = {
  
  indexOf: function(searchElement ) {
    "use strict";

    
    if (this == null) {
      throw new TypeError();
    }
    

    var t = Object(this);
    var len = t.length >>> 0;

    if (len === 0) {
      return -1;
    }

    var n = 0;

    if (arguments.length > 0) {
      n = Number(arguments[1]);

      if (n != n) 
      {
        n = 0;
      } else if (n != 0 && n != Infinity && n != -Infinity) {
        n = (n > 0 || -1) * Math.floor(Math.abs(n));
      }
    }

    if (n >= len) {
      return -1;
    }

    var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);

    for (; k < len; k++) {
      if (k in t && t[k] === searchElement) {
        return k;
      }
    }

    return -1;
  },
  
  
  
  
  
  mergeSort: (function() {

    function mergeSort(compare) {

      var length = this.length,
          middle = Math.floor(length / 2);

      if (!compare) {
        compare = function(left, right) {
          if (left < right)
            return -1;
          if (left == right)
            return 0;
          else
            return 1;
        };
      }

      if (length < 2)
        return this;

      return merge(
        Planview.mergeSort(this.slice(0, middle), compare),
        Planview.mergeSort(this.slice(middle, length), compare),
        compare
      );
    }

    function merge(left, right, compare) {

      var result = [];

      while (left.length > 0 || right.length > 0) {
        if (left.length > 0 && right.length > 0) {
          if (compare(left[0], right[0]) <= 0) {
            result.push(left[0]);
            left = left.slice(1);
          } else {
            result.push(right[0]);
            right = right.slice(1);
          }
        } else if (left.length > 0) {
          result.push(left[0]);
          left = left.slice(1);
        } else if (right.length > 0) {
          result.push(right[0]);
          right = right.slice(1);
        }
      }
      return result;
    }

    return mergeSort;
  })()
};





var pvEcma262 = {
  activate: function() {
    
    
    if (!Array.prototype.indexOf) {
      Array.prototype.indexOf = pvArrayHelper.indexOf;
    }
  }
};






var Planview = ((Planview && (typeof (Planview) === 'object')) ? Planview : {});
Planview.namespaceCache = {};
Planview.RegisterNamespace = function (ns) {
  if (!Planview.namespaceCache.hasOwnProperty(ns)) {
    var root = window;
    var nsParts = ns.split(".");

    for (var i = 0, nsLen = nsParts.length; i < nsLen; ++i) {
      if (typeof root[nsParts[i]] === "undefined") {
        root[nsParts[i]] = {};
      }

      root = root[nsParts[i]];
    }
    Planview.namespaceCache[ns] = root;
  }

  return Planview.namespaceCache[ns];
};

if (typeof Object.create !== 'function') {
  Object.create = function (o) {
    var f = function () {
      f.prototype = o;
      return new f();
    };
  };
}

Planview.getAppPath = function () {
  return g_strAppPath;
};

Planview.getQueryString = function () {
  var result = {}, queryString = location.search.substring(1),
    re = /([^&=]+)=([^&]*)/g, m;

  while (m = re.exec(queryString)) {
    result[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
  }

  return result;
};

Planview.findSiblingElementInDom = function (element, selector) {
  var found;
  if (element && element.length > 0) {
    if (element.css('display') === 'none') {
      
      return null;
    } else if (element.is(selector)) {
      
      return element;
    } else {
      
      found = element.find(selector);

      if (found.length > 0) {
        
        return found[0];
      } else {
        
        return Planview.findSiblingElementInDom(element.next(), selector);
      }
    }
  } else {
    
    return null;
  }
};

Planview.findNextElementInDom = function (element, selector) {
  var found;

  
  if (element.is('body')) {
    return element;
  } else {
    
    found = Planview.findSiblingElementInDom(element.next(), selector);

    if (found) {
      
      return found;
    } else {
      
      return Planview.findNextElementInDom($(element).parent(), selector);
    }
  }
};



Planview.debug = false;
window.console = window.console || {};





















  


window.console.log = window.console.log || function () { };
window.console.info = window.console.info || function (message) { window.console.log('info: ' + message); };
window.console.warn = window.console.warn || function (message) { window.console.log('Warn: ' + message); };
window.console.error = window.console.error || function (message) { window.console.log('Error: ' + message); };
window.console.assert = window.console.assert || function (condition, message) { if (!condition) window.console.log(message); };
window.console.dir = window.console.dir || function (object) { window.console.log(JSON.stringify(object)); };
window.console.clear = window.console.clear || function () { window.console.log('window.console.clear not supported by this browser.'); };
window.console.profile = window.console.profile || function () { window.console.log('window.console.profile not supported by this browser.'); };
window.console.profileEnd = window.console.profileEnd || function () { window.console.log('window.console.profileEnd not supported by this browser.'); };


Planview.makeUnifiedArguments = function (fixedArguments, extraArguments, extraArguemntsStart) {
  var exArgs, unifiedArguments;

  extraArguemntsStart = extraArguemntsStart || 0;
  exArgs = [];

  if (arguments.length > extraArguemntsStart) {
    exArgs = exArgs.slice.call(extraArguments, extraArguemntsStart);
  }

  unifiedArguments = fixedArguments.concat(exArgs);

  return unifiedArguments;
};

Planview.NotImplemented = function(method, context)
{
  method = "Function not implemented: " + (method || "");
  context = context || { };

  throw new Planview.AssertException(method, context);
};

Planview.isFunction = function (o) {
  var isFunction = (typeof o === 'function');

  return isFunction;
};

Planview.time = function(timerName) {
  if (console && console.time) console.time(timerName);
};

Planview.timeEnd = function (timerName) {
  if (console && console.time) console.timeEnd(timerName);
};

Planview.isString = function(o) {
  return typeof o === 'string';
};

Planview.isNumber = function (o) {
  return !isNaN(parseFloat(o)) && isFinite(o);
};

Planview.isDefined = function (o) {
  return (typeof (o) != 'undefined');
};

Planview.hasValue = function (o) {
  return ((o !== null) && Planview.isDefined(o));
};

Planview.isZeroOrHasNoValue = function (o) {
  return ((!Planview.hasValue(o)) || (o === 0));
};

Planview.endsWith = function (str, suffix) {
  return str.indexOf(suffix, str.length - suffix.length) !== -1;
};

Planview.isNullOrEmpty = function (o) {
  return !Planview.hasValue(o) || (Planview.isString(o) && o.length < 1);
};

Planview.isArray = function (o) {
  var isArray = (Object.prototype.toString.call(o) === '[object Array]');

  return isArray;
};

Planview.isDate = function(o) {
  return Planview.hasValue(o) && o.constructor == Date;
};

Planview.isNumberCloseTo = function(actual, expected, precision) {
  if (!(precision === 0)) {
    precision = precision || 2;
  }

  return Math.abs(expected - actual) < (Math.pow(10, -precision) / 2);
};

Planview.globalReplace = function (string, subString, replaceString) {
  var output = string;
  if (!Planview.isNullOrEmpty(subString) && typeof replaceString === 'string') {
    output = string.split(subString).join(replaceString);
  }
  return output;
};

Planview.asciiLetterRegex = new RegExp("[A-Z]", 'i');
Planview.escapeStringForRegExp = function (input) {
  
  
  
  var charArr = input.split('');
  var output = '';
  for (var i = 0, length = charArr.length; i < length; ++i) {
    if (!(charArr[i].match(Planview.asciiLetterRegex)))
      output += '\\' + charArr[i];
    else
      output += charArr[i];
  }
  return output;
};

Planview.arrayToMap = function(a, fkey, fvalue) {
  var j, o, map = {};
  for (j = 0; j < a.length; j += 1) {
    o = a[j];
    map[fkey(o)] = fvalue(o);
  }
  return map;
};

Planview.mapToArray = function (m, fValue) {
  var a = [];
  $.map(m, function(value, key) {
    a.push(fValue ? fValue(key, value) : m[key]);
  });
  return a;
};

Planview.filterMap = function (map, filter) {
  var filteredMap = {};
  if (map) {
    $.each(map, function(index, value) { if (filter(value)) filteredMap[index] = value; });
  }
  return filteredMap;
};

Planview.AssertException = function (message, context) {
  this.message = message;
  this.context = context || {};
};

Planview.AssertException.prototype.toString = function () {
  return 'AssertException: ' + this.message;
};

Planview.assert = function (exp, message, context) {
  if (!exp) {
    throw new Planview.AssertException(message, context);
  }
};





Planview.clone = function (srcInstance, doDeepClone) {
  var clone;

  doDeepClone = true;   


  if (!Planview.hasValue(srcInstance)) {
    return srcInstance;
  }
  
  if (typeof(srcInstance) !== "object") {
    return srcInstance;
  }

  if (srcInstance.getMonth) {  
    return new Date(srcInstance.getTime());
  }
  
  if (typeof(srcInstance.clone) === 'function') {
    return srcInstance.clone();
  }
  
  clone = (Planview.isArray(srcInstance) ? new Array : {});
  if (doDeepClone) {
    clone = jQuery.extend(true, clone, srcInstance);
  } else {
    clone = jQuery.extend(clone, srcInstance);  
  }

  return clone;
};



Planview.contains = function (arr, obj) {
  return (pvArrayHelper.indexOf.call(arr, obj) != -1);
};



Planview.mergeSort = function (arr, fcomp) {
  return pvArrayHelper.mergeSort.call(arr, fcomp);
};








Planview.removeFromArray = function(arr) {
  var v, vIndex;
  var a = arguments;
  var l = a.length;

  while ((l > 1) && arr.length) {
    v = a[--l];

    while ((vIndex = pvArrayHelper.indexOf.call(arr, v)) !== -1) {
      arr.splice(vIndex, 1);
    }
  }

  return arr;
};



Planview.findDistinctValues = function(a) {
  var i, il, v;

  var map = {};
  var distinctValues = [];

  for (i = 0, il = a.length; (i < il) ; ++i) {
    map[a[i]] = true;
  }

  for (v in map) {
    distinctValues.push(v);
  }
  
  return distinctValues;
};



Planview.findDuplicatesInTwoArrays = function (a, b) {
  var dups = [];
  var ia, ial;

  for (ia = 0, ial = a.length; (ia < ial); ++ia) {
    if (b.indexOf(a[ia]) != -1) {
      dups.push(a[ia]);
    }
  }

  return dups;
};








Planview.unionOf = function (a1, a2) {
  var i, e,
      unionMap = {},
      union = [];

  for (i = 0; (i < a1.length) ; ++i) {
    unionMap[a1[i]] = a1[i];
  }

  for (i = 0; (i < a2.length) ; ++i) {
    unionMap[a2[i]] = a2[i];
  }

  for (i = 0; (i < a1.length) ; ++i) {
    e = a1[i];

    if (unionMap.hasOwnProperty(e)) {
      union.push(unionMap[e]);
      delete unionMap[e];
    }
  }

  for (i = 0; (i < a2.length) ; ++i) {
    e = a2[i];

    if (unionMap.hasOwnProperty(e)) {
      union.push(unionMap[e]);
      delete unionMap[e];
    }
  }

  return union;
};




Planview.MinInt = -9999999999;
Planview.MaxInt = 9999999999;

Planview.RegisterNamespace("Planview.Serialization");

Planview.WaitManager = function (pContext, pStartWait, pEndWait) {
  var context = pContext || { };
  var startWait = pStartWait || function () { };
  var endWait = pEndWait || function () { };
  var that = {};

  that.context = function () { return context; };
  that.startWait = function () { startWait(context); };
  that.endWait = function () { endWait(context); };

  return that;
};

Planview.Serialization.deserializeJsonDateString = function (dateString) {
  var date = null;
  
  if (dateString && typeof dateString === 'string') {
    var datePattern = /Date\(([^)]+)\)/;
    var match = datePattern.exec(dateString);
    
    if (match && match.length === 2) {
      date = new Date(parseFloat(match[1]));
    }
  }

  return date;
};

Planview.RegisterNamespace("Planview.ClientStorage");

Planview.ClientStorage = {
  _loginSessionKey: "Planview.ClientStorage.LoginSessionKey",
  
  _sessionStorageType: "SessionStorage",
  _localStorageType: "LocalStorage",
  _getOperation: "get",
  _setOperation: "set",
  _userPrefix: undefined,
  clearSessionItem: function(key) {
    sessionStorage.removeItem(this._getStorageKey(key));
  },
  clearLocalItem: function(key) {
    localStorage.removeItem(key);
  },
  clearLocalItem2: function(key) {
    localStorage.removeItem(this._getStorageKey(key));
  },
  getSessionItem: function(key) {
    return this._getItem(this._sessionStorageType, key);
  },
  setSessionItem: function(key, value, fLoginSession) {
    this._setItem(this._sessionStorageType, key, value, fLoginSession);
  },
  getLocalItem: function(key) {
    return this._getItem(this._localStorageType, key);
  },
  setLocalItem: function(key, value, fLoginSession) {
    this._setItem(this._localStorageType, key, value, fLoginSession);
  },
  getBooleanSessionItem: function(key) {
    return this._isTrueValue(this._getItem(this._sessionStorageType, key));
  },
  setBooleanSessionItem: function(key, value, fLoginSession) {
    this._setItem(this._sessionStorageType, key, value ? 1 : 0, fLoginSession);
  },
  getBooleanLocalItem: function(key) {
    return this._isTrueValue(this._getItem(this._localStorageType, key));
  },
  setBooleanLocalItem: function(key, value, fLoginSession) {
    this._setItem(this._localStorageType, key, value ? 1 : 0, fLoginSession);
  },
  
  clearLoginSessionItems: function() {
    var keyCounter, keyCount, keysArray, storageTypeArray,
        storageTypeCounter, storageTypeCount,
        removeFunction;

    storageTypeArray = [this._sessionStorageType, this._localStorageType];

    storageTypeCount = storageTypeArray.length;
    
    for (storageTypeCounter = 0; storageTypeCounter < storageTypeCount; storageTypeCounter++) {
      
      keysArray = this._getSessionKeysArray(storageTypeArray[storageTypeCounter]);
      removeFunction = storageTypeArray[storageTypeCounter] === this._sessionStorageType
        ? function(key) { sessionStorage.removeItem(key); }
        : function(key) { localStorage.removeItem(key); };
      
      keyCount = keysArray.length;
      for (keyCounter = 0; keyCounter < keyCount; keyCounter++) {
        removeFunction(keysArray[keyCounter]);
      }
      
      removeFunction(this._loginSessionKey);
    }
  },
  _isTrueValue: function(value) { return value === "1"; },
  _getItem: function(storageType, key) {
    var getFunction = this._getStorageOperationByType(storageType, this._getOperation);
    return getFunction(this._getStorageKey(key));
  },
  _setItem: function(storageType, key, value, fLoginSession) {
    var setFunction = this._getStorageOperationByType(storageType, this._setOperation);
    var userKey = this._getStorageKey(key);
    if (fLoginSession) {
      this._addLoginSessionKey(storageType, userKey);
    }
    setFunction(userKey, value);
  },
  _getStorageOperationByType: function(storageType, operationType) {
    if (storageType === this._sessionStorageType) {
      
      return operationType === this._getOperation
        ? function(key) { return sessionStorage.getItem(key); }
        : function(key, value) { return sessionStorage.setItem(key, value); };
    } else {
      return operationType === this._getOperation
        ? function(key) { return localStorage.getItem(key); }
        : function (key, value) {
          var l = value.length;
          try {
            localStorage.setItem(key, value);
          } catch(ex) {
            var x = 0;
            throw ex;  
          }
          
        };
    }
  },
  
  _addLoginSessionKey: function(storageType, key) {
    var setFunction = this._getStorageOperationByType(storageType, this._setOperation);
    var sessionKeysArray = this._getSessionKeysArray(storageType);
    sessionKeysArray[sessionKeysArray.length] = key;
    
    setFunction(this._loginSessionKey, JSON.stringify(sessionKeysArray));
  },
  _getSessionKeysArray: function(storageType) {
    var getFunction = this._getStorageOperationByType(storageType, this._getOperation);
    var sessionKeys = getFunction(this._loginSessionKey);
    return sessionKeys ? JSON.parse(sessionKeys) : [];
  },
  
  
  
  _getStorageKey: function(key) {
    var userCookie;
    var errorString = "Planview.ClientStorage._getStorageKey :: User not defined";
    if (isNullOrUndefined(this._userPrefix)) {
        this._userPrefix = getCookieKey("jssPlanview", "User");
    }
    if (isNullOrUndefined(this._userPrefix)) {
      console.log(errorString);
      if (Planview.debug) {
        new Error(errorString);
      }
      this._userPrefix = "RandomPVUserWithNoUserCookie";
    }
    return this._userPrefix + key;
  }
};







Planview.RegisterNamespace("Planview.Browser");
Planview.Browser.Info = function () {
  this.NavString = navigator.userAgent.toLowerCase();
  this.IsMozilla = (this.isGecko && ua.indexOf('gecko/') + 14 == ua.length);
  if (undefined == this.IsMozilla || null == this.IsMozilla) this.IsMozilla = false;
  this.IsOpera = (this.NavString.indexOf('opera') != (-1));
  this.IsIE = ((this.NavString.indexOf('msie') != (-1) || this.NavString.indexOf('trident') != (-1)) && (!this.isOpera) && ((this.NavString.indexOf('webtv') == (-1))));
  this.IsExplorer = this.IsIE;
  this.IsFirefox = ((this.NavString.indexOf('firefox/') != (-1)) || (this.NavString.indexOf('firebird/') != (-1)));
  this.IsChrome = (this.NavString.indexOf('chrome/') != (-1));
  this.IsSafari = !this.IsChrome && (this.NavString.indexOf('safari') != (-1)); //'safari' shows up in chrome also, on mac (at least)
  this.IsMac = this.NavString.indexOf('macintosh') != -1;
  this.VersionMajor = parseFloat(navigator.appVersion);
  this.DocumentMode = null;
  this.CompatibilityMode = null;
  this.CompatibilityView = false;
  this.TridentVersion = -1;
  this.IsTridentAgent = this.TridentVersion !== -1;

  if (this.IsFirefox) {
    this.VersionMajor = parseFloat(this.NavString.substring(this.NavString.indexOf('firefox/') + 8));
  }
  else {
    if (this.IsIE) {
      this.VersionMajor = parseFloat(this.NavString.substring(this.NavString.indexOf('msie ') + 5));
      if (!this.VersionMajor) {
        this.VersionMajor = parseFloat(this.NavString.substring(this.NavString.indexOf('rv:') + 3));
      }
      if (this.VersionMajor == 7) {
        
        if (this.NavString.indexOf("trident/7") > -1) {
          this.TridentVersion = 7;
          this.VersionMajor = 11;
        }
        else {
          if (this.NavString.indexOf("trident/6") > -1) {
            this.TridentVersion = 6
            this.VersionMajor = 10;
          }
          else {
            if (this.NavString.indexOf("trident/5") > -1) {
              this.TridentVersion = 5;
              this.VersionMajor = 9;
            }
            else {
              if (this.NavString.indexOf("trident/4") > -1) {
                this.TridentVersion = 4;
                this.VersionMajor = 8;
              }
            }
          }
        }
      }
    }
    else {
      if (this.IsChrome) {
        this.VersionMajor = parseFloat(this.NavString.substring(this.NavString.indexOf('chrome/') + 7));
      }
      else if (this.IsSafari) {
        this.VersionMajor = Math.floor(parseFloat(this.NavString.substring(this.NavString.indexOf('version/') + 8)));
      }
    }
  }

  if (this.IsIE) {
    this.DocumentMode = document.documentMode;
    this.CompatibilityView = this.DocumentMode == 7;
    this.CompatibilityMode = document.compatMode;
  }

  this.report = function () {
    alert('FF: ' + this.IsFirefox + " IE: " + this.IsIE + " Chrome: " + this.IsChrome + " Safari: " + this.IsSafari + " Version: " + this.VersionMajor + " DocumentMode: " + this.DocumentMode + " CompatibilityMode: " + this.CompatibilityMode + " Compatability: " + this.CompatibilityView);
  };
};

var PVBrowserInfo = new Planview.Browser.Info();





var _sbDimensions;
Planview.Browser.ScrollbarDimensions = function () {
  if (!Planview.hasValue(_sbDimensions)) {
    var div = document.createElement("div");
    div.style.overflow = "scroll";
    div.style.visibility = "hidden";
    div.style.position = 'absolute';
    div.style.width = '100px';
    div.style.height = '100px';
    document.body.appendChild(div);

    _sbDimensions = {
      width: div.offsetWidth - div.clientWidth,
      height: div.offsetHeight - div.clientHeight
    };
    div.parentNode.removeChild(div);
  }
  return _sbDimensions;
};








Planview.Browser.HasScrollbars = function() {
  
  var scrollX = window.scrollX;
  var scrollY = window.scrollY;
  
  window.scrollTo(1, 1);
  var hasScrollX = window.scrollX === 1;
  var hasScrollY = window.scrollY === 1;
  
  window.scrollTo(scrollX, scrollY);
  return {
    horizontal: hasScrollX,
    vertical: hasScrollY
  };
};

var g_ButtonBackupArray = new Array();
var g_strAppPath = ("/"+window.location.pathname.split("/")[1]);
var g_strImgPath = (g_strAppPath + "/images/pvcorporate/").toLowerCase();
var portImgWidth, portImgHeight;
var g_tmLastResizeTimestamp = 0;
var g_strZoneWidthCookie = "";
var IE4 = (document.all && !document.getElementById) ? true : false;
var NS4 = (document.layers) ? true : false;
var IE5 = (document.all && document.getElementById) ? true : false;
var NS6 = (document.getElementById && !document.all) ? true : false;
var IE = (IE4 || IE5) ? true : false;
var NS = (NS4 || NS6) ? true : false;
var g_wPVTrace = null;

function IsNullOrEmpty(value)
{
  return isNullOrUndefined(value) || value.toString().length < 1;
}

function isNullOrUndefined(value)
{ 
  return ((null == value) || (typeof(value) == 'undefined'));
}


if (typeof HTMLElement != 'undefined' && !HTMLElement.prototype.click) {
  HTMLElement.prototype.click = function() {
    var evt = this.ownerDocument.createEvent('MouseEvents');
    evt.initMouseEvent('click', true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
    this.dispatchEvent(evt);
  };
}

function SetURLParam(vURL,vPrm,vVal)
{
  
  vVal = escape(vVal);
  var vL=vURL.toString();
  var vQ="";
  var iPos=vURL.indexOf("?");
  if (iPos > 0)
  {
    vL=vURL.substring(0,iPos);
    vQ=vURL.substr(iPos+1);
  }
  var vNQ="";
  if (vQ != "")
  {
    var vaT=vQ.split("&");
    for (i = 0; i < vaT.length; i++)
    {
      if (vaT[i].indexOf(vPrm + "=") != 0)
      {
        if (vNQ != "")
        {
          vNQ=vNQ.concat("&",vaT[i]);
        } 
        else 
        {
          vNQ=vNQ.concat("?",vaT[i]);
        }
      }
    }
  }
  if (vVal.toString() != "")
  {
    if (vNQ != "")
    {
      vNQ=vNQ.concat("&",vPrm,"=",vVal.toString());
    }
    else 
    {
      vNQ=vNQ.concat("?",vPrm,"=",vVal.toString());
    }
  }
  vL=vL.concat(vNQ);
  return vL;
}

function cfPopUp(strURL, fPopup)
{
  if( fPopup )
  {
    var vURL=SetURLParam(strURL,"popup","1");
    var vURL=SetURLParam(strURL,"back","close");
    var win = window.open(vURL, "PVChildWin_"+Number(Math.random()*1000000).toFixed(0), "width=600,height=400,left=100,top=100,resizable=yes,scrollbars=yes");
    if (win != null)
    {
      win.opener = window;
      CenterFit(win, 80, 90);
      win.focus();
    }
  }
  else
  {
    SetTopLocationHref(strURL);
  }
}


function loadPortfolio(vID, portalType, primaryTab)
{
  setLastCodesCookie("lastcodes", portalType, vID);
  setCookieKey("jssPlanview", "pt", portalType);
  var vURL = g_strAppPath + "/portal/main.asp?scode=" + vID;
  if (portalType == 'COSTCENTER') 
  {
    vURL = g_strAppPath + "/OpCapacity/CapacityAnalysis.aspx?scode="  + vID;
  }
  if (portalType !== null && typeof(portalType)!='undefined')
  { 
    vURL = vURL + "&pt="+portalType; 
  }
  if (primaryTab !== null && typeof(primaryTab)!='undefined')
  { 
    vURL = vURL + "&ptab="+primaryTab;
  }
  if ('project' == portalType.toLowerCase())
  {
    vURL = SetURLParam(vURL, 'useportcd', 0);
  }
  if (window.opener != null)
  {
    window.opener.LocationReplace(vURL);
    window.close();
  }
  else 
  {
    window.LocationReplace(vURL);
  }
}

function replacePage(url, portalType, newCode, oldCode)
{
  var newUrl;
  newUrl = SetURLParam(url, 'scode', newCode);
  newUrl = SetURLParam(newUrl, 'sc', newCode);
  if ('project' == portalType.toLowerCase())
  {
    newUrl = SetURLParam(newUrl, 'useportcd', 0);
  }
  setLastCodesCookie("lastcodes", portalType, newCode);
  setCookieKey("jssPlanview", "pt", portalType);
  if (window.opener != null)
  {
    window.opener.LocationReplace(newUrl);
    window.close();
  }
  else
  {
    window.LocationReplace(newUrl);
  }
}

function loadScenario(vID) 
{
  vURL = document.location.href;
  vL = SetURLParam(vURL, "iver", vID);
  document.location.href = vL;
}

function CenterFit(wnd, sizePctH, sizePctV)
{
  var nWindowWidth=640, nLeftMargin=80, nWindowHeight=480, nTopMargin=60; 
  var nPercentH, nPercentV;

  if (wnd != null && wnd.screen) 
  {
    
    if (sizePctH != 'defaultWidth')
      nPercentH = 2263/Math.sqrt(wnd.screen.availWidth);
    else
      nPercentH = parseInt(sizePctH);

    if (sizePctV != 'defaultHeight')
      nPercentV = nPercentH;
    else
      nPercentV = parseInt(sizePctV);


    
    nWindowWidth = wnd.screen.availWidth * nPercentH / 100;
    nLeftMargin = (wnd.screen.availWidth / 2) - (nWindowWidth / 2);
    nWindowHeight = wnd.screen.availHeight * nPercentV / 100;
    nTopMargin = (wnd.screen.availHeight / 2) - (nWindowHeight / 2);

    
    wnd.moveTo(nLeftMargin, nTopMargin);
    wnd.resizeTo(nWindowWidth, nWindowHeight);
  }
}


function SetPopUp(iPopupMode)
{
  if (iPopupMode != 0)
  {
    CenterFit(window, 'defaultHeight', 'defaultWidth');
  }
}


function PopUpClose(iCloseFlag, iBack, newHref) {
  if( iCloseFlag!=0 )
  {
    var href = newHref ? newHref : top.opener.location.href;
    try 
    {
      top.opener.LocationReplace(unescape(href)); 
    }
    catch(e) {}
    top.close();
  }
  else
  {
    top.history.go(-iBack);
  }
}


function popUpWnd()
{
  var argv = popUpWnd.arguments;
  var argc = popUpWnd.arguments.length;
  var strURL = (argc > 0) ? argv[0] : null;
  var fPopup = (argc > 1) ? argv[1] : true;
  var iW = (argc > 2) ? argv[2] : -1;
  var iH = (argc > 3) ? argv[3] : -1;
  var iLeft = (argc > 4) ? argv[4] : -1;
  var iTop = (argc > 5) ? argv[5] : -1;
  var strScrollbars = (argc > 6) ? argv[6] : "yes";
  var strResizable = (argc > 7) ? argv[7] : "yes";
  var strWindowName = (argc > 8) ? argv[8] : popUpWndName();
  var fStatusBar = (argc > 9) ? argv[9] : 1;
  if (fPopup)
  {
    if (strURL.indexOf("back=") < 0)
    {
      if (strURL.indexOf("?") < 0)
        strURL += "?back=close";
      else
        strURL += "&back=close";
    }

    
    if (iW == -1 && iH == -1)
    {
      var nWidth = 800;
      var nHeight = 600;

      if (window.screen)
      {
        nWidth = 80 * window.screen.availWidth / 100;
        nHeight = 90 * window.screen.availHeight / 100;
      }

      if (nWidth < 800 || nHeight < 600)
      {
        nWidth = window.screen.availWidth;
        nHeight = window.screen.availHeight;
        nLeft = 0;
        nTop = 0;
      }
    }
    else
    {
      var nWidth = iW;
      var nHeight = iH;
    }

    
    if (iLeft == -1 && iTop == -1)
    {
      var nLeft = 0;
      var nTop = 0;

      if (window.screen)
      {
        nLeft = (window.screen.availWidth / 2) - (nWidth / 2);
        nTop = (window.screen.availHeight / 2) - (nHeight / 2);
      }
      if (nLeft < 0) nLeft = 0;
      if (nTop < 0) nTop = 0;
    }
    else
    {
      var nLeft = iLeft;
      var nTop = iTop;
    }

    var strOptions = "width=" + nWidth + ",height=" + nHeight + ",left=" + nLeft + ",top=" + nTop + ",scrollbars=" + strScrollbars + ",resizable=" + strResizable + ",status=" + fStatusBar;

    var win = window.open(strURL, strWindowName, strOptions);
    if (win != null)
    {
      if (!UrlIsMarkForClosingException(strURL)) MarkChildWindowForClosing(strWindowName, win, false);
      win.opener = window;
      win.focus();
    }
  }
  else
  {
    SetTopLocationHref(strURL);
  }
}


function NewWnd() {
    var argv = NewWnd.arguments;
    var argc = NewWnd.arguments.length;
    var strURL = (argc > 0) ? argv[0] : null;
    var fPopup = (argc > 1) ? argv[1] : true;
    if (fPopup) {
        if (strURL.indexOf("back=") < 0) {
            if (strURL.indexOf("?") < 0)
                strURL += "?back=close";
            else
                strURL += "&back=close";
        }

        var urlElements = window.location.href.toLowerCase().split('/');

        var strRootURL = "http://" + urlElements[2] + "/planview/";
        strURL = strURL.replace("../", strRootURL);
        
        var win = window.open(strURL, '_blank');
        if (win != null) {
            win.opener = window;
            win.focus();
        }
    }
    else {
        SetTopLocationHref(strURL);
    }
}


function popUpWnd2()
{
  var argv = popUpWnd2.arguments;
  var argc = popUpWnd2.arguments.length;
  var strURL = (argc > 0) ? (argv[0].toString() != "" ? argv[0] : null) : null;
  var fPopup = (argc > 1) ? (argv[1].toString() != "" ? argv[1] : true) : true;
  var iW = (argc > 2) ? (argv[2].toString() != "" ? argv[2] : -1) : -1;
  var iH = (argc > 3) ? (argv[3].toString() != "" ? argv[3] : -1) : -1;
  var iLeft = (argc > 4) ? (argv[4].toString != "" ? argv[4] : -1) : -1;
  var iTop = (argc > 5) ? (argv[5] != "" ? argv[5] : -1) : -1;
  var strScrollbars = (argc > 6) ? (argv[6] != "" ? argv[6] : "yes") : "yes";
  var strResizable = (argc > 7) ? (argv[7] != "" ? argv[7] : "yes") : "yes";
  var strWindowName = (argc > 8) ? (argv[8] != "" ? argv[8] : popUpWndName()) : popUpWndName();
  
  popUpWnd(strURL, fPopup, iW, iH, iLeft, iTop, strScrollbars, strResizable, strWindowName);
}

function popUpWndName()
{
  return "PVChildWin_"+Number(Math.random()*1000000).toFixed(0);
}

function popUpWndHidden(strURL)
{
  var win = window.open(strURL,"PVChildWin_Processing", "width=1,height=1,resizable=no,toolbars=no,scrollbars=no");
  if (win != null)
  {
    win.blur();
  }
}

function OpenMW(strURL)
{
  var strOptions =" width="  + (window.screen.availWidth-24) +
                  ",height=" + (window.screen.availHeight-48) +
                  ",left="   + (8) +
                  ",top="    + (4) +
                  ",resizable=yes";
  

  var test = window.open("","MW2", strOptions);

  if (test && test.mwloaded)
  {
    test.focus();
  }
  else
  {
    var win = window.open(strURL, "MW2", strOptions);
    if (win != null)
    {
      win.opener = window;
      win.focus();
    }
  }
}

function startTrace()
{
  g_wPVTrace=window.open("","ExecutionTrace","HEIGHT=640,WIDTH=480,status=1,resizable=1,scrollbars=1");
  var dtDate = new Date();
  g_wPVTrace.document.write("<HTML><HEAD><TITLE>ExecutionTrace</TITLE></HEAD><BODY><hr><font color='green'>* * * "+dtDate.toLocaleTimeString( )+" ::Trace Started:: "+window.location+"<br></font><hr>");
}

function writeTrace(strHTMLString)
{
  if(g_wPVTrace==null||typeof(g_wPVTrace)!="object"){startTrace();}
  if(g_wPVTrace!=null){
    g_wPVTrace.document.write(strHTMLString);
  }
}

function stopTrace()
{
  if(g_wPVTrace!=null){
    var dtDate = new Date();
    g_wPVTrace.document.write("<br><hr>"+dtDate.toLocaleTimeString( )+" ::End Of Trace");
    g_wPVTrace.document.write("</BODY></HTML>");
    g_wPVTrace.document.close();
  }
}

function closeTrace()
{
  if(g_wPVTrace==null){
    g_wPVTrace.close();
    g_wPVTrace=null;
  }
}

function CheckZeroValOnPortlet(value, msg)
{
    if (value <= 0)
    {
        alert(msg);
        return false;
    }
    else
        return true;
}

function ResetZoneWidthCookie()
{
  var today = new Date();
  {
    var iZoneWidth;
    var strCookie = "";
    var oZone = document.getElementById("mainPortletZone");

    if (oZone)
    {
      if (IE) iZoneWidth = oZone.clientWidth ;
      else iZoneWidth = oZone.offsetWidth - 20;
      
      strCookie += ":" + iZoneWidth;
      if (strCookie != g_strZoneWidthCookie)
      {
        var nDays = 365;
        var today = new Date();
        var nextYear = new Date(today.getTime() + nDays*24*60*60*1000);
        setCookie("jssZoneWidth",strCookie,nextYear);
        g_strZoneWidthCookie = strCookie;
      }
    }
  }
  g_tmLastResizeTimestamp = today.getTime();
}


function ResetHXWCookie(bReset)
{
  var today = new Date();
  if ( (today.getTime()-g_tmLastResizeTimestamp)>20 )
  {
    setWinSize();
  }
  g_tmLastResizeTimestamp = today.getTime();
}


var g_iWinHeight = 0;
var g_iWinWidth = 0;


function setWinSize() 
{
  var chkHeight = f_clientHeight();
  var chkWidth = f_clientWidth();

  if ( Math.abs(g_iWinHeight - chkHeight) > 1 || Math.abs(g_iWinWidth - chkWidth) > 1 || (g_iWinHeight+g_iWinWidth) == 0)
  {
    var nDays = 365;
    var today = new Date();
    var nextYear = new Date(today.getTime() + nDays*24*60*60*1000);
    setCookie("jssHxw",chkHeight+"x"+chkWidth,nextYear);
    g_iWinHeight = chkHeight;
    g_iWinWidth = chkWidth;
  }
}


var g_arrResizableItem = new Array(100,2);
var g_iLastResizableItem = 0;
var g_iZone2_OriginalWidth = 0.;


function RegisterAllPVCharts()
{
  var oImage;
  if ( g_iZone2_OriginalWidth == 0.0 ) g_iZone2_OriginalWidth = (document.getElementById("mainPortletZone")).offsetWidth;
  for (var i = 0; i < document.images.length; i++)
  {
    oImage = document.images[i];
    if ((oImage.id).indexOf("PVCHART_") >= 0 )
    {
      if (IE) oImage.naturalWidth = oImage.width;
    }
  }
}

function ResetAllRegisteredResizableItems()
{
  var oZone = document.getElementById("mainPortletZone");
  if (!oZone) return;  
  var iZoneWidth = oZone.offsetWidth-10;
  for (var i = 0; i < document.images.length; i++)
  {
    var oImage = document.images[i];
    if ((oImage.id).indexOf("PVCHART_") >= 0 ) {
        width = (iZoneWidth / g_iZone2_OriginalWidth) * oImage.naturalWidth + "px";
        oImage.style.width = width;
    }
  }
}





function ResizeMiddleScreen()
{
  if (g_arr_iDValue[0] != '' && g_arr_iDValue[0] != null)
  {
    for (i=0; i<g_arr_iDValue.length; i++) {
        var scrollbarSize = IE ? 22 : 33;
      document.getElementById(g_arr_iDValue[i]).style.width = (document.getElementById("mainPortletZone").offsetWidth-scrollbarSize) + "px";
      document.getElementById(g_arr_iDValue[i]).style.display = "block";
    }
  }
}

function ResizeMiddleScreenExpand()
{ 
  if (g_arr_iDValue[0] != '' && g_arr_iDValue[0] != null) 
  {
    var scrollbarSize = IE ? 22 : 33;
    document.getElementById(g_arr_iDValue[0]).style.width = (document.getElementById("mainPortletZone").offsetWidth - 186 - scrollbarSize) + "px";
    document.getElementById(g_arr_iDValue[0]).style.display = "block";
  }
}






function swapImg(imageName, src1, src2, frameId)
{
  var myImage = document.images[imageName];
  if (myImage == null && frameId != null) {
    var oFrame = window.frames[frameId];
    if (oFrame != null) {
      myImage = oFrame.document.images[imageName];
    }
    
  }
  
  myImageStr = myImage;
  myImageStr = myImageStr.src.substring(myImageStr.src.lastIndexOf('/'));
  if(myImageStr == src1.substring(src1.lastIndexOf('/')))
  { 
    myImage.src = src2;
  }
  else
  { 
    myImage.src = src1;
  }
}

function getSslRequired() {
    return this.g_SslRequired;
}

var dtCookieExpiration;

function setCookie(name, value) {
    setCookieWithDate(name, value, null);
}

function setCookieWithDate(name, value, date) {
    var expires = date;
    var path = g_strAppPath;
    var domain = null;
    var arrKeys = value.split('&');
    var escValue = "";
    for (var i = 0; i < arrKeys.length; i++) {
        escValue += (escValue.length > 0 ? "&" : "");
        var arrSubKeys = arrKeys[i].split('=');
        escValue += arrSubKeys[0];
        if (arrSubKeys.length > 1) {
            if (name == 'Planview' || name == 'jssPlanviewDataPicker')
                escValue += "=" + arrSubKeys[1];
            else
                escValue += "=" + escape(arrSubKeys[1]);
        }
    }
    document.cookie = name + "=" + escValue +
    ((expires == null) ? "" : ("; expires=" + expires.toGMTString())) +
    ((path == null) ? "" : ("; path=" + path)) +
    (getSslRequired() ? "; secure" : "");
}



function setCookieProperties(name, domain, path, expires) {
    document.cookie = name + "=" + getCookie(name) +
    ((expires == null) ? "" : ("; expires=" + expires.toGMTString())) +
    ((path == null) ? "" : ("; path=" + path)) +
    ((domain == null) ? "" : ("; domain=" + domain)) +
    (getSslRequired() ? "; secure" : "");
}

function getCookieVal(offset) 
{
  var endstr = document.cookie.indexOf(";", offset);
  if (endstr == -1) endstr = document.cookie.length;

  var argv = getCookieVal.arguments;
  var argc = getCookieVal.arguments.length;
  var bNoEscape = (argc > 1) ? argv[1] : false;
  if (bNoEscape) return document.cookie.substring(offset, endstr);
  return unescape(document.cookie.substring(offset, endstr));
}


function getCookie(name) 
{
  var arg = name + "=";
  var alen = arg.length;
  var clen = document.cookie.length;
  var i = 0;
  while (i < clen) {
    var j = i + alen;
    if (document.cookie.substring(i, j) == arg)
      return getCookieVal (j,(name=='Planview'));
    i = document.cookie.indexOf(" ", i) + 1;
    if (i == 0) break;
  }
  return null;
}


function getCookieKey (name,key )
{
  var cookie = getCookie(name);
  if (cookie)
  {
    var arrKeys = cookie.split('&');
    for ( var i = 0; i < arrKeys.length; i++)
    {
      var strKey = key + '=';
      var iStart = arrKeys[i].indexOf(strKey);
      if (iStart==0)
        return arrKeys[i].substring(strKey.length,arrKeys[i].length);
    }
  }
  return null;
}

function setCookieKey(name, key, val) {
    setCookieKeyWithDate(name, key, val, null);
}

function setCookieKeyWithDate(name, key, val, date) {
    if (name == null || key == null) return false;
    var strNewKeyVal = (val == null || val == '') ? '' : key + '=' + val;
    var strCookie = getCookie(name);
    var strOrigVal = getCookieKey(name, key);
    var strNewCookie = strNewKeyVal;
    if (strCookie) {
        if (strOrigVal) {
            if (strCookie.indexOf(key + "=") == strCookie.lastIndexOf(key + "=") || strCookie.indexOf(key + "=") == 0) {
                strNewCookie = strCookie.replace(key + "=" + strOrigVal, strNewKeyVal);
            }
            else {
                
                strNewCookie = strCookie.replace('&' + key + "=" + strOrigVal, '&' + strNewKeyVal);
            }
        }
        else
            strNewCookie = (strNewKeyVal == '') ? strCookie : strCookie + '&' + strNewKeyVal;
    }
    else {
        strNewCookie = strNewCookie;
    }
    
    
    
    strNewCookie = strNewCookie.replace(/&&/g, "&");

    if (date == null) {
        setCookieWithDate(name, strNewCookie, date);
    } else {
        setCookie(name, strNewCookie);
    }
    return true;
}

function setPortalCookie(root, name,tab, val)
{
  var strCookieOrig = getCookieKey('PVPortal',name);
  if (!strCookieOrig) return;

  var strCookie = strCookieOrig;
  var arrTabs = strCookie.split('|');
  for ( var i = 0; i < arrTabs.length; i++)
  {
    var arrPair = arrTabs[i].split('.');
    if (arrPair[0]==tab)
    {
      strCookie = strCookie.replace(arrTabs[i],arrPair[0]+'.'+val);
      break;
    }
  }
  var strNewCookie = (getCookie('PVPortal')).replace(strCookieOrig,strCookie);
  setCookie('PVPortal',strNewCookie);
}

function setLastCodesCookie(name, tab, val) {
    var strCookieOrig = getCookie('jssLastcodes');
    if (!strCookieOrig) return;

    var strCookie = strCookieOrig;
    var arrTabs = strCookie.split('|');
    for (var i = 0; i < arrTabs.length; i++) {
        var arrPair = arrTabs[i].split('.');
        if (arrPair[0] == tab) {
            strCookie = strCookie.replace(arrTabs[i], arrPair[0] + '.' + val);
            break;
        }
    }
    var strNewCookie = (getCookie('jssLastcodes')).replace(strCookieOrig, strCookie);
    setCookie('jssLastcodes', strNewCookie);
}

function deleteCookie(name)
{
  var argv = deleteCookie.arguments;
  var argc = deleteCookie.arguments.length;
  var path = (argc > 1) ? argv[1] : g_strAppPath;
  var domain = (argc > 2) ? argv[2] : null;
  
  var expdate = new Date();
  expdate.setTime (expdate.getTime() - 1000 * 60 * 60 * 24 * 365);
  var cval = getCookie (name);
  if(cval!=null)
  {
    document.cookie = name + "=" +
            ((path) ? "; path=" + path : "") +
            ((domain) ? "; domain=" + domain : "") +
            "; expires=" + expdate.toGMTString();
  }
}


function toggleSecs( targetId,mDivExp,mDivColl )
{
  targetOne = document.getElementById( targetId );
  targetTwo = document.getElementById (targetId+"2");
  menuText = document.getElementById (targetId+"2Text");

  var isExpanding = targetOne.style.display == "none";

  if (isExpanding) 
  {
    document.getElementById(mDivExp).style.display = "none";
    document.getElementById(mDivColl).style.display = "block";
    targetOne.style.display = "block";
    targetTwo.style.display = "none";
  }
  else 
  {
    document.getElementById(mDivExp).style.display = "block";
    document.getElementById(mDivColl).style.display = "none";
    targetOne.style.display = "none";
    targetTwo.style.display = "block";
    if (!IE) menuText.style.display = "none";
  }
  
  setCookieKey("PVPortal",targetId,targetOne.style.display);
  setMainDiv();
  resizeMainMenus();
  resizePYImgWidth();
}

function savePortYourImgDimensions()
{
  if (document.getElementById("PORT_YOUR_IMAGE"))
  {
    portImgWidth = document.getElementById("PORT_YOUR_IMAGE").width;
    portImgHeight = document.getElementById("PORT_YOUR_IMAGE").height;
  }
}

function resizePYImgWidth()
{
  if ((document.getElementById("divPORT_YOUR_IMAGE")) && (document.getElementById("PORT_YOUR_IMAGE")))
  {
    if (document.getElementById("coll_left") && document.getElementById("coll_right"))
    {
      occupiedWidth = 100;
      if (document.getElementById("coll_left").style.display != "none")
      {
        occupiedWidth = occupiedWidth + 180;
      }
      if (document.getElementById("coll_right").style.display != "none")
      {
        occupiedWidth = occupiedWidth + 180;
      }
      imgHolderWidth = screen.width - occupiedWidth;

      if (imgHolderWidth < portImgWidth)
      {
        document.getElementById("PORT_YOUR_IMAGE").style.height = ((portImgHeight * imgHolderWidth) / portImgWidth) + "px";
        document.getElementById("PORT_YOUR_IMAGE").style.width = imgHolderWidth + "px";
      }
      else
      {
        document.getElementById("PORT_YOUR_IMAGE").style.height = portImgHeight + "px";
        document.getElementById("PORT_YOUR_IMAGE").style.width = portImgWidth + "px";
      }
    }  
  }
}


function resizeMainMenus() 
{
  var myCHeight = f_clientHeight();
  var bannerHeight = document.getElementById('PVBanner') ? document.getElementById('PVBanner').offsetHeight : 0;
  var iScrH = myCHeight - bannerHeight;

  oAppMenu = document.getElementById("appMenu");
  if (oAppMenu == null || oAppMenu.style.display == "none") 
  {
    oAppMenu = document.getElementById("appMenu2");
  }
  
  oUsrMenu = document.getElementById("userMenu");
  if (oUsrMenu == null || oUsrMenu.style.display == "none") 
  {
    oUsrMenu = document.getElementById("userMenu2");
  }
  
  if (oAppMenu == null) return;
  var iMainH = oAppMenu.parentNode.offsetHeight;
  var fUseScrH = (iScrH > iMainH) ? true : false;

  var iAppMenuHt, iUsrMenuHt;

  switch (oAppMenu.id) 
  {
    case "appMenu":
        iAppMenuHt = resizeV(oAppMenu, fUseScrH ? iScrH + 7 : iMainH + 7);
        iAppMenuHt = resizeV(document.getElementById("coll_left"), fUseScrH ? iScrH - 5 : iMainH - 5);
        break;
    case "appMenu2":
        iAppMenuHt = resizeV(oAppMenu, fUseScrH ? iScrH - 54 : iMainH - 54);
        break;
  }
  
  if (oUsrMenu == null) return;
  switch (oUsrMenu.id) 
  {
    case "userMenu":
        iAppMenuHt = resizeV(oUsrMenu, fUseScrH ? iScrH - 8 : iMainH - 8);
        iAppMenuHt = resizeV(document.getElementById("coll_right"), fUseScrH ? iScrH - 5 : iMainH - 5);
        break;
    case "userMenu2":
        iAppMenuHt = resizeV(oUsrMenu, fUseScrH ? iScrH - 54 : iMainH - 54);
        break;
  }
}


function resizeV(oIn)
{
  var argv = resizeV.arguments;
  var argc = resizeV.arguments.length;
  var iH = (argc > 1) ? argv[1] : 0;
  var iScrH = f_clientHeight();
  var iBnrH=document.getElementById('PVBanner').offsetHeight;
  if (iH == 0) 
  {
    var iParentH=(oIn!=null&&oIn.parentNode!=null)?oIn.parentNode.offsetHeight:0;
    iH=(iScrH-iBnrH-iParentH>0)?iScrH-iBnrH:iParentH;
  }
  if (oIn != null)
  {
    oIn.style.height = iH + "px";
  }
  return iH;
}


function initDashboard() 
{
  if (document.getElementById('dashboardBackground')) 
  {
    var myCHeight = f_clientHeight();
    if ((myCHeight - document.getElementById('PVBanner').offsetHeight - 16) > 0) 
    {
      document.getElementById('dashboardBackground').style.height = (myCHeight - document.getElementById('PVBanner').offsetHeight - 16) + "px";
    }
  }
}



function SetDocumentLocationHref(strUrl)
{
  try {document.location.href = strUrl;}
  catch (err) { HandleNavigationError(err); }
}

function SetWindowLocationHref(strUrl)
{
  try { window.location.href = strUrl; }
  catch (err) { HandleNavigationError(err); };
}

function SetTopLocationHref(strUrl)
{
  try { top.location.href = strUrl; }
  catch (err) { HandleNavigationError(err); }
}

function LocationReplace(strUrl)
{
  try { location.replace(strUrl); }
  catch (err) {HandleNavigationError(err); }
}

function HandleNavigationError(err)
{
  switch(err.number.toString())
  {
    case "-2147467259": 
      {break;}
    default:
    {      
      alert(err.name + " " + err.number + " " + err.description + " " + err.message);
      break;
    }
  }
}

function PT01FrameNavigate(strPortletCode, sUrl, sCookieKey, sCookieValue)
{
  var oDiv;
  var oIFrame;
  var dDate = new Date();
  var strUrl = sUrl;
  var strCookieKey = sCookieKey;
  var strCookieValue = sCookieValue;
    
  dDate.setTime (dDate.getTime() + 1000 * 60 * 60 * 24 * 30);
  oIFrame = document.getElementById('DashFrame' + strPortletCode);
  setCookieKeyWithDate("jssPT01UserSelect", strCookieKey, strCookieValue, dDate);
  oIFrame.src = strUrl;
}


function PT01PageNavigate(sUrl, sCookieKey, sCookieValue)
{
  var dDate = new Date();
  var strUrl = sUrl;
  var strCookieKey = sCookieKey;
  var strCookieValue = sCookieValue;
  
  dDate.setTime (dDate.getTime() + 1000 * 60 * 60 * 24 * 30);
  setCookieKeyWithDate("jssPT01UserSelect", strCookieKey, strCookieValue, dDate);
  location.replace(strUrl);
}

function GetTimeStampID()
{
  var dDate = new Date();
  return dDate.getFullYear().toString() + dDate.getMonth().toString() +
         dDate.getDay().toString() + dDate.getHours().toString() +
         dDate.getMinutes().toString() + dDate.getSeconds().toString() + dDate.getMilliseconds().toString();

}

function PT01Navigate(strPortletCode, sUrl, sCookieKey, sCookieValue, fInPortal)
{
  var oDiv;
  var oIFrame;
  var dDate = new Date();
  var strUrl = sUrl;
  var strCookieKey = sCookieKey;
  var strCookieValue = sCookieValue;
  var strCacheID = GetTimeStampID();
  
  dDate.setTime (dDate.getTime() + 1000 * 60 * 60 * 24 * 30);
  setCookieKeyWithDate("jssPT01UserSelect", strCookieKey, strCookieValue, dDate);
  setCookieKey( "jss"  + strPortletCode, "cache", strCacheID);
  strUrl += "&cache=" + strCacheID;
  
  if(fInPortal)
  {
    oIFrame = document.getElementById('DashFrame' + strPortletCode);
    
  }
  else
  {
    location.replace(strUrl + "&enlarge=1&fInPortal=0");
    oIFrame = opener.document.getElementById('DashFrame' + strPortletCode);
  }
  if (oIFrame != null)
  {
    oIFrame.src = strUrl + "&enlarge=0&fInPortal=1";
  }
}


function PT01Navigate2(strPortletCode, sUrl, fInPortal)
{
  var oDiv;
  var oIFrame;
  var dDate = new Date();
  var strUrl = sUrl;
  var strCacheID = dDate.getMinutes().toString() + dDate.getSeconds().toString() + dDate.getMilliseconds().toString();
  
  strUrl = strUrl.replace(/\[AP\]/g, "&");
  setCookieKey( "jss" + strPortletCode, "cache", strCacheID);
  setCookieKey("jssPT01UserSelect", "", "");
  strUrl += "&cache=" + strCacheID;
  
  if(fInPortal)
  {
    oIFrame = document.getElementById('DashFrame' + strPortletCode);
    if (isNullOrUndefined(oIFrame)) {
      oIFrame = window.frames[0].document.getElementById('DashFrame' + strPortletCode);
    }
  }
  else
  {
    location.replace(strUrl + "&enlarge=1&fInPortal=0");
    oIFrame = opener.document.getElementById('DashFrame' + strPortletCode);
    strUrl += "&cascade=true";
  }
  if(oIFrame!=null)
    oIFrame.src = strUrl + "&enlarge=0&fInPortal=1";
}


function PT01HeaderUpdate(strPortletCode, strInnerHTML)
{
  var oDiv = document.getElementById(strPortletCode + 'dashFramePT01FlyoutContainer');
  if (oDiv) {
    oDiv.innerHTML = strInnerHTML;
  }
}





function autoSizeIframe(strIframeName)
{
  var oFrame = top.document.getElementById(strIframeName);
  oFrame.style.display = 'block';
  var contentHeight = document.body.scrollHeight;
  oFrame.style.height = contentHeight + "px";
}



function deserialize(str)
{ 
  var v;
  if (/^("(\\.|[^"\\\n\r])*?"|new[ \t]+Date\([ \t]*[0-9]*[ \t]*\)|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(str))
  {
    try { 
      v=eval('('+str+')');
    } catch (e) { alert("ERROR-PJSON: deserialize failed to eval -> "+str); }
  } else { alert("ERROR-PJSON: deserialize failed on characters -> "+str); }
  return v;
}

Planview.Browser.setInputElementCursorPosition = function(elem, pos) {
  if (elem.setSelectionRange) {
    elem.setSelectionRange(pos, pos);
  } else if (elem.createTextRange) {
    var range = elem.createTextRange();
    range.collapse(true);
    range.moveEnd('character', pos);
    range.moveStart('character', pos);
    range.select();
  }

  return elem;
};



function SelectOptionInList( lstSelectList, intID )
{
  try
  {
    var intIndex = 0;
    
    for( intIndex = 0; intIndex < lstSelectList.options.length; intIndex++ )
    {
      
      if( lstSelectList.options[intIndex].value == intID )
      {
        
        lstSelectList.selectedIndex = intIndex;
        
        break;
      }
    }
  }
  catch( expError )
  {
        alert( "ClientUtilities1.js::SelectOptionInList( ).\n" +
                    "Error:" + expError.number + ", " + expError.description );
  }
} 






function f_clientWidth()
{
  return f_filterResults(
		window.innerWidth ? window.innerWidth : 0,
		document.documentElement ? document.documentElement.clientWidth : 0,
		document.body ? document.body.clientWidth : 0
	);
}

function f_clientHeight()
{
  return f_filterResults(
		window.innerHeight ? window.innerHeight : 0,
		document.documentElement ? document.documentElement.clientHeight : 0,
		document.body ? document.body.clientHeight : 0
	);
}

function f_scrollLeft()
{
  return f_filterResults(
		window.pageXOffset ? window.pageXOffset : 0,
		document.documentElement ? document.documentElement.scrollLeft : 0,
		document.body ? document.body.scrollLeft : 0
	);
}

function f_scrollTop()
{
  return f_filterResults(
		window.pageYOffset ? window.pageYOffset : 0,
		document.documentElement ? document.documentElement.scrollTop : 0,
		document.body ? document.body.scrollTop : 0
	);
}

function f_filterResults(n_win, n_docel, n_body)
{
  var n_result = n_win ? n_win : 0;
  if (n_docel && (!n_result || (n_result > n_docel)))
    n_result = n_docel;
  return n_body && (!n_result || (n_result > n_body)) ? n_body : n_result;
}

function getElementPosition(element)
{
  var offsetTrail = element;
  var offsetLeft = 0;
  var offsetTop = 0;
  while (offsetTrail)
  {
    offsetLeft += offsetTrail.offsetLeft;
    offsetTop += offsetTrail.offsetTop;
    offsetTrail = offsetTrail.offsetParent;
  }
  if (navigator.userAgent.indexOf('Mac') != -1 && typeof document.body.leftMargin != 'undefined')
  {
    offsetLeft += document.body.leftMargin;
    offsetTop += document.body.topMargin;
  }
  return { left: offsetLeft, top: offsetTop };
}

function SubmitFormWithWait(waitMessage, formname, bCanSubmit) 
{
  if (bCanSubmit) 
  {
    bCanSubmit = false;
    window.document.getElementById('btnOK').disabled = true;
    window.document.getElementById('btnCancel').disabled = true;
    $("div.loadingIcon").html(waitMessage);
    window.document.body.style.cursor = "wait";
    menuOn('loading');
    formname.submit();
  }
}


function getSubCookie(key, subkey)
{
  var dc = document.cookie;
  var prefix = key + "=";
  var begin = dc.indexOf("; " + prefix);
  if (begin == -1)
  {
    begin = dc.indexOf(prefix);
    if (begin != 0) return null;
  }
  else
  {
    begin += 2;
  }
  var end = dc.indexOf(";", begin);
  if (end == -1) end = dc.length;
  dc = dc.substring(begin + prefix.length, end);

  prefix = subkey + "=";
  begin = dc.indexOf("&" + prefix);
  if (begin == -1)
  {
    begin = dc.indexOf(prefix);
    if (begin != 0) return null;
  }
  else
  {
    begin += 1;
  }
  var end = dc.indexOf("&", begin);
  if (end == -1) end = dc.length;

  return unescape(dc.substring(begin + prefix.length, end));
}

function imagePath()
{
  var colorStyle;
  
  
  colorStyle = 'pvcorporate';
 return  '../images/' + colorStyle + '/';
}

function cssPath()
{
  var colorStyle;
  
  
  colorStyle = "pvcorporate";
  return  '../css/' + colorStyle + '/';
}

function image(name, attrib)
{
  if (attrib == null) attrib = "";
  document.write('<img src="' + imagePath + name + '" ' + attrib + ' \>');
}

function preventRepeatClickOfSaveAndCancel() {
  var arrSaveButtons = document.getElementsByName("Save");
  for (var i = 0; i < arrSaveButtons.length; i++)
  {
    arrSaveButtons[i].disable = true;
  }

  var arrCancelButtons = document.getElementsByName("Cancel");
  
  for (var i = 0; i < arrCancelButtons.length; i++)
  {
    arrCancelButtons[i].disable = true;
  }
}

function setFormFieldToRequired(strId, fIsRequired)
{
  var elem = document.getElementById(strId);
  
  if (!isNullOrUndefined(elem))
  {
    if (fIsRequired) {
      elem.className = "formlabelsrequired";
    }
    else {
      elem.className = "formlabels";
    }
  }
}

Planview.RegisterNamespace("Planview.ResourceManager");

Planview.ResourceManager.ResourceCache = Planview.ResourceManager.ResourceCache || {};

Planview.ResourceManager.GetString = function(id) {
  var result = undefined;
  var parts = id.split('.');
  if (parts.length == 2) {
    var module = parts[0];
    var resource = parts[1].toLowerCase();
    var language = GetValidBrowserLanguage(window.pvBannerLanguage);
    var key = module + "." + language;
    if (Planview.ResourceManager.ResourceCache[key] != undefined) {
      result = Planview.ResourceManager.ResourceCache[key][resource];
      if (result == undefined && language != "en") {
        result = Planview.ResourceManager.ResourceCache[module + "." + "en"][resource];
      }
    }
  }
  if (typeof result === 'undefined') {
    result = "[" + id + "]";
  } else {
    if (arguments.length > 1) {
      for (var i = 1; i < arguments.length; i++) {
        result = Planview.globalReplace(result, '!' + i + '!', Planview.hasValue(arguments[i]) ? arguments[i].toString() : '');
      }
    }
  }

  return result;
};

Planview.ResourceManager.CacheResources = function(key, language, resources) {
  var cacheKey = key + "." + language;
  Planview.ResourceManager.ResourceCache[cacheKey] = resources;
};

function PVResourceManagerGetString(text) 
{
  return Planview.ResourceManager.GetString(text);
}

function ChangeQueryStringValue(action, qsname, qsvalue)
{
  qsvalue = escape(qsvalue);
  if (action.indexOf('?') == -1)
    return (action + "?" + qsname + "=" + qsvalue);
  else
  {
    if ((action.indexOf("?" + qsname + "=") == -1) && (action.indexOf("&" + qsname + "=") == -1))
    {
      return (action + "&" + qsname + "=" + qsvalue);
    }
    else
    {
      var replaceQSPrefix = (action.indexOf("?" + qsname + "=") == -1) ? "&" + qsname + "=" : "?" + qsname + "=";
      var replaceQSSuffix = "";
      startpos = action.indexOf(replaceQSPrefix);

      for (a = (startpos + replaceQSPrefix.length); a < action.length; a++)
      {
        if (action.charAt(a) == '&')
          break;
        else
          replaceQSSuffix += action.charAt(a);
      }
      newaction = action.replace(replaceQSPrefix + replaceQSSuffix, replaceQSPrefix + qsvalue);
      return newaction;
    }
  }
}

function GetValidBrowserLanguage(lang)
{
  var validLanguages = "*en*de*fr*it*es*ja*pt*ru*zu*";
  var english = "en";
  return validLanguages.toString().indexOf(lang) > 0 ? lang : english;
}

var pvc = Planview.RegisterNamespace("Planview.Core");
var PVCM = Planview.ConnectionManager;
var serviceHelper = {
  isAutoDialogShowing: false,
  onAutoLoggedOut: function () {
    try {
      if (!serviceHelper.isAutoDialogShowing) {
        serviceHelper.isAutoDialogShowing = true;
        var dialogType = pvc.StandardDialogType.Information;
        var message = Planview.ResourceManager.GetString('Common.AutoLoggedOut');

        var dialog = pvc.TheDialogFactory().make({
          title: "",
          dialogType: dialogType,
          content: message,
          showSuppressDialogOption: false
        });

        dialog.on('standarddialogonfinish', function() {
          window.location.reload(true);
        });
      }
    } catch (ex) {
      window.location.reload(true);
    }
  },
  jsonServiceProxy: function(serviceUrl) {
    var _I = this;
    this.serviceUrl = serviceUrl;

    







    
    Planview.ajaxCallCount = 0;
    this.invoke = function(method, data, callback, errorHandler, runAsync, bare, actionType, dataType) {
      var json,
          url;
      
      json = JSON.stringify(data);
      
      url = _I.serviceUrl + method;
      if (Planview
       && Planview.Page
       && Planview.Page.PortfolioView
       && Planview.Page.PortfolioView.pageParameters
       && Planview.Page.PortfolioView.pageParameters.portalType) {
        url += '?pt=' + Planview.Page.PortfolioView.pageParameters.portalType;
      }

      function isAutoLoggedOut(responseText) {
        return (typeof responseText === "string") && responseText.indexOf("User context does not exist.") !== -1;
      }

      var doAsync = typeof runAsync === 'undefined' ? true : runAsync;
      var dtype = dataType === undefined ? "text" : dataType;
      var actType = actionType === undefined ? "POST" : actionType;
      ++Planview.ajaxCallCount;
      
      $.ajax({
        url: url,
        data: json,
        type: actType,
        processData: false,
        contentType: "application/json",
        timeout: 1000000,

        async: doAsync,

        dataType: dtype,  
        success: function(res) {
          var result,
              property;
          --Planview.ajaxCallCount;

          if (!callback) return;

          
          if (dtype == "text") {
            result = res.length > 0 ? JSON.parse(res) : res;
          } else {
            result = res;
          }

          
          if (bare) {
            callback(result);
            return;
          }

          
          
          for (property in result) {
            callback(result[property]);
            break;
          }
        },

        error: function(xhr) {
          --Planview.ajaxCallCount;
          var err = {};

          if (isAutoLoggedOut(xhr.responseText) && serviceHelper.onAutoLoggedOut) {
            serviceHelper.onAutoLoggedOut();
            return;
          }

          if (!errorHandler) return;
          if (typeof errorHandler != "function") {
            Planview.console.log((typeof errorHandler == "string" ? errorHandler : "") + " " + xhr.responseText);
            return;
          }
          ;

          if (xhr.responseText) {
            try {
              err = JSON.parse(xhr.responseText);
            } catch(exception) {
              err = xhr.responseText;
            }
          } else {
            err["responseText"] = undefined;
          }

          if (xhr.statusText) {
            err["errorCode"] = xhr.status;
            err["errorText"] = xhr.statusText;
          }

          if (err == {} || err == undefined) {
            errorHandler({ Message: "Unknown server error." });
          } else {
            errorHandler(err);
          }

          return;
        }
      });
    };
  }
};

function htmlEncode(str) {
  str = str || '';
  return String(str)
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function HtmlEncodeAllowRichText(str) {
  
  

  
  
  
  
  
  
  
  
  
  
  

  str = str || '';
  
  
  var precoded = String(str)
  .replace(/\\\\'/gi, "'")
  .replace(/&lt;/gi, "<")
  .replace(/&gt;/gi, ">");

  
  var encoded = htmlEncode(precoded);

  
  encoded = encoded.replace(/&lt;(BR\s*\/?)&gt;/gi, "<$1>");

  
  encoded = encoded.replace(/&lt;(\/?(B|EM|I|SMALL|STRONG|SUB|SUP|INS|DEL|MARK)\s*)&gt;/gi, "<$1>");

  
  encoded = encoded.replace(/&amp;(NBSP|AMP|QUOT|APOS|BULL|COPY|PRIME|UARR|DARR|LARR|RARR|#[0-9]+);/gi, "&$1;");

  
  
  
  
  encoded = encoded.replace(/&lt;(FONT\s+(COLOR|CLASS)\s*=\s*([a-z]+)\s*|\/FONT\s*)&gt;/gi, "<$1>");
  
  
  
  
  encoded = encoded.replace(/&lt;(FONT\s+)(COLOR|CLASS)(\s*=\s*&#39;)([a-z]+)(&#39;\s*)&gt;/gi, "<$1$2='$4'>");
  
  
  
  
  
  
  
  return encoded;
}

function HtmlEncodeAllowSlickGridData(str) {

  var encoded = str;

  if (typeof str == 'string') {
    if (str.match(/[<>\'\";]/gi)) {
    
    
    encoded = HtmlEncodeAllowRichText(str);

    
    encoded = encoded.replace(/&lt;(SPAN\s+|DIV\s+)(COLOR|CLASS)(\s*=\s*\")([a-z(\s*=\s*)]+)(\"\s*)&gt;/gi, "<$1$2='$4'>");

    
    encoded = encoded.replace(/{\s*\&quot;URL\&quot;:\s*\&quot;([a-z0-9-._~:/?#\[\]\@\!\$\&\'\(\)\*\+\,\;\=]*)\&quot;,\s*\&quot;Content\&quot;:\s*\&quot;([0-9]*)\&quot;\s*,\s*\&quot;JsMethod\&quot;:\s*\&quot;([0-9a-z_-]*)\&quot;\s*,\s*&quot;IconPath\&quot;:\s*\&quot;([a-z0-9-._~:\/?#\[\]\@\!\$\&\'\(\)\*\+\,\;\=]*)\&quot;\s*}/gi, "{\"URL\": \"$1\", \"Content\": \"$2\", \"JsMethod\": \"$3\", \"IconPath\": \"$4\"} ");
      
    
    }
  }

return encoded;
}

function htmlUnEncode(str) {
  str = str || '';
  return String(str)
    .replace(/&quot;/g, '"')
    .replace(/&#39;/g, "'")
    .replace(/&lt;/g, '<')
    .replace(/&gt;/g, '>')
    .replace(/&amp;/g, '&');
}

function convertLineFeeds(str) {
  str = str || '';
  return String(str).replace(/(\\n)|(\/n)/g, String.fromCharCode(10));
}

Planview.RegisterNamespace("Planview.Session");

Planview.Session.bounceIfIdleTimeout = function() {
  if (g_SesTimOut > 0) {
    var active = getCookie("jssActiveCert");
    if (active == null || active == "") {
      window.LocationReplace(g_strAppPath + "/Login/HasTimedOut.asp");
    }
  }
};

Planview.Session.monitorForIdleTimeout = function () {
  try {
    if (g_SesTimOut>0) {
      if (getCookie("jssActiveCert") != null) {
        setInterval(Planview.Session.bounceIfIdleTimeout, 30000);

        Planview.Session.lastTouchtime = Date.now;
      }
      else {
        
      }
    }
  }
  catch (e) {
      alert("BROKEN!!!! " + location.href + " has no g_SesTimOut");
  }
};

Planview.Session.monitorForIdleTimeout();

















Planview.console = function () {
  



  var canUseEnhancedLogging = function() {
    return !PVBrowserInfo.IsIE;
  }();

  



  var group = function () {
    console.group.apply(console, arguments);
  };

  



  var groupCollapsed = function () {
    console.groupCollapsed.apply(console, arguments);
  };

  



  var groupEnd = function () {
    console.groupEnd.apply(console, arguments);
  };

  



  var error = function() {
    console.error.apply(console, arguments);
  };
  
  



  var log = function(message) {
    console.log(message);
  };

  




  var devNull = function() {
  };

  
  var that = {};
  that.group = (canUseEnhancedLogging) ? group : devNull;
  that.groupCollapsed = (canUseEnhancedLogging) ? groupCollapsed : devNull;
  that.groupEnd = (canUseEnhancedLogging) ? groupEnd : devNull;
  that.error = (canUseEnhancedLogging) ? error : devNull;
  that.log = log;
  
  return that;
}(); 

Planview.ControlChar = {
  NUL: { hex: 0x00, regex: '\\x00' },
  SOH: { hex: 0x01, regex: '\\x01' },
  STX: { hex: 0x02, regex: '\\x02' },
  ETX: { hex: 0x03, regex: '\\x03' },
  EOT: { hex: 0x04, regex: '\\x04' },
  ENQ: { hex: 0x05, regex: '\\x05' },
  ACK: { hex: 0x06, regex: '\\x06' },
  BEL: { hex: 0x07, regex: '\\x07' },
  BS: { hex: 0x08, regex: '\\x08' },
  TAB: { hex: 0x09, regex: '\\x09' },
  LF: { hex: 0x0a, regex: '\\x0a' },
  VT: { hex: 0x0b, regex: '\\x0b' },
  FF: { hex: 0x0c, regex: '\\x0c' },
  CR: { hex: 0x0d, regex: '\\x0d' },
  SO: { hex: 0x0e, regex: '\\x0e' },
  SI: { hex: 0x0f, regex: '\\x0f' },
  DLE: { hex: 0x10, regex: '\\x10' },
  DC1: { hex: 0x11, regex: '\\x11' },
  DC2: { hex: 0x12, regex: '\\x12' },
  DC3: { hex: 0x13, regex: '\\x13' },
  DC4: { hex: 0x14, regex: '\\x14' },
  NAK: { hex: 0x15, regex: '\\x15' },
  SYN: { hex: 0x16, regex: '\\x16' },
  ETB: { hex: 0x17, regex: '\\x17' },
  CAN: { hex: 0x18, regex: '\\x18' },
  EM: { hex: 0x19, regex: '\\x19' },
  SUB: { hex: 0x1a, regex: '\\x1a' },
  ESC: { hex: 0x1b, regex: '\\x1b' },
  FS: { hex: 0x1c, regex: '\\x1c' },
  GS: { hex: 0x1d, regex: '\\x1d' },
  RS: { hex: 0x1e, regex: '\\x1e' },
  US: { hex: 0x1f, regex: '\\x1f' }
};

Planview.AllControlChars = [
    Planview.ControlChar.NUL,
    Planview.ControlChar.SOH,
    Planview.ControlChar.STX,
    Planview.ControlChar.ETX,
    Planview.ControlChar.EOT,
    Planview.ControlChar.ENQ,
    Planview.ControlChar.ACK,
    Planview.ControlChar.BEL,
    Planview.ControlChar.BS,
    Planview.ControlChar.TAB,
    Planview.ControlChar.LF,
    Planview.ControlChar.VT,
    Planview.ControlChar.FF,
    Planview.ControlChar.CR,
    Planview.ControlChar.SO,
    Planview.ControlChar.SI,
    Planview.ControlChar.DLE,
    Planview.ControlChar.DC1,
    Planview.ControlChar.DC2,
    Planview.ControlChar.DC3,
    Planview.ControlChar.DC4,
    Planview.ControlChar.NAK,
    Planview.ControlChar.SYN,
    Planview.ControlChar.ETB,
    Planview.ControlChar.CAN,
    Planview.ControlChar.EM,
    Planview.ControlChar.SUB,
    Planview.ControlChar.ESC,
    Planview.ControlChar.FS,
    Planview.ControlChar.GS,
    Planview.ControlChar.RS,
    Planview.ControlChar.US
];




Planview.getControlCharRegExp = function (toKeep) {
  var toStrip = _.difference(Planview.AllControlChars, toKeep);

  var exp = '';
  $.each(toStrip, function (i, v) {
    exp += v.regex;
  });
  exp = '[' + exp + ']';

  var regExp = new RegExp(exp, 'g');

  return regExp;
};

Planview.NameHelper = {
  parseName: function (name) {
    var nameArray, lastName, firstName, breakUpCSN;

    breakUpCSN = function (name) {
      var nameArray, count, counter, newName;

      nameArray = name.split(",");
      newName = "";
      count = nameArray.length;
      for (counter = count; counter > 0; counter--) {
        newName += nameArray[counter - 1].trim();
        if (counter > 1) { newName += " " };
      }

      return newName;
    }

    if (name.indexOf(",") > 0) {
      name = breakUpCSN(name);
    }

    nameArray = name.split(" ");
    firstName = nameArray[0];
    lastName = nameArray.length > 1 ? nameArray[1] : "";

    return {
      firstName: firstName,
      lastName: lastName,
      firstInitial: firstName.substring(0, 1).toUpperCase(),
      lastInitial: lastName.substring(0, 1).toUpperCase()
    }
  }
};

Planview.getBoundedValue = function(value, min, max) {
  return Math.max(min, Math.min(max, value));
};


(function ($, undefined) {
  
  'use strict';

  Planview.ImageCache = function () {
    var imageCache = Planview.imageCache || {};

    var containsSubCache = function (subCacheId) {
      var hasSubCache = Planview.hasValue(imageCache[subCacheId]);
      return hasSubCache;
    };

    var addImagesBySubCache = function (subCacheId, imageObjects)
    {
      imageCache[subCacheId] = imageObjects;
    };

    var addImage = function (subCacheId, imageObject) {
      imageCache[subCacheId] = imageObject;
    };
    
    var getImagesBySubCache = function (subCacheId)
    {
      return imageCache[subCacheId];
    };

    var getImage = function(subCacheId, imageId) {
      var requestedImageObject;
      if (!Planview.hasValue(imageCache[subCacheId])) {
        return undefined;
      }

      $.each(imageCache[subCacheId], function(i, imageObject) {
        if (imageObject.Id === imageId) {
          requestedImageObject = imageObject;
          return false;
        }
        return true;
      });

      return requestedImageObject;
    };

    var that =  {};
    that.addImagesBySubCache = addImagesBySubCache;
    that.getImagesBySubCache = getImagesBySubCache;
    that.addImage = addImage;
    that.getImage = getImage;
    that.containsSubCache = containsSubCache;

    var my = {};
    my.imageCache = {};
    my.imageCache = imageCache;

    return that;
  }(); 


})(jQuery);


































































































































































if (!this.JSON) {
    this.JSON = {};
}

(function () {

    function f(n) {
        
        return n < 10 ? '0' + n : n;
    }

    if (typeof Date.prototype.toJSON !== 'function') {

        Date.prototype.toJSON = function (key) {

            return isFinite(this.valueOf()) ?
                   this.getUTCFullYear()   + '-' +
                 f(this.getUTCMonth() + 1) + '-' +
                 f(this.getUTCDate())      + 'T' +
                 f(this.getUTCHours())     + ':' +
                 f(this.getUTCMinutes())   + ':' +
                 f(this.getUTCSeconds())   + 'Z' : null;
        };

        String.prototype.toJSON =
        Number.prototype.toJSON =
        Boolean.prototype.toJSON = function (key) {
            return this.valueOf();
        };
    }

    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap,
        indent,
        meta = {    
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"' : '\\"',
            '\\': '\\\\'
        },
        rep;


    function quote(string) {






        escapable.lastIndex = 0;
        return escapable.test(string) ?
            '"' + string.replace(escapable, function (a) {
                var c = meta[a];
                return typeof c === 'string' ? c :
                    '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
            }) + '"' :
            '"' + string + '"';
    }


    function str(key, holder) {



        var i,          
            k,          
            v,          
            length,
            mind = gap,
            partial,
            value = holder[key];



        if (value && typeof value === 'object' &&
                typeof value.toJSON === 'function') {
            value = value.toJSON(key);
        }




        if (typeof rep === 'function') {
            value = rep.call(holder, key, value);
        }



        switch (typeof value) {
        case 'string':
            return quote(value);

        case 'number':



            return isFinite(value) ? String(value) : 'null';

        case 'boolean':
        case 'null':





            return String(value);




        case 'object':




            if (!value) {
                return 'null';
            }



            gap += indent;
            partial = [];



            if (Object.prototype.toString.apply(value) === '[object Array]') {




                length = value.length;
                for (i = 0; i < length; i += 1) {
                    partial[i] = str(i, value) || 'null';
                }




                v = partial.length === 0 ? '[]' :
                    gap ? '[\n' + gap +
                            partial.join(',\n' + gap) + '\n' +
                                mind + ']' :
                          '[' + partial.join(',') + ']';
                gap = mind;
                return v;
            }



            if (rep && typeof rep === 'object') {
                length = rep.length;
                for (i = 0; i < length; i += 1) {
                    k = rep[i];
                    if (typeof k === 'string') {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            } else {



                for (k in value) {
                    if (Object.hasOwnProperty.call(value, k)) {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            }




            v = partial.length === 0 ? '{}' :
                gap ? '{\n' + gap + partial.join(',\n' + gap) + '\n' +
                        mind + '}' : '{' + partial.join(',') + '}';
            gap = mind;
            return v;
        }
    }



    if (typeof JSON.stringify !== 'function') {
        JSON.stringify = function (value, replacer, space) {







            var i;
            gap = '';
            indent = '';




            if (typeof space === 'number') {
                for (i = 0; i < space; i += 1) {
                    indent += ' ';
                }



            } else if (typeof space === 'string') {
                indent = space;
            }




            rep = replacer;
            if (replacer && typeof replacer !== 'function' &&
                    (typeof replacer !== 'object' ||
                     typeof replacer.length !== 'number')) {
                throw new Error('JSON.stringify');
            }




            return str('', {'': value});
        };
    }




    if (typeof JSON.parse !== 'function') {
        JSON.parse = function (text, reviver) {




            var j;

            function walk(holder, key) {




                var k, v, value = holder[key];
                if (value && typeof value === 'object') {
                    for (k in value) {
                        if (Object.hasOwnProperty.call(value, k)) {
                            v = walk(value, k);
                            if (v !== undefined) {
                                value[k] = v;
                            } else {
                                delete value[k];
                            }
                        }
                    }
                }
                return reviver.call(holder, key, value);
            }






            cx.lastIndex = 0;
            if (cx.test(text)) {
                text = text.replace(cx, function (a) {
                    return '\\u' +
                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }














            if (/^[\],:{}\s]*$/.
test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@').
replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').
replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {






                j = eval('(' + text + ')');




                return typeof reviver === 'function' ?
                    walk({'': j}, '') : j;
            }



            throw new SyntaxError('JSON.parse');
        };
    }
}());

var current_menu_name = "";
var pvFrameId = undefined;
var click_menus = new Object();
function menuOn(menu_name, iframeId)
{
    if (PVBrowserInfo.IsIE) {
        pvFrameId = iframeId;
    }
    
  menuOn2(menu_name, null, iframeId);
}



function menuOn2(menu_name, baseElementId)
{
  menusOff();
  if (current_menu_name != "")
  {
    menuOff(current_menu_name);
  }
  if (!click_menus[menu_name]) click_menus[menu_name] = menu_name;
  current_menu_name = menu_name;
  var menu;
  var pvIFrame = (typeof (pvFrameId) != "undefined") ? document.frames[pvFrameId] : "";
  if (pvIFrame) {
    menu = pvIFrame.document.getElementById(menu_name);
  } else {
    menu = document.getElementById(menu_name);
  }
  

  if (menu)
  {
    menu.style.display = "block";
    menu.style.visibility = "visible";
    var baseElement = null;
    if (baseElementId != null)
    {
      baseElement = $("#" + baseElementId);
      if (null != baseElement)
      {
        var basePosition = baseElement.position();
        var top = basePosition.top + (baseElement.height() / 2);
        var left = basePosition.left + (baseElement.width() / 2);
        if (left + $(menu).width() > $(window).width()) left = $(window).width() - $(menu).width();

        menu.style.top = top + "px";
        menu.style.left = left + "px";
      }
    }


    var nodeCounter = 0;
    var node;
    for (nodeCounter; nodeCounter < menu.childNodes.length; nodeCounter++)
    {
      node = menu.childNodes[nodeCounter];
      if (node.className == "dropDownLinkTable")
      {
        try
        {
          setFocusAttribsOnTable(node, menu_name);
        }
        catch (err)
        {
        }
      }
    }
  }
}



var g_pvMenuItemHasFocus = false;

function setFocusAttribsOnTable(menuTable, pvMenuId)
{ 
  var tr;
  var trCounter = 0;
  var cell;
  var cellChild;
  var firstAnchor = true;

  var tableElement;
  var tableCounter = 0;

  var tbody = getTBody(menuTable);

  if(tbody)
  {
    for(trCounter; trCounter < tbody.childNodes.length; trCounter++)
    {
      tr = tbody.childNodes[trCounter];
    
      if(tr.tagName && tr.tagName.toUpperCase() == "TR")
      {
        cellCounter = 0;
        for(cellCounter; cellCounter < tr.childNodes.length; cellCounter++)
        {
          cell = tr.childNodes[cellCounter];
          var counter = 0;
          for(counter; counter < cell.childNodes.length; counter++)
          {
            cellChild = cell.childNodes[counter];
            if(cellChild.tagName)
            {
              if(cellChild.tagName.toUpperCase() == "A")
              {
                if(firstAnchor)
                {
                  cellChild.focus();
                  firstAnchor = false;              
                }
                setFocuAttribsOnAnchor(cellChild, pvMenuId)
              }
            }      
          }      
        }    
      }  
    }
  }
}

function getTBody(tableElement)
{
  var tbody = null;
  for(counter = 0; counter < tableElement.childNodes.length; counter++)
  {
    node = tableElement.childNodes[counter];
    if(node.tagName && node.tagName.toUpperCase() == "TBODY")
    {
      tbody = node;
      break
    }  
  }

  return tbody;
}

function containsTR(element)
{
  var counter = 0;
  var node;
  var containsTR = false;
  for(counter; counter < element.childNodes.length; counter++)
  {
    node = element.childNodes[counter];
    if(node.tagName && node.tagName.toUpperCase() == "TR")
    {
      containsTR = true;
    }
  }
  
  return containsTR;
}

function setFocuAttribsOnAnchor(anchor, pvMenuId)
{
  var blurSet = anchor.getAttribute("blurSet") == "1";
  if(!blurSet)
  {  
    var oldFocus;
    var oldBlur;

    if(anchor.attachEvent)
    { 
      anchor.attachEvent("onfocus", pvMenuAnchorFocus);
      anchor.attachEvent("onblur", pvMenuAnchorBlur);
    }
    else
    {
      if(anchor.addEventListener)
      {
      anchor.addEventListener("focus", pvMenuAnchorFocus, false);
      anchor.addEventListener("blur", pvMenuAnchorBlur, false);
      }
      else
      {
        oldFocus = anchor.onfocus;
        oldBlur = anchor.onblur;
        
        if(typeof(anchor.onfocus != 'function'))
        {
          anchor.onfocus = pvMenuAnchorFocus;
        }
        else
        {
          anchor.onfocus = function(){oldFocus();pvMenuAnchorFocus();}
        }
        
        if(typeof(oldblur != 'function'))
        {
          anchor.onblur = pvMenuAnchorFocus;        
        }
        else
        {
          anchor.onblur = function(){oldBlur();pvMenuAnchoBlur();}
        }        
      }
    }
    
    anchor.setAttribute("blurSet", "1");
    anchor.setAttribute("pvMenuId", pvMenuId);
  }
}


function pvMenuAnchorFocus()
{
  g_pvMenuItemHasFocus = true;
}

function pvMenuAnchorBlur(e)
{
  g_pvMenuItemHasFocus = false;
  var pvMenuId;
  if(e.originalTarget)
  {
    pvMenuId = e.originalTarget.getAttribute("pvMenuId");
  }
  else
  {
    if(e.srcElement)
    {
      pvMenuId = e.srcElement.getAttribute("pvMenuId");
    }
  }
  if(pvMenuId) {
    
    setTimeout("losePVMenu('" + pvMenuId + "');", 500);
  }
}

function losePVMenu(pvMenuId)
{
  if(!g_pvMenuItemHasFocus)
  {
    menuOff(pvMenuId);
  }
}

function menusOff()
{
  for(var menuId in click_menus)
  {
    menuOff(click_menus[menuId]);
  }
}

function menuOff(menu_name) 
{
  var menu;
  var pvIFrame = (typeof (pvFrameId) != "undefined") ? document.frames[pvFrameId] : "";
  if (pvIFrame) {
    menu = pvIFrame.document.getElementById(menu_name);
  } else {
    menu = document.getElementById(menu_name);
  }

  if (menu) {
    menu.style.display = "none";
    menu.style.visibility = "hidden";
  }
  current_menu_name="";
}

function CurrentMenuOff() {
  if (current_menu_name!="") {
    menuOff(current_menu_name);
  }
}

function closeLoading() { menuOff('loading'); }

var myClientHeight = (document.documentElement)?document.documentElement.clientHeight:document.body.clientHeight;
var myClientWidth = (document.documentElement)?document.documentElement.clientWidth:document.body.clientWidth;
var prevPos; 
var flyoutTimer;
var g_aMarkForClosingExceptions = null;
var g_awinPVChildWin = new Array();
var g_awinExceptionWindows = new Array();

var g_winId = Date.now() + Math.floor((Math.random() * 100) + 1);
var isIE = (navigator.appName.toLowerCase().indexOf('netscape') == -1);


function WinInfo(strName, win, bReload) {
  this.m_strName = strName;
  this.m_win = win;
  this.m_bReload = bReload;
}

function ClientViewPortInfo(height, width) {
  this.height = height;
  this.width = width;
}


(function () {
  g_aMarkForClosingExceptions = new Array();
  g_aMarkForClosingExceptions[0] = "customizationoptions.asp";
  g_aMarkForClosingExceptions[1] = "projectresourcerates.aspx";
  g_aMarkForClosingExceptions[2] = "pvdispatcher.aspx";
  g_aMarkForClosingExceptions[3] = "pvdshdispatcher.aspx";
  g_aMarkForClosingExceptions[4] = "brandimpactalignment.aspx";
  g_aMarkForClosingExceptions[5] = "projectresourcemgmt.aspx";
  g_awinPVChildWin = new Array();
})();

function UrlIsMarkForClosingException(strUrl) {
  var isException = false;
  var lcUrl = strUrl.toLowerCase();
  for (var index = 0; index < g_aMarkForClosingExceptions.length; index++) {
    if (lcUrl.indexOf(g_aMarkForClosingExceptions[index]) > -1) isException = true;
  }
  return isException;
}

function IncrementAndGetWindowCount() {
  var itemKey, tmpCount;
  itemKey = "childWindowCounter";

  tmpCount = Planview.ClientStorage.getSessionItem(itemKey);
  if(!tmpCount) {
    tmpCount = 0;
  }

  tmpCount++;
  
  Planview.ClientStorage.setSessionItem(itemKey, tmpCount, true);
  return tmpCount;
}

function MarkChildWindowForClosing(name, win, bReload, strUrl) {
  if (!Planview.hasValue(strUrl) || !UrlIsMarkForClosingException(strUrl)) {
    g_awinPVChildWin[g_awinPVChildWin.length] = new WinInfo(name, win, bReload);
  }
  else {
    if ((window.location.href).indexOf("HomeView/logoff.asp") > 0) {
      
      
      
      win.close();
    }
    else {
      g_awinExceptionWindows[g_awinExceptionWindows.length] = new WinInfo(name, win, bReload);
    }
  }
  return true;
}

function OpenChildWindow(strURL, strName, nWidth, nHeight, nLeft, nTop, bResize, bScrollbars, bReload, bReturnWinObject) {
  var resizeOption;
  bScrollbars = (bScrollbars !== false) ? true : false;
  if ((!strName) || (strName == "")) strName = "PVChildWin_" + IncrementAndGetWindowCount();
  else strName = "PVChildWin_" + strName;

  var viewPortInfo = GetViewPortInfo();
  var htmlHeight = viewPortInfo.height;
  var winRef = undefined;

  if (isIE) 
  {
    htmlHeight = htmlHeight + 18;
  }

  var htmlWidth = viewPortInfo.width;

  if (nWidth == -1 || NullOrUndefined(nWidth)) nWidth = Math.round(9.2 * htmlWidth / 10);
  if (nHeight == -1 || NullOrUndefined(nHeight)) nHeight = Math.round(9.2 * htmlHeight / 10);


  if (nWidth > htmlWidth) {
    nWidth = htmlWidth;
    bScrollbars = true;
  }

  if (nHeight > htmlHeight) {
    nHeight = htmlHeight;
    bScrollbars = true;
  }

  if (bScrollbars && nWidth == 800 && nHeight == 600 && htmlWidth > 800 && htmlHeight > 600) {
    nWidth = Math.round(9.2 * htmlWidth / 10);
    nHeight = Math.round(9.2 * htmlHeight / 10);
  }

  if (nWidth < 0 || NullOrUndefined(nWidth)) nWidth = 800;
  if (nHeight < 0 || NullOrUndefined(nHeight)) nHeight = 600;

  if (nLeft == -1 || NullOrUndefined(nLeft)) {
    var screenWidth = window.screen ? window.screen.availWidth : htmlWidth;
    nLeft = Math.round((screenWidth / 2) - (nWidth / 2));
  }

  if (nTop == -1 || NullOrUndefined(nTop)) {
    var screenHeight = window.screen ? window.screen.availHeight : htmlHeight;
    nTop = Math.round((screenHeight / 2) - (nHeight / 2));
  }

  if (nLeft < 0 || NullOrUndefined(nLeft)) nLeft = 0;
  if (nTop < 0 || NullOrUndefined(nTop)) nTop = 0;


  var strOptions = "width=" + nWidth + ",height=" + nHeight + ",left=" + nLeft + ",top=" + nTop + ",dialog=1,open=0,status=1";
  
  resizeOption = ",resizable=" + (bResize || !Planview.hasValue(bResize) ? "yes" : "no");
  strOptions += resizeOption;
  if (bScrollbars) strOptions += ",scrollbars=yes";


  CloseChildWindow(strName);

  if (strURL.indexOf("popup=") == -1) {
    if (strURL.indexOf("?") >= 0) strURL += "&popup=1";
    else strURL += "?popup=1";
  }

  if (bReload) {
    if (strURL.indexOf("?") >= 0) strURL += "&back=closereload";
    else strURL += "?back=closereload";
  }
  else {
    if (strURL.indexOf("back=close") == -1) {
      if (strURL.indexOf("?") >= 0) strURL += "&back=close";
      else strURL += "?back=close";
    }

  }

  var win = window.open(strURL, strName, strOptions);
  
  if (win) {
    MarkChildWindowForClosing(strName, win, bReload, strURL, false);
    win.focus();
    winRef = ((bReturnWinObject === true) ? win : undefined);
  }

  return winRef;
}

function OpenChildWindow2(strURL, strName, nWidth, nHeight, nLeft, nTop, bResize, bScrollbars, bReload) {
  OpenChildWindow(strURL, strName, nWidth, nHeight, nLeft, nTop, bResize, bScrollbars, bReload, false);
}

function OpenFullWindow(strURL, strName, nWidth, nHeight, nLeft, nTop, bResize, bScrollbars, bReload, bReturnWinObject) {
  var resizeOption;
  if (!isIE) {
    OpenChildWindow(strURL, strName, nWidth, nHeight, nLeft, nTop, bResize, bScrollbars, bReload, bReturnWinObject);
  }
  else {
    if ((!strName) || (strName == "")) strName = "PVChildWin_" + IncrementAndGetWindowCount();
    else strName = "PVChildWin_" + strName;

    var viewPortInfo = GetViewPortInfo();
    var htmlHeight = viewPortInfo.height;

    var htmlWidth = viewPortInfo.width;

    var availHeight = window.screen.availHeight - 40;
    var strOptions = "width=" + (window.screen ? window.screen.availWidth : htmlWidth).toString() + ",height=" + (window.screen ? availHeight : htmlHeight).toString() + ",left=" + 0 + ",top=" + 0;
    resizeOption = ",resizable=" + (bResize || !Planview.hasValue(bResize) ? "yes" : "no");
    strOptions += resizeOption;
    if (bScrollbars) strOptions += ",scrollbars=yes";


    CloseChildWindow(strName);

    if (strURL.indexOf("popup=") == -1) {
      if (strURL.indexOf("?") >= 0) strURL += "&popup=1";
      else strURL += "?popup=1";
    }

    if (bReload) {
      if (strURL.indexOf("?") >= 0) strURL += "&back=closereload";
      else strURL += "?back=closereload";
    }
    else {
      if (strURL.indexOf("?") >= 0) strURL += "&back=close";
      else strURL += "?back=close";
    }

    var win = window.open(strURL, strName, strOptions);
    if (win) 
    {
      MarkChildWindowForClosing(strName, win, bReload, undefined, false);
      win.focus();
      if ((bReturnWinObject != null) && (typeof (bReturnWinObject) != 'undefined') && (bReturnWinObject)) return win;
    }
  }
}


function GetViewPortInfo() {
  var iFrame = location.href != top.location.href;
  var win = iFrame ? window.top : top;
  var height, width;
  height = $(win).height();
  width = $(win).width();

  if (NullOrUndefined(height) || height <= 0) height = window.screen ? window.screen.availHeight : 600;
  if (NullOrUndefined(width) || width <= 0) height = window.screen ? window.screen.availHeight : 800;

  return new ClientViewPortInfo(height, width);
}

function CloseChildWindow(strName) {
  if (!g_awinPVChildWin)
    return;

  if (strName.substr(0, 11) != "PVChildWin_")
    strName = "PVChildWin_" + strName;

  var awinTmp = g_awinPVChildWin;
  g_awinPVChildWin = new Array();
  for (var i = 0; i < awinTmp.length; i++) {
    if (awinTmp[i]) {
      if (awinTmp[i].m_strName == strName) {
        if (awinTmp[i].m_win && (!awinTmp[i].m_win.closed))
          awinTmp[i].m_win.close();
      }
      else
        g_awinPVChildWin[g_awinPVChildWin.length] = awinTmp[i];
    }
  }
}

function CloseAllChildWindows() {
  for (var i = 0; i < g_awinPVChildWin.length; i++) {
    if (g_awinPVChildWin[i] && g_awinPVChildWin[i].m_win && typeof (g_awinPVChildWin[i].m_win.closed) != 'unknown') {
      if (!(g_awinPVChildWin[i].m_win.closed || g_awinPVChildWin[i].m_strName == 'Dashboard')) {
        g_awinPVChildWin[i].m_win.close();
      }
    }
  }
  g_awinPVChildWin = new Array();

  for (var i = 0; i < g_awinExceptionWindows.length; i++) {
    if (g_awinExceptionWindows[i] && g_awinExceptionWindows[i].m_win && typeof (g_awinExceptionWindows[i].m_win.closed) != 'unknown') {
      if (!(g_awinExceptionWindows[i].m_win.closed || g_awinExceptionWindows[i].m_strName == 'Dashboard')) {
        if (window.loggingOff) {
          g_awinExceptionWindows[i].m_win.close();
        }
        else {
          if (g_awinExceptionWindows[i].m_win.PollParentAndRegisterChildWindow) {
            g_awinExceptionWindows[i].m_win.PollParentAndRegisterChildWindow(g_winId);
          }
        }
      }
    }
  }
  g_awinExceptionWindows = new Array();

}

function PollParentAndRegisterChildWindow(parentId) {
  var win = window;
  setTimeout(function () {
    console.log("polling..." + parentId);
    if (!(win.opener && win.opener.g_winId !== parentId && win.opener.MarkChildWindowForClosing && win.opener.MarkChildWindowForClosing(win.name, win, false, win.location.href))) {
      win.PollParentAndRegisterChildWindow(parentId);
    }
  }, 500);
}

function CloseAllChildWindowsExcept(strWindowName) {
  for (var i = 0; i < g_awinPVChildWin.length; i++) {
    if (g_awinPVChildWin[i] &&
            g_awinPVChildWin[i].m_win &&
            (g_awinPVChildWin[i].m_strName != 'PVChildWin_' & strWindowName) &&
            typeof (g_awinPVChildWin[i].m_win.closed) != 'unknown') {
      if (!g_awinPVChildWin[i].m_win.closed) {
        g_awinPVChildWin[i].m_win.close();
      }
    }
  }
  g_awinPVChildWin = new Array();
}


function GetChildWindow(strName) {
  if (!g_awinPVChildWin)
    return null;

  for (var i = 0; i < g_awinPVChildWin.length; i++) {
    if (g_awinPVChildWin[i] && (g_awinPVChildWin[i].m_strName == strName))
      return g_awinPVChildWin[i].m_win;
  }
}

function IsChildWindow() {
  if ((top.name.length > 0) && (top.name.substr(0, 11) == "PVChildWin_"))
    return true;

  return false;
}

function PVChildWindowCloseReload(childName) {
  
  
  setTimeout("PVChildWindowCloseReloadWait('" + childName + "')", 1);
}

function PVChildWindowCloseReloadWait(childName) {
  var childWindow = GetChildWindow(childName);

  if (!childWindow || (childWindow && childWindow.closed)) {
    
    top.LocationReplace(unescape(top.location.href));
  }
}

function UpdateParent(strFieldStrucFlag, strID, strValue) {
  if (!(top.opener == null)) {
    if (top.opener.PVCfg_UpdateElements) {
      var astrUpdateList = new Array();
      astrUpdateList[0] = strFieldStrucFlag + strID + "|" + strValue;
      top.opener.PVCfg_UpdateElements(astrUpdateList);
    }
  }
}


function sizeModalPercentage(nHeightMin, nWidthMin, nHeightPercent, nWidthPercent, doc ) {
  var availableHeight = 0;
  var availableWidth = 0;
    
  if (doc == null) {
      doc = top.document;
  }
  if (doc.body.offsetWidth < top.document.body.scrollWidth) {
      availableWidth = doc.body.offsetWidth;
  }
  else {
      availableWidth = doc.body.scrollWidth;
  }
  if (doc.body.offsetHeight < doc.body.scrollHeight) {
      availableHeight = doc.body.offsetHeight;
  }
  else {
      availableHeight = doc.body.scrollHeight;
  }

  var percentWidth = Math.round(availableWidth * (nWidthPercent / 100));
  if (percentWidth < nWidthMin) {
    percentWidth = nWidthMin;
  }

  var percentHeight = Math.round(availableHeight * (nHeightPercent / 100));
  if (percentHeight < nHeightMin) {
    percentHeight = nHeightMin;
  }

  sizeModal(percentHeight, percentWidth);
}

function HasShield() {
  var oShield = top.document.getElementById('Shield');
  if (oShield) {
    return true;
  }
  return false;
}

function SizePopupMaster(popupDocument) {
    return SizePopupMasterWithHeightOverride(popupDocument, false);
}

function SizePopupMasterWithHeightOverride(popupDocument, overrideHeight) {
  
  var popUpFormElement = popupDocument.getElementById("aspnetForm");

  var parentHeight = parentAvailHeight();
  var popHeight = popUpFormElement.scrollHeight;
  if (popHeight >= parentHeight || overrideHeight) {
    popHeight = Math.round(parentHeight * 0.95);
  }

  sizeModal(popHeight, popupDocument.body.scrollWidth);

  return popHeight;
}

function parentAvailHeight() {
  if (top.document.body.offsetHeight > top.document.body.scrollHeight) {
    return top.document.body.offsetHeight;
  }

  return top.document.body.scrollHeight;
}

function sizeModal(nHeight, nWidth) {
  var modal;
  
  try {
    var pvIFrame = (typeof (iframeId) != "undefined") ? top.document.getElementById(iframeId) : "";
    if (pvIFrame) {
      var frameWindow = top.frames[iframeId].window;
      if (!frameWindow) {
        frameWindow = top.frames[iframeId].contentWindow;
      }
      modal = frameWindow.frames['modal'].frameElement;
    } else {
      modal = top.frames['modal'].frameElement;
    }

  } catch (ex) {
    return;
  }
  if (!modal) return;

  var oShield;
  if (pvIFrame) {
    oShield = pvIFrame.contentWindow.document.getElementById('Shield');
  }
  else {
    oShield = top.document.getElementById('Shield');
    if (!oShield) return;
  }

  if (top.document.body.offsetWidth > top.document.body.scrollWidth) {
    oShield.style.width = top.document.body.offsetWidth + "px";
  }
  else {
    oShield.style.width = top.document.body.scrollWidth + "px";
  }
  if (top.document.body.offsetHeight > top.document.body.scrollHeight) {
    oShield.style.height = top.document.body.offsetHeight + "px";
  }
  else {
    oShield.style.height = top.document.body.scrollHeight + "px";
  }

  if ((nHeight == null) || (nWidth == null) || (nHeight == 0) || (nWidth == 0)) {
    if (0 < modal.clientHeight) {
      nHeight = modal.clientHeight;
    }
    else {
      nHeight = 425;
    }
    if (0 < modal.clientWidth) {
      nWidth = modal.clientWidth;
    }
    else {
      nWidth = 600;
    }
  }
  modal.style.height = nHeight + 'px';
  modal.style.width = nWidth + 'px';
  var leftPos = ((top.document.body.offsetWidth - nWidth) / 2);
  var topPos = ((top.document.body.offsetHeight - nHeight) / 2);
  if (topPos < 0) {
    topPos = 0;
  }
  if (leftPos < 0) {
    leftPos = 0;
  }
  if ((topPos >= 0) && (leftPos >= 0)) {
    modal.style.top = topPos + 'px';
    modal.style.left = leftPos + 'px';
  }
}

function ChildOrRedirect(url) {
  if (IsChildWindow()) {
    if (top.location.href.indexOf("popup=1") >= 0) {
      url += "&popup=1";
    }
    if (top.location.href.indexOf("back=closereload") >= 0) {
      url += "&back=closereload";
    }
    document.location.href = url;
  } else {
    OpenChildWindow(url, 'ConfiguredScreen', 800, 600, -1, -1, true, true, true);
  }
}

function OpenModalWindow(strURL) {
  var pvIFrame = (typeof (iframeId) != "undefined") ? top.document.getElementById(iframeId) : "";
  if (pvIFrame) {
    pvIFrame.contentWindow.document.getElementById('Shield').style.display = 'block';
  }
  else {
    top.document.getElementById('Shield').style.display = 'block';
  }
  frames['modal'].location.replace(strURL);
  frames['modal'].frameElement.style.display = 'block';
}

function CloseModalWindow(strSelectedGridId, fReload, fDoNotLowerShield, strPath) {
  if (strPath == null) strPath = "../";
  var pvIFrame = (typeof (iframeId) != "undefined") ? top.document.getElementById(iframeId) : "";
  var oShield, oModal;
  if (pvIFrame) {
    oShield = pvIFrame.contentWindow.document.getElementById('Shield');
    var frameWindow = top.frames[iframeId].window;
    if (!frameWindow) {
      frameWindow = top.frames[iframeId].contentWindow;
    }
    oModal = frameWindow.frames['modal'];
  }
  else {
    oShield = top.document.getElementById('Shield');
    oModal = top.frames['modal'];
  }

  if (!fDoNotLowerShield) {
    oShield.style.display = 'none';
  }
  oModal.frameElement.style.display = 'none';
  oModal.location.replace(strPath + 'shared/blank.html');

  top.scrollTo(0, 0);
  if (fReload) {
    top.location.replace(top.location.href);
  }
}

function ModalWindowResize(nHeight, nWidth) {
  var pvIFrame = (typeof (iframeId) != "undefined") ? top.document.getElementById(iframeId) : "";
  var oModal;
  if (pvIFrame) {
    oModal = top.frames[iframeId].window.frames['modal'];
  }
  else {
    oModal = top.frames['modal'];
  }

  oModal.frameElement.style.pixelHeight = nHeight;
  oModal.frameElement.style.pixelWidth = nWidth;
}


function PopupBlocked() {
  var PUtest = window.open('about:blank', '', 'width=1,height=1,left=0,top=0,scrollbars=no');
  try {
    PUtest.close();
    return false;
  }
  catch (e) {
    return true;
  }
}


function NullOrUndefined(val) {
  return val == undefined || val == null;
}

$(document).ready(function () {
  var modalParams,
      activeWindowId,
      baseShieldId,
      baseShieldFrame,
      baseModalId,
      $window,
      $body,
      defaultHeightPercentage,
      defaultWidthPercentage,
      frameCounter,
      autoDim;

  baseShieldId = "ModalShield";
  baseShieldFrame = "ModalShieldFrame";
  baseContentFrameId = "ModalContentFrame";
  defaultHeightPercentage = .8;
  defaultWidthPercentage = .8;
  $window = $(window);
  $body = $('body');
  autoDim = "auto";
  modalParams = {};

  ModalWindowHelper = {
      OpenModalWindow: function (modalId, strUrl, nWidth, nHeight, pWidth, pHeight, allowScroll) {
      var params,
          modalObjects;

      if (isNullOrUndefined(modalParams[modalId])) {
        
        
        params = { modalId: modalId, url: strUrl, nWidth: nWidth, nHeight: nHeight, pWidth: pWidth, pHeight: pHeight };
        modalObjects = this.GetModalObjectsById(modalId, allowScroll);
        params.modalObjects = modalObjects;
        params.resizeHandler = function () { ModalWindowHelper.HandleResizeAndScroll(params); };
        modalParams[modalId] = params;

      }
      else {
        params = modalParams[modalId];
        modalObjects = params.modalObjects;
      }
      modalObjects.$contentFrame[0].src = strUrl;
      modalObjects.$shield.show();
      modalObjects.$contentFrame.show();
      modalObjects.$contentFrame.focus();
      this.SizeAndPositionModal(params);
      
      
      $(window).bind("resize", params.resizeHandler);
    },
    CloseModalWindow: function (modalId, reload, strPath) {
      if (Planview.hasValue(modalId)) {
        modalId = modalId.replace(baseContentFrameId, "");
      }
          
      if (!modalParams || !modalParams[modalId]) {
        
        window.CloseModalWindow();
        return;
      }

      if (strPath == null) strPath = "../";
      var params;
      params = modalParams[modalId];
      params.modalObjects = this.GetModalObjectsById(modalId);
      params.modalObjects.$contentFrame[0].src = strPath + 'shared/blank.html';
      params.modalObjects.$shield.hide();
      params.modalObjects.$contentFrame.hide();
      $(window).unbind("resize", params.resizeHandler);
      if (reload) { window.location.reload(); }
    },
      
    SizeModal: function (modalId, nHeight, nWidth) {
      if (Planview.hasValue(modalId)) {
        modalId = modalId.replace(baseContentFrameId, "");
      }
        
      var iframeId;
      var modal;

      iframeId = baseContentFrameId + modalId;
      modal = top.frames[iframeId].frameElement;

      if (!modal) return;

      if ((nHeight == null) || (nHeight == 0)) {
        if (0 < modal.clientHeight) {
          nHeight = modal.clientHeight;
        } else {
          nHeight = 425;
        }
      }
      if ((nWidth == null) || (nWidth == 0)) {
        if (0 < modal.clientWidth) {
          nWidth = modal.clientWidth;
        } else {
          nWidth = 600;
        }
      }
      
      
      var parentHeight = $(document).height();
      if (nHeight > parentHeight) {
        nHeight = parentHeight - 20;
      }
      var parentWidth = $(document).width();
      if (nWidth > parentWidth) {
        nWidth = parentWidth - 20;
      }

      modal.style.height = nHeight + 'px';
      modal.style.width = nWidth + 'px';
      
      var leftPos = (($(window).width() - nWidth) / 2);
      var topPos = (($(window).height() - nHeight) / 2);
      if (topPos < 0) {
        topPos = 0;
      }
      if (leftPos < 0) {
        leftPos = 0;
      }
      if ((topPos >= 0) && (leftPos >= 0)) {
        modal.style.top = topPos + 'px';
        modal.style.left = leftPos + 'px';
      }
    },
      
    SizeAndPositionModalById: function (modalId, nHeight, nWidth) {
      if (Planview.hasValue(modalId)) {
        modalId = modalId.replace(baseContentFrameId, "");
      }

      var params = this.SetModalSizeById(modalId, nHeight, nWidth);
      if (!isNullOrUndefined(params)) {
        this.SizeAndPositionModal(params);
      }
    },
    SizeAndPositionModal: function (modalParams) {
      var size,
          $contentFrame,
          leftPos,
          topPos;
      this.SizeShield(modalParams);
      size = this.GetSizeFromParams(modalParams);
      $contentFrame = modalParams.modalObjects.$contentFrame;
      if (size === autoDim) {
        
        
        $contentFrame.css({ "top": "0px", "left": "0px" });
      }
      else {
        $contentFrame.height(Math.min(size.h, $window.height()))
                     .width(Math.min(size.w, $window.width()));
        leftPos = Math.max(0, $window.scrollLeft() + (($window.width() - size.w) / 2));
        topPos = Math.max(0, $window.scrollTop() + ((($window.height()) - size.h) / 2));
        $contentFrame.css({ "top": topPos + "px", "left": leftPos + "px" });
      }

    },
    SizeShield: function (modalParams) {
      var width, height;
      
      height = Math.max($(window).height(), $body.height());
      width = Math.max($(window).width(), $body.width());


      modalParams.modalObjects.$shield.width(width).height(height).css({ "top": 0, "left": 0 });
      $("iframe", modalParams.modalObjects.$shield).width(width).height(height).css({ "top": 0, "left": 0 });
    },
    GetSizeFromParams: function (modalParams) {
      var w, h;
      w = this.GetWidthFromParams(modalParams);
      h = this.GetHeightFromParams(modalParams);
      return w === autoDim || h === autoDim ? autoDim : { h: h, w: w };
    },
    GetWidthFromParams: function (modalParams) {
      return !isNullOrUndefined(modalParams.nWidth) && modalParams.nWidth !== -1
             ? modalParams.nWidth !== 0
               ? modalParams.nWidth
               : autoDim
             : !isNullOrUndefined(modalParams.pWidth)
               ? $window.width() * modalParams.pWidth
               : $window.width() * defaultWidthPercentage;
    },
    GetHeightFromParams: function (modalParams) {
      return !isNullOrUndefined(modalParams.nHeight) && modalParams.nHeight !== -1
             ? modalParams.nHeight !== 0
               ? modalParams.nHeight
               : autoDim
             : !isNullOrUndefined(modalParams.pHeight)
               ? ($window.height()) * modalParams.pHeight
               : ($window.height()) * defaultHeightPercentage;
    },
    GetModalObjectsById: function (modalId, allowScroll) {
      return { $shield: this.GetShieldById(modalId), $contentFrame: this.GetContentFrameById(modalId, allowScroll) };
    },
    GetShieldById: function (modalId) {
      var $shield,
          shieldId,
          shieldFrameId;

      shieldId = this.GetShieldIdByModalId(modalId);
      shieldFrameId = this.GetShieldFrameIdByModalId(modalId);
      $shield = $("#" + shieldId);
      if ($shield.length < 1) {
        $shield = $("<div id='" + shieldId + "' class='modalShieldContainer'><iframe id='" + shieldFrameId + "' name='" + shieldFrameId + "' class='modalShieldFrame' src='about:blank' scrolling='no'; frameborder='0';></iframe></div>").appendTo('body');
      }
      return $shield;
    },
    GetContentFrameById: function (modalId, allowScroll) {
      var $iframe,
          id,
          scrolling = "no";
        
      if (allowScroll) {
        scrolling = "yes";
      }

      id = this.GetContentFrameIdByModalId(modalId);
      $iframe = $("#" + id);
      if ($iframe.length < 1) {
        $iframe = $("<iframe id='" + id + "' name='" + id + "' class='modalContent' scrolling='" + scrolling + "' frameborder='0' src='about:blank'></iframe>").appendTo('body');
      }
      return $iframe;
    },
    GetShieldIdByModalId: function (modalId) { return baseShieldId + modalId; },
    GetShieldFrameIdByModalId: function (modalId) { return baseShieldFrame + modalId; },
    GetContentFrameIdByModalId: function (modalId) { return baseContentFrameId + modalId; },
    SetModalSizeById: function (modalId, nHeight, nWidth) {
      var params = modalParams[modalId];
      if (!isNullOrUndefined(params)) {
        params.nHeight = nHeight;
        params.nWidth = nWidth;
      }
      return params;
    },
    HandleResizeAndScroll: function (modalParams) {
      if (modalParams.modalObjects.$contentFrame.is(":visible")) { ModalWindowHelper.SizeAndPositionModal(modalParams); }
    }
  }
});

var iDelay = 500; 
var iNSWidth=100; 
var sDisplayTimer = null, oLastItem;


function getRealPos(i,which) {
  iPos = 0;
  while (i!=null) {
    iPos += i["offset" + which];
    i = i.offsetParent;
  }
  return iPos;
}


function toggleBigGauge(sg_id,bg_id){
    if (document.getElementById) {
    stopTimer();
    dest = document.getElementById(bg_id);
        if ((oLastItem!=null) && (oLastItem!=dest))
        hideItem();
        if (dest) {
      dest.style.left = getRealPos(sg_id,"Left")-78 + "px";
      dest.style.top = getRealPos(sg_id,"Top")-80 + "px";
      dest.style.visibility = "visible";
      dest.style.display = "block";
        }
        oLastItem = dest;
    }
}





function portletMenu(sDest,mDiv1,mDiv2,e,mVal,mLink) {
  var mText;

  if(!document.getElementById(mDiv1) || document.getElementById(mDiv1).style.display=="block"){
    mText = "<a href='#'>" + jsCstrCollapse + "</a>";
  }else if(document.getElementById(mDiv1).style.display=="none"){
    mText = "<a href='#'>" + jsCstrExpand + "</a>";
  }

  var mContent;
  mContent="<ul class='flyoutOptions'>\
                  <li onClick=\"toggle('" + mDiv1 + "');editCell(this);return false;\">" + mText + "</li>";
                  if(mLink!=""){
                      mContent=mContent + "<li><a href='" + mLink +"'>" + jsCstrEdit + "</a></li>";
                  }

                  if(mVal!="Global"){
                      mContent=mContent + "<li><a href='#' onClick=\"popUpWnd('Layouts/SaveContent.asp?back=close&amp;cmd=del&amp;val="+mDiv2+"',1,400,300,100,200);toggle('" + mDiv2 + "');return false;\">" + jsCstrHide + "</a></li>";
                  }
  mContent=mContent + "</ul>";

  document.write(mContent);
}






function portletMenu0(sDest,mDiv1,mDiv2,e,mVal,mLink,WL) {
  var mText, xPos, yPos, xWLPos, yWLPos, vExpCollLi;
  xWLPos = 46; yWLPos = 20; xPos = 52; yPos = 17;
  if(document.getElementById(mDiv1).style.display=="none"){
    mText = "<a href='#'>" + jsCstrExpand + "</a>";
  }else if(document.getElementById(mDiv1).style.display=="block"){
    mText = "<a href='#'>" + jsCstrCollapse + "</a>";
  }
  vExpCollLi="<li onClick=\"toggle('" + mDiv1 + "');editCell(this);document.location.replace(unescape(document.location.href));return false;\" onMouseOver=\"hidePMenu('pMenu');\">" + mText + "</li>";
  var mContent;
  mContent="<ul class='flyoutOptionsForTooltip'>"+vExpCollLi;
  if(mLink!=""){
      mContent=mContent + "<li onMouseOver=\"hidePMenu('pMenu');\"><a href='" + mLink +"'>" + jsCstrEdit + "</a></li>";
  }
  


  mContent=mContent + "</ul>";

  if (document.getElementById) {
    stopTimer();
    dest = document.getElementById(sDest);
    dest.innerHTML=mContent;
    if ((oLastItem!=null) && (oLastItem!=dest))
      hideItem();
    if (dest) {
      if(WL){
        dest.style.left = getRealPos(e,"Left") - xWLPos + "px";
        dest.style.top = getRealPos(e,"Top")+ yWLPos + "px";
      }else{
        dest.style.left = getRealPos(e, "Left") - xPos + "px";
        dest.style.top = getRealPos(e,"Top")+ yPos + "px";
      }
      dest.style.visibility = "visible";
      dest.style.display = "block";
    }
  oLastItem = dest;
  }
}





function portletMenu1(mDiv1,mDiv2,mLink) {

  var mText, dest, mContent;

  mText = "<a href='#'>" + jsCstrCollapse + "</a>";
  if(document.getElementById(mDiv1) && document.getElementById(mDiv1).style.display=="none")
    mText = "<a href='#'>" + jsCstrExpand + "</a>";

  mContent="<ul class='popupOptions' style='margin-left:-65px;margin-top:15px;'>\
              <li onClick=\"toggle('" + mDiv1 + "');editCell(this);return false;\">" + mText + "</li>";

  if(mLink!="")
    mContent=mContent + "<li><a href='" + mLink +"'>Edit</a></li>";

  mContent=mContent + "<li><a href='#' onClick=\"toggle('" + mDiv2 + "');return false;\">" + jsCstrHide + "</a></li>";
  mContent=mContent + "</ul>";

  document.write(mContent);

  





}




function portletMenu2(sDest,e,imgPath,blnPDF,blnExcel, strPrintPage, strExportToExcel) {  
  	xWLPos = 46;yWLPos = 20;xPos = 52;yPos = 17;
	var mContent;
	mContent="<ul class='listMenuPrintOptions' style='width:130px'><li><a href=\"javascript:hideMenu();printSource('');\"><img class='leftOfText' src='"+imgPath+"/icon_printexport.gif'>" + strPrintPage + "</a></li>";
	if (blnPDF=="true"){
    mContent+="<li><a href='#' onClick=\"OpenChildWindow('print_container.asp?ty=pdf&pc=','PrintPop',620,230,-1,-1,true,false,false);hideMenu();\"><img class='leftOfText' src='"+imgPath+"/icon_pdf.gif'>Export to PDF</a></li>";
  }
  if (blnExcel=="true"){
    mContent+="<li><a href=\"javascript:exportExcel('parentWnd');\"><img class='leftOfText' src='"+imgPath+"/icon_excel.gif'>" + strExportToExcel + "</a></li></ul>";
  }

	if (document.getElementById) {
		stopTimer();
		dest = document.getElementById(sDest);
		if (dest != null)
		{
		  dest.innerHTML = mContent;
		  if ((oLastItem != null) && (oLastItem != dest))
		    hideItem();
		  dest.style.left = getRealPos(e, "Left") + "px";
		  dest.style.top = getRealPos(e, "Top") + yPos + "px";
		  dest.style.visibility = "visible";
		  dest.style.display = "block";
		}
  }
  oLastItem = dest;
}



function notificationCategoryDetails(sDest) {
  if (document.getElementById) {
    var oDest = document.getElementById(sDest)
    stopTimer();
    if ((oLastItem != null) && (oLastItem != oDest))
      hideItem();
    if (oDest) {


      oDest.style.visibility = "visible";
      oDest.style.display = "block";
    }
  oLastItem = oDest;
  }
}




function stopTimer() {
  clearTimeout(sDisplayTimer);
}



function startTimer(el) {
    stopTimer();
    sDisplayTimer = setTimeout("hideItem()",iDelay);
}




function hideItem() {
  if (oLastItem)
  {
    oLastItem.style.visibility="hidden";
    oLastItem.style.display="none";
  }
}



function showItem() {
  stopTimer();
  if (oLastItem)
  {
    oLastItem.style.visibility="visible";
    oLastItem.style.display="block";
  }
}


function editCell (cell) {
    if (document.getElementById){
    if (cell.innerHTML.indexOf(jsCstrCollapse)!=-1){
      cell.innerHTML ="<a href='#'>" + jsCstrExpand + "</a>";
    }else{
      cell.innerHTML ="<a href='#'>" + jsCstrCollapse + "</a>";
    }
  }
  document.getElementById('popMenu').style.visibility='hidden';
}


function toggle( targetId ){
  var target = document.getElementById(targetId);
  if (target!=null){
    toggleById(targetId);
    setCookieKey('jssPVPortalMenu',targetId,target.style.display);
    if (document.getElementById('popMenu')) document.getElementById('popMenu').style.visibility='hidden';
    resizeMainMenus();
  }
}





function offsetElement(element, alignment, direction, offset)
{
  var target = document.getElementById(element);
  var initialOffset;
  if (null != target)
  {
    if (alignment == "horiz")
    {
      initialOffset = target.clientWidth;
      target.style.left = (initialOffset * direction) + offset + "px";
    }
    else
    {
      initialOffset = target.clientHeight;
      target.style.top = (initialOffset * direction) + offset + "px";
    }
  }
}

function toggleById( sId, cmd, frameId ){
  var target = document.getElementById(sId);
  if (target == null && frameId != null) {
    var oFrame = window.frames[frameId];
    if (oFrame != null) {
      target = oFrame.document.getElementById(sId);
    }
  }
  if (target!=null && cmd==null){
    if (target.style.display == "none")
    {
      if ((target.tagName == 'TABLE') && (!isIE))
      { target.style.display = "table";
      }
      else
      { target.style.display = "block";
      }
    } 
    else 
    { target.style.display = "none";
    }
  }
  else
  {
    if (target!=null && cmd == "collapse")  
    {
      target.style.display = "none";
    }
    else if (target!=null && cmd == "expand") 
    { 
      if ((target.tagName == 'TABLE') && (!isIE))
      { target.style.display = "table";
      }
      else
      { target.style.display = "block";
      }
    }
  }
}

function setMainDiv()
{ 
  var objDivAppMenu = document.getElementById("appMenu");
  var objTdAppMenuZone = document.getElementById("appMenuZone");
  if (document.getElementById("appMenu") && document.getElementById("appMenuZone"))
  {
      if (objDivAppMenu.offsetHeight || objTdAppMenuZone.offsetHeight){
        nAppMenuHt = objDivAppMenu.offsetHeight +"px";
        if (objTdAppMenuZone.offsetHeight < objDivAppMenu.offsetHeight )
        { nAppMenuHt = objTdAppMenuZone.offsetHeight +"px";
        }
        else
        { nAppMenuHt = objDivAppMenu.offsetHeight +"px";
        }
      }
      
    var objMenuArr = new Array();
    
    var objHTMLIdMenu = new Array();
      objHTMLIdMenu[0] = "appMenu";
      objHTMLIdMenu[1] = "appMenuZone";
      objHTMLIdMenu[2] = "appMenu2";
      objHTMLIdMenu[3] = "coll_left";
      objHTMLIdMenu[4] = "exp_left";
      for (i=0;i<objHTMLIdMenu.length;i++)
      {
        objMenuArr[i]= document.getElementById(objHTMLIdMenu[i]);
      }  
      
      for (i=0;i<objMenuArr.length;i++)
      {
        objMenuArr[i].style.height=nAppMenuHt;
        objDivAppMenu.style.height = "";
        objTdAppMenuZone.style.height="";
     }
  }
}



function toggleData(mStat,mImg,src1,src2){
  var mVal,mImgSrc; 
  var targetOne = document.getElementById(mStat);   
    if (document.getElementById){
    if (targetOne.style.display == "none"){
      mImgSrc=src1;
      mVal="block";
    }else{
      mImgSrc=src2;
      mVal="none";
    }
    targetOne.style.display = mVal;
    document.images[mImg].src=mImgSrc;

    setCookieKey('jssPVPortalMenu',mStat,mVal);
    setMainDiv();
    resizeMainMenus();    
  }


}



function makeChildrenVisible(strParentID)
{
  var parent = document.getElementById(strParentID);
  if ((parent) && (parent.tagName == 'UL'))
  {
    for( var x = 0; parent.childNodes[x]; x++ )
      parent.childNodes[x].style.display = 'block';
  }
}

function rollOff2(element, prevPos, topPos, leftPos)
{
  clearTimeout(myTimer)
  
  for( var x = 0; element.childNodes[x]; x++ ){
    if( element.childNodes[x].className == 'flyoutOptionsForTooltip' ) {
      element.childNodes[x].style.top = topPos;

      element.childNodes[x].style.display = 'none';
      element.style.position = prevPos;
      return;
    }
  }
}





function getY(e) { 
    return e.offsetTop;
}




function getScrollTop() { 
  if (document.documentElement && (document.documentElement.scrollTop > 0)) {
    return document.documentElement.scrollTop;
  }
  else {
    return document.body.scrollTop;
  }
}




function getClientHeight() { 
  if (document.documentElement && (document.documentElement.clientHeight > 0)) {
    return document.documentElement.clientHeight;
  }
  else {
    return document.body.clientHeight;
  }
}




function popUpMainMenu(menuObj, e) { 
  menuObj.style.top = getY(e) + "px";
  menuObj.style.visibility = "visible";
  menuObj.style.display = "block";
  if(getScrollTop()+getClientHeight()<=menuObj.offsetTop+menuObj.offsetHeight){
      menuObj.style.top = (getY(e) - menuObj.offsetHeight)+23 + "px";
  }
}




function makeLastElementObj(menuId)
{ stopTimer();
  menuObj1 = document.getElementById(menuId);
  oLastItem = menuObj1;
}




function makeObj(menuObj, e){
  stopTimer();
  menuObj1 = document.getElementById(menuObj);
  if ((oLastItem!=null) && (oLastItem!=menuObj1))
    hideItem();
  popUpMainMenu(menuObj1, e);
  oLastItem = menuObj1;
}

function makeObjForNotifications(menuObj, e){
  stopTimer();
  menuObj1 = top.document.getElementById(menuObj);
  if ((oLastItem!=null) && (oLastItem!=menuObj1))
    hideItem();
  popUpMainMenu(menuObj1, e);
  top.oLastItem = menuObj1;
}





function printMenu(sDest,e) {
  if (document.getElementById) {    
    dest = document.getElementById(sDest);    
    if (dest) {      
      dest.style.position="absolute";      
      dest.style.visibility = "visible";
      dest.style.display = "block";
      dest.style.left = 70 + "px"; //getRealPos(e,"Left") - 240 + "px";
      dest.style.top = 61 + "px"; //getRealPos(e,"Top")-120 + "px";
      if(getScrollLeft()+getClientWidth()<=dest.offsetLeft+dest.offsetWidth){        
        dest.style.left = (getX(e) - dest.offsetWidth) + "px";
      }
    }
  }
}

function hidePMenu() {
  var pItem;
  pItem = document.getElementById("pMenu");
  if (pItem)
  {
    pItem.style.visibility="hidden";
    pItem.style.display="none";
  }
}


function hideMenu() {
  var pItem1;
  pItem1 = document.getElementById("pMenu");
  pItem2 = document.getElementById("popMenu");
  if(pItem1)
  {
    pItem1.style.visibility="hidden";
    pItem1.style.display="none";   
  }else if(pItem2){
     pItem2.style.visibility="hidden";
     pItem2.style.display="none";
  }
}


function getX(e) { 
    return e.offsetLeft;
}


function getScrollLeft() { 
  if (document.documentElement && (document.documentElement.scrollLeft > 0)) {
    return document.documentElement.scrollLeft;
  }
  else {
    return document.body.scrollLeft;
  }
}

function getClientWidth() { 
  if (document.documentElement && (document.documentElement.clientWidth > 0)) {
    return document.documentElement.clientWidth;
  }
  else {
    return document.body.clientWidth;
  }
}


function exportExcel(wnd)
{
  var exportURL;
  var targetWin;
	if(wnd=="parentWnd"){
		exportURL = window.location.href;
		targetWin = window;
	}else{
	  exportURL = window.opener.location.href;
	  targetWin = window.opener;
	}
	if(exportURL.toLowerCase().indexOf("aspreport.asp")>0 || exportURL.toLowerCase().indexOf("fundingview.asp")>0)
	{
	  
	  targetWin.ViewInExcel();
	  window.close();	
	}  
  else
  {
    if(exportURL.indexOf("?")>0){      
      exportURL = exportURL + "&media=excel";
    }else{
      exportURL = exportURL + "?media=excel";
    }
    var cacheDate = new Date();
    exportURL += "&cache=" + cacheDate.getFullYear().toString() + cacheDate.getMonth().toString() + cacheDate.getDay().toString() + cacheDate.getHours().toString() + cacheDate.getMinutes().toString() + cacheDate.getSeconds().toString() + cacheDate.getMilliseconds().toString() + Math.floor(Math.random()*100000);
    window.location.href=exportURL;
    
    
  }
}


function tdWidthSetter(win){
	var Tds;
		try {
			Tds = win.ListOfTds();
		}catch(exception) {
			Tds = null
		}
		
	if(Tds != null){
		Tds_len = Tds.length;
		for(k=0; k<Tds_len; k++){
			var Tds_name;
			Tds_name = Tds[k].split(":");
				try {
					
					win.document.getElementById(Tds_name[1]).style.width = win.document.getElementById(Tds_name[0]).style.width + "px";
					
				}catch(exception) {
					
			}
		}
	}
}
function printSource(wnd){
	var Objs
	if(wnd=="parentWnd"){
		printPage = window.opener;
		if (
		     printPage.location.href.toLowerCase().indexOf("aspreport.asp")>0 || 
		     printPage.location.href.toLowerCase().indexOf("fundingview.asp")>0
		   )
		{
		  printPage.SwitchPrinterFriendly("on");
		  printPage.print();
		  printPage.SwitchPrinterFriendly("off");
		  window.close();
		  return;
		}
		try {
			Objs = printPage.GenPrnPage();
		}catch(exception) {
			Objs = null
		}
	}else{
		printPage = window;
		if(
		    printPage.location.href.toLowerCase().indexOf("aspreport.asp")>0 || 
		     (printPage.location.href.toLowerCase().indexOf("main.asp")>0 && 
		      printPage.location.href.toLowerCase().indexOf("usebanner")>0) ||
		     (printPage.location.href.toLowerCase().indexOf("execcontainer.asp")>0 && 
		      printPage.location.href.toLowerCase().indexOf("usebanner")>0) ||
		     printPage.location.href.toLowerCase().indexOf("portlettemplate01.asp")>0 || 
		     printPage.location.href.toLowerCase().indexOf("missedmilestonefull.asp")>0 || 
		    printPage.location.href.toLowerCase().indexOf("myportlettablefull.asp")>0
		  )
		{
		  printPage.SwitchPrinterFriendly("on");
		  printPage.print();
		  printPage.SwitchPrinterFriendly("off");
		  return;
		}
		try {
			Objs = printPage.GenPrnPage();
		}catch(exception) {
			Objs = null
		}
	}

	if(Objs != null){
		Obj_len = Objs.length;
		for(i=0; i<Obj_len; i++){
			var obj_name;
			obj_name = Objs[i].split(":");
			switch (obj_name[1])
			{
				case "overflow-x":
					printPage.document.getElementById(obj_name[0]).style.overflowX = "visible";
					break;
				case "overflow-y":
					printPage.document.getElementById(obj_name[0]).style.overflowY = "visible";
					break;
				default:
					printPage.document.getElementById(obj_name[0]).style.overflow = "visible";
			}
		}
    tdWidthSetter(printPage);
    try {
      mWidth = printPage.document.getElementById("mainContainer").offsetWidth;
      mWidth = mWidth/970;
      mWidth = Math.round(mWidth);
      for(var pCount=0;pCount <= mWidth-1; pCount++){
	      printPage.document.getElementById("mainContainer").style.left=-(970*pCount) + "px"; 
	      printPage.print();
      }
      printPage.document.getElementById("mainContainer").style.left = "0px";
    }catch(exception) {
      printPage.print();
    }

		for(i=0; i<Obj_len; i++){
			var obj_name;
			obj_name = Objs[i].split(":");

			switch (obj_name[1])
			{
				case "overflow-x":
					printPage.document.getElementById(obj_name[0]).style.overflowX = obj_name[2];
					break;
				case "overflow-y":
					printPage.document.getElementById(obj_name[0]).style.overflowY = obj_name[2];
					break;
				default:
					printPage.document.getElementById(obj_name[0]).style.overflow = obj_name[2];
			}
		}
	}
	else
	{
    try {
      mWidth = printPage.document.getElementById("mainContainer").offsetWidth;
      mWidth = mWidth/970;
      mWidth = Math.round(mWidth);
      for(var pCount=0;pCount <= mWidth-1; pCount++){
        printPage.document.getElementById("mainContainer").style.left=-(970*pCount) + "px"; 
        printPage.print();
      }
      printPage.document.getElementById("mainContainer").style.left = "0px";
    }catch(exception) {
      printPage.print();
    }
	}
}








function toggleRows(oTable,frameId){
  var objTable, objTBody, objTR;
  var m, n;
  var displaySpecifier;
  if (isIE)
  {
    displaySpecifier = "block";
  }
  else
  {
    displaySpecifier = "table-row";
  }
  objTable = document.getElementById(oTable);
  if (objTable === null  && frameId != null) {
    var oFrame = window.frames[frameId];
    if (oFrame != null) {
      objTable = oFrame.document.getElementById(oTable);
    }
  }
  objTBody = objTable.tBodies;
  objTBodyLen = objTBody.length-1;
  for(m=0;m<=objTBodyLen;m++){
    objTR = objTBody[m].rows;
    objTRLen = objTR.length-1;
    for(n=0;n<=objTRLen;n++)
    {
      if(objTR[n].id=="header" || objTR[n].id=="vRow")
      {
        objTR[n].style.display=displaySpecifier;
      }
      else
      {
        if(objTR[n].style.display==displaySpecifier || objTR[n].style.display=="")
        {
          objTR[n].style.display="none";
        }
        else
        {
          objTR[n].style.display=displaySpecifier;
        }
      }
    }  
  }
}

function beginDrag(elementToDrag, event)
{ var deltaX = event.clientX-parseInt(elementToDrag.style.left);
  var deltaY = event.clientY-parseInt(elementToDrag.style.top);
 
  document.attachEvent("onmousemove",moveHandler);
  document.attachEvent("onmouseup",upHandler);
  event.cancelBubble = true;
 
  function moveHandler(event)
  { elementToDrag.style.left = (event.clientX - deltaX) + 'px';
    elementToDrag.style.top = (event.clientY - deltaY) + 'px';
    event.cancelBubble = true;
  }
 
  function upHandler(event)
  { document.detachEvent("onmouseup",upHandler);
    document.detachEvent("onmousemove",moveHandler);
    event.cancelBubble = true;
  }
}





















function getYPosition(element,frameId)
{
  var myElement = element;
  if (myElement === null || myElement === undefined) { return 0; }
  
  var yPos = myElement.offsetTop;
  while (myElement.offsetParent)
  {
    myElement = myElement.offsetParent;
    yPos = yPos + myElement.offsetTop;
  }
  if (frameId)
  { 
    myElement = top.frames[frameId].frameElement;
    yPos = yPos + myElement.offsetTop;
    while (myElement.offsetParent)
    {
      myElement = myElement.offsetParent;
      yPos = yPos + myElement.offsetTop;
    }
  }
  return yPos;
}





















function getXPosition(element,frameId)
{
  var myElement = element;
  if (myElement === null || myElement === undefined) { return 0; }

  var xPos = myElement.offsetLeft;
  while (myElement.offsetParent)
  { myElement = myElement.offsetParent;
    xPos = xPos + myElement.offsetLeft - myElement.scrollLeft;
  }
  if (frameId)
  {
    myElement = top.frames[frameId].frameElement;
    xPos = xPos + myElement.offsetLeft;
    while (myElement.offsetParent)
    { myElement = myElement.offsetParent;
      xPos = xPos + myElement.offsetLeft - myElement.scrollLeft;
    }
  }
  return xPos;
}

var dashletChartFlyoutMenu;
var currentdashletChartFlyoutMenuBaseId;
function EnableFlyout(baseElementId, flyoutID) {
  var $baseElement, $flyoutElement, $content;

  $baseElement = $("#" + baseElementId);
  $flyoutElement = $("#" + flyoutID);

  $content = $flyoutElement.clone();
  if (isNullOrUndefined(dashletChartFlyoutMenu)) {
    dashletChartFlyoutMenu = PvMenuHelper._create({
      popupCssClass: "pvPopup dashletVectorMenu",
      triggerEl: $baseElement,
      originEl: $baseElement,
      id: "dashletChartFlyouMenu",
      origins: { baseOrigin: "bottom left", popupOrigin: "top left" }
    });
  }
  
  if (currentdashletChartFlyoutMenuBaseId === baseElementId && dashletChartFlyoutMenu.isVisible()) {
    dashletChartFlyoutMenu.hide();
    currentdashletChartFlyoutMenuBaseId = "";
  }
  else {
    dashletChartFlyoutMenu.showMenu($content, $baseElement, $baseElement);
    currentdashletChartFlyoutMenuBaseId = baseElementId;
  }  
}

function HideDashletChartFlyoutMenu() {
  if (dashletChartFlyoutMenu) {
    dashletChartFlyoutMenu.hide();
  }
}

$(document).ready(function () {
  
  PvDomWaitInit();
  PvDomUiHelperInit();
  PvDomMenuHelperInit();
  PvDomPopupHelperInit();
  PvDomTooltipHelperInit();
});

function AddOnload(func) {
  if (window.addEventListener) {
    window.addEventListener('load', func, false);
  }
  else if (window.attachEvent) {
    window.attachEvent('onload', func);
  }
  else {
    var oldfunc = window.onload;
    if (typeof window.onload != 'function') {
      window.onload = func;
    }
    else {
      window.onload = function () { oldfunc(); func(); };
    }
  }
}

(function OnUnloadHelperInit(undefined) {
  var _unloadFunctions = [];
  Planview.RegisterNamespace("Planview.OnUnloadHelper");

  Planview.OnUnloadHelper = {
    UnloadHandler: function() {
      var funcCount = _unloadFunctions.length,
          funcCounter,
          funcVal,
          retVal = "",
          beforeUnload = false;
      
      
      for (funcCounter = 0; funcCounter < funcCount; funcCounter++) {
        funcVal = _unloadFunctions[funcCounter]();
        if (funcVal) {
          beforeUnload = true;
          if (true !== funcVal) {
            retVal += (retVal.length > 0 ? " " : "") + funcVal.toString();
          }
        }
      }
      if (beforeUnload) {
        return retVal.length > 0 ? retVal : beforeUnload;
      }

    },
    AddOnBeforeUnloadHandler: function(func) {
      _unloadFunctions[_unloadFunctions.length] = func;
    }
  };

  if (PVBrowserInfo.IsExplorer && PVBrowserInfo.VersionMajor < 9) {
    window.onbeforeunload = Planview.OnUnloadHelper.UnloadHandler;
  }
  else if (window.addEventListener) {
    window.addEventListener("beforeunload", Planview.OnUnloadHelper.UnloadHandler, false);
  }
  else if (window.attachEvent) {
    window.attachEvent('onbeforeunload', Planview.OnUnloadHelper.UnloadHandler);
  }
  else {
    $(window).on("beforeunload", Planview.OnUnloadHelper.UnloadHandler);
  }
})();

function AddOnBeforeUnload(func) {
    Planview.OnUnloadHelper.AddOnBeforeUnloadHandler(func);
}

function AddOnUnload(func) {
  if (window.addEventListener) {
    window.addEventListener('unload', func, false);
  }
  else if (window.attachEvent) {
    window.attachEvent('onunload', func);
  }
  else {
    var oldfunc = window.onunload;
    if (typeof window.onunload != 'function') {
      window.onunload = func;
    }
    else {
      window.onunload = function () { oldfunc(); func(); };
    }
  }
}

function AddOnresize(obj, func) {
  if (typeof (func) == 'function') {
    if (obj.addEventListener) {
      obj.addEventListener('resize', func, false);
    }
    else if (window.attachEvent) {
      obj.attachEvent('onresize', func);
    }
    else {
      var oldfunc = obj.onresize;
      if (typeof obj.onresize != 'function') {
        obj.onresize = func;
      }
      else {
        obj.onresize = function () { oldfunc(); func(); }
      }
    }
  }
}

function AddOnScroll(obj, func) {
  if (typeof (func) == 'function') {
    if (obj.addEventListener) {
      obj.addEventListener('onscroll', func, false);
    }
    else if (window.attachEvent) {
      obj.attachEvent('onscroll', func);
    }
    else {
      var oldfunc = obj.onresize;
      if (typeof obj.onresize != 'function') {
        obj.onresize = func;
      }
      else {
        obj.onresize = function () { oldfunc(); func(); }
      }
    }
  }
}

function AddOnClick(func) {
  if (document.addEventListener) {
    document.addEventListener('click', func, false);
  }
  else if (document.attachEvent) {
    document.attachEvent('onclick', func);
  }
  else {
    var oldfunc = document.onclick;
    if (typeof document.onclick != 'function') {
      document.onclick = func;
    }
    else {
      document.onclick = function () { oldfunc(); func(); }
    }
  }
}

function AddOnClickElement(oElement, func) {
  if (oElement.addEventListener) {
    oElement.addEventListener('click', func, false);
  }
  else if (oElement.attachEvent) {
    oElement.attachEvent('onclick', func);
  }
  else {
    var oldfunc = oElement.onclick;
    if (typeof oElement.onclick != 'function') {
      oElement.onclick = func;
    }
    else {
      oElement.onclick = function () { oldfunc(); func(); }
    }
  }
}


function WaitObject() {
  this.ElementId = WaitObject.arguments.length > 0 ? WaitObject.arguments[0] : "loading";
  this.On = function () {
    menuOn(this.ElementId);
    var waitElement = document.getElementById(this.ElementId);
    if (waitElement) waitElement.style.display = "block";
  }
  this.Off = function () {
    menuOff(this.ElementId);
    var waitElement = document.getElementById(this.ElementId);
    if (waitElement) waitElement.style.display = "none";
  }
  this.Execute = function (routine) {
    this.On();
    setTimeout(routine + ";wObj=new WaitObject('" + this.ElementId + "');wObj.Off();", 0);
  }
}





function executeWithWaitGear() {
  var script = executeWithWaitGear.arguments.length > 0 ? executeWithWaitGear.arguments[0] : null;
  if (script != null) {
    var waitObj = executeWithWaitGear.arguments.length > 1 ? new WaitObject(executeWithWaitGear.arguments[1]) : new WaitObject();
    waitObj.Execute(script);
  }
}


function WaitCursor() {
  this.Element = WaitCursor.arguments.length > 0 ? WaitCursor.arguments[0] : null;
  this.On = function () {
    if (g_GridEntities) g_GridEntities.Grid.SetBusy();
    var waitElement = document.getElementById(this.Element);
    if (waitElement) waitElement.className = "waiting";
  }
  this.Off = function () {
    if (g_GridEntities) g_GridEntities.Grid.SetIdle();
    var waitElement = document.getElementById(this.Element);
    if (waitElement) waitElement.className = "";
  }
  this.Execute = function (routine) {
    this.On();
    setTimeout(routine + ";wObj=new WaitCursor('" + this.Element + "');wObj.Off();", 100);
  }
}

function executeWithWaitCursor() {
  var script = executeWithWaitCursor.arguments.length > 0 ? executeWithWaitCursor.arguments[0] : null;
  if (script != null) {
    var waitObj = executeWithWaitCursor.arguments.length > 1 ? new WaitCursor(executeWithWaitCursor.arguments[1]) : new WaitCursor();
    waitObj.Execute(script);
  }
}



var DoneCleanup = 1;

AddOnUnload(function () {
  if (DoneCleanup == 1) return;
  console.log("clean-up");
  if (window.CollectGarbage) window.CollectGarbage(); 

  var e;
  var i;
  var s;
  s=document.getElementsByTagName("A");
  for(i=s.length;i--;){
    e=s[i];
    e.onclick=null;
  }
  s=document.getElementsByTagName("BODY");
  for(var i=s.length;i--;){
    e=s[i];
    e.onbeforeunload=null;
    e.onload=null;
    e.onresize=null;
    e.onunload=null;
  }
  s=document.getElementsByTagName("BUTTON");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.onmouseout=null;
    e.onresize=null;
    e.onmouseover=null;
  }
  s=document.getElementsByTagName("DIV");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.onkeydown=null;
    e.onmousedown=null;
    e.onmouseout=null;
    e.onmouseover=null;
    e.onresize=null;
    e.onscroll=null;
    e.onselectstart=null;
  }
  s=document.getElementsByTagName("FORM");
  for(i=s.length;i--;){
    e=s[i];
    e.onsubmit=null;
  }
  s=document.getElementsByTagName("SELECT");
  for(var i=s.length;i--;){
    e=s[i];
    e.onchange=null;
    e.onfocus=null;
  }
  s=document.getElementsByTagName("SPAN");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.onmousedown=null;
    e.onmouseout=null;
    e.onmouseover=null;
    e.onmouseup=null;
  }
  s=document.getElementsByTagName("TABLE");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.oncontextmenu=null;
    e.ondblclick=null;
    e.onkeydown=null;
    e.onkeypress=null;
    e.onkeyup=null;
    e.onmousedown=null;
    e.onmousemove=null;
    e.onmouseout=null;
    e.onmouseover=null;
    e.onmouseup=null;
    e.onresize=null;
    e.onselectstart=null;
  }
  s=document.getElementsByTagName("TD");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.onmousedown=null;
    e.onmouseout=null;
    e.onmouseover=null;
    e.onselectstart=null;
  }
  s=document.getElementsByTagName("TR");
  for(var i=s.length;i--;){
    e=s[i];
    e.onclick=null;
    e.onmouseout=null;
    e.onmouseover=null;
  }
  
  s = document.getElementsByTagName("INPUT");
  for (var i = s.length; i--; ) {
    e = s[i];
    e.onfocus = null;
  }
  
  
  
  
  
  
  
  
  
  
  
  
  

  document.onkeypress = null;
  document.onmouseup = null;
  document.onmousemove = null;
  
  
  
  
  
  
  
  
  
  s=null;
  e=null;

  if(window.CollectGarbage) window.CollectGarbage();

  DoneCleanup = 1;
});


function fireChangeEvent(element) {
  if (document.createEventObject) {
    var evt = document.createEventObject();
    return element.fireEvent('onchange', evt)
  }
  else {
    var evt = document.createEvent("HTMLEvents");
    evt.initEvent('change', true, true); 
    return !element.dispatchEvent(evt);
  }
}

var styleTablePortlets = false;
function StyleTablePortlets() {
  
  
  
  if (!styleTablePortlets) {
    if (Planview.debug) {
      
    }
    
    $(".portletTable td").click(function () {
      var $el = $(this);
      $(".portletTable td").toggleClass("row-highlighted", false).toggleClass("active", false);
      $el.parent("tr").children("td").toggleClass("row-highlighted", true);
      $el.toggleClass("active", true);
    });
    styleTablePortlets = true;

    
    $(".portletHeader").hide();
  }
}



function PvDomUiHelperInit() {
  if (window.PvUiHelper) {
    return;
  }

  var top,
      bottom,
      center,
      left,
      right,
      $win,
      $body,
      validationAlertClass;

  (function init() {
    top = "top";
    bottom = "bottom";
    center = "center";
    left = "left";
    right = "right";
    $win = $(window);
    $body = $("body");
    validationAlertClass = "validation-alert";

  })();


  window.PvUiHelper = {
    positionElementOnElement: function ($el, elementRelPos, $baseEl, baseRelPos, overridePosition, offset) {
      var elPos, gutter;
      gutter = 30;
      if(Planview.hasValue(overridePosition)) {
        elPos = { left: overridePosition.menuX, top: overridePosition.menuY };
      }
      else {
        elPos = this.getCoordsRelativeToBaseElement($el, elementRelPos, $baseEl, baseRelPos, offset);
      }
      
      
      elPos.left = Math.min(Math.max(elPos.left, 0), Math.max(0, $win.outerWidth() - $el.outerWidth() - gutter));
      elPos.top = Math.min(Math.max(elPos.top, 0), Math.max(0, $win.height() - $el.outerHeight() - gutter));
      $el.css({ position: "absolute", top: elPos.top + "px", left: elPos.left + "px" });
      return $el;
    },
    positionElementOnElementWithIFrame: function ($el, elRelPos, $baseEl, baseRelPos, $iframe) {
      this.positionElementOnElement($el, elRelPos, $baseEl, baseRelPos).show();
      $iframe.height($el.outerHeight(true));
      $iframe.width($el.outerWidth(true));
      $iframe.css({ position: "absolute", top: $el.css("top"), left: $el.css("left") }).show();
    },
    getCoordsRelativeToBaseElement: function ($el, elRelPos, $baseEl, baseRelPos, offset) {
      return this.getRelativeCoords($el, this.decodePosition(elRelPos), this.getRelativeCoords($baseEl, this.decodePosition(baseRelPos), $baseEl.offset(), true), false, offset);
    },
    getRelativeCoords: function ($el, relPos, $offset, fPosMod, offset) {
      offset = offset || {top: 0, left: 0};
      if (window.isNullOrUndefined($offset)) { $offset = { left: 0, top: 0 }; }
      var mod = fPosMod ? 1 : -1;
      hPos = relPos.h === left
              ? $offset.left
              : relPos.h === right
                ? $offset.left + ($el.outerWidth() * mod)
                : $offset.left + (($el.outerWidth() / 2) * mod);

      vPos = relPos.v === top
              ? $offset.top
              : relPos.v === bottom
                ? $offset.top + ($el.outerHeight() * mod)
                : $offset.top + (($el.outerHeight() / 2) * mod);
      return { left: hPos + offset.left, top: vPos + offset.top };
    },
    isValidRelHPosition: function (pos) { return pos === left || pos === right || pos === center; },
    isValidRelVPosition: function (pos) { return pos === top || pos === bottom || pos === center; },
    decodePosition: function (pos) {
      var newPos;
      newPos = isNullOrUndefined(pos) ? " " : pos;
      var aPos = $.isArray(newPos) ? newPos : newPos.split(" ", 2);
      if (!$.isArray(aPos) || !aPos.length > 1) { aPos = [top, left]; }

      return {
        v: this.isValidRelVPosition(aPos[0]) ? aPos[0] : top,
        h: this.isValidRelHPosition(aPos[1]) ? aPos[1] : left
      };
    },
    coordsAreWithinElement: function (x, y, el) {
      var $el,
          offset;
      if (isNaN(x) || isNaN(y) || window.isNullOrUndefined(el)) return false;
      else {
        $el = el instanceof jQuery ? el : $el(el);
        offset = $el.offset();
        return x >= offset.left && x <= offset.left + $el.outerWidth(true) && y >= offset.top && y <= offset.top + $el.outerHeight(true);
      }
    },
    findAncestorWithData: function (el, dataId, dataValue) {
      var $el,
          $parent;

      $el = el instanceof jQuery ? el : $(el);
      $parent = $el.parent();

      return $parent.length === 0
               ? undefined
               : $parent.data(dataId) === dataValue
                 ? $parent
                 : this.findAncestorWithData($parent, dataId, dataValue);
    },
    switchValidation: function ($el, valid) {
      if (valid) { $el.removeClass(validationAlertClass); }
      else { $el.addClass(validationAlertClass); }
    }
  }
};


function PvDomPopupHelperInit() {
  if (window.PvPopupHelper) {
    return;
  }

  var popupCounter,
      currentPopups,
      currentPopupsByDiv,
      defaultPopupCssClass,
      jqContentType,
      literalContentType,
      functionalContentType,
      pvPopupDataId,
      $hiddenElements;

  (function init() {
    popupCounter = 0;
    currentPopups = {};
    currentPopupsByDiv = {};
    jqContentType = "jqContentType";
    literalContentType = "literalContentType";
    functionalContentType = "functionalContentType";
    pvPopupDataId = "pvPopup";
    $hiddenElements = $('body'); // $("<span id='popupHelperHiddenElements' style='display:none;'></div>").appendTo('body');
  } ());


  window.PvPopupHelper = {
    popupCounter: 0,
    $hiddenElements: $hiddenElements,
    addToHiddenElements: function (elements) { $hiddenElements.append(elements); },
    getCurrentPopups: function () { return currentPopups; },
    getPopupById: function (id) { return currentPopups[id]; },
    getPopupBy$Div: function ($div) { return currentPopupsByDiv[$div[0].id]; },
    _create: function (config) {
      var popup;

      function Popup(config) {
        this.getConfigProperty = function (obj, prop, defaultValue) {
          return obj.hasOwnProperty(prop) && !window.IsNullOrEmpty(obj[prop]) ? obj[prop] : (arguments.length > 2 ? arguments[2] : undefined);
        };


        popupCounter += 1;
        this.positioned = false;
        this.cssClass = this.getConfigProperty(config, "popupCssClass", "pvPopup");
        this.containerIdSuffix = "pvPopup";
        this.config = config;
        this.iframeIdSuffix = this.containerIdSuffix + "IFrame";
        this.$triggerEl = this.getConfigProperty(config, "triggerEl", $("body"));
        this.$originEl = this.getConfigProperty(config, "originEl", this.$triggerEl);
        this.id = this.getConfigProperty(config, "id", "pvPopup" + popupCounter.toString());
        this.content = this.getConfigProperty(config, "content", "defaultPopupContent");
        this.origins = this.getConfigProperty(config, "origins", { baseOrigin: "top left", popupOrigin: "top left" });
        this.onAfterPopulate = this.getConfigProperty(config, "onAfterPopulate", function () { });
        this.onAfterHide = this.getConfigProperty(config, "onAfterHide", function () { });
        this.onAfterShow = this.getConfigProperty(config, "onAfterShow", function () { });
        this.populateOnShow = this.getConfigProperty(config, "populateOnShow", true);
        this.parentalUnit = this.getConfigProperty(config, "parentalUnit");
        this.zindex = this.getConfigProperty(config, "zindex", undefined);
        this.sizeToContainer = this.getConfigProperty(config, "sizeToContainer", false);
        this.quirksMode = this.getConfigProperty(config, "quirksMode", false);
        this.animateOpen = this.getConfigProperty(config, "animateOpen", false);
        this.animateDirection = this.getConfigProperty(config, "animateDirection", "down");
        this.overridePosition = this.getConfigProperty(config, "overridePosition", undefined);
        this.offset = this.getConfigProperty(config, "offset", { top: 0, left: 0 });
        this.$div = $("<div id='" + this.id + this.containerIdSuffix + "' class='" + this.cssClass + "' role='menu'></div>").data(pvPopupDataId, true).appendTo($hiddenElements);
        if (config.hasArrow) {
          this.$arrow = $("<div class='arrow'><div class='pvPopupArrow'></div></div>");
        }
        this.populated = false;
        this.children = {};


        if (!window.isNullOrUndefined(this.zindex)) {
          this.$div.css("z-index", this.zindex);
        }

        this.toggle = function (newContent) {
          if (this.isVisible()) { this.hide(); }
          else { this.show(newContent); }
        };

        this.setTriggerElement = function (el) {
          this.$triggerEl = el instanceof jQuery ? el : $(el);
        };
        this.setOriginElement = function (el) {
          this.$originEl = el instanceof jQuery ? el : $(el);
          this.positioned = false;
        };
        this.setOrigins = function (origins) {
          this.config.origins = origins;
          this.origins = origins;
        }
        this.setOverridePosition = function (overridePosition) { this.overridePosition = overridePosition; }
        this.setCss = function (css) {
          this.$div.css(css);
        };
        this.setStyle = function (attr, val) {
          this.$div.css(attr, val);
        };
        this.getWidth = function () {
          return this.$div.width();
        };
        this.setWidth = function (width) {
          if ("auto" === width) this.setCss({ width: "auto" });
          else {
            this.$div.width(width);
          }
        };
        this.setHeight = function (height) {
          this.$div.height(height);
        }
        this.setOnAfterHide = function (onAfterHide) { this.onAfterHide = onAfterHide; }
        this.setOnAfterShow = function (onAfterShow) { this.onAfterShow = onAfterShow; }
        this.isVisible = function () { return this.$div.is(":visible"); }
        this.addChild = function (child) {
          this.children[child.id] = child;
          child.parentalUnit = this;
        };
        this.removeChild = function (child) { delete this.children[child.id]; }
        this.hide = function () {
          this.showing = false;
          this.$triggerEl.trigger("onBeforeHide");
          this.$triggerEl.removeClass('active');
          this.$div.hide();
          this.onAfterHide();
          return this;
        };

        this.showOnElement = function (newContent, originElement, triggerElement, origins, overridePosition) {
          if (!window.isNullOrUndefined(triggerElement)) { this.setTriggerElement(triggerElement); }
          if (!window.isNullOrUndefined(originElement)) { this.setOriginElement(originElement); }
          if (!window.isNullOrUndefined(origins)) { this.setOrigins(origins); }
          this.setOverridePosition(overridePosition);
          this.show(newContent);
        };

        this.handleChangeVisualState = function () {
        };

        this.setSizeToContainer = function (sizeToContainer) {
          this.sizeToContainer = sizeToContainer;
        };

        this.show = function (newContent) {
          this.showing = true;
          var focusElement, selectElement;
          if (!window.isNullOrUndefined(newContent) || !this.populated || this.populateOnShow) { this.populateContent(newContent); }

          
          
          
          var originalOverflow = $('body').css('overflow');
          $('body').css('overflow', 'hidden');
          

          
          
          var that = this;
          if (this.animateOpen) {
            this.$div.slideDown();
            setTimeout(function () { that.$div.slideDown(); }, 1);
          } else {
            this.$div.show();
            setTimeout(function() { that.$div.show(); }, 1);
          }
          if (this.sizeToContainer) { this.$div.css({ "min-width": this.$triggerEl.outerWidth(true) + "px" }); }
          this.positionOnOriginElement();
          this.onAfterShow();
          $('body').css('overflow', originalOverflow);
          this.$triggerEl.addClass('active');
            
          selectElement = this.$div.find(':tabbable.selected')[0];
          focusElement = this.$div.find(':tabbable:first')[0];
          if (selectElement) {
            selectElement.focus();
          }
          else if (focusElement) {
              focusElement.focus();
          }
            
          return this;
        };

        this.positionOnOriginElement = function () {
          PvUiHelper.positionElementOnElement(this.$div, this.origins.popupOrigin, this.$originEl, this.origins.baseOrigin, this.overridePosition, this.offset);
          
          if (config.hasArrow) {
            this.$arrow.css('top', this.$originEl.offset().top - this.$div.offset().top);
          }
          this.positioned = true;
          return this;
        };

        this.populateContent = function (newContent) {
          var popupContent, $contentElement;

          popupContent = this.getJQContent(window.isNullOrUndefined(newContent) ? this.content : newContent);
          $contentElement = $(".pvPopup-content", this.$div);
          if (!Planview.hasValue(newContent) || $contentElement.length < 1) { $contentElement = this.$div;}
          $contentElement.empty();
          
          popupContent.appendTo($contentElement).show();

          if (config.hasArrow && (config.origins && config.origins.baseOrigin == "top right")) { this.$arrow.css({ 'z-index': 100, 'position': 'absolute', 'left': -10 }).prependTo($contentElement); }
          this.populated = true;
          if (typeof this.content !== "function") { this.content = popupContent; }
          this.addAccessibility(popupContent);
          this.onAfterPopulate();
        };

        this.getJQContent = function (rawContent) {
          var jqContent;

          switch (this.getContentType(rawContent)) {
            case jqContentType:
              jqContent = rawContent;
              break;
            case literalContentType:
              jqContent = $(rawContent);
              break;
            case functionalContentType:
              jqContent = this.getJQContent(rawContent());
              break;
          }

          return jqContent;
        };

        this.getContentType = function (content) {
          return content instanceof jQuery
                    ? jqContentType
                    : typeof content === "function"
                      ? functionalContentType
                      : literalContentType;
        };

        this.coordsAreWithin = function (x, y, lookInTrigger) {
          var inAChild,
              propName,
              child;

          inAChild = false;
          for (propName in this.children) {
            if (this.children.hasOwnProperty(propName)) {
              child = this.children[propName];
              if (child.isVisible() && child.coordsAreWithin(x, y)) {
                inAChild = true;
                break;
              }
            }
          }
          if (!inAChild && lookInTrigger) inAChild = PvUiHelper.coordsAreWithinElement(x, y, this.$triggerEl);
          return inAChild || PvUiHelper.coordsAreWithinElement(x, y, this.$div);
        };

        this.elementIsWithin = function (el) {
          var inside = el === this.$triggerEl[0] || $.contains(this.$div[0], el) || el === this.$div[0] || $.contains(this.$triggerEl[0], el);
          if (!inside) {
            for (propName in this.children) {
              if (this.children.hasOwnProperty(propName)) {
                child = this.children[propName];
                inside = child.elementIsWithin(el);

              }
              if (inside) break;
            }
          }
          return inside;
        };

        this.addAccessibility = function (content) {
            var self = this, ul;
            
          
            if ($(content).is('ul')) {
                ul = content;
            } else {
                ul = content.find('ul.banner-list-menu')[0];
            }

            if (ul) {
              $(content).unbind('keydown');
                $(ul).attr('role', 'menu');
                $(ul).find('li').each(function () {
                    $(this).attr('role', 'menuitem');
                });
                
                $(content).on('keydown', function (e) {
                  var newSelectItem, found, searchChar;
                  var listItems = $(this).find("li, .fasttrack-menuitem-container");
                  var currentIndex = 0;
                  var oldSelectItem = $(this).find('li:focus, .fasttrack-menuitem-container:focus')[0];
                  if (Planview.isDefined(oldSelectItem)) {
                    currentIndex = listItems.index(oldSelectItem);
                  }
                  
                    if (!$(this).is($(document.activeElement))) {
                        
                    }
                    
                    switch (e.keyCode) {
                      case 9:
                        if (e.shiftKey) {
                          if (Planview.isDefined(oldSelectItem)) {
                            currentIndex--;
                            if (currentIndex < 0) {
                              
                              currentIndex = listItems.length - 1;
                            }
                          }
                          newSelectItem = listItems[currentIndex];
                          $(newSelectItem).focus();
                          e.preventDefault();
                        } else {
                          if (Planview.isDefined(oldSelectItem)) {
                            currentIndex++;
                            if (currentIndex >= listItems.length) {
                              
                              currentIndex = 0;
                            }
                          }
                          newSelectItem = listItems[currentIndex];
                          $(newSelectItem).focus();
                          e.preventDefault();
                        }
                        break;
                      case 37:
                        
                        if (oldSelectItem) {
                          var hasLeftMenu = $(oldSelectItem).find('.aim-left-small-icon:visible').length > 0;
                          if (hasLeftMenu) {
                            $(oldSelectItem).trigger('mouseenter');
                          }
                        }
                        break;
                      case 38:
                        
                        if (Planview.isDefined(oldSelectItem)) {
                          currentIndex--;
                          if (currentIndex < 0) {
                            
                            currentIndex = listItems.length - 1;
                          }
                        }
                        newSelectItem = listItems[currentIndex];
                        $(newSelectItem).focus();
                            break;
                        case 39:
                          
                          if (oldSelectItem) {
                            var hasRightMenu = $(oldSelectItem).find('.aim-right-small-icon:visible').length > 0 || $(oldSelectItem).hasClass('flyout-trigger');
                            if (hasRightMenu) {
                              $(oldSelectItem).trigger('mouseenter');
                            }
                          }
                            break;
                      case 40:
                          
                        if (Planview.isDefined(oldSelectItem)) {
                            currentIndex++;
                            if (currentIndex >= listItems.length) {
                              
                              currentIndex = 0;
                            }
                          }
                          newSelectItem = listItems[currentIndex];
                          $(newSelectItem).focus();
                          break;
                        case 13:
                        case 32:
                            
                            if (oldSelectItem) {
                                $(oldSelectItem).removeClass('selected');
                                if ($(oldSelectItem).hasClass('flyout-trigger') || $(oldSelectItem).find('.aim-right-small-icon:visible, .aim-left-small-icon:visible').length > 0) {
                                    
                                    $(oldSelectItem).trigger('mouseenter');
                                } else {
                                    
                                    $(oldSelectItem).trigger('click');
                                }
                            }
                            break;
                        default:
                            if (!oldSelectItem) {
                                
                                newSelectItem = $(this).children('li')[0];
                            } else {
                                
                                $(oldSelectItem).removeClass('selected');
                                newSelectItem = $(oldSelectItem).next();
                            }
                            
                            
                            if (e.keyCode >= 48 && e.keyCode <= 122) {
                                
                                searchChar = String.fromCharCode(e.keyCode).toUpperCase();
                                
                                while ($(newSelectItem).is('li')) {
                                    if (searchChar === $($(newSelectItem).children('a')[0]).text().charAt(0)) {
                                        found = true;
                                        break;
                                    } else {
                                        newSelectItem = $(newSelectItem).next();
                                    }
                                }
                                if (!found) {
                                    
                                  newSelectItem = $(this).find('li').first();
                                    while ($(newSelectItem).is('li')) {
                                        if (searchChar === $(newSelectItem).text().charAt(0)) {
                                            found = true;
                                            break;
                                        } else {
                                            newSelectItem = $(newSelectItem).next();
                                        }
                                    }
                                }

                                $(newSelectItem).addClass('selected');
                            }
                            break;
                        }
                    });
            }
            
            
            content.on('keydown', function (e) {
                if (e.keyCode === 27) {
                    
                    self.hide();

                    $(self.$triggerEl).focus();
                  
                    if (!$(self.$triggerEl).is($(document.activeElement))) {
                        $(self.$triggerEl).parent('[tabindex="0"]').focus();
                    }
                }
            });
        };
      } 

      popup = new Popup(config);
      currentPopups[popup.id] = popup;
      currentPopupsByDiv[popup.$div[0].id] = popup;
      popup._destroy = function () {
        delete currentPopups[this.id];
        delete currentPopupsByDiv[this.$div[0].id];
        this.$div.remove();
      };
      popup.destroy = function () {
        this._destroy();
      };
      return popup;
    }
  };
};

function PvDomTooltipHelperInit() {
  if (window.PvTooltipHelper) {
    return;
  }

  window.PvTooltipHelper = {
    hoverDelay: 700,
    _create: function (config) {
      var tooltip, baseShow, $closeButton, keepAliveOnTooltipHover;

      config.content = this.getTooltipMarkup(config);
      config.popupCssClass = "pvTooltip";

      if (config.onAfterShow) {
        config.onAfterShow = function () { this.handleOnAfterShow(); config.onAfterShow(); }
      }
      else {
        config.onAfterShow = this.handleOnAfterShow;
      }

      config.pointerAxis = config.pointerAxis ? config.pointerAxis : "vertical";

      tooltip = PvPopupHelper._create(config);

      tooltip.handleMouseLeave = function () {
        if (tooltip.showing) {
          tooltip.mouseOutTimeOut = setTimeout(function () {
            tooltip.hide();
          }, 200);
        }
        if (tooltip.queuedToShow) {
          tooltip.queuedToShow = false;
        }

        
        
        if (tooltip.mouseEnterTimeout) {
          clearTimeout(tooltip.mouseEnterTimeout);
          delete tooltip.mouseEnterTimeout
        }
      };

      tooltip.handleMouseEnter = function () {
        if (tooltip.showing) {
          if (tooltip.mouseOutTimeOut) {
            clearTimeout(tooltip.mouseOutTimeOut);
            delete tooltip.mouseOutTimeOut;
          }
        }
      };

      tooltip.updateTitle = function (title) {
        $("#tooltipTitle", tooltip.$div).html("<span>" + title + "</span>");
      }

      keepAliveOnTooltipHover = !Planview.hasValue(config.keepAliveOnTooltipHover) || config.keepAliveOnTooltipHover;
      tooltip.$triggerEl.on("mouseleave", tooltip.handleMouseLeave);
      tooltip.$triggerEl.on("mouseenter", tooltip.handleMouseEnter);
      
      if (keepAliveOnTooltipHover) {
        tooltip.$div.on("mouseleave", tooltip.handleMouseLeave);
        tooltip.$div.on("mouseenter", tooltip.handleMouseEnter);
      }

      return tooltip;
    },
    
    handleOnAfterShow: function () {
      var $pointerContainer, pointerWidth, pointerHeight, triggerWidth, divWidth,
          pointerLeftOffset, pointerTopOffset, pointerRotate,
          popupOrigin, popupOriginVertical, popupOriginHorizontal,
          $pointer, parentOffset, newParentLeft, newParentTop, $closeButton, tooltip;

      $pointerContainer = $("#pvToolTip-pointer-container", this.$div);
      $pointer = $('polygon', $pointer);
      pointerTopOffset = 0;
      triggerWidth = this.$triggerEl.width();
      pointerHeight = 11;
      pointerWidth = 12;
      divWidth = this.$div.width();
      pointerRotate = 0;
      parentOffset = this.$div.offset();
      newParentLeft = parentOffset.left;
      newParentTop = parentOffset.top;

      if (this.config.showCloseButton) {
        tooltip = this;
        $closeButton = $("#" + tooltip.config.id + "close-button", tooltip.config.content);
        $closeButton.one("click", function () {
          tooltip.hide();
        });
      }

      
      popupOrigin = this.origins.popupOrigin.split(" ");
      popupOriginVertical = popupOrigin[0];
      popupOriginHorizontal = popupOrigin[1];
      
      if ("vertical" == this.config.pointerAxis) {
        pointerTopOffset = -1 * pointerHeight;
        if (this.config.pointerOrigin == "right") {
          pointerLeftOffset = divWidth - 1.75 * pointerWidth;
        }
        else {
          if (this.config.pointerOrigin == "left") {
            pointerLeftOffset = pointerWidth / 4;
          }

          else {
            if ($pointer.length > 0) {
              if (triggerWidth > divWidth) {
                
                pointerLeftOffset = (divWidth / 2) - (pointerWidth / 2);

              }
              else {
                
                pointerLeftOffset = divWidth - triggerWidth + (triggerWidth / 2) - (pointerWidth / 2);
              }

            }

          }
        }
      }
      else {
        if (this.config.pointerOrigin == "bottom") {
          pointerTopOffset = this.$div.height() - (pointerHeight);
        }
        else {
          if (this.config.pointerOrigin == "center") {
            pointerTopOffset = (this.$div.height() / 2) - (pointerHeight / 2);
          }
          else {
            pointerTopOffset = 1;
          }
        }

        if ("left" == popupOriginHorizontal) {
          pointerRotate = 270;
          pointerLeftOffset = -1 * pointerHeight + 2;
          newParentLeft = newParentLeft;
        }
        else {
          pointerRotate = 90;
          
          pointerLeftOffset = divWidth - (pointerWidth / 2) - 2;

        }

      }

      this.$div.css({ left: newParentLeft, top: newParentTop });
      $pointerContainer.css({ left: pointerLeftOffset, top: pointerTopOffset });
      $pointer.attr("transform", "rotate(" + pointerRotate + " 9 9)");

    },

    getTooltipMarkup: function (config) {
      var title, content, $tooltipContent, $tooltipTitle, $markup, $titleContainer, $contentContainer, $closeButton,
          showCloseButton;

      title = config.title;
      content = config.content;
      showCloseButton = config.showCloseButton;

      $tooltipTitle = title instanceof jQuery ? title : $('<span>' + title + '</span>');
      $tooltipContent = content instanceof jQuery ? content : $(content);
     
      $markup = $('<div>' + 
                    '<svg id="pvToolTip-pointer-container" xmlns="http://www.w3.org/2000/svg" version="1.1">' +
                      '<polygon class="pvToolTip-arrow-up" points="0,9 18,9 9,0" style="fill: #003e7e; stroke-width: 1px; stroke:#003e7e;"/>' +
                    '</svg>' +
                  '</div>');

      $titleContainer = $('<h4 id="tooltipTitle" />').append($tooltipTitle).appendTo($markup);

      if (showCloseButton) {
        console.log(config.id + "close-button");
        $closeButton = $('<span id="' + config.id + 'close-button" class="gray-button close-affordance squared-close-affordance no-margin">✖</span>');
        $closeButton.appendTo($titleContainer);
      }

      $contentContainer = $('<div class="pvTooltip-content pvPopup-content" />').append($tooltipContent).appendTo($markup);
      
      return $markup;
    },

    getPointerMarkup: function () {


    }
  }
}


function PvDomMenuHelperInit() {
  if (window.PvMenuHelper) {
    return;
  }

  var currentMenus,
      currentMenusByDiv,
      pvPopupMenuDataId;

  (function init() {
    currentMenus = {};
    currentMenusByDiv = {};
    pvPopupMenuDataId = "pvPopupMenu";
  })();

  window.PvMenuHelper = {
    getMenuById: function (id) { return currentMenus[id]; },
    getMenuBy$Div: function ($div) { return currentMenusByDiv[$div[0].id]; },
    hideItemWithElement: function (element, hideAll) {
      var itemWithElement,
          menu;

      itemWithElement = window.PvUiHelper.findAncestorWithData(element, pvPopupMenuDataId, true);
      if (!window.isNullOrUndefined(itemWithElement)) {
        menu = this.getMenuBy$Div(itemWithElement);
        if (!window.isNullOrUndefined(menu)) { menu.hide(); }
      }
    },

    _create: function (config) {
      var menu;
      function protoMenu() {
        this.handleClosingEvent = function(evt) {
          var menu,
              fHide,
              srcElement;
          menu = evt.data.menu;
          fHide = false;
          if (!isNullOrUndefined(menu)) {
            if (evt.type === "click" && (evt.srcElement || (evt.originalEvent && evt.originalEvent.originalTarget))) {
              srcElement = evt.srcElement ? evt.srcElement : evt.originalEvent.originalTarget;
              fHide = !menu.elementIsWithin(srcElement); 
            }
            else { fHide = true; }
            if (fHide) { menu.hideMenu(); }
            }

          }

        this.removeClosingHandlers = function() {
          $(document).off("click", this.handleClosingEvent);
          
        };
      };
      protoMenu.prototype = PvPopupHelper._create(config);
      menu = new protoMenu();
      menu.hasVisibleItems = true;
      menu.destroy = function () {
        protoMenu.prototype.destroy();
        delete currentMenusByDiv[this.$div[0].id];
        delete currentMenus[this.id];
      }
      menu.$div.data(pvPopupMenuDataId, true);
      currentMenusByDiv[menu.$div[0].id] = menu;
      currentMenus[menu.id] = menu;
      menu.$div.blur = (function() { menu.hideMenu(); });

      menu.toggle = function (newContent, originElement, triggerElement, origins, overridePosition) {
        if (this.hasVisibleItems) {
          if (this.isVisible()) {
            this.hideMenu();
            
            this.config.triggerEl.focus();
          }
          else { this.showMenu(newContent, originElement, triggerElement, origins, overridePosition); }
        }
      }

      menu.hideControl = function () {
        this.hideMenu();
        this.$triggerEl.hide();
        return this;
      }
      menu.showControl = function () {
        this.$triggerEl.show();
        return this;
      }
      menu.showMenu = function (newContent, originElement, triggerElement, origins, overridePosition) {
        var trigEl, $eventEaters, $eventEater, $eventCatcher;
        trigEl = isNullOrUndefined(triggerElement)
            ? !isNullOrUndefined(originElement) ? originElement : null
            : triggerElement;
        protoMenu.prototype.showOnElement(newContent, originElement, trigEl, origins, overridePosition);
        if (!window.isNullOrUndefined(this.parentalUnit)) { this.parentalUnit.addChild(this); }
        $(document).on("click", { menu: this }, this.handleClosingEvent);


        $eventEaters = $('#PV_SilverlightHostDiv,iframe:visible');
        $eventEaters.each(function(index,eventEater) {
          $eventEater = $(eventEater);
          if($eventEater.data('eventCatcher') == undefined)
          {
            $eventCatcher = $('<div/>').css({
              position:'absolute',
              background:'url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)',
              zIndex:450,
              left:$eventEater.offset().left,
              top:$eventEater.offset().top,
              width:$eventEater.width(),
              height:$eventEater.height()
            }).addClass('event-catcher');
            $('body').append($eventCatcher);
            $eventEater.data('eventCatcher',$eventCatcher);
          }

          $eventCatcher = $eventEater.data('eventCatcher');
          $eventCatcher.css({
            left:$eventEater.offset().left,
            top:$eventEater.offset().top,
            width:$eventEater.width(),
            height:$eventEater.height()
          }).show();
        });
        menu.$triggerEl.trigger("showmenu");
        return this;
      }

      menu.populateContent = function (content) {
        protoMenu.prototype.populateContent(content);
      }

      menu.hideMenu = function (hideAll) {
        var propName;
        if (hideAll) {
          if (!window.isNullOrUndefined(this.parentalUnit)) { this.parentalUnit.hide(hideAll); }
          else {
            for (propName in this.children) { if (this.children.hasOwnProperty(propName)) { this.children[propName].hide(); } }
            this.hide();
          }
        }
        else {
          if (!window.isNullOrUndefined(this.parentalUnit)) { this.parentalUnit.removeChild(this); }
          protoMenu.prototype.hide();
          this.removeClosingHandlers();
        }

        $('.event-catcher').hide();
        return this;
      }

            menu.setOnAfterHide = function(onAfterHide) {
                protoMenu.prototype.onAfterHide = onAfterHide;
            }
            menu.setOnAfterShow = function(onAfterShow) {
                protoMenu.prototype.onAfterShow = onAfterShow;
            }
            return menu;
        }
    };
};


$(document).ready(function () {
  var selectMenus;

  (function init() {
    selectMenus = {};
  })();

  window.pvSelectMenuHelper = {
    selectMenus: selectMenus,
    getSelectById: function(id) { return selectMenus[id]; },


    getSelectByTriggerElementId: function(id) {
      var select, tempSelect;

      tempSelect = undefined;
      selectCount = this.selectMenus.length;
      for (selectId in selectMenus) {
        if (selectMenus.hasOwnProperty(selectId)) {
          tempSelect = this.selectMenus[selectId];
          if (tempSelect.$triggerEl[0].id == id) {
            select = tempSelect;
            break;
          }
        }
      }
      return select;
    },
    
    



    getContainerTemplate: function (id, label) {
        var result;
            
        if (label) {
            result = [
                '<span id="' + id + '" tabindex="0" role="menu" class="pvSelectContainer form-field">',
                '   <span class="columnSetLabel">' + label + ':</span>', 
                '   <span class="selectedText" ></span>',
                '   <span class="affordance" >&#9660;</span>',
                '</span>'
            ].join('');
        } else {
            result = [
                '<span id="' + id + '" tabindex="0" role="menu" class="pvSelectContainer form-field">',
                '   <span class="selectedText" ></span>',
                '   <span class="affordance" >&#9660;</span>',
                '</span>'
            ].join('');
        }

        return result;
    },

    _create: function (selectMenuConfig) {
      var menuShown = false;
      
      if (pvSelectMenuHelper.getSelectById(selectMenuConfig.id)) {
        pvSelectMenuHelper.getSelectById(selectMenuConfig.id).destroy();
      }
      
      
      
      if (!selectMenuConfig.hasOwnProperty("origins")) {
        selectMenuConfig.origins = { baseOrigin: "bottom right", popupOrigin: "top right" };
      };

      if (!selectMenuConfig.hasOwnProperty("populateOnShow")) {
        selectMenuConfig.populateOnShow = false;
      };

      var selectMenu;

      function protoSelect() {

        this.content = undefined;
        this.populateSelect = function () {
            var content = this.getSelectContent();
            this.populateContent(content);
            this.addAccessibility(content);
            return this;
        };

        this.addAccessibility = function (content) {
          var self = this, ul;
            
            
            if ($(content).is('ul')) {
                ul = content;
            } else {
                ul = content.find('ul.banner-list-menu')[0];
            }
          
            if (ul == undefined) {
              ul = content;
            }
            
            if (ul) {
              $(ul).unbind('keydown');
              $(ul).attr('role', 'menu');
              $(ul).find('li').each(function () {
                $(this).attr('role', 'menuitem');
              });

              $(ul).on('keydown', function (e) {
                var newSelectItem, i, searchChar;
                var currentIndex = 0;

                var listItems = $(this).find(":tabbable");
                var oldSelectItem = $(this).find('li:focus, button:focus')[0];
                
                
                
                
                if (Planview.isDefined(oldSelectItem)) {
                  currentIndex = listItems.index(oldSelectItem);
                }
                switch (e.keyCode) {
                  case 9:
                    if (e.shiftKey) {
                      if (Planview.isDefined(oldSelectItem)) {
                        currentIndex--;
                        if (currentIndex < 0) {
                          
                          currentIndex = listItems.length - 1;
                        }
                      }
                      newSelectItem = listItems[currentIndex];
                      $(newSelectItem).focus();
                      e.preventDefault();
                    } else {
                      if (Planview.isDefined(oldSelectItem)) {
                        currentIndex++;
                        if (currentIndex >= listItems.length) {
                          
                          currentIndex = 0;
                        }
                      }
                      newSelectItem = listItems[currentIndex];
                      $(newSelectItem).focus();
                      e.preventDefault();
                    }
                    break;
                  case 27:
                    
                    $(selectMenuConfig.triggerEl).trigger('click');
                    break;
                  case 38:
                    
                    if (Planview.isDefined(oldSelectItem)) {
                      currentIndex--;
                      if (currentIndex < 0) {
                        
                        currentIndex = listItems.length - 1;
                      }
                    }
                    newSelectItem = listItems[currentIndex];
                    $(newSelectItem).focus();
                    e.preventDefault();
                    break;
                  case 40:
                    
                    if (Planview.isDefined(oldSelectItem)) {
                      currentIndex++;
                      if (currentIndex >= listItems.length) {
                        debugger;
                        
                        currentIndex = 0;
                      }
                    }
                    newSelectItem = listItems[currentIndex];
                    $(newSelectItem).focus();
                    e.preventDefault();
                    break;
                  case 13:
                  case 32:
                    
                    self.getClickAction(self, self.selectItems[currentIndex])(e);
                    e.preventDefault();
                    break;
                  default:
                    
                    
                    if (e.keyCode >= 48 && e.keyCode <= 122) {
                      
                      searchChar = String.fromCharCode(e.keyCode).toUpperCase();
                      
                      for (i = currentIndex + 1; i < self.selectItems.length; i++) {
                        if (searchChar === self.selectItems[i].displayText.charAt(0)) {
                          self.setSelection(self.selectItems[i], true);
                          return;
                        }
                      }
                      
                      for (i = 0; i < currentIndex; i++) {
                        if (searchChar === self.selectItems[i].displayText.charAt(0)) {
                          self.setSelection(self.selectItems[i], true);
                          return;
                        }
                      }
                    }
                    break;
                }
              });
            }
            
            
            content.on('keydown', function (e) {
                if (e.keyCode === 27) {
                    
                    self.hide();

                    $(self.$triggerEl).focus();
                  
                    if (!$(self.$triggerEl).is($(document.activeElement))) {
                        $(self.$triggerEl).parent('[tabindex="0"]').focus();
                    }
                }
            });
        };

        this.getListItem = function (selectItem) {
          var $itemLi;

          if (Planview.hasValue(selectItem.customMarkup)) {
            $itemLi = $(selectItem.customMarkup);
          } else {
            var hoverText;
            if (Planview.hasValue(selectItem.hoverText)) {
              hoverText = selectItem.hoverText;
            } else {
              hoverText = selectItem.displayText;
            }
            $itemLi = $("<li role='menuitem' title='" + hoverText + "' tabIndex='0'>" + selectItem.displayText + "</li>");
          }
          
          if (selectItem.hasOwnProperty('disabled') && selectItem.disabled) {
            $itemLi.attr('disabled', true);
          }
          $itemLi.click(this.getClickAction(this, selectItem));
          selectItem.$itemLi = $itemLi;
          return $itemLi;
        };

        this.getSelectContentBase = function() {
          var $content,
              $itemLi,
              selectItemKey,
              selectItem,
              foundSelectedItem,
              itemCounter,
              self,
              filteredItems,
              itemCounter = 0,
              tmpItemCounter,
              tmpItem;
          
          if (this.config.hasOwnProperty("selectItems")) {
            filteredItems = this.filterItems(this.config.selectItems);
            this.selectItems = new Array();
            if ($content) {
              $content.remove();
            }
            $content = $("<ul class='" + this.selectCssClass + "' tabindex='0' role='menu'></ul>").appendTo(PvPopupHelper.$hiddenElements);
            
            for (selectItemKey in filteredItems) {
              if (filteredItems.hasOwnProperty(selectItemKey)) {
                if (filteredItems[selectItemKey].selected) {
                  foundSelectedItem = true;
                }
              }
            }
            
            if (!foundSelectedItem && filteredItems && filteredItems.length > 0 && selectMenu.selectDefault) {
              if (selectMenu.selectLastItemByDefault) {
                filteredItems[filteredItems.length - 1].selected = true;
              }
              else {
                filteredItems[0].selected = true;
              }
              
              
              for (tmpItemCounter = 0; tmpItemCounter < this.config.selectItems; tmpItemCounter++) {
                tmpItem = this.config.selectItems[tmpItemCounter];
                if (tmpItem.selected) {
                  tmpItem.selected = false;
                  if (tmpItem.$itemLi) {
                    tmpItem.$itemLi.removeClass("selected");
                  }
                }
              }

            } else {
                if (!selectMenu.selectDefault && selectMenu.initialText != '') {
                    this.$selectedTextItem.html("<span style= 'font-style:italic;'>" + selectMenu.initialText + "</span>");
                    this.$selectedTextItem.parent().attr("title", selectMenu.initialText);
                }
            }
              
            for (selectItemKey in filteredItems) {
              if (filteredItems.hasOwnProperty(selectItemKey)) {
                selectItem = filteredItems[selectItemKey];
                $itemLi = this.getListItem(selectItem);

                $itemLi.appendTo($content);
                
                if (selectItem.selected) {
                  this.setSelection(selectItem, !this.performInitAfterSelect);
                }

                this.selectItems[itemCounter++] = selectItem;
              }
            }
          }
          this.$content = $content;
          return $content;
        };

        this.setSelection = function (selectedItem, dontPerformAfterSelect) {
          var selectedMarkup;
          if (!isNullOrUndefined(this.selectedItem) && this.selectedItem.$itemLi) {
            this.selectedItem.$itemLi.removeClass("selected");
          }
          this.selectedItem = selectedItem;
          if (this.selectedItem.$itemLi) {
            this.selectedItem.$itemLi.addClass("selected");
          }

          if (selectedItem.customSelectedMarkup) {
            if ("function" === typeof selectedItem.customSelectedMarkup) {
              selectedMarkup = selectedItem.customSelectedMarkup(this.selectedItem);
            }
            else {
              selectedMarkup = selectedItem.customSelectedMarkup;
            }

          }
          else {
            selectedMarkup = selectedItem.displayText;
          }

          this.$selectedTextItem.html(selectedMarkup);
          if (Planview.hasValue(selectedItem.hoverText)) {
            this.$selectedTextItem.parent().attr("title", selectedItem.hoverText);
          } else {
            this.$selectedTextItem.parent().attr("title", selectedItem.displayText);
          }
          if (!this.disabled) {
            this.$formField.val(selectedItem.value);
            if ("function" === typeof this.afterSelect && !dontPerformAfterSelect) {
              this.afterSelect(selectedItem);
              this.$triggerEl.trigger("afterSelect", [{ selectItem: selectedItem, control: this }]);
            }
          }
        };

        this.setSelectionByValue = function (newValue, dontPerformAfterSelect) {
          var itemCounter, itemCount, item;
          itemCount = this.selectItems.length;
          for (itemCounter = 0; itemCounter < itemCount; itemCounter++) {
            item = this.selectItems[itemCounter];
            if (item.value == newValue) {
              break;
            }
          }
          if (!isNullOrUndefined(item)) {
            this.setSelection(item, dontPerformAfterSelect);
          }

        };

        this.getItemByValue = function (value) {
          var itemCounter, itemCount, item, itemByValue;
          itemCount = this.selectItems.length;
          for (itemCounter = 0; itemCounter < itemCount; itemCounter++) {
            item = this.selectItems[itemCounter];
            if (item.value == value) {
              itemByValue = item;
              break;
            }
          }

          return itemByValue;

        };

        this.getClickAction = function(menu, selectItem) {
          if (typeof selectItem.clickAction !== "function") {
            selectItem.clickAction = function() {
            };
          }
          return function () {
            var disabled = selectItem.hasOwnProperty('disabled') && selectItem.disabled;
            var selectable = !selectItem.hasOwnProperty('selectable') || (selectItem.hasOwnProperty('selectable') && selectItem.selectable);

            
            if (disabled || !selectable) {
              
            }
            else {
              menu.hide();
              menu.setSelection(selectItem);
              
              menu.config.triggerEl.focus();
              selectItem.clickAction(arguments);
              
              
              
              
              
            }
          }
        };
      }

      selectMenuConfig.sizeToContainer = true;
      protoSelect.prototype = PvMenuHelper._create(selectMenuConfig);
      selectMenu = new protoSelect();
      selectMenu.selectItems = [];
      selectMenu.$formParent = undefined;
      selectMenu.$formField = undefined;
      selectMenu.selectedItem = undefined;
      selectMenu.selectLastItemByDefault = selectMenu.getConfigProperty(selectMenuConfig, "selectLastItemByDefault", false);
      selectMenu.selectDefault = selectMenu.getConfigProperty(selectMenuConfig, "selectDefault", true);
      selectMenu.initialText = selectMenu.getConfigProperty(selectMenuConfig, "initialText", '');
      selectMenu.disabled = selectMenu.getConfigProperty(selectMenuConfig, "disabled", false);
      selectMenu.$formParent = selectMenu.getConfigProperty(selectMenuConfig, "formParent", $('form').eq(0));
      selectMenu.selectCssClass = selectMenu.getConfigProperty(selectMenuConfig, "selectCssClass", 'pvSelectMenu');
      selectMenu.getSelectContent = selectMenu.getConfigProperty(selectMenuConfig, "getSelectContent", selectMenu.getSelectContentBase);
      selectMenu.afterInitialSize = selectMenu.getConfigProperty(selectMenuConfig, "afterInitialSize", function () { });
      selectMenu.performInitialSize = selectMenu.getConfigProperty(selectMenuConfig, "performInitialSize", true);
      
      selectMenu.performInitAfterSelect = selectMenu.getConfigProperty(selectMenuConfig, "performInitAfterSelect", selectMenu.getSelectContent);
      selectMenu.$selectedTextItem = $(".selectedText", selectMenu.$triggerEl);
      
      
      selectMenu.filterItems = selectMenu.getConfigProperty(selectMenuConfig, "filterItems", function (baseItems) {
        return baseItems;
      });
      selectMenu.accountedForScrollBars = false;
      selectMenu.initializeSize = function () {
        var $ul, liHeight, thisMagicNumber, defaultHeight, initialVisibility;

        initialVisibility = selectMenu.isVisible();

        if (!initialVisibility) {
          selectMenu.$div.show();
        }
        $ul = selectMenu.$div.find("ul.pvSelectMenu");
        var ulWidth = $ul.width();
        
        
        defaultHeight = 300;

        
        
        liHeight = 0;
        if ($ul.length > 0) {
          $($ul.children()).each(function () {
            liHeight += $(this).outerHeight(true);
          });
          
          if (liHeight > defaultHeight && !selectMenu.accountedForScrollBars) {
            thisMagicNumber = 10;
            $ul.width($ul.width() + Planview.Browser.ScrollbarDimensions().width + thisMagicNumber);
            selectMenu.accountedForScrollBars = true;
          }
        }
        if (!initialVisibility) {
          selectMenu.$div.hide();
        }

        selectMenu.afterInitialSize(ulWidth);
      };

      
      
      if (selectMenu.performInitialSize) {
        selectMenu.$triggerEl.on("showmenu", function () {
          selectMenu.initializeSize();
          selectMenu.$triggerEl.off("showmenu")

        });
      }

      selectMenu.toggleEnablement = function (enabled) {
        var onOrOff = !isNullOrUndefined(enabled) ? enabled : this.disabled;
        if (onOrOff) {
          selectMenu.$triggerEl.removeClass("disabled");
        }
        else {
          selectMenu.$triggerEl.addClass("disabled");
          selectMenu.hideMenu();
        }
        selectMenu.disabled = !onOrOff;
      };
      
      selectMenu.selectInitialText = function () {  
        var selectInitialItem = { displayText: selectMenu.initialText, selected: true, value: "" };
        selectMenu.setSelection(selectInitialItem, true);
      };
      
      if (selectMenu.disabled) {
        selectMenu.toggleEnablement(false);
      }
      else {
        selectMenu.afterSelect = selectMenu.getConfigProperty(selectMenuConfig, "afterSelect", function () {
        });
        selectMenu.$formField = $("<input id='" + selectMenuConfig.id + "HiddenFormField' name='" + selectMenuConfig.id + "' type='hidden' />").appendTo(selectMenu.$formParent);
        selectMenu.$triggerEl.hover(function () { $(".affordance", $(this)).toggleClass("hover"); }, function () { $(".affordance", $(this)).toggleClass("hover"); });
        selectMenu.$triggerEl.click(function () { if (!selectMenu.disabled) { selectMenu.toggle(); }});
        selectMenu.$triggerEl.on('keydown', function (e) {
          
          if (e.keyCode === 13 || e.keyCode === 32) {
            
            selectMenu.toggle();
          }
        });
      };

      
      selectMenu.handleItemDeleteProxy = function (deletedItem) {
        var itemCount, itemCounter, item;
        itemCount = this.selectItems.length;
        for (itemCounter = 0; itemCounter < itemCount; itemCounter++) {
          item = this.selectItems[itemCounter];
          if (deletedItem.value === item.value) { break; }
        }
        if (item) { this.handleItemDelete(item); }
      };

      selectMenu.handleItemAdd = function (newItem, insertPosition, selectNewItem) {
        var $itemLi, insertAtPosition, $liChildren, childrenCount;

        
        $itemLi = this.getListItem(newItem);
        this.selectItems.push(newItem);
        this.filterItems();

        $liChildren = this.$content.children();
        childrenCount = $liChildren.length;
        if (insertPosition > childrenCount) {
          this.$content.append($itemLi);
        }
        else {
          insertAtPosition = Math.max(0, insertPosition - 1);
          $($liChildren[insertAtPosition]).before($itemLi);
        }

        
        this.initializeSize();
        if (selectNewItem) {
          selectMenu.setSelection(newItem);
        }
      };

      selectMenu.handleItemDelete = function(deletedItem) {
        var deletedCurrentItem;
        deletedItem.$itemLi.remove();
        this.selectItems.splice(pvArrayHelper.indexOf.call(this.selectItems, deletedItem), 1);
          if (this.config.selectItems) {
            this.config.selectItems.splice(pvArrayHelper.indexOf.call(this.config.selectItems, deletedItem), 1);
          }
        if (deletedItem === this.selectedItem) {
          deletedCurrentItem = true;
         
          if (this.selectItems.length > 0) {
            this.setSelection(this.selectItems[0]);
          } else {
            this.setSelection({ displayText: "", value: undefined });
          }
        }
        this.$triggerEl.trigger("afterDelete", [{ deletedItem: deletedItem, deletedCurrentItem: deletedCurrentItem, control: this }]);
      };

      selectMenu.destroy = function() {
        selectMenu.$triggerEl.unbind("mouseenter mouseleave");
        selectMenu.$triggerEl.unbind("click");
        selectMenu.$formField.remove();
        protoSelect.prototype.destroy();
        delete selectMenus[selectMenu.id];

      };
      selectMenus[selectMenu.id] = selectMenu;

      return selectMenu;
    }
  };
});

function PvDomWaitInit() {
  if (window.pvWaitingIndicator) {
    return;
  }

  var waiting,
      $bodyWaitContainer,
      $bannerWaitContainer,
      $tabMenuLoadingIndicatorContainer,
      waitingTimeout;

  (function init() {
    
    $bannerWaitContainer = $("<div class='waitIconContainer' id='waitIconContainer'><div class='waitIconContainerIcon' id='waitIconContainerIcon'></div><div class='waitIconContainerMessage' id='waitIconContainerMessage' style='display:none;'></div></div>").appendTo($('body')).click(function () { $(this).hide(); });

    
    $bodyWaitContainer = $("<div class='waitIndicatorContainer dark-shield' id='bodyWaitIndicatorContainer'></div>").appendTo($('body'));

    
    $tabMenuLoadingIndicatorContainer = $('<div class="bannerMenu top" id="tabMenuLoadingIndicatorContainer"></div>').appendTo($('body')).click(function(){$(this).hide();});
    $tabMenuLoadingIndicatorSign = $('<div class="sign"></div>');
    $tabMenuLoadingIndicatorIcon = $('<div class="pvar-tile-wait-icon"></div>');
    $tabMenuLoadingIndicatorText = $('<div class="loadingIcon">' + g_LoadingIndicatorMenu + '</div>');
    $tabMenuLoadingIndicator = $('<div class="loadingIndicator menu"></div>');
    $tabMenuLoadingIndicator.hide();

    
    $tabMenuLoadingIndicatorSign.append($tabMenuLoadingIndicatorIcon, $tabMenuLoadingIndicatorText);
    $tabMenuLoadingIndicator.append($tabMenuLoadingIndicatorSign);
    $tabMenuLoadingIndicatorContainer.append($tabMenuLoadingIndicator).appendTo($('body'));
  })();

  waiting = {
    showBannerWaitContainer: function (message) {
      if (message.length > 0) {
        $("#waitIconContainerMessage")[0].innerHTML = message;
        $("#waitIconContainerMessage").show();
      }
      this.positionBannerShield();
      $bannerWaitContainer.show();
    },
    hideBannerWaitContainer: function () {
      $bannerWaitContainer.hide();
      $("#waitIconContainerMessage")[0].innerHTML = "";
      $("#waitIconContainerMessage").hide();
    },
    showShield: function (hideAllContent) {
      this.showBannerShield(hideAllContent);
      this.showBodyShield(hideAllContent);
    },
    hideShield: function () {
      this.hideBannerShield();
      this.hideBodyShield();
    },
    showBannerShield: function () {
      if (PVBanner.$bannerWrapper.length > 0) {
        this.positionBannerShield();
      }
      $("#waitIconContainerMessage").hide();
      $bannerWaitContainer.show();
      return $bannerWaitContainer;
    },
    hideBannerShield: function () {
      $bannerWaitContainer.hide();
      return $bannerWaitContainer;
    },
    positionBannerShield: function () {
      if (PVBanner.$bannerWrapper.length > 0) {
        PvUiHelper.positionElementOnElement($bannerWaitContainer, "top center", PVBanner.$bannerWrapper, "bottom center");
      }
      return $bannerWaitContainer;
    },
    showBodyShield: function (hideAllContent) {
      this.positionBodyShield(hideAllContent);
      $bodyWaitContainer.show();
      return $bodyWaitContainer;
    },
    hideBodyShield: function () {
      $bodyWaitContainer.hide();
      return $bodyWaitContainer;
    },
    positionBodyShield: function (hideAllContent) {
      this.sizeBodyShield(hideAllContent);
      PvUiHelper.positionElementOnElement($bodyWaitContainer, "top left", (PVBanner.$bannerWrapper.length > 0 && !hideAllContent ? PVBanner.$bannerWrapper : $('body')), "bottom left");
      if (hideAllContent) {
        $bodyWaitContainer.addClass("omni");
      }
      else {
        $bodyWaitContainer.removeClass("omni");
      }
      return $bodyWaitContainer;
    },
    sizeBodyShield: function (hideAllContent) {
      $bodyWaitContainer.height($(window).height() - (PVBanner.$bannerWrapper.length > 0 && !hideAllContent ? PVBanner.$bannerWrapper.outerHeight(true) : 0));
      return $bodyWaitContainer;
    },
    showTabMenuShield: function () {
      var that = this;
      
      if (PVBanner.$bannerWrapper.length > 0) {
        PvUiHelper.positionElementOnElement($tabMenuLoadingIndicatorContainer, "top center", PVBanner.$bannerWrapper, "bottom center");
      }
      $bodyWaitContainer.fadeIn(200, function(){
        $(this).css("filter", "alpha(opacity=50)");
      });

      
      if (PVBanner.$bannerWrapper.length > 0) {
        this.positionBannerShield();
      }
      setTimeout(function(){
      $tabMenuLoadingIndicatorContainer.slideDown(100);
      $tabMenuLoadingIndicator.fadeIn(200);
      }, 200);
    },
    hideTabMenuShield: function (animateLoadingIndicator) {
      
      $bodyWaitContainer.fadeOut(200);
      
      if(animateLoadingIndicator){
        $tabMenuLoadingIndicatorContainer.slideUp(100);
      }else{
        $tabMenuLoadingIndicatorContainer.hide();
      }
      
      $bodyWaitContainer.off('click');
      $tabMenuLoadingIndicatorContainer.off('click');
    },
    showTabMenuWaitNoShield: function () {
      if (PVBanner.$bannerWrapper.length > 0) {
        PvUiHelper.positionElementOnElement($tabMenuLoadingIndicatorContainer, "top center", PVBanner.$bannerWrapper, "bottom center");
      }

      waitingTimeout = setTimeout(function () {
        $tabMenuLoadingIndicatorContainer.slideDown(100);
        $tabMenuLoadingIndicator.fadeIn(200);
      }, 200);
    },
    hideTabMenuWaitNoShield: function (animateLoadingIndicator) {
      clearTimeout(waitingTimeout);
      if (animateLoadingIndicator) {
        $tabMenuLoadingIndicatorContainer.slideUp(100);
      } else {
        $tabMenuLoadingIndicatorContainer.hide();
      }
      $tabMenuLoadingIndicatorContainer.off('click');
      $tabMenuLoadingIndicator.fadeOut(200);
    },
    getBodyShield: function () {
      return $bodyWaitContainer;
    }
  };

  window.pvWaitingIndicator = waiting;
};

function getDeviceZoom(){
  var zoom = 1;
  
  if(window.devicePixelRatio){
    zoom = window.devicePixelRatio;
  }
  else {
    
    if(screen.deviceXDPI && screen.logicalXDPI){
      zoom = screen.deviceXDPI / screen.logicalXDPI;
    }
  }
  return zoom;
}

function getDevicePixelZoomMod() {
  var zoom;
  
  zoom = getDeviceZoom();
  return zoom !== 1 ? Math.ceil(1 / zoom) : 0;
}

$(document).ready(function () {
  $(".input-text-hint").one("focus", function (evt) {
    var $input;
    $input = $(evt.srcElement);
    $input.removeClass("input-text-hint");
    $input.val("");
    $input.data("focused", "1");
  });
});






;(function(){function n(n,t,e){e=(e||0)-1;for(var r=n?n.length:0;++e<r;)if(n[e]===t)return e;return-1}function t(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var u="number"==r?e:m+e;return t=(t=t[r])&&t[u],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function e(n){var t=this.l,e=typeof n;if("boolean"==e||null==n)t[n]=true;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:m+n,t=t[e]||(t[e]={});"object"==e?(t[r]||(t[r]=[])).push(n):t[r]=true
}}function r(n){return n.charCodeAt(0)}function u(n,t){for(var e=n.m,r=t.m,u=-1,o=e.length;++u<o;){var i=e[u],a=r[u];if(i!==a){if(i>a||typeof i=="undefined")return 1;if(i<a||typeof a=="undefined")return-1}}return n.n-t.n}function o(n){var t=-1,r=n.length,u=n[0],o=n[r/2|0],i=n[r-1];if(u&&typeof u=="object"&&o&&typeof o=="object"&&i&&typeof i=="object")return false;for(u=f(),u["false"]=u["null"]=u["true"]=u.undefined=false,o=f(),o.k=n,o.l=u,o.push=e;++t<r;)o.push(n[t]);return o}function i(n){return"\\"+U[n]
}function a(){return h.pop()||[]}function f(){return g.pop()||{k:null,l:null,m:null,"false":false,n:0,"null":false,number:null,object:null,push:null,string:null,"true":false,undefined:false,o:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var t=n.l;t&&c(t),n.k=n.l=n.m=n.object=n.number=n.string=n.o=null,g.length<_&&g.push(n)}function p(n,t,e){t||(t=0),typeof e=="undefined"&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function s(e){function h(n,t,e){if(!n||!V[typeof n])return n;
t=t&&typeof e=="undefined"?t:tt(t,e,3);for(var r=-1,u=V[typeof n]&&Fe(n),o=u?u.length:0;++r<o&&(e=u[r],false!==t(n[e],e,n)););return n}function g(n,t,e){var r;if(!n||!V[typeof n])return n;t=t&&typeof e=="undefined"?t:tt(t,e,3);for(r in n)if(false===t(n[r],r,n))break;return n}function _(n,t,e){var r,u=n,o=u;if(!u)return o;for(var i=arguments,a=0,f=typeof e=="number"?2:i.length;++a<f;)if((u=i[a])&&V[typeof u])for(var l=-1,c=V[typeof u]&&Fe(u),p=c?c.length:0;++l<p;)r=c[l],"undefined"==typeof o[r]&&(o[r]=u[r]);
return o}function U(n,t,e){var r,u=n,o=u;if(!u)return o;var i=arguments,a=0,f=typeof e=="number"?2:i.length;if(3<f&&"function"==typeof i[f-2])var l=tt(i[--f-1],i[f--],2);else 2<f&&"function"==typeof i[f-1]&&(l=i[--f]);for(;++a<f;)if((u=i[a])&&V[typeof u])for(var c=-1,p=V[typeof u]&&Fe(u),s=p?p.length:0;++c<s;)r=p[c],o[r]=l?l(o[r],u[r]):u[r];return o}function H(n){var t,e=[];if(!n||!V[typeof n])return e;for(t in n)me.call(n,t)&&e.push(t);return e}function J(n){return n&&typeof n=="object"&&!Te(n)&&me.call(n,"__wrapped__")?n:new Q(n)
}function Q(n,t){this.__chain__=!!t,this.__wrapped__=n}function X(n){function t(){if(r){var n=p(r);be.apply(n,arguments)}if(this instanceof t){var o=nt(e.prototype),n=e.apply(o,n||arguments);return wt(n)?n:o}return e.apply(u,n||arguments)}var e=n[0],r=n[2],u=n[4];return $e(t,n),t}function Z(n,t,e,r,u){if(e){var o=e(n);if(typeof o!="undefined")return o}if(!wt(n))return n;var i=ce.call(n);if(!K[i])return n;var f=Ae[i];switch(i){case T:case F:return new f(+n);case W:case P:return new f(n);case z:return o=f(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o
}if(i=Te(n),t){var c=!r;r||(r=a()),u||(u=a());for(var s=r.length;s--;)if(r[s]==n)return u[s];o=i?f(n.length):{}}else o=i?p(n):U({},n);return i&&(me.call(n,"index")&&(o.index=n.index),me.call(n,"input")&&(o.input=n.input)),t?(r.push(n),u.push(o),(i?St:h)(n,function(n,i){o[i]=Z(n,t,e,r,u)}),c&&(l(r),l(u)),o):o}function nt(n){return wt(n)?ke(n):{}}function tt(n,t,e){if(typeof n!="function")return Ut;if(typeof t=="undefined"||!("prototype"in n))return n;var r=n.__bindData__;if(typeof r=="undefined"&&(De.funcNames&&(r=!n.name),r=r||!De.funcDecomp,!r)){var u=ge.call(n);
De.funcNames||(r=!O.test(u)),r||(r=E.test(u),$e(n,r))}if(false===r||true!==r&&1&r[1])return n;switch(e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,u){return n.call(t,e,r,u)};case 4:return function(e,r,u,o){return n.call(t,e,r,u,o)}}return Mt(n,t)}function et(n){function t(){var n=f?i:this;if(u){var h=p(u);be.apply(h,arguments)}return(o||c)&&(h||(h=p(arguments)),o&&be.apply(h,o),c&&h.length<a)?(r|=16,et([e,s?r:-4&r,h,null,i,a])):(h||(h=arguments),l&&(e=n[v]),this instanceof t?(n=nt(e.prototype),h=e.apply(n,h),wt(h)?h:n):e.apply(n,h))
}var e=n[0],r=n[1],u=n[2],o=n[3],i=n[4],a=n[5],f=1&r,l=2&r,c=4&r,s=8&r,v=e;return $e(t,n),t}function rt(e,r){var u=-1,i=st(),a=e?e.length:0,f=a>=b&&i===n,l=[];if(f){var p=o(r);p?(i=t,r=p):f=false}for(;++u<a;)p=e[u],0>i(r,p)&&l.push(p);return f&&c(r),l}function ut(n,t,e,r){r=(r||0)-1;for(var u=n?n.length:0,o=[];++r<u;){var i=n[r];if(i&&typeof i=="object"&&typeof i.length=="number"&&(Te(i)||yt(i))){t||(i=ut(i,t,e));var a=-1,f=i.length,l=o.length;for(o.length+=f;++a<f;)o[l++]=i[a]}else e||o.push(i)}return o
}function ot(n,t,e,r,u,o){if(e){var i=e(n,t);if(typeof i!="undefined")return!!i}if(n===t)return 0!==n||1/n==1/t;if(n===n&&!(n&&V[typeof n]||t&&V[typeof t]))return false;if(null==n||null==t)return n===t;var f=ce.call(n),c=ce.call(t);if(f==D&&(f=q),c==D&&(c=q),f!=c)return false;switch(f){case T:case F:return+n==+t;case W:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case z:case P:return n==oe(t)}if(c=f==$,!c){var p=me.call(n,"__wrapped__"),s=me.call(t,"__wrapped__");if(p||s)return ot(p?n.__wrapped__:n,s?t.__wrapped__:t,e,r,u,o);
if(f!=q)return false;if(f=n.constructor,p=t.constructor,f!=p&&!(dt(f)&&f instanceof f&&dt(p)&&p instanceof p)&&"constructor"in n&&"constructor"in t)return false}for(f=!u,u||(u=a()),o||(o=a()),p=u.length;p--;)if(u[p]==n)return o[p]==t;var v=0,i=true;if(u.push(n),o.push(t),c){if(p=n.length,v=t.length,(i=v==p)||r)for(;v--;)if(c=p,s=t[v],r)for(;c--&&!(i=ot(n[c],s,e,r,u,o)););else if(!(i=ot(n[v],s,e,r,u,o)))break}else g(t,function(t,a,f){return me.call(f,a)?(v++,i=me.call(n,a)&&ot(n[a],t,e,r,u,o)):void 0}),i&&!r&&g(n,function(n,t,e){return me.call(e,t)?i=-1<--v:void 0
});return u.pop(),o.pop(),f&&(l(u),l(o)),i}function it(n,t,e,r,u){(Te(t)?St:h)(t,function(t,o){var i,a,f=t,l=n[o];if(t&&((a=Te(t))||Pe(t))){for(f=r.length;f--;)if(i=r[f]==t){l=u[f];break}if(!i){var c;e&&(f=e(l,t),c=typeof f!="undefined")&&(l=f),c||(l=a?Te(l)?l:[]:Pe(l)?l:{}),r.push(t),u.push(l),c||it(l,t,e,r,u)}}else e&&(f=e(l,t),typeof f=="undefined"&&(f=t)),typeof f!="undefined"&&(l=f);n[o]=l})}function at(n,t){return n+he(Re()*(t-n+1))}function ft(e,r,u){var i=-1,f=st(),p=e?e.length:0,s=[],v=!r&&p>=b&&f===n,h=u||v?a():s;
for(v&&(h=o(h),f=t);++i<p;){var g=e[i],y=u?u(g,i,e):g;(r?!i||h[h.length-1]!==y:0>f(h,y))&&((u||v)&&h.push(y),s.push(g))}return v?(l(h.k),c(h)):u&&l(h),s}function lt(n){return function(t,e,r){var u={};e=J.createCallback(e,r,3),r=-1;var o=t?t.length:0;if(typeof o=="number")for(;++r<o;){var i=t[r];n(u,i,e(i,r,t),t)}else h(t,function(t,r,o){n(u,t,e(t,r,o),o)});return u}}function ct(n,t,e,r,u,o){var i=1&t,a=4&t,f=16&t,l=32&t;if(!(2&t||dt(n)))throw new ie;f&&!e.length&&(t&=-17,f=e=false),l&&!r.length&&(t&=-33,l=r=false);
var c=n&&n.__bindData__;return c&&true!==c?(c=p(c),c[2]&&(c[2]=p(c[2])),c[3]&&(c[3]=p(c[3])),!i||1&c[1]||(c[4]=u),!i&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),f&&be.apply(c[2]||(c[2]=[]),e),l&&we.apply(c[3]||(c[3]=[]),r),c[1]|=t,ct.apply(null,c)):(1==t||17===t?X:et)([n,t,e,r,u,o])}function pt(n){return Be[n]}function st(){var t=(t=J.indexOf)===Wt?n:t;return t}function vt(n){return typeof n=="function"&&pe.test(n)}function ht(n){var t,e;return n&&ce.call(n)==q&&(t=n.constructor,!dt(t)||t instanceof t)?(g(n,function(n,t){e=t
}),typeof e=="undefined"||me.call(n,e)):false}function gt(n){return We[n]}function yt(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==D||false}function mt(n,t,e){var r=Fe(n),u=r.length;for(t=tt(t,e,3);u--&&(e=r[u],false!==t(n[e],e,n)););return n}function bt(n){var t=[];return g(n,function(n,e){dt(n)&&t.push(e)}),t.sort()}function _t(n){for(var t=-1,e=Fe(n),r=e.length,u={};++t<r;){var o=e[t];u[n[o]]=o}return u}function dt(n){return typeof n=="function"}function wt(n){return!(!n||!V[typeof n])
}function jt(n){return typeof n=="number"||n&&typeof n=="object"&&ce.call(n)==W||false}function kt(n){return typeof n=="string"||n&&typeof n=="object"&&ce.call(n)==P||false}function xt(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;)u[t]=n[e[t]];return u}function Ct(n,t,e){var r=-1,u=st(),o=n?n.length:0,i=false;return e=(0>e?Ie(0,o+e):e)||0,Te(n)?i=-1<u(n,t,e):typeof o=="number"?i=-1<(kt(n)?n.indexOf(t,e):u(n,t,e)):h(n,function(n){return++r<e?void 0:!(i=n===t)}),i}function Ot(n,t,e){var r=true;t=J.createCallback(t,e,3),e=-1;
var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&(r=!!t(n[e],e,n)););else h(n,function(n,e,u){return r=!!t(n,e,u)});return r}function Nt(n,t,e){var r=[];t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u;){var o=n[e];t(o,e,n)&&r.push(o)}else h(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function It(n,t,e){t=J.createCallback(t,e,3),e=-1;var r=n?n.length:0;if(typeof r!="number"){var u;return h(n,function(n,e,r){return t(n,e,r)?(u=n,false):void 0}),u}for(;++e<r;){var o=n[e];
if(t(o,e,n))return o}}function St(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof u=="number")for(;++r<u&&false!==t(n[r],r,n););else h(n,t);return n}function Et(n,t,e){var r=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof r=="number")for(;r--&&false!==t(n[r],r,n););else{var u=Fe(n),r=u.length;h(n,function(n,e,o){return e=u?u[--r]:--r,t(o[e],e,o)})}return n}function Rt(n,t,e){var r=-1,u=n?n.length:0;if(t=J.createCallback(t,e,3),typeof u=="number")for(var o=Xt(u);++r<u;)o[r]=t(n[r],r,n);
else o=[],h(n,function(n,e,u){o[++r]=t(n,e,u)});return o}function At(n,t,e){var u=-1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a>o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e>u&&(u=e,o=n)});return o}function Dt(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=J.createCallback(t,r,4);var o=-1,i=n.length;if(typeof i=="number")for(u&&(e=n[++o]);++o<i;)e=t(e,n[o],o,n);else h(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)
});return e}function $t(n,t,e,r){var u=3>arguments.length;return t=J.createCallback(t,r,4),Et(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)}),e}function Tt(n){var t=-1,e=n?n.length:0,r=Xt(typeof e=="number"?e:0);return St(n,function(n){var e=at(0,++t);r[t]=r[e],r[e]=n}),r}function Ft(n,t,e){var r;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&!(r=t(n[e],e,n)););else h(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function Bt(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=-1;
for(t=J.createCallback(t,e,3);++o<u&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[0]:v;return p(n,0,Se(Ie(0,r),u))}function Wt(t,e,r){if(typeof r=="number"){var u=t?t.length:0;r=0>r?Ie(0,u+r):r||0}else if(r)return r=zt(t,e),t[r]===e?r:-1;return n(t,e,r)}function qt(n,t,e){if(typeof t!="number"&&null!=t){var r=0,u=-1,o=n?n.length:0;for(t=J.createCallback(t,e,3);++u<o&&t(n[u],u,n);)r++}else r=null==t||e?1:Ie(0,t);return p(n,r)}function zt(n,t,e,r){var u=0,o=n?n.length:u;for(e=e?J.createCallback(e,r,1):Ut,t=e(t);u<o;)r=u+o>>>1,e(n[r])<t?u=r+1:o=r;
return u}function Pt(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(e=J.createCallback(e,r,3)),ft(n,t,e)}function Kt(){for(var n=1<arguments.length?arguments:arguments[0],t=-1,e=n?At(Ve(n,"length")):0,r=Xt(0>e?0:e);++t<e;)r[t]=Ve(n,t);return r}function Lt(n,t){var e=-1,r=n?n.length:0,u={};for(t||!r||Te(n[0])||(t=[]);++e<r;){var o=n[e];t?u[o]=t[e]:o&&(u[o[0]]=o[1])}return u}function Mt(n,t){return 2<arguments.length?ct(n,17,p(arguments,2),null,t):ct(n,1,null,null,t)
}function Vt(n,t,e){function r(){c&&ve(c),i=c=p=v,(g||h!==t)&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null))}function u(){var e=t-(Ue()-f);0<e?c=_e(u,e):(i&&ve(i),e=p,i=c=p=v,e&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null)))}var o,i,a,f,l,c,p,s=0,h=false,g=true;if(!dt(n))throw new ie;if(t=Ie(0,t)||0,true===e)var y=true,g=false;else wt(e)&&(y=e.leading,h="maxWait"in e&&(Ie(t,e.maxWait)||0),g="trailing"in e?e.trailing:g);return function(){if(o=arguments,f=Ue(),l=this,p=g&&(c||!y),false===h)var e=y&&!c;else{i||y||(s=f);var v=h-(f-s),m=0>=v;
m?(i&&(i=ve(i)),s=f,a=n.apply(l,o)):i||(i=_e(r,v))}return m&&c?c=ve(c):c||t===h||(c=_e(u,t)),e&&(m=true,a=n.apply(l,o)),!m||c||i||(o=l=null),a}}function Ut(n){return n}function Gt(n,t,e){var r=true,u=t&&bt(t);t&&(e||u.length)||(null==e&&(e=t),o=Q,t=n,n=J,u=bt(t)),false===e?r=false:wt(e)&&"chain"in e&&(r=e.chain);var o=n,i=dt(o);St(u,function(e){var u=n[e]=t[e];i&&(o.prototype[e]=function(){var t=this.__chain__,e=this.__wrapped__,i=[e];if(be.apply(i,arguments),i=u.apply(n,i),r||t){if(e===i&&wt(i))return this;
i=new o(i),i.__chain__=t}return i})})}function Ht(){}function Jt(n){return function(t){return t[n]}}function Qt(){return this.__wrapped__}e=e?Y.defaults(G.Object(),e,Y.pick(G,A)):G;var Xt=e.Array,Yt=e.Boolean,Zt=e.Date,ne=e.Function,te=e.Math,ee=e.Number,re=e.Object,ue=e.RegExp,oe=e.String,ie=e.TypeError,ae=[],fe=re.prototype,le=e._,ce=fe.toString,pe=ue("^"+oe(ce).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),se=te.ceil,ve=e.clearTimeout,he=te.floor,ge=ne.prototype.toString,ye=vt(ye=re.getPrototypeOf)&&ye,me=fe.hasOwnProperty,be=ae.push,_e=e.setTimeout,de=ae.splice,we=ae.unshift,je=function(){try{var n={},t=vt(t=re.defineProperty)&&t,e=t(n,n,n)&&t
}catch(r){}return e}(),ke=vt(ke=re.create)&&ke,xe=vt(xe=Xt.isArray)&&xe,Ce=e.isFinite,Oe=e.isNaN,Ne=vt(Ne=re.keys)&&Ne,Ie=te.max,Se=te.min,Ee=e.parseInt,Re=te.random,Ae={};Ae[$]=Xt,Ae[T]=Yt,Ae[F]=Zt,Ae[B]=ne,Ae[q]=re,Ae[W]=ee,Ae[z]=ue,Ae[P]=oe,Q.prototype=J.prototype;var De=J.support={};De.funcDecomp=!vt(e.a)&&E.test(s),De.funcNames=typeof ne.name=="string",J.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:J}},ke||(nt=function(){function n(){}return function(t){if(wt(t)){n.prototype=t;
var r=new n;n.prototype=null}return r||e.Object()}}());var $e=je?function(n,t){M.value=t,je(n,"__bindData__",M)}:Ht,Te=xe||function(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==$||false},Fe=Ne?function(n){return wt(n)?Ne(n):[]}:H,Be={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},We=_t(Be),qe=ue("("+Fe(We).join("|")+")","g"),ze=ue("["+Fe(Be).join("")+"]","g"),Pe=ye?function(n){if(!n||ce.call(n)!=q)return false;var t=n.valueOf,e=vt(t)&&(e=ye(t))&&ye(e);return e?n==e||ye(n)==e:ht(n)
}:ht,Ke=lt(function(n,t,e){me.call(n,e)?n[e]++:n[e]=1}),Le=lt(function(n,t,e){(me.call(n,e)?n[e]:n[e]=[]).push(t)}),Me=lt(function(n,t,e){n[e]=t}),Ve=Rt,Ue=vt(Ue=Zt.now)&&Ue||function(){return(new Zt).getTime()},Ge=8==Ee(d+"08")?Ee:function(n,t){return Ee(kt(n)?n.replace(I,""):n,t||0)};return J.after=function(n,t){if(!dt(t))throw new ie;return function(){return 1>--n?t.apply(this,arguments):void 0}},J.assign=U,J.at=function(n){for(var t=arguments,e=-1,r=ut(t,true,false,1),t=t[2]&&t[2][t[1]]===n?1:r.length,u=Xt(t);++e<t;)u[e]=n[r[e]];
return u},J.bind=Mt,J.bindAll=function(n){for(var t=1<arguments.length?ut(arguments,true,false,1):bt(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=ct(n[u],1,null,null,n)}return n},J.bindKey=function(n,t){return 2<arguments.length?ct(t,19,p(arguments,2),null,n):ct(t,3,null,null,n)},J.chain=function(n){return n=new Q(n),n.__chain__=true,n},J.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},J.compose=function(){for(var n=arguments,t=n.length;t--;)if(!dt(n[t]))throw new ie;
return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];return t[0]}},J.constant=function(n){return function(){return n}},J.countBy=Ke,J.create=function(n,t){var e=nt(n);return t?U(e,t):e},J.createCallback=function(n,t,e){var r=typeof n;if(null==n||"function"==r)return tt(n,t,e);if("object"!=r)return Jt(n);var u=Fe(n),o=u[0],i=n[o];return 1!=u.length||i!==i||wt(i)?function(t){for(var e=u.length,r=false;e--&&(r=ot(t[u[e]],n[u[e]],null,true)););return r}:function(n){return n=n[o],i===n&&(0!==i||1/i==1/n)
}},J.curry=function(n,t){return t=typeof t=="number"?t:+t||n.length,ct(n,4,null,null,null,t)},J.debounce=Vt,J.defaults=_,J.defer=function(n){if(!dt(n))throw new ie;var t=p(arguments,1);return _e(function(){n.apply(v,t)},1)},J.delay=function(n,t){if(!dt(n))throw new ie;var e=p(arguments,2);return _e(function(){n.apply(v,e)},t)},J.difference=function(n){return rt(n,ut(arguments,true,true,1))},J.filter=Nt,J.flatten=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(n=Rt(n,e,r)),ut(n,t)
},J.forEach=St,J.forEachRight=Et,J.forIn=g,J.forInRight=function(n,t,e){var r=[];g(n,function(n,t){r.push(t,n)});var u=r.length;for(t=tt(t,e,3);u--&&false!==t(r[u--],r[u],n););return n},J.forOwn=h,J.forOwnRight=mt,J.functions=bt,J.groupBy=Le,J.indexBy=Me,J.initial=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else r=null==t||e?1:t||r;return p(n,0,Se(Ie(0,u-r),u))},J.intersection=function(){for(var e=[],r=-1,u=arguments.length,i=a(),f=st(),p=f===n,s=a();++r<u;){var v=arguments[r];
(Te(v)||yt(v))&&(e.push(v),i.push(p&&v.length>=b&&o(r?e[r]:s)))}var p=e[0],h=-1,g=p?p.length:0,y=[];n:for(;++h<g;){var m=i[0],v=p[h];if(0>(m?t(m,v):f(s,v))){for(r=u,(m||s).push(v);--r;)if(m=i[r],0>(m?t(m,v):f(e[r],v)))continue n;y.push(v)}}for(;u--;)(m=i[u])&&c(m);return l(i),l(s),y},J.invert=_t,J.invoke=function(n,t){var e=p(arguments,2),r=-1,u=typeof t=="function",o=n?n.length:0,i=Xt(typeof o=="number"?o:0);return St(n,function(n){i[++r]=(u?t:n[t]).apply(n,e)}),i},J.keys=Fe,J.map=Rt,J.mapValues=function(n,t,e){var r={};
return t=J.createCallback(t,e,3),h(n,function(n,e,u){r[e]=t(n,e,u)}),r},J.max=At,J.memoize=function(n,t){function e(){var r=e.cache,u=t?t.apply(this,arguments):m+arguments[0];return me.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}if(!dt(n))throw new ie;return e.cache={},e},J.merge=function(n){var t=arguments,e=2;if(!wt(n))return n;if("number"!=typeof t[2]&&(e=t.length),3<e&&"function"==typeof t[e-2])var r=tt(t[--e-1],t[e--],2);else 2<e&&"function"==typeof t[e-1]&&(r=t[--e]);for(var t=p(arguments,1,e),u=-1,o=a(),i=a();++u<e;)it(n,t[u],r,o,i);
return l(o),l(i),n},J.min=function(n,t,e){var u=1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a<o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e<u&&(u=e,o=n)});return o},J.omit=function(n,t,e){var r={};if(typeof t!="function"){var u=[];g(n,function(n,t){u.push(t)});for(var u=rt(u,ut(arguments,true,false,1)),o=-1,i=u.length;++o<i;){var a=u[o];r[a]=n[a]}}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)||(r[e]=n)
});return r},J.once=function(n){var t,e;if(!dt(n))throw new ie;return function(){return t?e:(t=true,e=n.apply(this,arguments),n=null,e)}},J.pairs=function(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;){var o=e[t];u[t]=[o,n[o]]}return u},J.partial=function(n){return ct(n,16,p(arguments,1))},J.partialRight=function(n){return ct(n,32,null,p(arguments,1))},J.pick=function(n,t,e){var r={};if(typeof t!="function")for(var u=-1,o=ut(arguments,true,false,1),i=wt(n)?o.length:0;++u<i;){var a=o[u];a in n&&(r[a]=n[a])
}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},J.pluck=Ve,J.property=Jt,J.pull=function(n){for(var t=arguments,e=0,r=t.length,u=n?n.length:0;++e<r;)for(var o=-1,i=t[e];++o<u;)n[o]===i&&(de.call(n,o--,1),u--);return n},J.range=function(n,t,e){n=+n||0,e=typeof e=="number"?e:+e||1,null==t&&(t=n,n=0);var r=-1;t=Ie(0,se((t-n)/(e||1)));for(var u=Xt(t);++r<t;)u[r]=n,n+=e;return u},J.reject=function(n,t,e){return t=J.createCallback(t,e,3),Nt(n,function(n,e,r){return!t(n,e,r)
})},J.remove=function(n,t,e){var r=-1,u=n?n.length:0,o=[];for(t=J.createCallback(t,e,3);++r<u;)e=n[r],t(e,r,n)&&(o.push(e),de.call(n,r--,1),u--);return o},J.rest=qt,J.shuffle=Tt,J.sortBy=function(n,t,e){var r=-1,o=Te(t),i=n?n.length:0,p=Xt(typeof i=="number"?i:0);for(o||(t=J.createCallback(t,e,3)),St(n,function(n,e,u){var i=p[++r]=f();o?i.m=Rt(t,function(t){return n[t]}):(i.m=a())[0]=t(n,e,u),i.n=r,i.o=n}),i=p.length,p.sort(u);i--;)n=p[i],p[i]=n.o,o||l(n.m),c(n);return p},J.tap=function(n,t){return t(n),n
},J.throttle=function(n,t,e){var r=true,u=true;if(!dt(n))throw new ie;return false===e?r=false:wt(e)&&(r="leading"in e?e.leading:r,u="trailing"in e?e.trailing:u),L.leading=r,L.maxWait=t,L.trailing=u,Vt(n,t,L)},J.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Xt(n);for(t=tt(t,e,1);++r<n;)u[r]=t(r);return u},J.toArray=function(n){return n&&typeof n.length=="number"?p(n):xt(n)},J.transform=function(n,t,e,r){var u=Te(n);if(null==e)if(u)e=[];else{var o=n&&n.constructor;e=nt(o&&o.prototype)}return t&&(t=J.createCallback(t,r,4),(u?St:h)(n,function(n,r,u){return t(e,n,r,u)
})),e},J.union=function(){return ft(ut(arguments,true,true))},J.uniq=Pt,J.values=xt,J.where=Nt,J.without=function(n){return rt(n,p(arguments,1))},J.wrap=function(n,t){return ct(t,16,[n])},J.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var e=arguments[n];if(Te(e)||yt(e))var r=r?ft(rt(r,e).concat(rt(e,r))):e}return r||[]},J.zip=Kt,J.zipObject=Lt,J.collect=Rt,J.drop=qt,J.each=St,J.eachRight=Et,J.extend=U,J.methods=bt,J.object=Lt,J.select=Nt,J.tail=qt,J.unique=Pt,J.unzip=Kt,Gt(J),J.clone=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=t,t=false),Z(n,t,typeof e=="function"&&tt(e,r,1))
},J.cloneDeep=function(n,t,e){return Z(n,true,typeof t=="function"&&tt(t,e,1))},J.contains=Ct,J.escape=function(n){return null==n?"":oe(n).replace(ze,pt)},J.every=Ot,J.find=It,J.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=J.createCallback(t,e,3);++r<u;)if(t(n[r],r,n))return r;return-1},J.findKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),h(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.findLast=function(n,t,e){var r;return t=J.createCallback(t,e,3),Et(n,function(n,e,u){return t(n,e,u)?(r=n,false):void 0
}),r},J.findLastIndex=function(n,t,e){var r=n?n.length:0;for(t=J.createCallback(t,e,3);r--;)if(t(n[r],r,n))return r;return-1},J.findLastKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),mt(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.has=function(n,t){return n?me.call(n,t):false},J.identity=Ut,J.indexOf=Wt,J.isArguments=yt,J.isArray=Te,J.isBoolean=function(n){return true===n||false===n||n&&typeof n=="object"&&ce.call(n)==T||false},J.isDate=function(n){return n&&typeof n=="object"&&ce.call(n)==F||false
},J.isElement=function(n){return n&&1===n.nodeType||false},J.isEmpty=function(n){var t=true;if(!n)return t;var e=ce.call(n),r=n.length;return e==$||e==P||e==D||e==q&&typeof r=="number"&&dt(n.splice)?!r:(h(n,function(){return t=false}),t)},J.isEqual=function(n,t,e,r){return ot(n,t,typeof e=="function"&&tt(e,r,2))},J.isFinite=function(n){return Ce(n)&&!Oe(parseFloat(n))},J.isFunction=dt,J.isNaN=function(n){return jt(n)&&n!=+n},J.isNull=function(n){return null===n},J.isNumber=jt,J.isObject=wt,J.isPlainObject=Pe,J.isRegExp=function(n){return n&&typeof n=="object"&&ce.call(n)==z||false
},J.isString=kt,J.isUndefined=function(n){return typeof n=="undefined"},J.lastIndexOf=function(n,t,e){var r=n?n.length:0;for(typeof e=="number"&&(r=(0>e?Ie(0,r+e):Se(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},J.mixin=Gt,J.noConflict=function(){return e._=le,this},J.noop=Ht,J.now=Ue,J.parseInt=Ge,J.random=function(n,t,e){var r=null==n,u=null==t;return null==e&&(typeof n=="boolean"&&u?(e=n,n=1):u||typeof t!="boolean"||(e=t,u=true)),r&&u&&(t=1),n=+n||0,u?(t=n,n=0):t=+t||0,e||n%1||t%1?(e=Re(),Se(n+e*(t-n+parseFloat("1e-"+((e+"").length-1))),t)):at(n,t)
},J.reduce=Dt,J.reduceRight=$t,J.result=function(n,t){if(n){var e=n[t];return dt(e)?n[t]():e}},J.runInContext=s,J.size=function(n){var t=n?n.length:0;return typeof t=="number"?t:Fe(n).length},J.some=Ft,J.sortedIndex=zt,J.template=function(n,t,e){var r=J.templateSettings;n=oe(n||""),e=_({},e,r);var u,o=_({},e.imports,r.imports),r=Fe(o),o=xt(o),a=0,f=e.interpolate||S,l="__p+='",f=ue((e.escape||S).source+"|"+f.source+"|"+(f===N?x:S).source+"|"+(e.evaluate||S).source+"|$","g");n.replace(f,function(t,e,r,o,f,c){return r||(r=o),l+=n.slice(a,c).replace(R,i),e&&(l+="'+__e("+e+")+'"),f&&(u=true,l+="';"+f+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),a=c+t.length,t
}),l+="';",f=e=e.variable,f||(e="obj",l="with("+e+"){"+l+"}"),l=(u?l.replace(w,""):l).replace(j,"$1").replace(k,"$1;"),l="function("+e+"){"+(f?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}";try{var c=ne(r,"return "+l).apply(v,o)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},J.unescape=function(n){return null==n?"":oe(n).replace(qe,gt)},J.uniqueId=function(n){var t=++y;return oe(null==n?"":n)+t
},J.all=Ot,J.any=Ft,J.detect=It,J.findWhere=It,J.foldl=Dt,J.foldr=$t,J.include=Ct,J.inject=Dt,Gt(function(){var n={};return h(J,function(t,e){J.prototype[e]||(n[e]=t)}),n}(),false),J.first=Bt,J.last=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[u-1]:v;return p(n,Ie(0,u-r))},J.sample=function(n,t,e){return n&&typeof n.length!="number"&&(n=xt(n)),null==t||e?n?n[at(0,n.length-1)]:v:(n=Tt(n),n.length=Se(Ie(0,t),n.length),n)
},J.take=Bt,J.head=Bt,h(J,function(n,t){var e="sample"!==t;J.prototype[t]||(J.prototype[t]=function(t,r){var u=this.__chain__,o=n(this.__wrapped__,t,r);return u||null!=t&&(!r||e&&typeof t=="function")?new Q(o,u):o})}),J.VERSION="2.4.1",J.prototype.chain=function(){return this.__chain__=true,this},J.prototype.toString=function(){return oe(this.__wrapped__)},J.prototype.value=Qt,J.prototype.valueOf=Qt,St(["join","pop","shift"],function(n){var t=ae[n];J.prototype[n]=function(){var n=this.__chain__,e=t.apply(this.__wrapped__,arguments);
return n?new Q(e,n):e}}),St(["push","reverse","sort","unshift"],function(n){var t=ae[n];J.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),St(["concat","slice","splice"],function(n){var t=ae[n];J.prototype[n]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),J}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" \t\x0B\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",w=/\b__p\+='';/g,j=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,I=RegExp("^["+d+"]*0+(?=.$)"),S=/($^)/,E=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",$="[object Array]",T="[object Boolean]",F="[object Date]",B="[object Function]",W="[object Number]",q="[object Object]",z="[object RegExp]",P="[object String]",K={};
K[B]=false,K[D]=K[$]=K[T]=K[F]=K[W]=K[q]=K[z]=K[P]=true;var L={leading:false,maxWait:0,trailing:false},M={configurable:false,enumerable:false,value:null,writable:false},V={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false},U={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},G=V[typeof window]&&window||this,H=V[typeof exports]&&exports&&!exports.nodeType&&exports,J=V[typeof module]&&module&&!module.nodeType&&module,Q=J&&J.exports===H&&H,X=V[typeof global]&&global;!X||X.global!==X&&X.window!==X||(G=X);
var Y=s();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(G._=Y, define(function(){return Y})):H&&J?Q?(J.exports=Y)._=Y:H._=Y:G._=Y}).call(this);


;


(function ($, undefined) {
  
  "use strict";

  var pvud = Planview.RegisterNamespace("Planview.Util.Date");

  pvud.DateMaskTranslator = function() {
    var that = {};
    var dotNetToJQueryCache = {};
    var aspToJqueryCache = {};

    var translateDateMask = function(dotNetMask) {
      var datepickerMask = dotNetMask,
          theDs = dotNetMask.match(/d+/g) || [],
          theMs = dotNetMask.match(/M+/g) || [],
          theYs = dotNetMask.match(/y+/g) || [],
          translator = {
            d: 'd',
            dd: 'dd',
            ddd: 'D',
            dddd: 'DD',
            M: 'm',
            MM: 'mm',
            MMM: 'M',
            MMMM: 'MM',
            yy: 'y',
            yyyy: 'yy'
          },
          error = function(dateUnit, expected) {
            throw "Could not resolve the " + dateUnit + " component in the mask '" + dotNetMask + "'. " +
              "Expected one of " + expected + ".";
          };

      if ((theDs.length === 1 && Planview.hasValue(translator[theDs[0]])) || error("Day", "['d', 'dd', 'ddd', 'dddd']"))
        datepickerMask = datepickerMask.replace(theDs[0], translator[theDs[0]]);

      if ((theMs.length === 1 && Planview.hasValue(translator[theMs[0]])) || error("Month", "['M', 'MM', 'MMM', 'MMMM']"))
        datepickerMask = datepickerMask.replace(theMs[0], translator[theMs[0]]);

      if ((theYs.length === 1 && Planview.hasValue(translator[theYs[0]])) || error("Year", "['yy', 'yyyy']"))
        datepickerMask = datepickerMask.replace(theYs[0], translator[theYs[0]]);

      return datepickerMask;
    };

    var dotNetToJQuery = function (dtoNetMask) {
      var memoKey = dtoNetMask;
      if (!dotNetToJQueryCache.hasOwnProperty(memoKey)) {
        dotNetToJQueryCache[memoKey] = translateDateMask(dtoNetMask);
      }
      return dotNetToJQueryCache[memoKey];
    };

    

    var aspToJQuery = function (aspMask) {
      var memoKey = aspMask, normalizedDateMask;
      if (!aspToJqueryCache.hasOwnProperty(memoKey)) {
        
        
        normalizedDateMask = aspMask.replace(/Y/g, 'y').replace(/D/g, 'd');
        aspToJqueryCache[memoKey] = translateDateMask(normalizedDateMask);
      }
      return aspToJqueryCache[memoKey];
    };

    

    that.dotNetToJQuery = dotNetToJQuery;
    that.aspToJQuery = aspToJQuery;
    return that;
  }();  

})(jQuery);



;


;


(function($, undefined) {
  
  "use strict";

  var pvud = Planview.RegisterNamespace("Planview.Util.Date");

  pvud.TimeScaleHelpersConstructor = function (that) {

    


    var toString = function () {
      return 'Timescale [ordinal: ' + this.ordinal + '] [symbol: ' + this.symbol + '] [word: ' + this.word + '] [grain: ' + this.grain + ']';
    };

    


    var timescaleModels = [
      { ordinal: 0, symbol: 'd', word: 'Days', grain: 'day', toString: toString },
      { ordinal: 1, symbol: 'w', word: 'Weeks', grain: 'week', toString: toString },
      { ordinal: 2, symbol: 'm', word: 'Months', grain: 'month', toString: toString },
      { ordinal: 3, symbol: 'q', word: 'Quarters', grain: 'quarter', toString: toString },
      { ordinal: 4, symbol: 'y', word: 'Years', grain: 'year', toString: toString },
      { ordinal: 5, symbol: 'fm', word: 'FiscalMonths', grain: 'fiscalmonth', toString: toString }
    ]

    


    var getTimescaleBy = function (byProperty, withValue) {
      switch (byProperty) {
        case 'ordinal': return _.find(timescaleModels, { 'ordinal': withValue });
        case 'symbol': return _.find(timescaleModels, { 'symbol': withValue });
        case 'word': return _.find(timescaleModels, { 'word': withValue });
        case 'grain': return _.find(timescaleModels, { 'grain': withValue });
      }  
    };

    

    var addUnit = function (date, baseUnit, addend) {
      var sum;

      addend = addend || 1;
      
      if (typeof(addend) !== "number") {
        addend = 1;
      }
                                          
      switch (baseUnit)
      {
        case pvud.TimeScales.Days:
          {
            sum = new Date(date).setDate(date.getDate() + (1 * addend));

            break;
          }

        case pvud.TimeScales.Weeks:
          {
            sum = new Date(date).setDate(date.getDate() + (7 * addend));

            break;
          }

        case pvud.TimeScales.Months:
          {
            sum = new Date(date).setMonth(date.getMonth() + (1 * addend));

            break;
          }

        case pvud.TimeScales.Quarters:
          {
            sum = new Date(date).setMonth(date.getMonth() + (3 * addend));

            break;
          }

        case pvud.TimeScales.Years:
          {
            sum = new Date(date).setYear(date.getFullyear() + (1 * addend));

            break;
          }

        default:
          {
            throw new ArgumentOutOfRangeException("date",
                                                  "This function needs to be updated with additional pvud.TimeScales enum values");
          }
      }

      return sum;
    };

    

    var truncate = function (date, baseUnit) {
      var sum = new Date(date.Year, new Date(date).Month, new Date(date).Day);

      switch (baseUnit)
      {
        case pvud.TimeScales.Days:
          {
            break;
          }

        case pvud.TimeScales.Weeks:
          {
            sum = new Date(date).setDate(date.getDate() - new Date(date).getDay());

            break;
          }

        case pvud.TimeScales.Months:
          {
            sum = new Date(date).setDate((date.getDay() - 1) * (-1));

            break;
          }

        case pvud.TimeScales.Quarters:
          {
            var delta = (((date.getMonth() - 1) % 3) * (-1));

            sum = new Date(date).setMonth(delta);
            sum = sum.setDay((sum.getDay() - 1) * (-1));

            break;
          }

        case pvud.TimeScales.Years:
          {
            sum = new Date(date.getFullYear(), 0, 1);

            break;
          }

        default:
          {
            throw new ArgumentOutOfRangeException("date",
                                                  "This function needs to be updated with additional pvud.TimeScales enum values");
          }
      }

      sum = sum.Date;

      return sum;
    };

    that = that || {};
    that.getTimescaleBy = getTimescaleBy;
    that.addUnit = addUnit;
    that.truncate = truncate;

    return that;
  };

})(jQuery);



;





DropDownMenu.g_MenuActivatorCount;        
DropDownMenu.g_CurrentlyOpenMainMenu;     
DropDownMenu.g_LastMenuActivatorId;        
DropDownMenu.g_MainMenuCount = 0;         
DropDownMenu.g_MainMenus = new Array();       
DropDownMenu.g_jsonMenus = new Array();   
DropDownMenu.g_RenderedMenuIds = new Array();       
DropDownMenu.g_ImageUrl = "";             
DropDownMenu.g_FormStyles = new Array();
DropDownMenu.g_TaskbarStyles = new Array();
DropDownMenu.g_LayoutPanelStyles = new Array();
DropDownMenu.g_GridStyles = new Array();
DropDownMenu.g_GridId = "";
DropDownMenu.ActivatorContextData = [];



function DropDownMenu(parentId, parentDepth, parentIndex, dropDownMenuType, items, element)
{
  if(window.masterObject)
  {
    masterObject();
    DropDownMenu.g_ImageUrl = ImagePath.Url;
  }

  this.HasOpenSubmenu = false;
  this.ParentMenuId = parentId;
  this.ParentIndex = parentIndex;
  this.OpenSubmenuId = null;
  this.OpenedSubMenuIndex = null;
  this.IsMainMenu = false;
  this.Items = items;
  this.Element = element; 
  this.ShowSubmenu = null;
  this.Submenus = null;
  this.Depth = 0;
  this.DropDownMenuType = dropDownMenuType;   
  
  this.IsMainMenu = (this.ParentMenuId === null || this.ParentMenuId === undefined);

  if(this.MenuHasSubmenu())
  {
    this.ShowSubmenu = ShowSubmenu;
    this.Submenus = new Array(this.Items.length);
  }
    
  if (this.IsMainMenu)
  {
    this.Depth = 0;
    this.Id = "DDM_" + this.Element.id + "0";
    this.MenuContainerId = this.Id + "MenuContainer";
  }
  else
  {
    this.Depth = parentDepth + 1;
    this.Id = this.ParentMenuId + "_SubmenuOnItem" + parentIndex;
    this.MenuContainerId = this.Id + "MenuContainer";
  }
  
  this.RenderHTML();
  
  function ShowSubmenu(itemIndex,element)
  {
    
    
    
    
    if (this.Submenus[itemIndex] !== undefined && this.Submenus[itemIndex] !== null)
    {
      return;
    }
    
    element.onmouseout = '';
    
    var newSubmenu = new DropDownMenu(this.Id, this.Depth, itemIndex, this.DropDownMenuType, this.Items[itemIndex].Items, element);
    DropDownMenu.g_RenderedMenuIds[DropDownMenu.g_RenderedMenuIds.length] = newSubmenu.Id;
    this.Submenus[itemIndex] = newSubmenu;
    



    if(this.ItemHasSubmenu(itemIndex))
    {
      this.OpenedSubMenuIndex = itemIndex;
      this.HasOpenSubmenu = true;
      this.OpenSubmenuId = newSubmenu.Id;

    }
    
    return newSubmenu;
  }
}





DropDownMenu.prototype.RenderHTML = function ()
{
  var bodyElements = document.getElementsByTagName("body");
  var bodyElement = bodyElements[0];

  
  var ddmDiv = document.createElement("div");
  var ddmDivId = this.MenuContainerId;
  ddmDiv.className = 'dropDownMenuContainer';
  ddmDiv.onmouseout = new Function("DropDownMenu.StartTimer('" + this.Id + "');");
  ddmDiv.setAttribute("id", this.MenuContainerId);
  var top = getYPosition(this.Element);
  var left = getXPosition(this.Element);
  if (!this.IsMainMenu)
  {
    left = left + this.Element.offsetWidth - 2;
    ddmDiv.style.top = top + 1 + 'px';
    ddmDiv.style.left = left + 'px';
    ddmDiv.style.zIndex = 100 + this.Depth;
  }

  
  var frame = document.createElement("iframe");
  frame.style.zindex = '-1';
  frame.setAttribute("src", "javascript:\'<html></html>\';");
  frame.setAttribute("frameBorder", "0");
  frame.setAttribute("scrolling", "no");
  frame.setAttribute("id", this.Id + "HvrShm");


  
  var list = document.createElement("ul");
  list.className = 'dropDownMenu';
  list.setAttribute("id", this.Id);  


  
  var item;
  var anchor;
  for (var count = 0; count < this.Items.length; count++)
  {
    item = document.createElement("li");
    if (!this.Items[count].IsSeparator)
    {
      if (this.Items[count].Disable)
      {
        item.onmouseout = new Function("this.className='disabled';");
      }
      else
      {
        item.onmouseout = new Function("this.className='';");
        if (this.Items[count].UseSecondaryColor)
        {
          item.onmouseout = new Function("this.className='" + this.Items[count].SecondaryColorClass + "';");
        }
      }
    }



    if (this.ItemHasSubmenu(count))
    {
      if (this.Items[count].Disable)
      {
        item.onmouseover = new Function("DropDownMenu.StopDropDownMenuTimer('" + this.Id + "');DropDownMenu.SetRowDefaultStyles('" + this.Id + "');this.className='disabled';");
        item.innerHTML = this.Items[count].Text;
        item.className = "disabled";
        item.onmouseout = new Function("this.className='disabled';");
      }
      else
      {
        item.onmouseover = new Function("DropDownMenu.StopDropDownMenuTimer('" + this.Id + "');DropDownMenu.SetRowDefaultStyles('" + this.Id + "');this.className='hasSubmenuhover';DropDownMenu.ShowSubmenu(this,'" + this.Id + "','" + count + "');");
        item.innerHTML = this.Items[count].Text;
        item.className = "hasSubmenu";
        item.onmouseout = new Function("this.className='hasSubmenu';");
      }
    }
    else if (this.Items[count].IsSeparator)
    {
      item.className = "menuSeparator";
      if (!isIE)
      {
        item.style.height = "1px";
      }
      item.innerHTML = " ";
    }
    else
    {
      if (this.Items[count].UseSecondaryColor)
      {
        item.className = this.Items[count].SecondaryColorClass;
      }

      if (this.Items[count].Disable)
      {
        item.onmouseover = new Function("DropDownMenu.StopDropDownMenuTimer('" + this.Id + "');DropDownMenu.SetRowDefaultStyles('" + this.Id + "');this.className='disabled';");
        item.className = 'disabled';
      }
      else
      {
        item.onmouseover = new Function("DropDownMenu.StopDropDownMenuTimer('" + this.Id + "');DropDownMenu.SetRowDefaultStyles('" + this.Id + "');this.className='hover';");
      }
      
      
      var itemAction = this.Items[count].Action;

      
      var innerHtmlStr = this.Items[count].Text;

      var auxActions = this.Items[count].AuxActions;
      if (auxActions !== null && typeof (auxActions) !== 'undefined' && auxActions.length > 0)
      {
        innerHtmlStr = "<table id='" + this.Id + "AuxActions' name='" + this.Id + "AuxActions' cellpadding='0' cellspacing='0'" + (PVBrowserInfo.IsIE ? "" : " style='width:100%;'") + "><tr><td nowrap='nowrap' onclick=\"DropDownMenu.HideAllOpenMenusRightNow();" + itemAction + "\">" + innerHtmlStr + "</td>";
        var auxActionHtml = "";
        for (x = 0; x < auxActions.length; x++)
        {
          auxActionHtml += "<td width=\"1\" nowrap=\"nowrap\" title=\"" + auxActions[x].ToolTip + "\">";
          if ((!auxActions[x].Disabled) && (!IsNullOrEmpty(auxActions[x].Action)))
          {
            auxActionHtml += "<a class=\"ddMenuAuxAction\" id=\"" + auxActions[x].ID + "\" href=\"javascript:" + auxActions[x].Action + "\">";
          }
          if ((typeof (auxActions[x].Text) != 'undefined') && (auxActions[x].Text !== null) && (auxActions[x].Text != ''))
          {
            auxActionHtml += "<span style='padding-left:5px;'>" + auxActions[x].Text + "</span>";
          }
          else
          {
            auxActionHtml += "<img style='padding-left:5px;' src='" + auxActions[x].Icon + "'/>";
          }
          if ((!auxActions[x].Disabled) && (!IsNullOrEmpty(auxActions[x].Action)))
          {
            auxActionHtml += "</a>";
          }
          auxActionHtml += "</td>";
        }
        innerHtmlStr = innerHtmlStr + auxActionHtml;
        innerHtmlStr = innerHtmlStr + "</tr></table>";
      }
      else if (!this.Items[count].Disable)
      {
        item.onclick = new Function("DropDownMenu.HideAllOpenMenusRightNow();" + itemAction);
      }
      innerHtmlStr = innerHtmlStr.replace(" & ", " &#38; "); 
      item.innerHTML = innerHtmlStr;
    }

    if (this.Items[count - 1])
    {
      if (this.Items[count - 1].IsSeparator)
      {
        item.style.borderTop = 'none';
      }
    }

    item.setAttribute("id", this.Id + "_Item" + count);  
    if (this.Items[count] && this.Items[count].ToolTip) {
      item.setAttribute("title", this.Items[count].ToolTip);
    }
    list.appendChild(item);
  }

  
  ddmDiv.appendChild(list);
  ddmDiv.appendChild(frame);

  
  bodyElement.insertBefore(ddmDiv, bodyElement.firstChild);
};

DropDownMenu.prototype.ItemHasSubmenu = function(iItemIndex)
{
  if (this.Items === null || this.Items === undefined) { return false; }

  if (iItemIndex < this.Items.length)
  {
    if(this.Items[iItemIndex] !== undefined && 
       this.Items[iItemIndex].Items !== undefined && 
       this.Items[iItemIndex].Items !== null &&
       this.Items[iItemIndex].Items.length > 0)
    {
      return true;
    }
  }
  return false;
};


DropDownMenu.prototype.MenuHasSubmenu = function()
{
  if (this.Items === null || this.Items === undefined) { return false; }

  for (var iItemIndex = 0;iItemIndex < this.Items.length; iItemIndex++)
  {
    if (this.ItemHasSubmenu(iItemIndex)) 
    {
      return true;
    }
  }
  return false;
}; 


DropDownMenu.prototype.MakeMenuVisible = function()
{
  var menuElement = document.getElementById(this.MenuContainerId);
  menuElement.style.display = 'block';
};

DropDownMenu.prototype.GetParentMenuId = function()
{
  return this.ParentMenuId;
};

DropDownMenu.prototype.GetOpenSubmenuId = function()
{
  return this.OpenSubmenuId;
};






DropDownMenu.prototype.HideMenu = function()
{
  
  var menuContainerElement = document.getElementById(this.MenuContainerId);
  menuContainerElement.style.display = 'none';

 
 
 
  if (DropDownMenu.g_CurrentlyOpenMainMenu === null || DropDownMenu.g_CurrentlyOpenMainMenu === undefined) 
  {
    return;
  }
  
  if (this.Id == DropDownMenu.g_CurrentlyOpenMainMenu.Id)
  {
    DropDownMenu.g_CurrentlyOpenMainMenu = null;
  }
};


DropDownMenu.prototype.StopTimer = function() 
{ 
  clearTimeout(DropDownMenu.sDisplayTimer);
};


DropDownMenu.prototype.StartTimer = function (millisec)
{
  
  this.StopTimer();

  
  if (this.HasOpenSubmenu)
  {
    DropDownMenu.sDisplayTimer = setTimeout("DropDownMenu.HideThisMenu('" + this.OpenSubmenuId + "');DropDownMenu.HideThisMenuAndAllParents('" + this.Id + "');", millisec);
  }
  else
  {
    DropDownMenu.sDisplayTimer = setTimeout("DropDownMenu.HideThisMenuAndAllParents('" + this.Id + "');", millisec);
  }
};









DropDownMenu.HideThisMenuAndAllParents = function (menuId)
{
  var oMenu = DropDownMenu.FindMenu(menuId, DropDownMenu.g_CurrentlyOpenMainMenu);

  if (oMenu !== null && oMenu !== undefined)
  {
    oMenu.HideMenu();
    if (oMenu.IsMainMenu != true)
    {
      parentMenuId = oMenu.GetParentMenuId();

      if (parentMenuId !== null && parentMenuId !== undefined)
      {
        DropDownMenu.HideThisMenuAndAllParents(parentMenuId);
      }
    }
  }
};

DropDownMenu.HideThisMenu = function(menuId)
{
  var oMenu = DropDownMenu.FindMenu(menuId, DropDownMenu.g_CurrentlyOpenMainMenu);
 
  if (oMenu !== null && oMenu !== undefined)
  {
    oMenu.HideMenu();
  }
};

DropDownMenu.StartTimer = function(menuId)
{
  var oMenu = DropDownMenu.FindMenu(menuId, DropDownMenu.g_CurrentlyOpenMainMenu);
  if (oMenu !== null && oMenu !== undefined)
  {
    oMenu.StartTimer(500);
  }
};

DropDownMenu.StopDropDownMenuTimer = function(menuId)
{  



  if (menuId === null || menuId === undefined) 
  {
    return;
  }

  
  
  if (DropDownMenu.g_CurrentlyOpenMainMenu === null || DropDownMenu.g_CurrentlyOpenMainMenu === undefined) 
  {
    return;
  }
  
  var oMenu = DropDownMenu.FindMenu(menuId, DropDownMenu.g_CurrentlyOpenMainMenu);
  
  if (oMenu !== null && oMenu !== undefined)
  {
    oMenu.StopTimer();
    if (oMenu.HasOpenSubmenu)
    {
  
      DropDownMenu.HideAllOpenMenusFromHereDown(oMenu.GetOpenSubmenuId(), oMenu);
    }
  }
};

DropDownMenu.HideAllOpenMenusRightNow = function()
{
  if (DropDownMenu.g_CurrentlyOpenMainMenu !== null && DropDownMenu.g_CurrentlyOpenMainMenu !== undefined)
  {
    DropDownMenu.HideAllOpenMenusFromHereDown(DropDownMenu.g_CurrentlyOpenMainMenu.Id, DropDownMenu.g_CurrentlyOpenMainMenu);
  }
};



DropDownMenu.HideAllOpenMenusFromHereDown = function(menuId, startMenu)
{ 
  
  
  
  
 
 

  if (menuId === null || menuId === undefined) 
  {
    return;
  }
      
  var oMenu = DropDownMenu.FindMenu(menuId, startMenu);
  
  if (oMenu === null || oMenu === undefined)
  {
    
    return;
  }

  oMenu.HideMenu();
    
  if (oMenu.HasOpenSubmenu)
  {
    var subMenuId = oMenu.GetOpenSubmenuId();
    if(subMenuId !== null && subMenuId !== undefined)
    {
      DropDownMenu.HideAllOpenMenusFromHereDown(subMenuId, oMenu);
    } 
  }
};


DropDownMenu.ShowMainMenu = function (element, masterElementId, dropDownMenuType, gridId)
{
  
  
  if (gridId != null && typeof (gridId) != 'undefined')
  {
    DropDownMenu.g_GridId = gridId
  }
  
  DropDownMenu.HideAllOpenMenusRightNow();

  var jsonString = DropDownMenu.g_jsonMenus[masterElementId];

  if (jsonString !== undefined)
  {
    if (!DropDownMenu.MenuExists("DDM_" + element.id + "0"))
    {
      var menuData = jsonString;
      DropDownMenu.g_CurrentlyOpenMainMenu = new DropDownMenu(null, 0, -1, dropDownMenuType, menuData, element);
      DropDownMenu.g_MainMenus[DropDownMenu.g_MainMenuCount] = DropDownMenu.g_CurrentlyOpenMainMenu;
      DropDownMenu.g_RenderedMenuIds[DropDownMenu.g_RenderedMenuIds.length] = DropDownMenu.g_CurrentlyOpenMainMenu.Id;
      ++DropDownMenu.g_MainMenuCount;
      DropDownMenu.g_jsonMenus[masterElementId].ForceRedefine = false;
    }
    else
    {
      DropDownMenu.g_CurrentlyOpenMainMenu = DropDownMenu.FindMainMenuById("DDM_" + element.id + "0");
    }

    if (DropDownMenu.g_CurrentlyOpenMainMenu === null)
    {
      alert('Unable to find previously created main menu object: DDM_' + element.id + '0');
      return;
    }

    DropDownMenu.g_LastMenuActivatorId = element.id;

    DropDownMenu.g_CurrentlyOpenMainMenu.MakeMenuVisible();

    
    
    

    DropDownMenu.ResizeContainers(DropDownMenu.g_CurrentlyOpenMainMenu, element, dropDownMenuType);

    
    

    
    
    
  }
  else
  {
    alert("DropDownMenu Error: There is no json from which to create a menu.");
  }
};


DropDownMenu.ShowSubmenu = function(element, parentMenuId, itemIndex, dropDownMenuType)
{ 
  var parentMenu = DropDownMenu.FindMenu(parentMenuId, DropDownMenu.g_CurrentlyOpenMainMenu);  
  var subMenuId = parentMenuId + "_SubmenuOnItem" + itemIndex;
  


  
  if(parentMenu !== null)
  {
    var oSubmenu = null;
    if (! DropDownMenu.MenuExists(subMenuId))
    {
      oSubmenu = parentMenu.ShowSubmenu(itemIndex, element);
    }
    else
    {
      parentMenu.OpenedSubMenuIndex = itemIndex;
    }
    
    if (oSubmenu === null)
    {
     oSubmenu = DropDownMenu.FindMenu(subMenuId, parentMenu);
     parentMenu.OpenSubmenuId = oSubmenu.Id;
    }
    
    element.onmouseout = '';
        
    oSubmenu.MakeMenuVisible();
    DropDownMenu.ResizeContainers(oSubmenu,element, dropDownMenuType);
  }
  else
  {
    alert('parent menu ' + parentMenuId + ' not found');
  }
};


DropDownMenu.MenuExists = function(menuId)
{
  var existenceTest = document.getElementById(menuId);
  var menuIdForJSONArray = menuId;
  if (menuId.indexOf("DDM_",0) >= 0)
  { menuIdForJSONArray = menuId.substring(4,menuId.length-1);
  }

  if(existenceTest === null || existenceTest === undefined)
  {
    return false;
  }
  else if (DropDownMenu.g_jsonMenus[menuIdForJSONArray] && DropDownMenu.g_jsonMenus[menuIdForJSONArray].ForceRedefine)
  { 
    existenceTest = existenceTest.parentNode;
    existenceTest.parentNode.removeChild(existenceTest);
    return false;
  }
  
  return true;
};

DropDownMenu.FindMainMenuById = function(menuId)
{
  var fFound = false;
  var i = 0;
  var menu = null;
  do 
  {
    if(DropDownMenu.g_MainMenus[i].Id == menuId)
    {
      fFound = true;
      menu = DropDownMenu.g_MainMenus[i];
    }
    ++i;
  } 
  while ((i < DropDownMenu.g_MainMenuCount) && 
         (fFound == false))
  
  return menu;
};

DropDownMenu.FindMenu = function(menuId, menus)
{ 
  var menu = null;  
   
  
  if(menuId === null || menuId === undefined)
  {
    alert('You must provide a menuId to search for.');
    return null;
  }
  
  if(menus === null || menus === undefined)
  {
   
    return null;
  }
  
  
  if (menus.Id == menuId) 
  { 
    return menus; 
  } 
  
  
  if (! menus.MenuHasSubmenu())
  {
    
    return null;
  }
 
  var numItems = menus.Items.length;

  for (var i = 0; i < numItems; i++)
  {
    
    
    
    if(menus.Submenus[i] !== null && menus.Submenus[i] !== undefined)
    {
      if(menus.Submenus[i].Id == menuId)
      {
        menu = menus.Submenus[i];
      }
      else if(menus.Submenus[i].MenuHasSubmenu())
      {
        menu = DropDownMenu.FindMenu(menuId, menus.Submenus[i]);
      } 
          
      if (menu !== null) { return menu; }
    }
  }
  
  return menu;
};

DropDownMenu.RemoveAllHTMLMenus = function()
{ 
  
  
  
  

  
  
  

  
  
  
  
  

  
  
  
  
  
  

  
  
  

  
  
  
  
  
  
  
  
  
  
  

  
        
  if(DropDownMenu.g_RenderedMenuIds === null || DropDownMenu.g_RenderedMenuIds === undefined)
  {
    return true;
  }
  
  if(DropDownMenu.g_RenderedMenuIds.length == 0 )
  {
    return true;
  }
  
  for (var i = 0; i < DropDownMenu.g_RenderedMenuIds.length; i++)
  {
    var menuId = DropDownMenu.g_RenderedMenuIds[i];
    var menuHTML =  document.getElementById(menuId);
    menuHTML.parentNode.removeChild(menuHTML);
  }
  DropDownMenu.g_RenderedMenuIds = new Array();
  DropDownMenu.g_MainMenuCount = 0;
  DropDownMenu.g_MainMenus = new Array(); 
  DropDownMenu.g_CurrentlyOpenMainMenu = null;
  
  return true;
};


DropDownMenu.SetRowDefaultStyles = function(menuId)
{
  if (DropDownMenu.g_CurrentlyOpenMainMenu === null || DropDownMenu.g_CurrentlyOpenMainMenu === undefined) 
  {
    return;
  }
  var oMenu = DropDownMenu.FindMenu(menuId, DropDownMenu.g_CurrentlyOpenMainMenu);

  if (oMenu !== null && oMenu !== undefined)
  {
    if (oMenu.OpenedSubMenuIndex !== null)
    {
      var menuElement = document.getElementById(menuId);
      menuElement.childNodes[oMenu.OpenedSubMenuIndex].className = 'hasSubmenu';
    }
  }
};

DropDownMenu.ResizeContainers = function (currentlyOpenMenu, activatorElement, dropDownMenuType)
{
  if (currentlyOpenMenu != undefined)
  {
    var activatorElementAction = null;
    if (currentlyOpenMenu.IsMainMenu)
    {
      
      activatorElementAction = document.getElementById(activatorElement.id + '_action');
    }
    var menu = document.getElementById(currentlyOpenMenu.Id);
    var menuContainer = document.getElementById(currentlyOpenMenu.MenuContainerId);
    var menuIFrame = document.getElementById(currentlyOpenMenu.Id + 'HvrShm');
    var menuText = document.getElementsByName(currentlyOpenMenu.Id + 'AuxActions');

    if (menu && menuContainer && menuIFrame)
    {
      if (activatorElementAction !== null)
      {
        if (menu.offsetWidth < activatorElementAction.offsetWidth)
        {
          menu.style.width = activatorElementAction.offsetWidth + 'px';
        }
      }

      menuContainer.style.width = menu.offsetWidth + 'px';
      menuIFrame.style.width = menu.offsetWidth + 'px';
      menuContainer.style.height = menu.offsetHeight + 'px';
      menuIFrame.style.height = menu.offsetHeight + 'px';

      if (menuText !== null && typeof (menuText) !== 'undefined')
      {
        var maxWidth = menu.offsetWidth;
        for (var x = 0; x < menuText.length - 1; x++)
        {
          if (menuText[x].offsetWidth > maxWidth) { maxWidth = menuText[x].offsetWidth; }
        }
        
        for (var x = 0; x < menuText.length; x++)
        {
          if(PVBrowserInfo.IsIE) menuText[x].style.width = maxWidth - 12 + 'px';
        }
      }
    }

  }
  DropDownMenu.MoveMenu(currentlyOpenMenu, activatorElement, dropDownMenuType);
};

DropDownMenu.MoveMenu = function (currentlyOpenMenu, activatorElement, dropDownMenuType)
{
  var menuContainer = document.getElementById(currentlyOpenMenu.MenuContainerId);

  
  var activatorElementAction = document.getElementById(activatorElement.id + '_action');
  var activatorElementInner = $("#" + activatorElement.id.replace("|","\\|") + "_inner"); // Some id's have pipes in them
  
  if (currentlyOpenMenu.IsMainMenu) {
    
    
    var top = "BannerTab" == dropDownMenuType ? $("#tabs").offset().top + $("#tabs").height() : $(activatorElement).offset().top + activatorElementInner.outerHeight();
    var left = getXPosition(activatorElement);

    if (dropDownMenuType == "Taskbar")
    {
      top = top - 2;
      left = left + 14;
    }

    if (dropDownMenuType == "Grid" && PVBrowserInfo.IsIE) left = left + 3; ;

    if (dropDownMenuType == "LayoutPanel") left = left + 4;


    menuContainer.style.top = top + 'px';
    menuContainer.style.left = left + 'px';
    menuContainer.style.zIndex = 100;
    
    
    
    var flipMenu = true;
    var checkTop = top;
    if (!PVBrowserInfo.IsIE && dropDownMenuType == "Grid")
    {
      checkTop = top + activatorElementAction.offsetHeight;
    }
    if (checkTop - menuContainer.offsetHeight - activatorElementInner.outerHeight() - $("#BannerWrapper").height() < 0)
    {
      flipMenu = false;
      
      if ((top + $(menuContainer).height()) > ($(window).height() - $("#BannerWrapper").height())) {
        
        top = $("#BannerWrapper").height() + 5;
        menuContainer.style.top = top + "px";
      }
    }
    if ((getScrollTop2() + getClientHeight2() <= top + menuContainer.offsetHeight) && (flipMenu))
    {
      if (!PVBrowserInfo.IsIE && dropDownMenuType == "Grid")
      {
        top = top + activatorElementAction.offsetHeight;
      }
      top = top - menuContainer.offsetHeight - activatorElementInner.outerHeight();
      menuContainer.style.top = top + "px";
    }

    
    flipMenu = true;
    var checkLeft = left;
    if (checkLeft - (menuContainer.offsetWidth - activatorElement.offsetWidth) < 0)
    {
      flipMenu = false;
    }
    if (getScrollLeft2() + getClientWidth2() <= left + menuContainer.offsetWidth)
    {
      
      left = left - (menuContainer.offsetWidth - activatorElementInner.outerWidth());
      menuContainer.style.left = left + "px";
    }
  }
  else
  {
    
    
    var $activator = $(activatorElement);
    var left = $activator.parent().offset().left + activatorElement.offsetWidth + 6;
    var top = $activator.offset().top;

    menuContainer.style.top = top + 'px';

    
    
    var flipMenu = true;
    var checkTop = top;
    if (checkTop - menuContainer.offsetHeight - activatorElementInner.outerHeight() - $("#BannerWrapper").height() < 0)
    {
      flipMenu = false;
      if ((top + $(menuContainer).height()) > ($(window).height() - $("#BannerWrapper").height())) {
        
        top = $("#BannerWrapper").height() + 5;
        menuContainer.style.top = top + "px";
      }
    }
    if ((getScrollTop2() + getClientHeight2() <= top + menuContainer.offsetHeight) && (flipMenu))
    {
      top = top - menuContainer.offsetHeight + $(document.getElementById(activatorElement.id).offsetParent.parentElement).height();
      menuContainer.style.top = top + "px";
    }

    
    flipMenu = true;
    var checkLeft = left;
    if (checkLeft - menuContainer.offsetWidth - currentlyOpenMenu.Element.offsetWidth < 0)
    {
      flipMenu = false;
    }
    
    if (getScrollLeft2() + getClientWidth2() <= left + menuContainer.offsetWidth)
    {
      var newLeft = left - menuContainer.offsetWidth - currentlyOpenMenu.Element.offsetWidth;
      if (newLeft < 0) {
        newLeft = 0;
      }
      menuContainer.style.left = newLeft + "px";
    }
  }
};

DropDownMenu.EnableItem = function(menuId, index, optionalSecondaryClassName)
{ DropDownMenu.g_jsonMenus[menuId][index].Disable = false;
  if ((null == optionalSecondaryClassName) || (typeof(optionalSecondaryClassName) == 'undefined') || (optionalSecondaryClassName!=''))
  { DropDownMenu.g_jsonMenus[menuId][index].SecondaryColorClass = optionalSecondaryClassName;
  }
  DropDownMenu.g_jsonMenus[menuId].ForceRedefine = true;
}
DropDownMenu.DisableItem = function(menuId, index)
{ 
  DropDownMenu.g_jsonMenus[menuId][index].Disable = true;
  DropDownMenu.g_jsonMenus[menuId].ForceRedefine = true;
}


DropDownMenu.Enable = function (id, icon, text, tooltip, styles)
{
  var onclick = 'DropDownMenu.ShowMainMenu(document.getElementById(\'' + id + '\'))';
  var activatorStyle = styles["ActivatorStyle"];
  var activeStyle = styles["ActivatorActiveStyle"];
  var disabledStyle = styles["ActivatorDisabledStyle"];
  var mouseOverStyle = styles["ActivatorMouseOverStyle"];
  var mouseOutStyle = styles["ActivatorMouseOutStyle"];
  var mouseDownStyle = styles["ActivatorMouseDownStyle"];
  var mouseUpStyle = styles["ActivatorMouseUpStyle"];
  var NoIcon = styles["ActivatorNoIconStyle"];

  if (icon == "noicon")
  {
    document.getElementById(id).innerHTML = '<a id="' + id + '_action" ' + 'onclick="' + onclick + '" title="' + tooltip + '">' +
                                               '<span class="' + activeStyle + '" id="' + id + '_inner' +
                                                   '" onMouseOver="this.className=\'' + mouseOverStyle +
                                                   '\';" onMouseOut="this.className=\'' + mouseOutStyle + "\';DropDownMouseOutEvent()" +
                                                   ';" onMouseDown="this.className=\'' + mouseDownStyle +
                                                   '\';" onMouseUp="this.className=\'' + mouseUpStyle + '\';" >' +
                                                 ' ' + text + ' ' +
                                               '</span>' +
                                             '</a>';

  }
  else
  {
    if (icon.length > 0)
    {
      document.getElementById(id).innerHTML = '<a id="' + id + '_action" ' + 'onclick="' + onclick + '" title="' + tooltip + '">' +
                                               '<span class="' + activeStyle + '" id="' + id + '_inner' +
                                                   '" onMouseOver="this.className=\'' + mouseOverStyle +
                                                   '\';" onMouseOut="this.className=\'' + mouseOutStyle + "\';DropDownMouseOutEvent()" +
                                                   ';" onMouseDown="this.className=\'' + mouseDownStyle +
                                                   '\';" onMouseUp="this.className=\'' + mouseUpStyle + '\';" >' +
                                                 '<img id="' + id + '_image" ' + 'src="' + DropDownMenu.g_ImageUrl + icon + '" align="absmiddle">' +
                                                 ' ' + text + ' ' +
                                                 '<img src="' + DropDownMenu.g_ImageUrl + 'arrow_down.gif' + '" align="absmiddle">' +
                                               '</span>' +
                                             '</a>';
    }
    else
    {
      document.getElementById(id).innerHTML = '<a id="' + id + '_action" ' + 'onclick="' + onclick + '" title="' + tooltip + '">' +
                                               '<span class="' + activeStyle + ' buttonNoIcon" id="' + id + '_inner' +
                                                   '" onMouseOver="this.className=\'' + mouseOverStyle +
                                                   '\';" onMouseOut="this.className=\'' + mouseOutStyle + "\';DropDownMouseOutEvent()" +
                                                   ';" onMouseDown="this.className=\'' + mouseDownStyle +
                                                   '\';" onMouseUp="this.className=\'' + mouseUpStyle + '\';" >' +
                                                 ' ' + text + ' ' +
                                                 '<img src="' + DropDownMenu.g_ImageUrl + 'arrow_down.gif' + '" align="absmiddle">' +
                                               '</span>' +
                                             '</a>';
    }
  }
};

DropDownMenu.Disable = function (id, icon, text, tooltip, styles)
{
  var disabledStyle = styles["ActivatorDisabledStyle"];
  var NoIcon = styles["ActivatorNoIconStyle"];
  var iconNameNoPostfix = icon.substring(0, icon.length - 4);

  if (icon == "noicon")
  {
    document.getElementById(id).innerHTML = '<span class="' + disabledStyle + '">' +
                                               '<span class="' + NoIcon + '">' + text + ' </span>' +
                                            '</span>';
  }
  else
  {
    if (icon.length > 0)
    {
      document.getElementById(id).innerHTML = '<span class="' + disabledStyle + '">' +
                                               '<img id="' + id + '_image" ' + 'src="' + DropDownMenu.g_ImageUrl + icon + '_d' + '" align="absmiddle">' +
                                               ' ' + text + ' ' +
                                               '<img src="' + DropDownMenu.g_ImageUrl + 'arrow_down.gif' + '" align="absmiddle">' +
                                             '</span>';
    }
    else
    {
      document.getElementById(id).innerHTML = '<span class="' + disabledStyle + '">' +
                                               '<span class="' + NoIcon + '">' + text + ' </span>' +
                                               '<img src="' + DropDownMenu.g_ImageUrl + 'arrow_down.gif' + '" align="absmiddle">' +
                                            '</span>';
    }
  }
};

DropDownMenu.AddJSONMenuJavaScriptArray = function(menuID, menuJSON)
{ 
  DropDownMenu.g_jsonMenus[menuID] = menuJSON;
};

DropDownMenu.GetActivatorContextData = function()
{
  return DropDownMenu.ActivatorContextData[DropDownMenu.g_LastMenuActivatorId];
};

function GridDropDownMenu(){}
GridDropDownMenu.Enable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Enable(id, icon, text, tooltip, DropDownMenu.g_GridStyles);
}
GridDropDownMenu.Disable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Disable(id, icon, text, tooltip, DropDownMenu.g_GridStyles);
}


function FormDropDownMenu(){}
FormDropDownMenu.Enable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Enable(id, icon, text, tooltip, DropDownMenu.g_FormStyles);
}
FormDropDownMenu.Disable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Disable(id, icon, text, tooltip, DropDownMenu.g_FormStyles);
}

function TaskbarDropDownMenu(){}
TaskbarDropDownMenu.Enable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Enable(id, icon, text, tooltip, DropDownMenu.g_TaskbarStyles);
}
TaskbarDropDownMenu.Disable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Disable(id, icon, text, tooltip, DropDownMenu.g_TaskbarStyles);
}


function LayoutPanelDropDownMenu(){}
LayoutPanelDropDownMenu.Enable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Enable(id, icon, text, tooltip, DropDownMenu.g_LayoutPanelStyles);
}
LayoutPanelDropDownMenu.Disable = function(id, icon, text, tooltip)
{  
  DropDownMenu.Disable(id, icon, text, tooltip, DropDownMenu.g_LayoutPanelStyles);
}






















function getYPosition(element,frameId)
{
  var myElement = element;
  var yPos = myElement.offsetTop;
  while (myElement.offsetParent)
  { 
    myElement = myElement.offsetParent;
    yPos = yPos + myElement.offsetTop  - myElement.scrollTop;
  }
  if (frameId)
  { 
    myElement = top.frames[frameId].frameElement;
    yPos = yPos + myElement.offsetTop;
    while (myElement.offsetParent)
    { myElement = myElement.offsetParent;
      yPos = yPos + myElement.offsetTop  - myElement.scrollTop;
    }
  }  
  return yPos;
}





















function getXPosition(element,frameId)
{ 
  var myElement = element;
  var xPos = myElement.offsetLeft;
  while (myElement.offsetParent)
  { myElement = myElement.offsetParent;
    xPos = xPos + myElement.offsetLeft - myElement.scrollLeft;
  }
  if (frameId)
  { myElement = top.frames['Frame_NOTIFICATIONS'].frameElement;
    xPos = xPos + myElement.offsetLeft;
    while (myElement.offsetParent)
    { myElement = myElement.offsetParent;
      xPos = xPos + myElement.offsetLeft - myElement.scrollLeft;
    }
  }
  return xPos;
}


function getScrollLeft2()
{ 
  if (document.documentElement && (document.documentElement.scrollLeft > 0))
  {
    return document.documentElement.scrollLeft;
  }
  else
  {
    return document.body.scrollLeft;
  }
}




function getScrollTop2()
{ 
  if (document.documentElement && (document.documentElement.scrollTop > 0))
  {
    return document.documentElement.scrollTop;
  }
  else
  {
    return document.body.scrollTop;
  }
}




function getClientHeight2()
{ 
  if (document.documentElement && (document.documentElement.clientHeight > 0))
  {
    return document.documentElement.clientHeight;
  }
  else
  {
    return document.body.clientHeight;
  }
}

function getClientWidth2()
{ 
  if (document.documentElement && (document.documentElement.clientWidth > 0))
  {
    return document.documentElement.clientWidth;
  }
  else
  {
    return document.body.clientWidth;
  }
}

function DropDownMouseOutEvent()
{
  if (DropDownMenu.g_CurrentlyOpenMainMenu !== null && DropDownMenu.g_CurrentlyOpenMainMenu !== undefined) { DropDownMenu.StopDropDownMenuTimer(DropDownMenu.g_CurrentlyOpenMainMenu.Id); DropDownMenu.g_CurrentlyOpenMainMenu.StartTimer(1000); }
}

















































  var objHandler = null;
  var arrExcluded = new Array();
  var URL;

  var g_ciSubmitForm = 0;
  var g_ciLoadInSelf = 1;
  var g_ciLoadInParent = 2;

  var g_iSelStructureSubmitMode = g_ciSubmitForm;
  var g_strSelStructureSubmitURL=null;
  var g_strSelStructureQParam = null;

  function exclude(code)  {
    arrExcluded[arrExcluded.length] = code;
  }

  function excludeMultiple(codeArray) {
    if (!codeArray.length > 0)  {
      for (var i=0; i<codeArray.length; i++)  {
        exclude(codeArray[i]);
      }
    }
  }

  function setHandlerObject(objCode,objDesc)  {
    objHandlerCode  = objCode;
    objHandlerDesc  = objDesc;
  }

  function insertText(oSelected)  {
    if (oSelected == null)
      return;

    var strCode   = oSelected.key;
    var strDesc   = oSelected.description;

    

    var nStartPos = strDesc.search("&#");
    while (nStartPos > -1)
    {
      var strNumeric = strDesc.substr(nStartPos + 2,10);
      var nEndPos = strNumeric.search(";");
      if (nEndPos > -1)
      {
        

        strNumeric = strNumeric.substr(0,nEndPos);
        var nValue = parseInt(strNumeric);
        strNumeric = String.fromCharCode(nValue);
        var strPrefix = "";
        var strSuffix = "";
        if (nStartPos > 0)
        {
          strPrefix = strDesc.substr(0,nStartPos);
        }
        strSuffix = strDesc.substr(nStartPos + 3 + nEndPos,strDesc.length);
        strDesc = strPrefix + strNumeric + strSuffix;

      }
      else
      {
        

        var strPrefix = "";
        var strSuffix = "";
        if (nStartPos > 0)
        {
          strPrefix = strDesc.substr(0,nStartPos);
        }
        strSuffix = strDesc.substr(nStartPos + 2,strDesc.strlen());
        strDesc = strPrefix + ":::" + strSuffix;

      }
      nStartPos = strDesc.search("&#");
    }
    strDesc = strDesc.replace(":::","&#");
    strDesc = strDesc.replace("&gt;",">");
    strDesc = strDesc.replace("&lt;","<");
    strDesc = strDesc.replace("&amp;","&");
    strDesc = strDesc.replace("&quot;","\"");

    objHandlerCode.value  = strCode;
    objHandlerDesc.value  = strDesc;
    arrExcluded = new Array();
    exclude(strCode);
  }

  function RemoveHtmlEncoding(oSelected)  {
    if (oSelected == null)
      return;

    var strCode   = oSelected.key;
    var strDesc   = oSelected.description;

    

    var nStartPos = strDesc.search("&#");
    while (nStartPos > -1)
    {
      var strNumeric = strDesc.substr(nStartPos + 2,10);
      var nEndPos = strNumeric.search(";");
      if (nEndPos > -1)
      {
        

        strNumeric = strNumeric.substr(0,nEndPos);
        var nValue = parseInt(strNumeric);
        strNumeric = String.fromCharCode(nValue);
        var strPrefix = "";
        var strSuffix = "";
        if (nStartPos > 0)
        {
          strPrefix = strDesc.substr(0,nStartPos);
        }
        strSuffix = strDesc.substr(nStartPos + 3 + nEndPos,strDesc.length);
        strDesc = strPrefix + strNumeric + strSuffix;

      }
      else
      {
        

        var strPrefix = "";
        var strSuffix = "";
        if (nStartPos > 0)
        {
          strPrefix = strDesc.substr(0,nStartPos);
        }
        strSuffix = strDesc.substr(nStartPos + 2,strDesc.strlen());
        strDesc = strPrefix + ":::" + strSuffix;

      }
      nStartPos = strDesc.search("&#");
    }
    strDesc = strDesc.replace(":::","&#");
    strDesc = strDesc.replace("&gt;",">");
    strDesc = strDesc.replace("&lt;","<");
    strDesc = strDesc.replace("&amp;","&");
    strDesc = strDesc.replace("&quot;","\"");
    
    return {"key": strCode, "description": strDesc};
  }

  function setURL(str)  {
    URL = str;
    URL = URL.replace("~/", "../");
  }

  function addOne(oSelected)  {
    

    var strCode   = oSelected.key;
    URL       = URL + strCode;
    location.href = URL;
  }

  function addOneWithReplace(oSelected) {
    

    var strCode   = oSelected.key;
    URL       = URL + strCode;
    location.replace(URL);
  }

  function add(arr) {
    for (var i=0; i<arr.length; i++)  {
      var strCode   = arr[i].key;
      var strDesc   = arr[i].description;
      var newOption = new Option(strDesc,strCode,0,1);
      var j     = document.picker.structure_codes.length;
      document.picker.structure_codes.options[j]  = newOption;
      document.picker.structure_codes.options[j].selected = false;
      exclude(strCode);
    }
  }

  function deleteUnselected() {
    var j = document.picker.structure_codes.length - 1;
    for (var i=j; i>0; i--) {
      if (!document.picker.structure_codes.options[i].selected) {
        document.picker.structure_codes.options[i]  = null;
      }
    }
    arrExcluded = new Array();
    for (i=0; i<=document.picker.structure_codes.length - 1; i++) {
      arrExcluded[i]  = document.picker.structure_codes.options[i].value;
    }
  }

  function dumpSpacer() {
    document.picker.structure_codes.options[0]  = null;
  }

var g_strStructureToChange;
var cPickerFormID = 'fmDataPickerParams';


function NeedsAppPath(strPath, strAppPath)
{
    var strUPath = strPath.toUpperCase();
    var strUAppPath = strAppPath.toUpperCase();
    var needsAppPath = false;
    var isRelativePath = ((strUPath.length >= 2) && (strUPath.substr(0, 2) == ".."));
    var startsWithHttp = ((strUPath.indexOf("HTTP:") == 0) || (strUPath.indexOf("HTTPS:") == 0));
    var startsWithDoubleSlash = (strUPath.indexOf("//") == 0);

    if ((! isRelativePath) && (! startsWithHttp) && (! startsWithDoubleSlash))
    {
        var pathElements = strUPath.split("/");
        var firstElement = "";
        
        if ((pathElements.length <= 1) && (pathElements[0] !== "/"))
        {
            firstElement = pathElements[0];
        }
        else if (pathElements.length >= 1)
        {
            firstElement = ("/" + pathElements[1]);
        }



        needsAppPath = (firstElement != strUAppPath)
    }



    return needsAppPath;
}

function TestNeedsAppPath() 
{
    alert("Begin TestNeedsAppPath()");

    var appPath = "/AppPath";
    var path1 = "../AppPath"; 
    var path2 = "/AppPathPlus"; 
    var path3 = "/AppPathPlus/someStuff/AppPath"; 
    var path4 = "/appPath" 
    var path5 = "../appPath" 
    var path6 = "/appPath/SomeStuff";  
    var path7 = "appPath" // not relative, no app path (missing '/'); needs app path
    var path8 = "appPathPlus" // not relative, no app path (missing '/'); needs app path
    var path9 = "" 
    var path10 = "/appPathPlus/apppath" 

    if (NeedsAppPath(path1, appPath)) alert("TestNeedsAppPath fail on path1" + path1);
    if (!NeedsAppPath(path2, appPath)) alert("TestNeedsAppPath fail on path2 " + path2);
    if (!NeedsAppPath(path3, appPath)) alert("TestNeedsAppPath fail on path3 " + path3);
    if (NeedsAppPath(path4, appPath)) alert("TestNeedsAppPath fail on path4 " + path4);
    if (NeedsAppPath(path5, appPath)) alert("TestNeedsAppPath fail on path5 " + path5);
    if (NeedsAppPath(path6, appPath)) alert("TestNeedsAppPath fail on path6 " + path6);
    if (!NeedsAppPath(path7, appPath)) alert("TestNeedsAppPath fail on path7 " + path7);
    if (!NeedsAppPath(path8, appPath)) alert("TestNeedsAppPath fail on path8 " + path8);
    if (!NeedsAppPath(path9, appPath)) alert("TestNeedsAppPath fail on path9 " + path9);
    if (!NeedsAppPath(path10, appPath)) alert("TestNeedsAppPath fail on path10 " + path10);
}

function DataPickerHandleSingleStruct(oSelected)
{
  if (oSelected == null || g_strStructureToChange == null || g_strStructureToChange.length == 0)
      return;
  switch (g_iSelStructureSubmitMode) {
  case g_ciLoadInSelf:
    if (g_strSelStructureSubmitURL){
      top.location.replace(SetURLParam(g_strAppPath+g_strSelStructureSubmitURL,g_strSelStructureQParam,oSelected.key));}
    break;
  case g_ciLoadInParent:
    if (g_strSelStructureSubmitURL && window.opener) {
        window.opener.location.replace(SetURLParam(g_strAppPath + g_strSelStructureSubmitURL, g_strSelStructureQParam, oSelected.key));
        window.close();
    }
    else {
        
        
        
        
        
        
        
        
        
        
        

        

        var submitURL = (  NeedsAppPath(g_strSelStructureSubmitURL, g_strAppPath)
                         ? (g_strAppPath + g_strSelStructureSubmitURL)
                         : g_strSelStructureSubmitURL);

        top.location.replace(SetURLParam(submitURL, g_strSelStructureQParam, oSelected.key));
    }
    break;
  default:
    var fm = document.getElementById(cPickerFormID);
    if (fm)
    {
      fm.appendChild(CreateHiddenField("scode",oSelected.key));
      fm.appendChild(CreateHiddenField("selectedCodes",oSelected.key));
      fm.appendChild(CreateHiddenField("selectedDescriptions",oSelected.description));
      fm.submit();
    }
  }
}
function DataPickerHandleMultiStruct(arrSelected)
{
  if (arrSelected.length == 0 || g_strStructureToChange == null || g_strStructureToChange.length == 0)
    return;
  var strCodes = strDescr = ".";
  for (var i = 0; i < arrSelected.length; i++)
  {
    strCodes = strCodes + "," + arrSelected[i].key;
    strDescr = strDescr + "," + arrSelected[i].description;
  }
  strCodes=strCodes.replace(".,","");
  strDescr=strDescr.replace(".,","");
  switch (g_iSelStructureSubmitMode) {
  case g_ciLoadInSelf:
    if (g_strSelStructureSubmitURL){
      top.location.replace(SetURLParam(g_strAppPath+g_strSelStructureSubmitURL,g_strSelStructureQParam,strCodes));}
    break;
  case g_ciLoadInParent:
    if (g_strSelStructureSubmitURL&&window.opener){
      window.opener.location.replace(SetURLParam(g_strAppPath+g_strSelStructureSubmitURL,g_strSelStructureQParam,strCodes));
      window.close();}
    break;
  default:
    var fm = document.getElementById(cPickerFormID);
    if (fm)
    {
      fm.appendChild(CreateHiddenField("selectedCodes",strCodes));
      fm.appendChild(CreateHiddenField("selectedDescriptions",strDescr));
      fm.submit();
    }
  }
}

function CreateHiddenField(strName, strValue)
{
  var input = document.createElement("input");
  input.name = strName;
  input.type = "hidden";
  input.value = strValue;
  return input;
}

function SelectStructure(strStruc, strTitle, urlSubmit, strSingle)
{
  var argv = SelectStructure.arguments;
  var argc = SelectStructure.arguments.length;
  g_iSelStructureSubmitMode = (argc > 4) ? argv[4] : g_ciSubmitForm;
  g_strSelStructureQParam = (argc > 5) ? argv[5] : "scode";
  var fMinSelLevelPPL = (argc > 6) ? argv[6] : false;
  if (g_iSelStructureSubmitMode!=g_ciSubmitForm&&g_iSelStructureSubmitMode!=g_ciLoadInSelf&&g_iSelStructureSubmitMode!=g_ciLoadInParent)
    {g_iSelStructureSubmitMode = g_ciSubmitForm;}
  g_strSelStructureSubmitURL = urlSubmit;
  g_strStructureToChange = strStruc;
  var strValue, arrSelected;
  if (!document.getElementById(cPickerFormID))
  {
    var myForm = document.createElement("form");
    document.getElementsByTagName("body").item(0).appendChild(myForm);

    myForm.id = cPickerFormID;
    myForm.name = cPickerFormID;
    myForm.method = "POST";
    myForm.action = urlSubmit;
    myForm.appendChild(CreateHiddenField("title",strTitle));
    myForm.appendChild(CreateHiddenField("prim",strStruc));
    myForm.appendChild(CreateHiddenField("single",strSingle));
  }
  var sUserName = unescape(getCookieKey("jssPlanview","User"));
  switch(strStruc)
  {
    case "$Plan":
      if (strSingle=="Y")
        if (fMinSelLevelPPL)
          DataPicker_SingleSelect(strTitle, "GrantedStructureProvider", "structure=$Plan;user="+sUserName+";usage=all;maxsellevel=ppl;minsellevel=ppl", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
        else
          DataPicker_SingleSelect(strTitle, "GrantedStructureProvider", "structure=$Plan;user="+sUserName+";usage=all;maxsellevel=ppl", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "GrantedStructureProvider", "structure=$Plan;user="+sUserName+";usage=all;maxsellevel=ppl", arrSelected, "DataPickerHandleMultiStruct",g_rootPathFromBanner);
      break;
    case "$Res":
      if (strSingle=="Y")
        DataPicker_SingleSelect(strTitle, "GrantedStructureProvider", "structure=$Res;user="+sUserName+";usage=all", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "GrantedStructureProvider", "structure=$Res;user="+sUserName+";usage=all", arrSelected, "DataPickerHandleMultiStruct",g_rootPathFromBanner);
      break;
    case "$Asset":
      if (strSingle=="Y")
        DataPicker_SingleSelect(strTitle, "StructureProvider", "structure=$Asset;selmode=0;", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "StructureProvider", "structure=$Asset;selmode=0;", arrSelected, "DataPickerHandleMultiStruct",g_rootPathFromBanner);
      break;
    case "$Service":
      if (strSingle=="Y")
        DataPicker_SingleSelect(strTitle, "GrantedStructureProvider", "structure=$Service;user="+sUserName+";usage=All", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "GrantedStructureProvider", "structure=$Service;user="+sUserName+";usage=All", arrSelected, "DataPickerHandleMultiStruct", g_rootPathFromBanner);
      break;
    case "$Prod":
      if (strSingle=="Y")
        DataPicker_SingleSelect(strTitle, "GrantedStructureProvider", "structure=$Prod;user="+sUserName+";usage=all", arrSelected, "DataPickerHandleSingleStruct", g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "GrantedStructureProvider", "structure=$Prod;user="+sUserName+";usage=all", arrSelected, "DataPickerHandleMultiStruct", g_rootPathFromBanner);
      break;
    default:
      if (strSingle=="Y")
        DataPicker_SingleSelect(strTitle, "StructureProvider", "structure="+strStruc+";selmode=1;", arrSelected, "DataPickerHandleSingleStruct",g_rootPathFromBanner);
      else
        DataPicker_MultiSelect(strTitle, "StructureProvider", "structure="+strStruc+";selmode=1;", arrSelected, "DataPickerHandleMultiStruct",g_rootPathFromBanner);
      break;
  }
}

function SelectSingleStructure(strStruc, strTitle, urlSubmit)
{
  SelectStructure(strStruc, strTitle, urlSubmit, 'Y');
}
function SelectMultiStructure(strStruc, strTitle, urlSubmit)
{
  SelectStructure(strStruc, strTitle, urlSubmit, 'N');
}





var g_arrSelected = null;
var g_funcReturn = null;
var g_strRootPath = "../";
var g_nSelectMode = 0;
var g_DP_strControlID = "";
var g_arrExcluded = null;

function DataPicker_SingleSelect(strTitle, strProvider, strProviderOptions, selected, funcReturn, strRootPath, startNode, arrExcluded)
{ 
  DataPicker_SingleSelectionProcessor(selected, strRootPath, arrExcluded)
  DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode, "directory");
}

function DataPicker_SingleSelectSearch(strTitle, strProvider, strProviderOptions, strSearchTerm, selected, funcReturn, strRootPath, startNode, arrExcluded)
{  
  DataPicker_SingleSelectionProcessor(selected, strRootPath, arrExcluded)
  DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode, "search", strSearchTerm);
}

function DataPicker_SingleSelectRecents(strTitle, strProvider, strProviderOptions, selected, funcReturn, strRootPath, startNode, arrExcluded)
{  
  DataPicker_SingleSelectionProcessor(selected, strRootPath, arrExcluded)
  DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode, "recents");
}

function DataPicker_SingleSelectFavorites(strTitle, strProvider, strProviderOptions, selected, funcReturn, strRootPath, startNode, arrExcluded)
{  
  DataPicker_SingleSelectionProcessor(selected, strRootPath, arrExcluded)
  DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode, "favorites");
}



function DataPicker_SingleSelectionProcessor(selected, strRootPath, arrExcluded)
{
  g_nSelectMode = 0;
  
  if (selected != null && typeof selected == "string")
  {    
    var arrSelected = new Array();
    arrSelected[0] = selected;
    SetSelectedList(arrSelected);
  }
  else
  {
    SetSelectedList(selected);
  }  
  SetExcludedList(arrExcluded);
  SetRootPath(strRootPath);
}



function DataPicker_MultiSelect(strTitle, strProvider, strProviderOptions, selected, funcReturn, strRootPath, startNode, arrExcluded)
{
  g_nSelectMode = 1;

  SetSelectedList(selected);
  SetRootPath(strRootPath);
  SetExcludedList(arrExcluded);
  
  DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode);
}

function SetSelectedList(arrSelected)
{
  g_arrSelected = new Array();
  if (arrSelected instanceof Array)
  {
    for (var i = 0; i < arrSelected.length; i++)
    {
      if (arrSelected[i] != null && typeof arrSelected[i] == "string" && arrSelected[i].length > 0)
        g_arrSelected[i] = arrSelected[i];
    }
  }
}

function SetExcludedList(arrExcluded)
{
  g_arrExcluded = new Array();
  if (arrExcluded instanceof Array)
  {
    for (var i = 0; i < arrExcluded.length; i++)
    {
      if (arrExcluded[i] != null && typeof arrExcluded[i] == "string" && arrExcluded[i].length > 0)
      {
        g_arrExcluded[i] = arrExcluded[i];
      }
    }
  }
}

function SetRootPath(strPath)
{
  g_strRootPath = "../";
  
  if (strPath == null || strPath.length == 0)
    return;
  
  if (strPath.charAt(strPath.length-1) != '/')
    strPath += "/";
  g_strRootPath = strPath;
}

function DataPicker_Show(strTitle, strProvider, strProviderOptions, funcReturn, startNode, startTab, strSearchTerm)
{
  g_funcReturn = funcReturn;
  
  if (strProvider.indexOf(".") < 0)
    strProvider = "Planview.Enterprise.DataPicker." + strProvider;
  
  var nCookieIndex = 0;      
  var arrCookieValues = new Array();
  arrCookieValues[0] = new Array("title",ConvertTextToCodes(strTitle));
  arrCookieValues[1] = new Array("provider",strProvider);
  arrCookieValues[2] = new Array("options",strProviderOptions);
  arrCookieValues[3] = new Array("selectmode", g_nSelectMode);
  nCookieIndex = 3;
  if (g_arrSelected.length > 0)
  {
    arrCookieValues[4] = new Array("startsel", g_arrSelected[0]);
    nCookieIndex = 4;
  }
  else if (startNode != null)
  {
    arrCookieValues[4] = new Array("drilldown", startNode);
    nCookieIndex = 4;
  }
  if (startTab != null && startTab.length > 0 && startTab != "directory")
  {
    arrCookieValues[++nCookieIndex] = new Array("startTab", startTab);
    
    if (startTab == "search")
    {
      arrCookieValues[++nCookieIndex] = new Array("searchTerm", strSearchTerm);
    }
  }

  var sanitizedValue = "";
  for (var cookieCounter = 0; cookieCounter < arrCookieValues.length; cookieCounter++)
  {
    if (cookieCounter > 0) sanitizedValue += "&";
    sanitizedValue += arrCookieValues[cookieCounter][0] + "=" + escape(arrCookieValues[cookieCounter][1]);
  }
  setCookie("jssPlanviewDataPicker", sanitizedValue, null, "/");
  
  OpenChildWindow(g_strRootPath + "DataPicker/DataPicker.aspx","DataPicker",-1,-1,-1,-1,true,false,false);
}

function DataPicker_ClearSingleSelect(strControlID, strText)
{
  var elem = document.getElementById(strControlID);
  if (elem && elem.value.length > 0)
  {
    elem.value = "";
    elem = document.getElementById(strControlID + "_link_");
    if (elem)
      elem.innerHTML = strText;
    elem = document.getElementById(g_DP_strControlID + "_selectBox_");
    if (elem)
      elem.value = strText;
  }
}

function DataPicker_HandleSingleSelectOld(oSel)
{
  if (g_DP_strControlID != null && g_DP_strControlID.length > 0)
  {
    var elem = document.getElementById(g_DP_strControlID);
    if (elem)
    {
      elem.value = oSel.key;
      elem = document.getElementById(g_DP_strControlID + "_link_");
      if (elem)
        elem.innerHTML = oSel.description;
      elem = document.getElementById(g_DP_strControlID + "_selectBox_");
      if (elem)
      elem.value= oSel.description;
    }
    g_DP_strControlID = "";
  }
  if (g_funcReturn != null && g_funcReturn.length > 0)
    eval(g_funcReturn + "(oSel);");
}

function DataPicker_HandleSingleSelect(oSel)
{
  var pickerId = "";
  
  if (g_DataPickerPlus !== undefined) { g_DataPickerPlus = false; }
  
  if (g_DP_strControlID != null && g_DP_strControlID.length > 0)
  {
    pickerId = g_DP_strControlID;
    g_DP_strControlID = "";
  }
  
  if (typeof g_funcReturn !== 'string' && typeof g_funcReturn !== 'undefined') {
    g_funcReturn(oSel);
  } else if (g_funcReturn != null && typeof g_funcReturn === "string" && g_funcReturn.length > 0) {
    eval(g_funcReturn + "(oSel, pickerId);");
  }
}





function DataPicker_HandleMultiSelect(oSel) {
  if (typeof g_funcReturn !== 'string' && typeof g_funcReturn !== 'undefined') {
    g_funcReturn(JSON.parse(oSel));
  }
}


function ConvertTextToCodes(strText)
{
	var strCodes = ""
	for (var i = 0; i < strText.length; i++)
	{
	  if (i > 0)
	    strCodes += ",";
		strCodes += strText.charCodeAt(i);
	}
	return strCodes;
}


var g_winContent = null;

function ShowContentWindow(strCode, strPortalType, fCloseParent)
{
	
	var strRoot = "..";
	
	
	if (window.location.href.toLowerCase().indexOf("managework/tickets") > -1)
    strRoot += "/..";

	if (window.location.href.toLowerCase().indexOf("portal/strategy") > -1)
    strRoot += "/..";

 	if (window.location.href.toLowerCase().indexOf("portal/portlets") > -1)
    strRoot += "/../..";


	ShowContentWindowR(strCode, strRoot, strPortalType, fCloseParent, "");
}

function ShowContentWindow2(strCode, strPortalType, fCloseParent, strReqNo)
{
	
	var strRoot = "..";
	
	
	if (window.location.href.toLowerCase().indexOf("managework/tickets") > -1)
    strRoot += "/..";

	if (window.location.href.toLowerCase().indexOf("portal/strategy") > -1)
    strRoot += "/..";

 	if (window.location.href.toLowerCase().indexOf("portal/portlets") > -1)
    strRoot += "/../..";


	ShowContentWindowR(strCode, strRoot, strPortalType, fCloseParent, strReqNo);
}

function ShowContentWindowR(strCode, strRoot, strPortalType, fCloseParent, strReqNo)
{
  var nWidth = 800
  var nHeight = 600
  var nLeft = 0
  var nTop = 0
  var strBackLink
    

  if (window.screen)
  {
    nWidth = 8 * window.screen.availWidth / 10;
    nHeight = 9 * window.screen.availHeight / 10;
    nLeft = (window.screen.availWidth / 2) - (nWidth / 2);
    nTop = (window.screen.availHeight / 2) - (nHeight / 2);
  }
  if (nLeft < 0) nLeft = 0;
  if (nTop < 0) nTop = 0;

  if (nWidth < 800 || nHeight < 600)
  {
      nWidth = window.screen.availWidth;
      nHeight = window.screen.availHeight
      nLeft = 0
      nTop = 0
  }
  
  var strOptions = "width=" + nWidth + ",height=" + nHeight + ",left=" + nLeft + ",top=" + nTop + ",scrollbars=yes,resizable=yes";

  var win = window.open("", "PVContentWindow", strOptions);




  if (win != null)
  {
    win.opener = self;
    win.focus();
    var url = strRoot + "/ContentManagement/contentmain.asp?sc=" + strCode;
    if (strPortalType != '')
			url = url + '&pt=' + strPortalType;
    if (strReqNo != "" && strReqNo != null)
			url = url + '&rc=' + strReqNo;
  	url = url + '&back=close';
    win.location.href = url;
    g_winContent = win;
    if (fCloseParent == true) window.close();
  }
  else
    g_winContent = null;
}

function CloseContentWindow()
{
  if (g_winContent != null)
    g_winContent.close();
}

var g_confirmDeletePortfolioMsg;
var g_applicationPath;
var g_lastVisitedWorkType;
var g_rootPathFromBanner;
var g_resetBannerCacheID = "";
var g_javascriptString = "";
var g_javascriptMatch = "";
var g_hasBanner = 0;
var g_pvBannerCanPrint;
var g_pvBannerCanExcelPrint;
var g_pvBannerCanPDF;
var g_pvBannerReloadParent;

var _isDirtyRow = "GridDirtyRow";
var _spIsDirtyConfirmMessage = "Current changes are not saved, would you like to proceed ?";





$(document).ready(function () {
  





	
  if (PVBrowserInfo.IsSafari) {
    setTimeout(function() {
      $('body').css('display','none');
      setTimeout(function() { $('body').css('display','block'); }, 10);
    }, 100);
  }
  

  if (g_pvBannerCanExcelPrint) {
    addLegacyPrintExport();
  }


  if (window.PVBanner) {
    return;
  }

  
  if ($("#BannerWrapper").length > 0) PvBannerAfterLoad();
});

function PvBannerAfterLoad() {
  PvDomWaitInit();
  PvDomUiHelperInit();
  PvDomMenuHelperInit();
  PvDomPopupHelperInit();
  PvDomTooltipHelperInit();

  var mainTabsSelector,
    expanderSelector,
    tabMenuSelector,
    subMenuSelector,
    minExpanderSpaceWidth,
    resizeTimer,
    resizeDelay,
    banner,
    expandedTabKey,
    tabWidths,
    tabsCount,
    $expander,
    $addItemPanel,
    hiddenTabsMenu,
    addItemMenu,
    addAggrItemMenu,
    mainTabMenu,
    adminMenu,
    analyticsMenu,
    mainTabSubMenu,
    myAccountMenu,
    myAccountSubMenu,
    currentMyAccountSubMenuId,
    $bannerWrapper,
    lastTabIdClicked,
    $bottomPanel,
    $topPanel,
    addItemPanelWidth,
    $topPanelActions,
    $fppreferenceContainer,  
    topPanelActionsWidth,
    minBannerWidth,
    logoWidth,
    adminMenuId,
    adminSubMenu,
    currentAdminSubMenuId,
    $selectedMainTabMenuItem,
    $banner,
    titleBarMenu,
    fpVersionControlIsActive,
    searchItemMenu,
    windowWidth = $(window).width(),
    windowHeight = $(window).height()
  ;

  $window = $(window);
  $bannerWrapper = $("#BannerWrapper");
  $topPanel = $("#PVBanner-top-panel");
  $bottomPanel = $("#PVBanner-bottom-panel");
  $topPanelActions = $("#topPanelActions");
  $fppreferenceContainer = $("#fp-preferenceContainer");

  $("#preferenceButton").hide();
  if (window.isPopUpWindow()) {
    $("#banner-logo-a").hide();
    $bottomPanel.hide();
    $("#bannerSearchDiv").remove();
    $("#myAccountButton").hide();
    $("#logoffButtonContainer").hide();
    $("#bannerNotificationButton").hide();
    $("#bannerNotificationButtonSpacer").hide();
    $("#PVBannerTitleBarMenuButton").hide();
    if (window.history.length > 0 && !isNaN(parseInt(g_backLinkHistory)) && g_backLinkHistory != 0) { $("#closeButtonContainer").hide(); }
    else { $("#backButtonContainer").hide(); }
    $("#titleBarBack").hide();
    
    if ($.isFunction(window.PvBannerPreferenceButtonOverride)) {
      window.PvBannerPreferenceButtonOverride();
    }
  }
  else {
    $("#closeButtonContainer").hide();
    $("#backButtonContainer").hide();
  }

  if (g_pvBannerCanPDF) { $("#pdfPrintButton").show(); }
  else { $("#pdfPrintButton").hide(); }


  if (g_hasBanner !== 1) {
    $("#closeButtonContainer").hide();
    $("#backButtonContainer").hide();
  }
  else {
    window.PVBanner = {
      $bannerWrapper: $bannerWrapper
    };

    if (!$bannerWrapper[0] ||
         ($window[0].frameElement != null &&
           ($window[0].frameElement.tagName == 'IFRAME' ||
             $window[0].document != top.frames[0].document)
        )) {
      if ($bannerWrapper[0] && $bannerWrapper[0].style) {
        $bannerWrapper[0].style.display = 'none';
      }
      return;
    }

    banner = {
      $bannerWrapper: $bannerWrapper,
      setActiveMenu: function () {
        var structureName = '',
            subStructureName = '',
          pageUrl = window.location.pathname,
          urlSegments = pageUrl.split("/"),
          structIdLookup = PVnavHighlightMap;
        
        structureName = $($bannerWrapper).attr("data-struct");  
        if (structureName === '') {   
          var sname_a = new RegExp('[\\?&]' + 'sname' + '=([^&#]*)').exec(window.location.href);
          if (sname_a !== null) {
            structureName = sname_a[1];
          }
        }

        if (structureName === '') {   
          var pt_a = new RegExp('[\\?&]' + 'pt' + '=([^&#]*)').exec(window.location.href);
          if (pt_a !== null) {
            structureName = pt_a[1];
          }
        }
        if (structureName === '') {   // finally, fallback on the second-to-last segment of the browser's URL
          structureName = urlSegments[urlSegments.length - 2];
        }

        if (structureName === "$Res" && urlSegments[urlSegments.length - 2] === "TrackTime") {
          structureName = "TrackTime";
        }

        if (structureName === "$Asset") {   
          var pt_a = new RegExp('[\\?&]' + 'pt' + '=([^&#]*)').exec(window.location.href);
          if (pt_a !== null) {
            if (pt_a[1] === "APPL_PTF") {   
              structureName = "$Appl";
            }
          }
        }

        if (structIdLookup[structureName] != undefined) {
          $("#" + structIdLookup[structureName]).addClass("active");
        }
        else {   
          $("#" + structIdLookup["MyPlanview"]).addClass("active");
        }
      },
      arrangeBannerLayout: function () {
        var winWidth;

        winWidth = $window.width();
        this.arrangeTopPanelLayout(winWidth);
        this.arrangeBottomPanelLayout(winWidth);
      },
      arrangeTopPanelLayout: function (winWidth, searchWidth) {
        var minWidth,
          $logo,
          $searchBox,
          $searchDiv,
          availableWidth,
          startPointOfAvailableWidth,
          centerPoint,
          searchEndPoint;

        minWidth = Math.max(winWidth, minBannerWidth);
        $logo = $("#banner-logo-img");
        $searchBox = $("#bannerSearchBox");
        $searchDiv = $("#bannerSearchDiv");

        if (!searchWidth) { searchWidth = $searchBox.outerWidth(true); }

        availableWidth = minWidth - logoWidth - topPanelActionsWidth;

        if (availableWidth < searchWidth) {
          $logo.hide();
          startPointOfAvailableWidth = 0;
          availableWidth += logoWidth;
        }
        else {
          $logo.show();
          startPointOfAvailableWidth = logoWidth;
        }

        if (availableWidth < searchWidth && searchIsWide) {
          $topPanelActions.hide();
          availableWidth += topPanelActionsWidth;
        }
        else { $topPanelActions.show(); }
          

        if (getParameterByName("powerpoint") == "1") {
            $topPanelActions.hide();
            $topPanel.hide();
            $fppreferenceContainer.hide();
        }

        centerPoint = Math.max(0, Math.round((availableWidth / 2) - (searchWidth / 2) + startPointOfAvailableWidth));

        $searchDiv.css({ top: 0, left: '230px' });
        $searchDiv.show();
      },
      arrangeBottomPanelLayout: function (winWidth) {
        var tabCounter,
          currentWidth,
          outOfWidth,
          exceedsMaxVisible,
          exceedsScreenWidth,
          activeOutOfWidth,
          lastInWidth,
          $tab;

        
        var maxNumberOfVisibleTabs = parseInt($("#PVBanner-tabs").attr("data-maxVisible")); 
        if (isNaN(maxNumberOfVisibleTabs)) {
          maxNumberOfVisibleTabs = -1;
        }

        tabCounter;
        currentWidth = 0;
        outOfWidth = false;
        exceedsMaxVisible = false;
        exceedsScreenWidth = false;
        activeOutOfWidth = false;
        lastInWidth = 0;
        for (tabCounter = 0; tabCounter < tabsCount; tabCounter++) {
          $tab = $tabs.eq(tabCounter);

          if (maxNumberOfVisibleTabs > -1 && tabCounter >= maxNumberOfVisibleTabs) {
            outOfWidth = true;
            exceedsMaxVisible = true;
          }

          if (!outOfWidth) {
            currentWidth += tabWidths[$tab[0].id];
            outOfWidth = currentWidth >= winWidth - minExpanderSpaceWidth;
            exceedsScreenWidth = outOfWidth;
            lastInWidth++;
          }

          if (outOfWidth) {
            if ($tab.hasClass("active")) {
              
              $tab.show();
              activeOutOfWidth = true;
            } else { $tab.hide(); }
          } else { $tab.show(); }
        }
        if (activeOutOfWidth) {
          
          if (exceedsScreenWidth) {        
            $tabs.eq(lastInWidth - 2).hide();
          } else if (exceedsMaxVisible) {  
            $tabs.eq(lastInWidth - 1).hide();
          }
        }
      },
      handleWindowResize: function () {
        var $eaters, $eater, $catcher;

        PVBanner.arrangeBannerLayout();
        $bannerWrapper.trigger("bannerresize");
        
        $eaters = $('#PV_SilverlightHostDiv,iframe:visible');
        $eaters.each(function (index, eventEater) {
          $eater = $(eventEater);
          $catcher = $eater.data('eventCatcher');
          if ($catcher != undefined) {
            $catcher.css('height', $eater.height());
            $catcher.css('width', $eater.width());
          }
        });

      },
      handleTabClicked: function (event) { this.toggleTabMenu(event.target); },
      updateLastTabClicked: function (tabId) { lastTabIdClicked = tabId; },

      hideAllBannerMenus: function () {
        
        PVBanner.hideAddMenu();
        PVBanner.hideMyAccountMenu();
        
        
        PVBanner.hideSearchResults();
      },

      hideSearchResults: function () {
        var $bannerSearchBox = $("#bannerSearchBox");
        if ($bannerSearchBox.length > 0 && $bannerSearchBox[0].value != "") {
          $("#bannerSearchBox").trigger('blur');
        }
      },

      hideAdminMenu: function () {
        if (!window.isNullOrUndefined(adminMenu)) {
          adminMenu.hideMenu();
          PVBanner.clearSubMenuActive('more');
          PVBanner.hideAdminSubMenu();
        }
      },

      hideAnltMenu: function () {
        if (!window.isNullOrUndefined(analyticsMenu)) {
          analyticsMenu.hideMenu();
          
        }
      },

      toggleAnltMenu: function (tabId, menuUrl, el) {
        var $el,
          origins,
          fUseExpandedTabsMenu;
        this.updateLastTabClicked(tabId);
        lastTabIdClicked = tabId;
        $el = $(el);
        fUseExpandedTabsMenu = $el.data(window.PVBanner.getExpandedTabKey());
        origins = fUseExpandedTabsMenu ? { baseOrigin: "top left", popupOrigin: "top right" }
                               : { baseOrigin: "bottom right", popupOrigin: "top right" };
        if (!window.isNullOrUndefined(analyticsMenu)) {
          
            analyticsMenu.toggle(null, $el, $el, origins);
          
          PVBanner.clearSubMenuActive('anlt');
          PVBanner.setSubMenuActive($el);
        }
        else {
          window.pvWaitingIndicator.showTabMenuWaitNoShield();
          PVBanner.setSubMenuActive($el);
          $.get(menuUrl, function (data) {
            window.PVBanner.showAnltMenu($el, $el, data, fUseExpandedTabsMenu, origins, tabId);
            PVBanner.clearSubMenuActive('anlt');
            PVBanner.setSubMenuActive($el);
          }).fail(function () { location.reload(); });
        }
      },

      toggleAdminMenu: function (tabId, menuUrl, el) {
        var $el,
          origins,
          fUseExpandedTabsMenu;

        this.updateLastTabClicked(tabId);
        lastTabIdClicked = tabId;
        PVBanner.hideAdminSubMenu();
        $el = $(el);
        fUseExpandedTabsMenu = $el.data(window.PVBanner.getExpandedTabKey());
        origins = fUseExpandedTabsMenu ? { baseOrigin: "top left", popupOrigin: "top right" }
                               : { baseOrigin: "bottom right", popupOrigin: "top right" };

        if (!window.isNullOrUndefined(adminMenu)) {
          adminMenu.toggle(null, $el, $el, origins);
          if ($('#adminMainMenu').is(':hidden')) {
            

            PVBanner.clearSubMenuActive('admin');
            PVBanner.setSubMenuActive($el);
          }

        }
        else {
          window.pvWaitingIndicator.showTabMenuWaitNoShield();
          PVBanner.setSubMenuActive($el);
          $.get(menuUrl, function (data) {
            window.PVBanner.showAdminMenu($el, $el, data, fUseExpandedTabsMenu, origins, tabId);
            PVBanner.clearSubMenuActive('admin');
            PVBanner.setSubMenuActive($el);
          }).fail(function () { location.reload(); });
        }

      },

      showAnltMenu: function ($el, $originElement, data, fUseExpandedTabsMenu, origins, tabId) {
        var content;
        
        
        if (lastTabIdClicked === tabId) {
          if (window.isNullOrUndefined(analyticsMenu)) {
            PvPopupHelper.addToHiddenElements(data);
            content = $("#anltMainMenu", PvPopupHelper.$hiddenElements);
            analyticsMenu = PvMenuHelper._create({
              popupCssClass: "bannerMenu anlt",
              triggerEl: $el,
              originEl: $el,
              id: "anltMenu",
              content: content,
              populateOnShow: true,
              onAfterPopulate: function () { PVBanner.removeLastNormalLinkStyle(this.$div); },
              onAfterHide: function () { PVBanner.clearOpenTab(this.$triggerEl); },
              onAfterShow: function () {
                PVBanner.setOpenTab(this.$triggerEl);
                PVBanner.positionSubMenu(this.$div);
                PVBanner.clearSubMenuActive('anlt');
              }
            });
            
            
            
            
            
            
          }

          window.pvWaitingIndicator.hideTabMenuWaitNoShield();
          analyticsMenu.toggle(content, $originElement, $el, origins);
          if (fUseExpandedTabsMenu) { hiddenTabsMenu.addChild(analyticsMenu); }
        }
      },

      showAdminMenu: function ($el, $originElement, data, fUseExpandedTabsMenu, origins, tabId) {
        var content;
        
        
        if (lastTabIdClicked === tabId) {
          if (window.isNullOrUndefined(adminMenu)) {
            PvPopupHelper.addToHiddenElements(data);
            content = $("#adminMainMenu", PvPopupHelper.$hiddenElements);
            adminMenu = PvMenuHelper._create({
              popupCssClass: "bannerMenu admin",
              triggerEl: $el,
              originEl: $el,
              id: "adminMenu",
              content: content,
              populateOnShow: true,
              onAfterPopulate: function () { PVBanner.removeLastNormalLinkStyle(this.$div); },
              onAfterHide: function () { PVBanner.clearOpenTab(this.$triggerEl); },
              onAfterShow: function () {
                PVBanner.setOpenTab(this.$triggerEl);
                PVBanner.positionSubMenu(this.$div);
                PVBanner.clearSubMenuActive('admin');
              }
            });
            
            $('.bannerMenu.admin').on('mouseenter', 'li:has(.progressive-left)', function () {
              PVBanner.toggleAdminSubMenu($(this).attr('data-menuid'), $(this));
            });
            $('.bannerMenu.admin').on('mouseenter', 'li:visible:not(:has(a .progressive-left))', function () {
              PVBanner.hideAdminSubMenu();
            });
          }
          window.pvWaitingIndicator.hideTabMenuWaitNoShield();
          adminMenu.toggle(content, $originElement, $el, origins);
          if (fUseExpandedTabsMenu) { hiddenTabsMenu.addChild(adminMenu); }
        }
      },
      toggleTitleBarMenu: function (menuUrl, el) {
        var $el;
        $el = $(el);
        if (window.isNullOrUndefined(titleBarMenu)) {
          window.pvWaitingIndicator.showTabMenuWaitNoShield();

          $.get(menuUrl,
              function (data) {
                $("#PVBannerTitleBarMenuItems").html($(data));

                titleBarMenu = PvMenuHelper._create({
                  popupCssClass: "bannerMenu title",
                  triggerEl: $el,
                  id: el.id,
                  content: $("#PVBannerTitleBarMenuItems"),
                  origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
                  populateOnShow: false
                });

                window.pvWaitingIndicator.hideTabMenuWaitNoShield();
                titleBarMenu.toggle();
              }).fail(function () { location.reload(); });
        }
        else {
          titleBarMenu.toggle();
        }
      },
      toggleFpVersionControl: function (el, rootUrl) {
        var $el = $(el);
        if (!fpVersionControlIsActive) {
          var universalProxy = new serviceHelper.jsonServiceProxy(rootUrl + 'services/UniversalPortfolioQueryServiceJson.svc/');
          universalProxy.invoke("GetFinancialPlanningVersionControlData",
            {
              portalType: Planview.getQueryString()['pt'],
              portfolioCode: Planview.getQueryString()['scode'],
              structureName: Planview.getQueryString()['sname'],
              versionId: Planview.getQueryString()['ver']
            },
            function (result) {
              result.rootUrl = rootUrl;
              result.triggerElement = $el;
              result.markWidgetAsStale = function () {
                fpVersionControlIsActive = false;
              };

              $('body').FpVersionControl(result);
              $('body').FpVersionControl('resetOptions',result); // I'm using this reset function because I couldn't get destroy to destroy everthing
              fpVersionControlIsActive = true;
              $('body').FpVersionControl('show');
            },
            function(err) { alert("Error getting financial version control: " + err); });
        } else {
          $('body').FpVersionControl('toggle');
        }
      },
      toggleSearchItemMenu: function (menuUrl, searchItemThatWasClicked) {
        $("#bannerSearchBox").focus(); 
        var $searchItemThatWasClicked = $(searchItemThatWasClicked);
        var $pvBannerSearchItemMenu = $("#PVBannerSearchItemMenu");
         
        if ($pvBannerSearchItemMenu.is(":visible")) {
          $pvBannerSearchItemMenu.hide();
          return;
        }

        if (window.isNullOrUndefined(searchItemMenu) || searchItemMenu.id != searchItemThatWasClicked.id) {
          $pvBannerSearchItemMenu.html(g_LoadingIndicatorMenu);
          $pvBannerSearchItemMenu.show();
          window.PvUiHelper.positionElementOnElement($pvBannerSearchItemMenu, "top left", $searchItemThatWasClicked, "bottom left");

          $.get(menuUrl,
              function (data) {
                $pvBannerSearchItemMenu.html($(data));
                window.PvUiHelper.positionElementOnElement($pvBannerSearchItemMenu, "top left", $searchItemThatWasClicked, "bottom left");
              }).fail(function () { location.reload(); });
        }
        else {
          $pvBannerSearchItemMenu.show();
        }
      },
      toggleTabMenu: function (tabId, menuUrl, el) {
        var $el,
            origins,
            fUseExpandedTabsMenu,
            that = this;

        this.updateLastTabClicked(tabId);
        $el = $(el);
        fUseExpandedTabsMenu = $el.parent().data(window.PVBanner.getExpandedTabKey());
        origins = { baseOrigin: "bottom center", popupOrigin: "top center" };

        if ($('.mainTabMenu:visible').length > 0) { 
          if (mainTabMenu.$div.is(tabMenuSelector + "_" + tabId)) {  
            window.pvWaitingIndicator.hideTabMenuShield(false);
            mainTabMenu.$div.hide();
            $el.removeClass('active open');
          } else {    
            window.pvWaitingIndicator.hideTabMenuShield(false);
            setTimeout(function () {
              window.pvWaitingIndicator.showTabMenuShield();
              that.bindTabMenuAbort('#bodyWaitIndicatorContainer', '#tabMenuLoadingIndicatorContainer');
              setTimeout(function () {
                that.getTabMenuContents(menuUrl, $el, fUseExpandedTabsMenu, origins, tabId);
              }, 0);
            }, 200);  
          }
        }
        else {      
          window.pvWaitingIndicator.showTabMenuShield();
          this.bindTabMenuAbort('#bodyWaitIndicatorContainer', '#tabMenuLoadingIndicatorContainer');
          setTimeout(function () {
            that.getTabMenuContents(menuUrl, $el, fUseExpandedTabsMenu, origins, tabId);
          }, 0);
        }
        
        var morePopupMenu = $('.more');
        if (morePopupMenu && morePopupMenu.length > 0) {
          morePopupMenu.hide();
        }
      },
      abortTabMenu: function () {
        PVBanner.abortTabMenuLoad = true;
        window.pvWaitingIndicator.hideTabMenuShield(true);
      },
      bindTabMenuAbort: function (shieldId, loadingIndicatorId) {
        $(shieldId).on('click', this.abortTabMenu);
        $(loadingIndicatorId).on('click', this.abortTabMenu);
      },
      unbindTabMenuAbort: function (shieldId, loadingIndicatorId) {
        $(shieldId).off('click', this.abortTabMenu);
        $(loadingIndicatorId).off('click', this.abortTabMenu);
      },
      getTabMenuContents: function (menuUrl, $el, fUseExpandedTabsMenu, origins, tabId) {
        var that = this;
        $.get(menuUrl, function (data) {
          if (data && data.toLowerCase().indexOf('doctype') > -1) {
            
            location.reload();
            return;
          }

          if (!PVBanner.abortTabMenuLoad) {   
            setTimeout(function () {
              PVBanner.showTabMenu($el, $bottomPanel, data, fUseExpandedTabsMenu, origins, tabId);
              that.unbindTabMenuAbort('#bodyWaitIndicatorContainer', '#tabMenuLoadingIndicatorContainer');
            }, 0);
          } else { PVBanner.abortTabMenuLoad = false; }
        }).fail(function () { location.reload(); });
      },
      abortTabMenuLoad: false,
      showTabMenu: function ($el, $originElement, data, fUseExpandedTabsMenu, origins, tabId) {
        
        
        if (lastTabIdClicked === tabId) {
          if (window.isNullOrUndefined(mainTabMenu)) {
            mainTabMenu = PvMenuHelper._create({
              popupCssClass: "bannerMenu mainTabMenu",
              triggerEl: $el,
              id: "PVBannerMenu_" + tabId,
              content: data,
              populateOnShow: true,
              onAfterPopulate: function () {
                PVBanner.removeLastNormalLinkStyle(this.$div);
              },
              onAfterHide: function () {
                
                if ($col2.data('loadingIndicator') !== undefined) { $col2.data('loadingIndicator').remove(); }
                if ($col3.data('loadingIndicator') !== undefined) { $col3.data('loadingIndicator').remove(); }
                window.pvWaitingIndicator.hideTabMenuShield(false);
                PVBanner.clearOpenTab(this.$triggerEl);
              },
              onAfterShow: function () {
                PVBanner.setOpenTab(this.$triggerEl);
              }
            });
          }
          
          mainTabMenu.$div.attr('id', "PVBannerMenu_" + tabId);

          mainTabMenu.toggle(data, $originElement, $el, origins);
          if (fUseExpandedTabsMenu) { hiddenTabsMenu.addChild(mainTabMenu); }

          
          var that = this,
            rootUrl = $(".mainTabMenu .tabMenuTitle").attr("data-root"),
            animDuration = 500,
            refreshDuration = 200,
            $window = $(window),
            $tab = $(".mainTabMenu"),
            $col1 = $(".mainTabMenu #PVBannerMenu_col1"),
            $col2 = $(".mainTabMenu #PVBannerMenu_col2"),
            $col3 = $(".mainTabMenu #PVBannerMenu_col3"),
            $title = $(".tabMenuTitle"),
            titleMargin,
            tabHeight = 0, tabWidth = 800, tabMargin,
            colHeight = Math.max($col3.height(), $col2.height(), $col1.height()),
            defaultTabHeight = colHeight + $title.outerHeight(true),
            availHeight = colHeight,
            ulHeight = colHeight,
            liHeight = colHeight,
            menubarHeight = $("#BannerWrapper").outerHeight(),
            get_url2 = "",
            get_url3 = "",
            pauseMenuClicks = false,
            $selectLabel, selectLabelWidth = 0, selectWidth = 0;

          $col1.height(colHeight);
          $col2.height(colHeight).css({ display: "none" });
          $col3.height(colHeight).css({ display: "none" });
          titleMargin = $title.outerHeight(true) - $title.height();
          tabMargin = $tab.outerHeight(true) - $tab.height();
          _renderMainTabMenu();

          
          $tab.css("top", -tabHeight);

          
          $selectLabel = $('#PVBannerMenu_col2 .banner-menu-heading').clone();
          $('#PVBannerMenu_col1').append($selectLabel);  
          selectLabelWidth = $selectLabel.outerWidth(true);
          $selectLabel.remove();
          selectWidth = $('#PVBannerMenu_col2').outerWidth(true) - selectLabelWidth - 25; 
          $('#PVBannerMenu_col2 select').width(selectWidth);

          
          availHeight = colHeight - 55 - 50;    
          liHeight = 36; 
          ulHeight = Math.floor(availHeight / liHeight) * liHeight;
          $("#PVBannerMenu_col2 ul.banner-tab-main-items").height(ulHeight);
          
          $("#PVBannerMenu_col2 ul li:first-child").addClass("selected");

          
          
          $tab.animate({ top: menubarHeight - 1 }, animDuration / 2, "easeOutSine", function () {
            
            $col2.css({ display: "block" });
            $col2.animate({ left: 0 }, animDuration / 16, "easeOutExpo", function () {
              
              $col3.css({ display: "block" });
              $col3.animate({ left: 0 }, animDuration / 16, "easeOutExpo", function () {
                $("#PVBannerMenu_col3 li[tabindex='1']").focus();
              });
            });
          });

          
          
          $(window).on("resize", _renderMainTabMenu);
          
          
          mainTabMenu.$div.on('keydown', function (e) {
            
              $(document.activeElement).parent().removeClass('selected');
              






























          });
            
          mainTabMenu.$div.on('keyup', function (e) {
              $(document.activeElement).parent().addClass('selected');
          });
          
          $("#PVBannerMenu_col1").on("click", ".toggleItemsContent", function () {
            var $el = $(this);

            if (!pauseMenuClicks) {
              
              $(".toggleItemsContent").toggleClass("selected", false).find("a span").toggleClass("white", false);
              $el.toggleClass("selected", true).find("a span").toggleClass("white", true);
              
              if ($el.children("a").attr("data-isport") === "Y") {
                $("#bannerTabButtonPicker").fadeOut(refreshDuration);
                $("#PVBannerMenu_col2 select[data-isport=N]").fadeOut(refreshDuration, function () {
                  $("#PVBannerMenu_col2 select[data-isport=Y]").fadeIn(refreshDuration);
                  $("#bannerTabButtonGoTo").fadeIn(refreshDuration);
                });
              } else {
                $("#bannerTabButtonGoTo").fadeOut(refreshDuration);
                $("#PVBannerMenu_col2 select[data-isport=Y]").fadeOut(refreshDuration, function () {
                  $("#PVBannerMenu_col2 select[data-isport=N]").fadeIn(refreshDuration);
                  $("#bannerTabButtonPicker").fadeIn(refreshDuration);
                });
              }
              
              get_url2 = _buildCol2get($(this).children("a"));
              if ($el.attr('id') === 'projectWorkTabToggleLinkContainer') {
                _refreshTabMenuCol2($('#bannerMenuPortfolios'), $('#bannerMenuEntities'), refreshDuration, get_url2);
              } else if ($el.attr('id') === 'portfolioWorkTabToggleLinkContainer') {
                _refreshTabMenuCol2($('#bannerMenuEntities'), $('#bannerMenuPortfolios'), refreshDuration, get_url2);
              }
            }
          });

          
          $("#PVBannerMenu_col1").on("click", "li.bannerMenuBody", function (e) {
            var $el = $(this);
            e.preventDefault();
            if (!pauseMenuClicks) {
                if ($el.find("a").attr("data-action") === "OpenChildWindow") {
                  $(document).trigger("click");
                OpenChildWindow($el.find("a").attr("data-url"), '', -1, -1, -1, -1, true, true, false, false);
              } else {
                window.location.href = $el.find("a").attr("href");
              }
            }
          });

          
          $("#PVBannerMenu_col2").on("click", "a.main-item-description", function (e) {
            e.preventDefault();
          });

          
          $("#PVBannerMenu_col2").on({
            mouseenter: function () {
              var $shortcut = $(this).find(".shortcut-icon");
              var title = $("#PVBannerMenu_col3 li[tabindex='1']").attr("title");  
              $shortcut.show();
              $shortcut.attr("title", title);
            },
            mouseleave: function () {
              $(this).find(".shortcut-icon").hide();
            }
          }, "li.main-item-container");
          $("#PVBannerMenu_col2").on({
            mouseenter: function () {
              $(this).parent("li.main-item-container").children("a.main-item-description").css("text-decoration", "underline");
            },
            mouseleave: function () {
              $(this).parent("li.main-item-container").children("a.main-item-description").css("text-decoration", "");
            }
          }, ".shortcut-icon");

          
          $("#PVBannerMenu_col2").on("click", "a.main-item-favorite", function (e) {
            var $el = $(this);
            e.stopPropagation();
            that.toggleFavorite($el.children("span.icon"), $el.attr("data-struct"), $el.attr("data-entity"), rootUrl);
          });

          
          $("#PVBannerMenu_col2").on("click", ".shortcut-icon", function (e) {
            _shortcutLink(e);
          });

          
          $("#PVBannerMenu_col2").on("dblclick", ".main-item-container", function (e) {
            _shortcutLink(e);
          });

          
          $("#PVBannerMenu_col2").on("click", "li.main-item-container", function (e) {
            if (!pauseMenuClicks) {
              var $el = $(this);
              e.stopPropagation();
              if ($(e.target).hasClass("icon")) return; // don't trigger on favorite click
              $("#PVBannerMenu_col2 .bannerMenuBody").toggleClass("selected", false);
              $el.toggleClass("selected", true);
              get_url3 = _buildCol3get($el);
              _refreshTabMenuCol3(refreshDuration, get_url3);
            }
          });

          
          $("#PVBannerMenu_col2").on("change", " select", function () {
            if (!pauseMenuClicks) {
              get_url2 = _buildCol2get($(this));
              if ($(this).attr('id') === "select-portfolio") {
                _refreshTabMenuCol2($('#bannerMenuPortfolios'), $('#bannerMenuPortfolios'), refreshDuration, get_url2);
              } else if ($(this).attr('id') === "select-entity") {
                _refreshTabMenuCol2($('#bannerMenuEntities'), $('#bannerMenuEntities'), refreshDuration, get_url2);
              }
            }
          });

          
          $("#PVBannerMenu_col2").on("click", "#bannerTabButtonGoTo", function () {
            if (!pauseMenuClicks) {
              window.location.href = rootUrl + "Shared/PortfolioPicker.aspx?pt=" + $(this).attr("data-ptype");
            }
          });

          $("#PVBannerMenu_col2").on("click", "#bannerTabButtonPicker", function () {
            if (!pauseMenuClicks) {
              DataPicker_SingleSelect("",
                                      $("#bannerTabButtonPicker").attr("data-picker-name"),
                                      $("#bannerTabButtonPicker").attr("data-picker-attr"),
                                      "",
                                      "BannerMenuHandleGrantedPicker",
                                      $("#bannerTabButtonPicker").attr("data-root-url"));
            }
          });

          
          $(document).on("keypress", function (e) {
            
            if ($(".mainTabMenu:visible").length !== 0) {
              if (!pauseMenuClicks) {
                var keycode = (e.keyCode ? e.keyCode : e.which);
                var codelookup = {
                  49: 1, 50: 2, 51: 3, 52: 4, 53: 5,
                  54: 6, 55: 7, 56: 8, 57: 9, 48: 0,
                  97: 1, 98: 2, 99: 3, 100: 4, 101: 5,
                  102: 6, 103: 7, 104: 8, 105: 9, 96: 0
                };
                $("#PVBannerMenu_col2 .main-item-container[accesskey='" + codelookup[keycode] + "']:visible").click();
              }
            }
          });

          
          $("#PVBannerMenu_col3").on({
            click: function () {
              if (!pauseMenuClicks) {
                var $el = $(this);
                
                $el.animate({ backgroundColor: "#516CA0" }, 100, function () {
                  $el.animate({ backgroundColor: "#003E7E" }, 400, function () {
                    $el.css("background-color", "");
                  });
                });
                
                _col3onClick(this);
              }
            },
            keypress: function (e) {
              if (!pauseMenuClicks) {
                var $el = $(this);
                var keycode = (e.keyCode ? e.keyCode : e.which);
                if (keycode == '13' || keycode == '10') {
                  if (!pauseMenuClicks) {
                    
                    $el.animate({ backgroundColor: "#516CA0" }, 100, function () {
                      $el.animate({ backgroundColor: "#DFE9F0" }, 400, function () {
                        $el.css("background-color", "");
                        $el.click();
                      });
                    });
                    
                    _col3onClick(this);
                  }
                }
              }
            }
          }, ".bannerMenuBody");
            
          mainTabMenu.$div.on('keydown', '#PVBannerMenu_' + tabId + ' :tabbable:first', mainTabMenu.$div, function (e) {
              
              if (e.shiftKey && e.keyCode === 9) {
                  $($(e.data).find(':tabbable:last')[0]).focus();
                  e.preventDefault();
              }
          });

          mainTabMenu.$div.on('keydown', '#PVBannerMenu_' + tabId + ' :tabbable:last', mainTabMenu.$div, function (e) {
              
              if (!e.shiftKey && e.keyCode === 9) {
                  $($(e.data).find(':tabbable:first')[0]).focus();
                  e.preventDefault();
              }
          });

          
          $("#PVBannerMenu_col1,  #PVBannerMenu_col3").on({
            mouseenter: function () {
              $(this).find(".icon").toggleClass("white", true);
            },
            mouseleave: function () {
              if (!$(this).hasClass("selected")) {
                $(this).find(".icon").toggleClass("white", false);
              }
            }
          }, ".toggleItemsContent, li.bannerMenuBody");
        }

        
        function _renderMainTabMenu() {
          var centeredLeftCoord;
          var windowHeight;

          windowHeight = $window.height();
          
          if (defaultTabHeight >= windowHeight - menubarHeight) {
            $tab.height(windowHeight - menubarHeight - tabMargin - titleMargin);
            $tab.width(tabWidth + 20);            
            $tab.css("overflow-y", "auto");
          } else if (defaultTabHeight < windowHeight - menubarHeight - tabMargin - titleMargin) {
            tabHeight = Math.min(windowHeight - menubarHeight - tabMargin - titleMargin, defaultTabHeight);
            $tab.height(tabHeight);
            $col1.height(tabHeight - tabMargin - titleMargin);
            $col2.height(tabHeight - tabMargin - titleMargin);
            $col3.height(tabHeight - tabMargin - titleMargin);
            $tab.width(tabWidth);
            $tab.css("overflow-y", "");
          }
          
          centeredLeftCoord = ($(window).outerWidth() - $tab.outerWidth()) / 2;
          $tab.css("left", centeredLeftCoord);
        }

        function _buildCol2get(el) {
          var col2get = "",
            isfav = "N";
          
          col2get = [rootUrl, "banner/Menu.aspx?isport=", el.attr("data-isport"),
            "&isReload=Y",
            "&id=", el.attr("data-menu"),
            "&tabid=", el.attr("data-menu"),
            , "&fav=", (el.children("option:selected").val()) ? el.children("option:selected").val() : isfav].join("");
          return col2get;
        }

        function _buildCol3get($el) {
          var col3get = [rootUrl, "banner/Menu.aspx?id=",
            $el.find("a.main-item-description").attr("data-submenu"),
            "&popup=y&tabid=",
            $el.find("a.main-item-description").attr("data-menu"),
            "&sc=",
            $el.find("a.main-item-description").attr("data-struct")
          ].join("");
          return col3get;
        }

        function _refreshTabMenuCol2($hideEl, $showEl, duration, col2get) {
          var col2html = "";
          
          _pauseMenuClicks();
          
          $showEl.hide();
          $("#col3-box .action-menu").fadeOut(refreshDuration);
          var refreshMenu = function () {
            
            $.ajax({
              url: col2get,
              type: "POST",
              timeout: 30000,
              success: function (data, textStatus, jqXHR) {
                col2html = data.toString();
                $showEl.html(col2html).css('height', $showEl.outerHeight());
                $showEl.fadeIn(refreshDuration);
                
                setTimeout(function () {
                  if ($showEl.find("li.bannerMenuWarning:visible").length < 1) {     // if there's no warning
                    var get_url3 = _buildCol3get($showEl);
                    $showEl.find("li:visible:first").addClass('selected');
                    _refreshTabMenuCol3(duration, get_url3);
                  } else {
                    _refreshTabMenuCol3(duration, "");
                    _hideLoadingIndicator($tab.children('.col-container'));
                  }
                }, refreshDuration + 1);
              },
              error: function (jqXHR, textStatus, errorThrown) {
                if (textStatus == "timeout") {
                  $showEl.html("<li class='bannerMenuWarning'><strong>" + g_ERROR + "</strong><br/>" + g_ERROR_MENU_TIMED_OUT + "</li>");
                } else {
                  $showEl.html("<li class='bannerMenuWarning'><strong>" + g_ERROR + "</strong><br/>" + g_ERROR_MENU_CANNOT_LOAD + "</li>");
                }
                $showEl.parent().fadeIn(refreshDuration);
                
                setTimeout(function () {
                  _refreshTabMenuCol3(duration, "");
                  _hideLoadingIndicator($tab.children('.col-container'));
                }, refreshDuration + 1);
              }
            });
            _showLoadingIndicator($tab.children('.col-container'));
          };
          if ($hideEl.length > 0) {
            $hideEl.fadeOut(refreshDuration, refreshMenu);
          }
          else { refreshMenu(); }
        }

        function _refreshTabMenuCol3(duration, col3get) {
          var col3html = "";
          var $_el = $("#col3-box .action-menu");
          
          _pauseMenuClicks();
          
          $_el.fadeOut(refreshDuration, function () {
            
            if (col3get !== "") {
              $.ajax({
                url: col3get,
                type: "POST",
                timeout: 30000,
                success: function (data, textStatus, jqXHR) {
                  col3html = data.toString();
                  $_el.html(col3html).css('height', $_el.outerHeight());
                  $_el.fadeIn(refreshDuration);
                  _hideLoadingIndicator($tab.children('.col-container'));
                  
                  setTimeout(function () {
                    
                    if ($(document.activeElement).parents('#PVBannerMenu_col2').length > 0) {
                      $_el.find(":tabbable:first").focus();
                    } else if ($(document.activeElement).parents('#PVBannerMenu_col1').length > 0) {
                      $('#PVBannerMenu_col2 :tabbable:first').focus();
                    }
                    _unpauseMenuClicks();
                  }, refreshDuration + 1);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                  if (textStatus == "timeout") {
                    $_el.html("<li class='bannerMenuWarning'><strong>" + g_ERROR + "</strong><br/>" + g_ERROR_MENU_TIMED_OUT + "</li>");
                  } else {
                    $_el.html("<li class='bannerMenuWarning'><strong>" + g_ERROR + "</strong><br/>" + g_ERROR_MENU_CANNOT_LOAD + "</li>");
                  }
                  $_el.css('height', $_el.outerHeight());
                  $_el.fadeIn(refreshDuration);
                  _hideLoadingIndicator($tab.children('.col-container'));
                  
                  setTimeout(function () {
                    _unpauseMenuClicks();
                  }, refreshDuration + 1);
                }
              });
            } else {
              $_el.fadeOut(refreshDuration);
              
              setTimeout(function () {
                $_el.empty();
                $_el.css('height', $_el.outerHeight());
                $_el.fadeIn(refreshDuration);
                _hideLoadingIndicator($tab.children('.col-container'));
                _unpauseMenuClicks();
              }, refreshDuration + 1);
            }
            _showLoadingIndicator($tab.children('.col-container'));
          });
        }

        function _col3onClick(el) {
          var action = $(el).attr("data-action");
          url = $(el).attr("data-url");
          switch (action) {
            case "location":
              window.location.href = url;
              break;
            case "OpenChildWindow":
              OpenChildWindow(url, '', -1, -1, -1, -1, true, true, false, false);
              break;
            case "javascript":
              eval(url);
              break;
          }
        }

        function _shortcutLink(e) {
          var scode, action,
            shortcutUrl = "";

          if ($(e.target).hasClass("shortcut-icon")) {  
            scode = $(e.target).attr("data-struct");
          } else if ($(e.target).hasClass("main-item-description")) {  
            scode = $(e.target).siblings(".shortcut-icon").attr("data-struct");
          } else {  
            scode = $(e.target).children(".shortcut-icon").attr("data-struct");
          }
          action = $("#PVBannerMenu_col3 li[tabindex='0']").attr("onclick").split("'")[1];

          e.stopImmediatePropagation();
          
          
          if (action.indexOf("scode=") >= 0) {
            shortcutUrl = action.replace(/scode=[^&;]*/, 'scode=' + scode);
          } else
            
            if (action.indexOf("rc=" >= 0)) {
              shortcutUrl = action.replace(/rc=[^&;]*/, 'rc=' + scode);
            }
          
          
          window.location.href = shortcutUrl;
        }

        function _showLoadingIndicator($el) {
          var $bannerLoadingShield,
            $bannerLoadingIndicatorSign,
            $bannerLoadingIndicatorIcon,
            $bannerLoadingIndicatorText,
            $bannerLoadingIndicator;

          if ($el.find('.light-shield').length == 0) {
            
            $bannerLoadingShield = $('<div class="light-shield" style="height:' + colHeight + 'px">');
            $bannerLoadingShield.hide();
            $bannerLoadingIndicatorSign = $('<div class="sign">'),
            $bannerLoadingIndicatorIcon = $('<div class="pvar-tile-wait-icon">'),
            $bannerLoadingIndicatorText = $('<div class="loadingIcon">').html(g_LoadingIndicatorMenu)
            $bannerLoadingIndicator = $('<div class="loadingIndicator menu">');
            $bannerLoadingIndicator.hide();
            
            $el.append($bannerLoadingShield);
            
            $bannerLoadingIndicatorSign.append($bannerLoadingIndicatorIcon, $bannerLoadingIndicatorText);
            $bannerLoadingIndicator.append($bannerLoadingIndicatorSign);
            $el.append($bannerLoadingIndicator);
            
            setTimeout(function () {
              $bannerLoadingShield.fadeIn(refreshDuration, function () {
                $(this).css("filter", "alpha(opacity=50)");
              });
              $bannerLoadingIndicator.fadeIn(refreshDuration);
            }, 500);  
          }
        }

        function _hideLoadingIndicator($el) {
          $el.children('.loadingIndicator').fadeOut(refreshDuration, function () {
            $(this).remove();
          });
          $el.children('.light-shield').fadeOut(refreshDuration, function () {
            $(this).remove();
          });
        }

        function _pauseMenuClicks() {
          pauseMenuClicks = true;
          $('#PVBannerMenu_col2 select:visible').prop('disabled', true);
        }

        function _unpauseMenuClicks() {
          pauseMenuClicks = false;
          $('#PVBannerMenu_col2 select:visible').prop('disabled', false);
        }
      },

      toggleAddItemMenu: function (el) {
        var $el;
        $el = $(el);
        if (window.isNullOrUndefined(addItemMenu)) {
          addItemMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu add",
            triggerEl: $el,
            id: el.id,
            content: $("#PVBannerAddItemMenuItems"),
            origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
            populateOnShow: false,
            onAfterShow: function () {
              PVBanner.clearSubMenuActive('add');
            }
          });
          
          $('.bannerMenu.add').on('mouseenter', 'li:has(.progressive-left)', function () {
            PVBanner.showAddAggrMenu(this);
          });
          $('.bannerMenu.add').on('mouseenter', 'li:visible:not(:has(a .progressive-left))', function () {
            PVBanner.hideAddAggrMenu(this);
          });
        }
        addItemMenu.toggle();
      },

      hideAddMenu: function () {
        if (!window.isNullOrUndefined(addItemMenu)) {
          PVBanner.hideAddAggrMenu();
          addItemMenu.hideMenu();
        }
      },

      showAddAggrMenu: function (baseEl) {
        if (window.isNullOrUndefined(addAggrItemMenu)) {
          addItemMenuPanelId = baseEl.id;
          addAggrItemMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu add left",
            triggerEl: $(baseEl),
            id: "AddAgrItemSubMenu",
            content: $("#PVBannerAddAggrItemMenuItems").show(),
            origins: { baseOrigin: "top left", popupOrigin: "top right" },
            populateOnShow: false,
            parentalUnit: addItemMenu,
            onAfterShow: function () {
              PVBanner.setOpenTab(this.$triggerEl);
              PVBanner.positionSubMenu(this.$div);
            }
          });
        }
        addAggrItemMenu.showMenu();
        PVBanner.clearSubMenuActive('add');
        PVBanner.setSubMenuActive($(baseEl));
      },

      hideAddAggrMenu: function (baseEl) {
        if (!window.isNullOrUndefined(addAggrItemMenu)) {
          addAggrItemMenu.hide();   
          PVBanner.clearSubMenuActive('add');
        }
      },

      toggleAddAggrMenu: function (baseEl) {
        if (window.isNullOrUndefined(addAggrItemMenu)) {
          addItemMenuPanelId = baseEl.id;
          addAggrItemMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu add left",
            triggerEl: $(baseEl),
            id: "AddAgrItemSubMenu",
            content: $("#PVBannerAddAggrItemMenuItems").show(),
            origins: { baseOrigin: "top left", popupOrigin: "top right" },
            populateOnShow: false,
            parentalUnit: addItemMenu,
            onAfterShow: function () {
              PVBanner.setOpenTab(this.$triggerEl);
              PVBanner.positionSubMenu(this.$div);
            }
          });
        }
        addAggrItemMenu.toggle();
        PVBanner.clearSubMenuActive('add');
      },

      toggleTabExpanderMenu: function (el, rootUrl) {
        var $el;
        $el = $(el);
        if (window.isNullOrUndefined(hiddenTabsMenu)) {
          hiddenTabsMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu more",
            triggerEl: $el,
            id: $tabExpander[0].id,
            content: function () {
              var menuList = $("<ul class='banner-list-menu' />").append(PVBanner.cloneHiddenTabs().addClass("normal-link").removeClass("banner-bottom-panel-item").show().data(expandedTabKey, 1));
              menuList.append("<li class='toolbar'><a class='menuButton' title='" + g_Banner_BannerManage + "' href='javascript:ModalWindowHelper.OpenModalWindow(&quot;navigationPreferences&quot;, &quot;" + rootUrl + "Preferences/ManageUserPreferences.aspx&quot;, 800, 460, 0, 0, true);'>" + g_Banner_BannerManage + "</a></li>");
              
              menuList.children('li').css({ 'border': '', 'color': '' });
              return menuList;
            },
            origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
            populateOnShow: true,
            onAfterPopulate: function () { PVBanner.removeLastNormalLinkStyle(this.$div); },
            
            onAfterHide: function () { PVBanner.clearOpenTab($el); },
            onAfterShow: function () {
              PVBanner.setOpenTab($el);
            }
          });
          
          $('.bannerMenu.more').on('mouseenter', 'li:has(.progressive-left)', function () {
            var $el = $(this);

            if ($el.is('#ADMIN')) {
              $('.bannerMenu.anlt').hide();
              PVBanner.clearSubMenuActive('more');
              PVBanner.toggleAdminMenu('ADMIN', $el.attr('data-url'), this);
            }
            if ($el.is('#ANLT')) {
              $('.bannerMenu.admin').hide();
              PVBanner.clearSubMenuActive('more');
              PVBanner.toggleAnltMenu('ANLT', $el.attr('data-url'), this);
            }
          });
          $('.bannerMenu.more').on({
            
            
            
            
            
            
            click: function () {
              PVBanner.toggleTabExpanderMenu();
            }
          }, 'li:visible:not(:has(a .progressive-left))'
          );
        }
        PVBanner.hideAllBannerMenus();
        
        hiddenTabsMenu.toggle();
      },

      hideTabExpanderMenu: function () {
        if (!window.isNullOrUndefined(hiddenTabsMenu)) {
          hiddenTabsMenu.hideMenu();
        }
      },

      hideAdminSubMenu: function () {
        if (!window.isNullOrUndefined(adminSubMenu)) {
          adminSubMenu.hide();
          PVBanner.clearSubMenuActive('admin');
        }
      },

      showAdminSubMenu: function (id, el) {
        var $el,
            content;
        $el = $(el);
        if (window.isNullOrUndefined(adminSubMenu)) {
          adminSubMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu admin",
            triggerEl: $el,
            id: "BannerAdminSubMenu",
            origins: { baseOrigin: "top left", popupOrigin: "top right" },
            populateOnShow: false,
            onAfterShow: function () {
              PVBanner.setOpenTab(this.$triggerEl);
              PVBanner.positionSubMenu(this.$div);
              PVBanner.clearSubMenuActive('admin');
              PVBanner.setSubMenuActive($el);
            }
          });
        }

        if (currentAdminSubMenuId !== id) {
          content = $("#adminSubMenu" + id.toString(), PvPopupHelper.$hiddenElements).clone();

          if (content.length > 0) {
            adminSubMenu.$div.empty().hide();
            adminSubMenu.toggle(content, $el, $el);
            adminMenu.addChild(adminSubMenu);
          }
          
          

        }
        else { adminSubMenu.showMenu(); }

        currentAdminSubMenuId = id;
      },

      toggleAdminSubMenu: function (id, el) {
        var $el,
          content;

        $el = $(el);
        if (window.isNullOrUndefined(adminSubMenu)) {
          adminSubMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu admin",
            triggerEl: $el,
            id: "BannerAdminSubMenu",
            origins: { baseOrigin: "top left", popupOrigin: "top right" },
            populateOnShow: false,
            onAfterShow: function () {
              PVBanner.setOpenTab(this.$triggerEl);
              PVBanner.positionSubMenu(this.$div, true);
              PVBanner.clearSubMenuActive('admin');
              PVBanner.setSubMenuActive(this.$triggerEl);
            }
          });
        }

        if ((currentAdminSubMenuId !== id || !adminSubMenu.isVisible())) {
          if (currentAdminSubMenuId !== id) {
            content = $("#adminSubMenu" + id.toString(), PvPopupHelper.$hiddenElements).clone();
            if (content.length > 0) {
              adminSubMenu.$div.empty().hide();
              adminSubMenu.toggle(content, $el, $el);
              adminMenu.addChild(adminSubMenu);
            }
          } else {
            adminSubMenu.toggle();
          }
        } else {
          {
            adminSubMenu.hide();
          }
        }
        currentAdminSubMenuId = id;
      },

      toggleMyAccountMenu: function (elId) {
        if (undefined === myAccountMenu) {
          myAccountMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu account",
            triggerEl: $("#" + elId),
            id: "BannerMyAccountMenu",
            origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
            popuplateOnShow: false,
            content: $("#myAccountMainMenu"),
            onAfterShow: function () {
              PVBanner.clearSubMenuActive('account');
            }
          });
          
          $('.banner-myAccount-menu li a:has(.progressive-left)').attr('href', '#');
          
          $('.bannerMenu.account').on('mouseenter', 'li:has(.progressive-left)', function () {
            PVBanner.toggleMyAccountSubMenu($(this).attr('data-menuid'), $(this));
          });
          $('.bannerMenu.account').on('mouseenter', 'li:visible:not(:has(a .progressive-left))', function () {
            PVBanner.hideMyAccountSubMenu();
          });
        }
        myAccountMenu.toggle();

      },

      hideMyAccountMenu: function () {
        PVBanner.hideMyAccountSubMenu();
        if (!window.isNullOrUndefined(myAccountMenu)) {
          myAccountMenu.hideMenu();
          
        }
      },

      toggleMyAccountSubMenu: function (id, el) {
        var $el,
            content;
        $el = $(el);
        if (window.isNullOrUndefined(myAccountSubMenu)) {
          myAccountSubMenu = PvMenuHelper._create({
            popupCssClass: "bannerMenu account left",
            triggerEl: $el,
            id: "BannerMyAccountSubMenu",
            origins: { baseOrigin: "top left", popupOrigin: "top right" },
            populateOnShow: false,
            onAfterShow: function () {
              PVBanner.setOpenTab(this.$triggerEl);
              PVBanner.positionSubMenu(this.$div);
            }
          });
        }
        if ((currentMyAccountSubMenuId !== id || !myAccountSubMenu.isVisible())) {
          if (currentMyAccountSubMenuId !== id) {
            content = $("#myAccountSubMenu" + id.toString(), PvPopupHelper.$hiddenElements).clone();
            if (content.length > 0) {
              myAccountSubMenu.$div.empty().hide();
              myAccountSubMenu.toggle(content, $el, $el);
              myAccountMenu.addChild(myAccountSubMenu);
            }
          } else {
            if ($el.hasClass('open') === false) {
              myAccountSubMenu.toggle();
            }
          }
        } else {
          if ($el.hasClass('open') === false) {
            myAccountSubMenu.hide();
          }
        }
        currentMyAccountSubMenuId = id;
        
        
      },

      hideMyAccountSubMenu: function () {
        if (!window.isNullOrUndefined(myAccountSubMenu)) {
          myAccountSubMenu.hideMenu();
          PVBanner.clearSubMenuActive('account');
        }
      },

      positionSubMenu: function ($el, subMenu) {
        var $that = $el;
        $el.offset(function (index, coords) {
          var padding = $that.outerWidth() - $that.find('ul').width();
          var leftPos = coords.left - padding / 2 + 1;
          if (leftPos <= 0) {
            $that.find(".progressive-left").hide();
            $that.find(".progressive-right").show();

            if (subMenu) {
              leftPos = adminMenu.$div.width() - padding / 2 + 1;
            }
          }
          return { left: leftPos, top: coords.top };
        });
      },

      setSubMenuActive: function ($el) {
        if ($el !== undefined) {
          $el.addClass('open');
          $el.find('.progressive-left').addClass('white');
        }
      },

      clearSubMenuActive: function (targetClass) {
        $('.bannerMenu.' + targetClass + ' .active').removeClass('active');
        $('.bannerMenu.' + targetClass + ' .open').removeClass('open');
        $('.bannerMenu.' + targetClass + ' .white').removeClass('white');
      },

      setOpenTab: function ($el) {
        $el.addClass("open");
      },

      clearOpenTab: function ($el) {
        $el.removeClass("open");
      },
      
      cloneHiddenTabs: function () {
        var $clonetabs = $tabs.filter(":hidden").clone(),
          $el = $('<div>').append($clonetabs),
          progressiveSelectors = [
            '#ADMIN a',
            '#ANLT a'
            
            
            
          ].join(', ');
        
        $el.find(progressiveSelectors).prepend('<span class="icon icon16x16 aim-left-small-icon progressive-left"></span>');
        return $clonetabs;
      },

      getExpandedTabKey: function () {
        return expandedTabKey;
      },

      removeLastNormalLinkStyle: function ($el) {
        
        if (window.PVBrowserInfo.IsExplorer) {
          $("li.normal-link", $el).last().css({ "border-bottom": '0px' });
        }
      },

      
      toggleFavorite: function ($srcElement, structureCode, portfolioType, rootUrl) {
        $.ajax({
          url: rootUrl + 'services/UniversalPortfolioQueryServiceJSON.svc/ToggleEntityFavorite',
          data: '{"entityType": "' + portfolioType + '", "structureCode":"' + structureCode + '"}',
          type: "POST",
          processData: false,
          contentType: "application/json; charset=utf-8",
          timeout: 1000000,
          dataType: "json",
          success: function (data) {
            
            
            
            var onClass, offClass;
            if (data.d) { onClass = 'favorite16x16-selected-icon'; offClass = 'favorite16x16-icon'; }
            else { offClass = 'favorite16x16-selected-icon'; onClass = 'favorite16x16-icon'; }
            $srcElement.removeClass(offClass).addClass(onClass);
          },
          error: function (XMLHttpRequest, textStatus, errorThrown) { alert(textStatus); }
        });
      },

      
      renderDarkShield: function () {
        var $darkShield = window.pvWaitingIndicator.getBodyShield();
        if ($darkShield.length > 0) {
          $darkShield.css('top', $(document).scrollTop());
        }
      },

      
      deleteProject: function (scode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteEntity", { columnId: "PE_PLANNING_CODE", structureCode: scode }, scode, serviceUrl, confirmMessage);
      },
      deleteProduct: function (scode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteEntity", { columnId: "ST_PRODUCT_CODE", structureCode: scode }, scode, serviceUrl, confirmMessage);
      },
      deleteStrategy: function (scode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteStrategy", { strategyCode: scode }, scode, serviceUrl, confirmMessage);
      },
      deleteService: function (scode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteService", { serviceCode: scode }, scode, serviceUrl, confirmMessage);
      },
      deleteAsset: function (scode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteAsset", { assetCode: scode }, scode, serviceUrl, confirmMessage);
      },
      deleteRequest: function (rcode, serviceUrl, confirmMessage) {
        this.deleteEntity("DeleteRequest", { requestCode: rcode }, rcode, serviceUrl, confirmMessage);
      },
      deleteEntity: function (serviceName, parameterList, scode, serviceUrl, confirmMessage) {
        $(document).trigger('click'); 
        if (confirm(confirmMessage)) {
          

          setTimeout(function () {
            pvWaitingIndicator.showShield();
            var universalProxy = new serviceHelper.jsonServiceProxy(serviceUrl);
            universalProxy.invoke(serviceName, parameterList,
              function (result) {
                if (result != null
                && result.ReplyStatus != null
                && result.ReplyStatus != 0) {
                  
                  pvWaitingIndicator.hideShield();
                  alert(result.ReplyMessage);
                  return false;
                }
                if (window.warningMessageForSearchResult) {
                  alert(window.warningMessageForSearchResult);
                }
                
                if (location.search.indexOf("=" + scode) > -1) {
                  location.replace("//" + location.hostname + "/" + location.pathname.split("/")[1] + "/MyPlanview/MyPlanview.aspx?ptab=HV_DASH&pt=HOMEVIEW&scode=$None");
                } else {
                  location.reload(true);
                }
              }, "error");
          }, 20);
        }
      },

      deletePortfolio: function (url, confirmMessage) {
        $(document).trigger('click');
        var $pvPopupMenu = $('.bannerMenu');
        if ($pvPopupMenu.length > 0) {
          $pvPopupMenu.hide();
        }
        var del = confirm(confirmMessage);
        if (del) {
          var scode = url.substring(url.indexOf('scode=') + 6, url.length);
          if (window.handlePortfolioDelete) {
            window.handlePortfolioDelete(scode);
          }

          $.get(url,
                function (data) {
                  if (window.warningMessageForSearchResult) {
                    alert(window.warningMessageForSearchResult);
                    location.reload(true);
                  }
                  if (location.search.indexOf("=" + scode) > -1) {
                    
                    location.replace("//" + location.hostname + "/" + location.pathname.split("/")[1] + "/MyPlanview/MyPlanview.aspx?ptab=HV_DASH&pt=HOMEVIEW&scode=$None");
                  } else {
                    var currentMenu = $(".mainTabMenu").find("#PVBannerMenu_col1").find(".selected");
                    if (currentMenu.length > 0) {
                      currentMenu[0].click();
                    }
                  }
                }).fail(function () { location.reload(); });

          }
      },
      
      refreshPortfolio: function (portfolioCode, serviceUrl, message, onfinish, waitAdditionalMilliseconds) {
        $(document).click(); 

        setTimeout(function () {
          if (!waitAdditionalMilliseconds || waitAdditionalMilliseconds < 1000) {
            waitAdditionalMilliseconds = 1000;  
          }

          pvWaitingIndicator.showBannerWaitContainer(message);
          var universalProxy = new serviceHelper.jsonServiceProxy(serviceUrl);
          universalProxy.invoke("RefreshPortfolio", { portfolioCode: portfolioCode },
            function (result) {
              setTimeout(function() {
                pvWaitingIndicator.hideBannerWaitContainer();

                if (result != null
                && result.ReplyStatus != null
                && result.ReplyStatus != 0) {
                  
                  alert(result.ReplyMessage);
                }
                    
                if (onfinish) {
                  onfinish(portfolioCode);
                }
              }, waitAdditionalMilliseconds);
            }, "error");
        }, 20);
      },
      
      handleChangeToPortfolio: function(portfolioCode, forceReload) {
        if (Planview.hasValue(portfolioCode)
         && window.top.Planview
         && window.top.Planview.Context
         && window.top.Planview.Context.PortfolioOrEntityCode === portfolioCode)
        {
          if (forceReload) {
            window.top.location.reload();
            return;
          }

          
          if (Planview.isDefined(window.top.RefreshWithoutReload)) {
            window.top.RefreshWithoutReload();
          } else if (Planview.isDefined(window.top.ReloadFromChild)) {
            if (window.top.ReloadFromChild.length > 0) {
              
              window.top.location.reload();
            } else {
              window.top.ReloadFromChild();
            }
          } else {
            window.top.location.reload();
          }
        }
      }
    };

    window.PVBanner = banner;
    window.PVBanner.setActiveMenu();
    $bannerWrapper.show();

    resizeDelay = 250;
    minBannerWidth = 770;
    logoWidth = 250;
    expandedTabKey = "expandedTab";
    mainTabsSelector = "ul.banner-tabs li";
    tabMenuSelector = "#PVBannerMenu";
    tabExpanderSelector = "#PVBannerTabs-Expand";
    subMenuSelector = "#PVBannerSubMenu";
    $tabExpander = $(tabExpanderSelector);
    $tabs = $(mainTabsSelector).not(tabExpanderSelector);
    $addItemPanel = $("#addItemMenuPanel");
    adminMenuId = "ADMIN";
    topPanelActionsWidth = $topPanelActions.outerWidth(true);
    tabWidths = {};

    var addItemWidth = $addItemPanel.outerWidth(true);
    var tabExpanderWidth = $tabExpander.outerWidth(true);
    var primaryTab = $("#primary-tab-spacer");
    var primaryTabWidth = primaryTab.outerWidth(true);
    if (!primaryTabWidth)
      primaryTabWidth = 0;
    minExpanderSpaceWidth = $addItemPanel.length > 0 ? addItemWidth + tabExpanderWidth + primaryTabWidth + 35 : 150;

    (function getInitialTabWidths() {
      var tabCounter,
          $tab;
      tabsCount = $tabs.length;
      for (tabCounter = 0; tabCounter < tabsCount; tabCounter++) {
        $tab = $tabs.eq(tabCounter);
        tabWidths[$tab[0].id] = $tab.outerWidth(true);
      }
      addItemPanelWidth = $addItemPanel.outerWidth(true);
    })();

    banner.arrangeBannerLayout();


    


    var stopResizeTimer = function () {
      if (resizeTimer)
        clearTimeout(resizeTimer);
    };

    


    var throttleResize = function () {
      stopResizeTimer();

      resizeTimer = setTimeout(function () {
        
        safeResize();
      }, resizeDelay);
    };

    







    var safeResize = function () {
      var curWindowWidth = $window.width();
      var curWindowHeight = $window.height();

      if ((curWindowWidth === windowWidth) && (curWindowHeight === windowHeight))
        return;

      windowWidth = curWindowWidth;
      windowHeight = curWindowHeight;

      

      window.PVBanner.handleWindowResize();
    };

    
    $(window).on('resize', throttleResize);

    var $search = $("#bannerSearchBox");
    var searchIsWide = false;
    var jsStr = function (s) { return "'" + s.replace(/\\/g, '\\\\').replace(/'/g, '\\\'') + "'"; };
    var goWide = function () {
      if (!searchIsWide) {
        var animationDone = function () {
          if ($search[0].value != "") $search.bannerAutocomplete('search', $(this)[0].value);
        };

        var resize = 480;
        var winWidth = $(window).width();
        if (resize > winWidth) {
          resize = winWidth - 10;
        }

        searchIsWide = true;
        
        
        if ($(this)[0].value == $(this)[0].defaultValue) $(this)[0].value = "";
        $(this).toggleClass('active-focus', true);
        $(this).focus();
      }

      return true;
    };
    var goNarrow = function () {
      if (searchIsWide) {
        var resize = 200;
        var winWidth = $(window).width();
        if (resize > winWidth) {
          resize = winWidth - 10;
        }

        searchIsWide = false;
        
        
        if ($(this)[0].value == "") $(this)[0].value = $(this)[0].defaultValue;
        $(this).toggleClass('active-focus', false);
      }

      return true;
    };
    var goSelect = function () {
      var input = $(this); 
      setTimeout(function () { input.select(); }, 10);
      return true;
    };
    $search.keydown(function (evt) { if (9 !== evt.originalEvent.keyCode) goWide.call($search); });
    
    
    $search.focus(goWide);
    $search.blur(goNarrow);
    $search.bannerAutocomplete({
      source: function (request, response) {
        $search.criteria = $search.val();
        $.ajax({
          url: g_UrlBannerSearchBestRecomentations,
          data: "{ 'searchCriteria' : " + jsStr($search.val()) + "}",
          dataType: "json",
          type: "POST",
          contentType: "application/json; charset=utf-8",
          dataFilter: function (data) { return data; },
          success: function (data) {
            var resultOrder = ["PORTFOLIO", "REQUEST", "STRATEGY", "CAPACITY", "COSTCENTER", "RESOURCE", "ASSET_PTF", "SERV_PTF", "APPL_PTF", "$WR", "$Strategy", "$Plan", "$Res", "ORG", "$Prod", "PRODUCT", "$Service", "APPL", "$Asset", ""];
            if (data.d != null) {

              var categories = {};
              
              
              


              $(data.d).each(function (i, v) {

                
                
                
                
                if (!categories[v.Kind]) {
                  categories[v.Kind] = [];
                }

                categories[v.Kind].push(v);
              });
              var responseArray = [];
              if (!categories.hasOwnProperty('') || data.d.length > 1) {
                for (var i = 0; i < resultOrder.length; i++) {
                  var category = resultOrder[i],
                    items = categories[category],
                    liHtml = '',
                    lastItem = '',
                    portfolioType = undefined;

                  if (items) {
                    if (category && category !== '') {
                      liHtml = '<h3 category="' + category + '" style="height:' + items.length * 30 + 'px"><div>' + items[0].Category + '</div></h3>';
                      liHtml += '<ul id="searchUl" class="category">';
                    } else {
                      liHtml += '<ul class="toolbar">';
                    }

                    $.each(items, function (i, item) {
                      if (category === '') {
                        lastItem += '<li class="item last searchall" data-searchall="true" dest="' + item.Dest + '"><a class="button11 gray-button">' + item.Desc + '</a></li>';
                      } else {
                          liHtml += '<li id="SearchItem' + item.Key + '" class="item ' + (i === 0 ? "first" : "") + '" dest="' + item.Dest + '" sc="' + item.Key + '" tabid="' + item.TabId + '">'
                                 + '<div class="ui-state-default ui-corner-all ui-button-text-icon-primary" style="float:left; width:20px; height:10px; padding-top:6px; margin-right:5px;">'
                                 + '<span class="ui-button-icon-primary ui-icon ui-icon-triangle-1-s" style="position:relative!important;"></span>'
                                 + '</div>'
                                 + '<a title="' + item.Desc + '" class="first" href="#" style="padding-top:1px;">' + item.Desc + '</a>'
                                 + '<a class="second" href="#" style="padding-top:1px;">' + (item.ShortName ? item.ShortName : '') + '</a>';

                        liHtml += '</li>';
                      }
                    });
                    liHtml += lastItem;
                    liHtml += '</ul>';
                    responseArray.push({ value: liHtml });
                  }


                }

                response(responseArray);

                $("li.item").on({
                  mouseenter: function () {
                      $("#PVBannerSearchItemMenu").hide();


                  },
                  mouseleave: function () {


                  }
                });


                
                $('.searchall').on('click', function () {
                  var destination = $(this).attr('dest');
                  var criteria = $('#bannerSearchBox').val();
                  if (typeof (destination) !== 'undefined') {
                    document.location.href = destination.replace('[searchCriteria]', encodeURIComponent(criteria));
                  }
                });
              } else {
                response();
              }

            }

          },

          error: function (XMLHttpRequest, textStatus, errorThrown) {
            alert(textStatus);
          }
        });
      },

      open: function (event, ui) {
        $('.ui-menu-item h3').each(function (i, v) { $(v).parent().height($(v).height()); });
        $('ul.category li.item div.ui-button-text-icon-primary').click(function () {
            var structureCode = $(this).parent().attr('sc');
            var tabId = $(this).parent().attr('tabid');
            PVBanner.toggleSearchItemMenu(g_pvRootUrl + 'banner/Menu.aspx?tabid=' + tabId + '&sc=' + structureCode + '&h=N', this);
            return false;
        });
          
        $('ul.category li.item').click(function () {
            var action = $(this).attr('dest');
            if (!action || action == "") alert("Unknown destination for\n\n" + ui.item.value);
            else document.location.href = action.replace('[searchCriteria]', encodeURIComponent($search.criteria));
            return false;
        });

        $(this).data('bannerAutocomplete').setSuggestHeight();

      },
      position: {
        my: "left top",
        at: "left bottom",
        of: "#bannerSearchDiv"
      },
      minLength: 1,
      delay: 1,
      autoFocus: true,
      html: true
    });
  }

  

  
  $(window).on("scroll", PVBanner.renderDarkShield);

  
  $('.banner-tabs').on('mouseenter', 'li:not(.more)', function () {
    PVBanner.hideAllBannerMenus();
  });

  
  $('.banner-tabs').on('click', '#ADMIN:not(.more)', function () {
    PVBanner.toggleAdminMenu('ADMIN', $(this).attr('data-url'), this);
  });

  
  $('.banner-tabs').on('click', '#ANLT:not(.more)', function () {
    PVBanner.toggleAnltMenu('ANLT', $(this).attr('data-url'), this);
  });

  
  $('body').on('mouseenter', 'ul.pvPopup-menu li, .bannerMenu ul.banner-tab-dropdown li.bannerMenuBody, .bannerMenu ul.banner-myAccount-menu li', function () {
    $(this).find('.icon').addClass('white');
  });
  $('body').on('mouseleave', 'ul.pvPopup-menu li, .bannerMenu ul.banner-tab-dropdown li.bannerMenuBody, .bannerMenu ul.banner-myAccount-menu li', function () {
    $(this).find('.icon').removeClass('white');
  });

  $("#PVBannerSearchItemMenu").on('mousedown', '*', function (e) {
    var autoComplete = $('#bannerSearchBox.ui-autocomplete-input').data('bannerAutocomplete');

    if (!Planview.hasValue(autoComplete)) return;

    
    setTimeout(function () {
      clearTimeout(autoComplete.closing);
    }, 13);

    
    $(document).one('mouseup', function (e) {
      
      autoComplete.closing = setTimeout(function () {
        autoComplete.close(e);
        autoComplete._change(e);
      }, 150);
    });
  });
};



var PVnavHighlightMap = {
  "MyPlanview": "HV",          
  "$WR": "REQ",                
  "$Strategy": "STRAT",        
  "Cbs1": "COSTCTR",           
  "$OrgRes": "ORG",            
  "Org": "ORG",
  "ORG": "ORG",
  "CAPACITY": "CAP",           
  "Capacity": "CAP",
  "$Plan": "W",                
  "$Res": "RES",               
  "RESOURCE": "RES",
  "ApproveTime": "RES",
  "TrackTime": "TIME",         
  "TrackExpenses": "EXPENSES", 
  "Customer": "CUSTOMERS",     
  "Contracts": "CONTRACTS",    
  "$Prod": "PROD",             
  "PRODUCT": "PROD",
  "BIA": "PROD",
  "PdPM": "RELEASES",          
  "$Service": "SERV",          
  "SERV_PTF": "SERV",
  "$Appl": "APPL",             
  "Appl": "APPL",
  "APPL_PTF": "APPL",
  "$Asset": "ASSET",           
  "ASSET_PTF": "ASSET",
  "admin": "ADMIN",            
  "AdminApplication": "ADMIN",
  "Archiving": "ADMIN",
  "CostingEngine": "ADMIN",
  "ifm": "ADMIN",
  "GeneralRequest": "ADMIN",
  "Estimating": "ADMIN",
  "IFM": "ADMIN",
  "PPM": "ADMIN",
  "Workflows": "ADMIN",
  "ConfiguredScreens": "ADMIN",
  "ScriptedAction": "ADMIN",
  "Migration": "ADMIN",
  "Alerts": "ADMIN",
  "RateSets": "ADMIN",
  "ExemptAndNonExempt": "ADMIN",
  "Portal": "ADMIN",
  "Dashlets": "ADMIN",
  "AdminDatamart": "ADMIN",
  "AdminCalendars": "ADMIN",
  "ManageColumnSets": "ADMIN",
  "ServiceCatalog": "ADMIN",
  "spm": "ADMIN",
  "Action": "ADMIN",
  "Infoset": "ADMIN"
};



function PVGoBack() {
  if (window.history.length == 0) top.close();
  var docurl = document.URL;

  if (docurl.search("back=dashboard") > 0) {
    var newWin = window.open('', "Dashboard");
    if (newWin != null) {
      newWin.focus();
      void (0);
      return;
    }
  }
  if (isNaN(parseInt(g_backLinkHistory))) {
    if (g_backLinkHistory == "close") {
      top.close();
    }
    if (g_backLinkHistory == "closereload") {
      top.opener.location.replace(unescape(top.opener.location.href));
      top.close();
    }
    top.history.go(-1);
  }
  var nBack = -1;
  if (g_backLinkHistory < 0) nBack = g_backLinkHistory;
  if (g_backLinkHistory > 0) nBack = -g_backLinkHistory;
  top.history.go(nBack);
}

function hrefPH() { }

function andAfterBanner(performFunction) {
  performFunction();
}

function isPopUpWindow() {
  return ((window.parent.name.search('PVChildWin') > -1) || (window.frameElement != null) || getParameterByName("powerpoint") == "1");
}

function getParameterByName(name) {
  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
      results = regex.exec(location.search);
  return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}


function deletePort(url, desc) {
  var confirmMessage = g_confirmDeletePortfolioMsg;
  confirmMessage = confirmMessage.replace("!1!", desc);
  var del = confirm(confirmMessage);
  if (del) {
    window.location.href = url;
  }
}

function deleteScenario(url, confirmMessage, scenDesc) {
  confirmMessage = confirmMessage.replace("!1!", scenDesc);
  var del = confirm(confirmMessage);
  if (del) {
    window.location.href = url;
  }
}

(function ($, undefined) {

  function filter(array, term) {
    var matcher = new RegExp($.ui.autocomplete.escapeRegex(term), "i");
    return $.grep(array, function (value) {
      return matcher.test($("<div>").html(value.label || value.value || value).text());
    });
  }


  $.widget("Planview.bannerAutocomplete", $.ui.autocomplete, {

    _initSource: function () {
      if (this.options.html && $.isArray(this.options.source)) {
        this.source = function (request, response) {
          response(filter(this.options.source, request.term));
        };
      } else {
        $.ui.autocomplete.prototype._initSource.apply(this);
      }
    },

    setSuggestHeight: function ($listItems) {
      if (!$listItems) {
        $listItems = $('ul.category li.item:not(.last)');
      }
      var searchSuggest = this.menu.element,
      itemSize = Math.floor(($(window).height() - (searchSuggest.offset().top + parseInt(searchSuggest.css('borderTopWidth')) + parseInt(searchSuggest.css('borderTopWidth')))) / 30) - 1;

      $.each($listItems, function (i, v) {
        var element = $(v),
        parent = element.parent().parent();
        if (i < itemSize) {
          element.removeClass('hidden').show();
          parent.show();
        } else {
          element.addClass('hidden').hide();
          if (element.hasClass('first')) {
            parent.hide();
          }
        }
        var height = parent.find('li:not(.hidden)').length * 30;
        parent.height(height).find('h3').height(height);
      });
    },

    _create: function () {
      $.ui.autocomplete.prototype._create.apply(this);
      this.searchIcon = $('<span class="BannerIcon icon icon16x16 search-icon"></span>');
      this._render();
      this._attachEvents();

      this.menu.options.selected = undefined;
      this.menu.options.focus = undefined;
    },

    _render: function () {
      this.menu.element.addClass('bannerAutocomplete');
      this.element.parent().prepend(this.searchIcon);
    },

    _attachEvents: function () {
      var that = this;
      this.element.bind("keydown.autocomplete", $.proxy(this._keyDown, this.element));
      this.element.focus(function () { that.menu.element.show(); });
      this.searchIcon.click(function () {
          if ($('ul.bannerAutocomplete').is(":visible")) {
              $("#bannerSearchBox").blur();
          } else {
              $("#bannerSearchBox").focus();
          }
      });
      $(window).resize(function () {
        that.setSuggestHeight();
      });
    },

    _renderItem: function (ul, item) {
      var li = $("<li></li>")
        .data("item.autocomplete", item)
        .append($("<a></a>")[this.options.html ? "html" : "text"](item.label))
        .appendTo(ul);

      li.find('li.item').hover(function () { $('ul.category li.item').removeClass('active'); $(this).addClass('active'); }, function () { $(this).removeClass('active'); });
      return li;
    },

    _keyDown: function (e) {
      var element = $(this).data('bannerAutocomplete').menu.element,
        activeElement = element.find('.category li.active').removeClass('active');

      activeElement.closest('.ui-corner-all').removeClass('active');
      element.find('.ui-corner-all').removeClass('ui-state-hover');

      
      switch (e.keyCode) {
        case 40:
          if (activeElement.length == 0) {
            activeElement = element.find('.category:first li.item:first');
          }
          else {
            var nextElement = activeElement.next();
            if (nextElement.length == 0) {
              activeElement = activeElement.closest('li.ui-menu-item').next().find('.category li.item:first');
            } else {
              activeElement = nextElement;
            }
          }
          break;
          
        case 38:
          var prevElement = activeElement.prev();
          if (prevElement.length == 0) {
            activeElement = activeElement.closest('li.ui-menu-item').prev().find('.category li.item:last');
          } else {
            activeElement = prevElement;
          }
          break;
          
        case 13:
          var action = activeElement.attr('dest');
          if (!action || action == "") {
            var resultsButton = $('ul.bannerAutocomplete .toolbar li:has(a.gray-button)');
            if (resultsButton.length < 1) {
              resultsButton = $('ul.bannerAutocomplete li .first');
            }
            if (resultsButton.length > 0 && this.data('bannerAutocomplete').menu.element.css('display') !== 'none') {
              resultsButton.click();
            }
            else {
              return false;
            }
          }
          else {
            var criteria = $(this).criteria;
            if (activeElement.data('searchall')) {
              criteria = $(this).val();
            }
            document.location.href = action.replace('[searchCriteria]', encodeURIComponent(criteria));
          }
          break;
      }

      if (activeElement.length > 0) {
        activeElement.addClass('active').closest('.ui-corner-all').addClass('active');
      }
    },
      
    
    close: function () {
      $("#PVBannerSearchItemMenu").hide();
      $('ul.bannerAutocomplete').hide();
    }
  });

})(jQuery);

function BannerMenuHandleGrantedPicker(oSelected) {
  window.location.href = $("#bannerTabButtonPicker").attr("data-root-url") + "Banner/DefaultPage.aspx?scode=" + oSelected.key + "&pt=" + $("#bannerTabButtonPicker").attr("data-ptype");
}

function setTitleInBanner(bannerTitle) {
  var titleHolder = document.getElementById('bannerTitle');
  if (!isNullOrUndefined(titleHolder)) {
    titleHolder.innerHTML = bannerTitle;
  }
}

function addLegacyPrintExport() {
  var action, url;

  url = ChangeQueryStringValue(location.href, "media", "excel");

  action = function(){
    $('<form id="pvBannerExportForm" action="' + url + '" method="' + 'post' + '" />').appendTo('body').submit().remove();
  }
  $("#pvBannerExcelExport").on("click", action);
}


var _MEwin = null;


var _MEproduct = "PVE";


function focusMEProcesLogin(userName, password, request) {
	_MEFireUpWindow("applet.local.html");
	var parameters = {
		NAME :'Planview Process Builder',
		hostnames :'MethodEngine url:/PPB/server',
		REQUEST :request,
		interactiveLogin :false,
		USER :userName,
		PASSWORD :password
	};
	_MEwin.parameters = parameters;

}


function focusMEProcessManager(serverURL, context, LoginCert) {
    focusMEProcessManagerOnStructure(serverURL, context, null, LoginCert);
}


function focusMEProcessManagerOnStructure(serverURL, context, scode, LoginCert) {
	var cookie;
	var pvCookie;
	var scode;
	var aPos;
	var request;

	cookie = document.cookie.toString();
	aPos = getSubStringBoundaries(cookie, "planview", ";");
	pvCookie = cookie.substring(aPos[0] + 9, aPos[1]);
	request = "request=showProject&guid=" + scode;

	serverURL = unescape(serverURL);
	if (scode == null) {
	    scode = getCookieKey(pvCookie, "scode");
		scode = "0";
		request = "showStructure&scode=" + scode;
	}
	
	var loginURL = serverURL
		+ "/PPB/applet.html?NAME=Planview Process Builder,hostnames=MethodEngine url:/PPB/server,interactiveLogin=false,CERTIFICATE="
		+ escape(LoginCert)
		+ ",REQUEST=" + request;

	
    if (LoginCert != null && scode != null) {
		MEContext = context;
	

		if (!_MEwin) {
			_MEFireUpWindow(loginURL);
		} else {
			fOpened = false;
			try {
				_MEwin.document.bgColor = 'white';
				MEShowProject(scode);

				fOpened = true;
			} catch (e) {
			}
			if (!fOpened) {
				_MEFireUpWindow(loginURL);
			}
		}
	} else {
		alert("Missing cookies");
	}
}


function getSubStringBoundaries(string, subString, delimiter) {
	var nPos1, nPos2;
	nPos1 = nPos2 = -1;
	nPos1 = string.toLowerCase().indexOf(subString);
	if (nPos1 != -1) {
		nPos2 = string.indexOf(delimiter, nPos1);
		if (nPos2 == -1) {
			nPos2 = string.length;
		}
	}
	return new Array(nPos1, nPos2);
}


























function _MEGetWindow(url) {
	
	
	
	
	var baseName = "_ME";
	var instance = 1;

	var fns = "status=yes,resizable=yes,menubar=no";
	var name = baseName + instance++;
	_MEwin = window.open(url, baseName, fns);

	while (_MEwin && _MEwin != null && instance < 10) {
		if (_MEwin != null) {
			try {
				
				

				return _MEwin;
			} catch (e) {
				alert("An exception occurred in the script. Error name: "
						+ e.name + ". Error message: " + e.message);
				return;
			}
		}

		name = baseName + instance++;
		_MEwin = window.open(url, name, fns);
	}

	
	
	if (_MEwin != null) {
		
		alert("Unable to open Planview Process Builder window");
		_MEwin = null;
	}

	return _MEwin;
}









function _MEFireUpWindow(url) {

	try {
		var win = _MEGetWindow(url);

	} catch (e) {
		alert("An exception occurred in the script. Error name: " + e.name
				+ ". Error message: " + e.message);
		return;
	}
	if (win == null)
		return win;

	_MEwin = win;
	return win;
}



function PVUrl(urlString) {
  var queryArray;
  
  var urlArray = urlString.split("?");
  var queryStringArray = new Array();
  var rawSegments = urlString.split("/");
  
  if (urlArray[1])
  {
    queryArray = urlArray[1].split("#");
    queryStringArray = queryArray[0].split("&");
  }

  this.Path = urlArray[0];
  this.QueryStringArray = queryStringArray;
  this.Segments = PVUrlSegments.call(this, rawSegments);
  this.ApplicationPath = PVApplicationPath.call(this);
  this.UrlRoot = PVUrlRoot.call(this, urlString, rawSegments);
  this.AddOrUpdate = PVUrlAddOrUpdateParameter;
  this.Remove = PVUrlRemoveParameter;
  this.ToString = PVUrlToString;
  this.Contains = PVUrlContains;
  this.PageName = PVUrlPageName;
  this.PageNameShort = PVUrlPageNameShort;
  this.QueryStringParameterValue = PVUrlQueryStringParameterValue;
}

function PVUrlSegments(rawSegments) {
  var s, sl;
  var segments = ["/"];
  
  for (s = 3, sl = rawSegments.length; (s < sl); ++s) {
    segments.push(rawSegments[s] + ((s < (sl - 1)) ? "/" : ""));
  }

  return segments;
}

function PVApplicationPath() {
  var applicationPath = ((this.Segments.length > 1) ? this.Segments[1] : "");
  
  applicationPath = ((applicationPath.lastIndexOf("/") >= 0) ? applicationPath : undefined);
  
  return applicationPath;
}

function PVUrlRoot(urlString, rawSegments) {
  var urlRoot = (  (rawSegments.length > 2)
                 ? (rawSegments[0] + "//" + rawSegments[2] + "/")
                 : undefined);

  return urlRoot;
}

function PVUrlAddOrUpdateParameter(key,value)
{
  for (var i = 0; i < this.QueryStringArray.length; i++)
  {
    var keyValue = this.QueryStringArray[i].split("=");
    if (keyValue[0] && keyValue[0].toLowerCase() == key.toLowerCase())
    {
      
      this.QueryStringArray[i] = key + "=" + value;
      return true;
    }
  }
  
  
  this.QueryStringArray[this.QueryStringArray.length] = key + "=" + value;
  return true;
}

function PVUrlRemoveParameter(key)
{
  
  var queryStringArray = new Array();
  for (var i = 0; i < this.QueryStringArray.length; i++)
  {
    var keyValue = this.QueryStringArray[i].split("=");
    if (keyValue[0])
    {
      if (keyValue[0].toLowerCase() != key.toLowerCase())
      {
        queryStringArray[queryStringArray.length] = this.QueryStringArray[i];
      }
    }
    else
    {
      queryStringArray[queryStringArray.length] = this.QueryStringArray[i];
    }
  }
  this.QueryStringArray = queryStringArray;

  return true;
}

function PVUrlToString()
{
  
  var urlString = this.Path + "?";
  var and = "";
  for (var i = 0; i < this.QueryStringArray.length; i++)
  {
    urlString += and + this.QueryStringArray[i];
    and = "&";
  }
  return urlString;
}

function PVUrlContains(key)
{
  
  for (var i = 0; i < this.QueryStringArray.length; i++)
  {
    var keyValue = this.QueryStringArray[i].split("=");
    if (keyValue[0] && keyValue[0].toLowerCase() == key.toLowerCase())
    {
      return true;
    }
  }
  return false;
}

function PVUrlQueryStringParameterValue(key)
{
    
    for (var i = 0; i < this.QueryStringArray.length; i++)
    {
        var keyValue = this.QueryStringArray[i].split("=");
        if (keyValue[0] && keyValue[0].toLowerCase() == key.toLowerCase())
        {
            return keyValue[1];
        }
    }
    return false;
}

function PVUrlPageName()
{
  var pageName = this.Path.substring(this.Path.lastIndexOf('/') + 1);
  if (pageName == "")
  {
    pageName = this.Path.substring(this.Path.lastIndexOf('\\') + 1);
  }
  return pageName;
}

function PVUrlPageNameShort()
{
  
  var shortName = this.PageName().split(".");
  return shortName[0];
}







;



(function(undefined) {
  

  'use strict';

  
  
  
  
  
  
  
  
  function getCompleteHostingUri(uri) {
    var completeHostingUri = uri;

    return completeHostingUri;
  }
  
  
  
  function getRootedUrlFromSourceUri(url, useAbsolutePathing, sourceUri) {
    var segmentCount, root, currentUri, i, rootedUrl, applicationPath;
    

    if (url.substr(0, 2) != "~/") {
      return url;
    }

    root = "";
    currentUri = sourceUri;

    if (useAbsolutePathing === true) {
      currentUri = getCompleteHostingUri(currentUri);
      applicationPath = currentUri.ApplicationPath.substr(0, (currentUri.ApplicationPath.length - 1));
      
      
      
      
      
      

      root = (currentUri.UrlRoot + applicationPath + "/");

    } else {
      segmentCount = currentUri.Segments.length;

      for (i = 0; (i < (segmentCount - 3)); i++)  
      {
        root += "../";
      }
    }

    rootedUrl = url.replace("~/", root);

    return rootedUrl;
  }


  

  function getRootedUrl(url, useAbsolutePathing) {
    var currentUri = Planview.getUri();
    var rootedUrl = getRootedUrlFromSourceUri(url, useAbsolutePathing, currentUri);

    return rootedUrl;
  }

  

  function getImageUrl(fileName) {
    var imageUrl = Planview.getRootedUrl(
          "~/images/"
        + Planview.Context.User.getColorScheme()
        + "/" + fileName
    );

    return imageUrl;
  }

  

  function getAbsoluteImageUrl(fileName) {
    var absoluteImageUrl = Planview.getRootedUrl(
          "~/images/"
        + Planview.Context.User.getColorScheme()
        + "/" + fileName,
      true
    );

    return absoluteImageUrl;
  }

  

  function getCssUrl(fileName) {
    var cssUrl = Planview.getRootedUrl(
          "~/css/"
        + Planview.Context.User.getColorScheme()
        + "/" + fileName
    );

    return cssUrl;
  }

  

  function getUri(pUrl) {
    var url = (Planview.hasValue(pUrl) || window.location.href);
    
    
    var uri = new PVUrl(url);
   
    
    return uri;
  }

  
  

  Planview.getRootedUrl = getRootedUrl;
  Planview.getImageUrl = getImageUrl;
  Planview.getAbsoluteImageUrl = getAbsoluteImageUrl;
  Planview.getCssUrl = getCssUrl;
  Planview.getUri = getUri;

})();




(function($, undefined) {
  
  'use strict';

  Planview.RegisterNamespace("Planview.Context.");

  var pvc = Planview.Context;

  
  
  
  

  pvc.UserContext = function (spec) {

    var that, userId, dsn, colorScheme, features;

    spec = (spec || {});
    userId = spec.userId;
    dsn = spec.dsn;
    colorScheme = spec.colorScheme;
    features = spec.features;
    
    
    
    function getUserId() {
      return userId;
    }
    
    
    
    function getDsn() {
      return dsn;
    }
    
    

    function getColorScheme() {
      return colorScheme;
    }
    
    

    function hasFeature(feature) {
      var result = features.hasOwnProperty(feature);

      return result;
    }

    

    that = {};

    that.getUserId = getUserId;
    that.getDsn = getDsn;
    that.getColorScheme = getColorScheme;
    that.hasFeature = hasFeature;

    
    
    return that;
  };

})(jQuery);


;


(function($, undefined) {
  
  'use strict';

  
  
  
  

  Planview.StructureProperties = function (map) {

    var that;

    map = (map || {});
    
    
    
    
    
    function hasApproveRequest(ancestorIteration) {
      var code, result = false;
      
      while (ancestorIteration.next()) {
        code = ancestorIteration.value();
        
        if (map.hasOwnProperty(code) && Planview.hasValue(map[code].approveRequest)) {
          result = (map[code].approveRequest === "Y");
        }

        if (result) break;
      }
      
      return result;
    }
    
    

    that = {};

    that.hasApproveRequest = hasApproveRequest;

    
    
    return that;
  };

})(jQuery);


;


(function ($, undefined) {
  
  'use strict';

  
  
  
  

  Planview.ExpenditureProperties = function (map) {

    var that;

    map = (map || {});

    

    that = {};

    

    return map;
  };

})(jQuery);


;


(function ($, undefined) {
  
  'use strict';

  
  
  
  

  Planview.CurrencyConversionRates = function (map) {

    var that;

    map = (map || {});

    

    that = {};

    

    return map;
  };

})(jQuery);


;


(function ($, undefined) {
  var idCounter, baseGuid;

  idCounter = 0;
  baseWidgetId = "PVWidget";
  Planview.RegisterNamespace("Planview.WidgetHelper");

  Planview.WidgetHelper.GetBaseWidget = function (widgetPrototype, nameSpace) {
    var pvWidget, baseWidget, id, protoCreate;

    baseWidget = function () {
      return {
        isABaseWidget: true,
        decorateElement: function () {
          this.element.addClass("pvWidget");
          if (this.options.debug) {
            this.debugIt("decorating...")
            this.element.addClass("debug");
          }
        },

        debugIt: function (it) {
          if (this.options.debug) {
            this.logIt(it);
          }
        },

        logIt: function (it) {
          Planview.console.log(this.widgetId + ' ~ ' + it);
        },

        getDebugOption: function () {
          return this.options.debug;
        },

        doSomethingWhimsical: function (whimsy) {
          var message;

          message = whimsy ? whimsy : ': The square root of 42 is Purple. ~~~';
          this.logIt('~~~' + this.widgetId + whimsy);
        }
      }
    };

    
    pvWidget = widgetPrototype.isABaseWidget ? widgetProtoType :$.extend({}, new baseWidget(), widgetPrototype);

    if (!pvWidget.options) {
      pvWidget.options = {
        debug: false
      }
    }


    
    if (pvWidget._create) {
      protoCreate = pvWidget._create;
      pvWidget._create = function () {
        this.widgetId = baseWidgetId + "-" + idCounter++ + "-";
        this.decorateElement.apply(this);
        protoCreate.apply(this);
        
      }
    }
    else {
      pvWidget._create = function () {
        this.widgetId = baseWidgetId + "-" + idCounter++ + "-";
        
        this.decorateElement.apply(this);

        
        

        
        
        

        
        

      }
    }

    return pvWidget;
  }


  Planview.widget = function (nameSpace, baseWidget, widgetPrototype) {
    var newWidgetPrototype;

    if (!widgetPrototype) {
      widgetPrototype = baseWidget;
      baseWidget = $.Widget;
    }

    newWidgetPrototype = Planview.WidgetHelper.GetBaseWidget(widgetPrototype, nameSpace);

    $.widget(nameSpace, baseWidget, newWidgetPrototype);


  }
})(jQuery);

var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;

(function($, undefined) {
  'use strict';
  $.widget('Planview.loadingIndicator', {
    options: {
      content: '<div class="loadingIcon"></div>',
      classname: 'loadingIndicator',
      bodySelector: 'body',
      useMask: true,
      zIndex: 100,
      top: undefined,
      left: undefined
    },


    


    _create: function() {
      if (Planview.debug) {
        console.log('Planview.loadingIndicator created', this.options);
      }

      this.$body = $(this.options.bodySelector);
      this.$loadingIndicator = $('<div></div>').addClass(this.options.classname);
      if (this.options.useMask) {
        this.$mask = $('<div class="mask"></div>');
      }
      this.$sign = $('<div class="sign"><div class="pvar-tile-wait-icon"></div>' + this.options.content + '</div>');
      this.$loadingIndicator.append(this.$mask ? this.$mask : '').append(this.$sign);
    },

    render: function ($el, $body) {
      var width = parseInt($el.css('padding-left')) + parseInt($el.css('padding-right')) + $el.width(),
          height = $el.height() + parseInt($el.css('padding-top')) + parseInt($el.css('padding-bottom')),
          offset = $el.offset(),
          maskTop = (('top' in this.options) ? this.options.top : offset.top),
          maskLeft = (('left' in this.options) ? this.options.left : offset.left);

      this.remove();
      this.$loadingIndicator.find(".loadingIcon").text(pv_CommonLoadingRecords);
      
      $body.append(this.$loadingIndicator);
      if (this.$mask) {
        this.$mask.css({
          display: 'block',
          opacity: .4,
          background: 'black',
          position: 'absolute',
          top: maskTop,
          left: maskLeft,
          height: height,
          width: width,
          'z-index': this.options.zIndex
        });
      }
      this.$sign.css({
        color: 'white',
        position: 'absolute',
        top: maskTop + (height / 2) - (this.$sign.height() / 2),
        'z-index': this.options.zIndex + 1,
        left: maskLeft + (width / 2) - (this.$sign.width() / 2)
      });
    },

    show: function() {
      this.render(this.element, this.$body);
      this._attachLoadingIndicatorEvents();
      this.$loadingIndicator.show();
    },

    hide: function() {
      this.$loadingIndicator.hide();
    },

    remove: function() {
      this.$loadingIndicator.remove();
    },

    


    _attachLoadingIndicatorEvents: function() {

    }
  });
})(jQuery);

var g_fTimeInputCheckError = false;
function PositiveCheck(Input)
{
  if(Input == "")
  {
    return true;
  }
  else if(isNaN(Input))
  {
    return false;
  }
  else if(Input < 0)
  {
    return false;
  }
  else
  {
    return true;
  }
}

function PositiveInputCheck(InputControl, strInvalidNumber, strNonPositiveNumber)
{
  var ControlValue = InputControl.value;
  if(ControlValue == "")
  {
    return true;
  } 
  ControlValue = parseInt(ControlValue, 10);
  var fCheck = PositiveCheck(ControlValue);
  if(fCheck == true)
  {
    InputControl.value = ControlValue;
    return true;
  }
  else
  {
    if(isNaN(ControlValue))
    {
      window.alert(strInvalidNumber);
      onBlurFocusAndSelect(InputControl);
    }
    else if(ControlValue < 0)
    {
      window.alert(strNonPositiveNumber);
      onBlurFocusAndSelect(InputControl);
      return false;
    }
  }
}

function IntegerInputCheck(InputControl, strInvalidNumber)
{
  var ControlValue = InputControl.value;
  if(ControlValue == "")
  {
    return;
  } 
  ControlValue = parseInt(ControlValue, 10);
  if(isNaN(ControlValue))
  {
    window.alert(strInvalidNumber);
    onBlurFocusAndSelect(InputControl);
  }
  else
  {
    InputControl.value = ControlValue;
    return;
  }  
}

function TimeInputCheck(InputControl, strInvalidEntry, f24HourLimit, nNumberOfResources)
{
  TimeInputCheck2(InputControl, strInvalidEntry, "", f24HourLimit, nNumberOfResources, false);
}

function TimeInputCheck2(InputControl, strInvalidEntry, strInvalidDayEntry, f24HourLimit, nNumberOfResources, fTrackTimeInDays)
{
  var ControlValue = InputControl.value;
  var i;
  var nLen = ControlValue.length;
  var nMaxEntry = 24;
  var strInvalidEntryMessage = strInvalidEntry;

  for(i=0; i<nLen; i++)
  {
    if((ControlValue.charAt(i) != "0") &&
       (ControlValue.charAt(i) != "1") &&
       (ControlValue.charAt(i) != "2") &&
       (ControlValue.charAt(i) != "3") &&
       (ControlValue.charAt(i) != "4") &&
       (ControlValue.charAt(i) != "5") &&
       (ControlValue.charAt(i) != "6") &&
       (ControlValue.charAt(i) != "7") &&
       (ControlValue.charAt(i) != "8") &&
       (ControlValue.charAt(i) != "9") &&
       (ControlValue.charAt(i) != ":") &&
       (ControlValue.charAt(i) != ".") &&
       (ControlValue.charAt(i) != ","))
    {
      ControlValue = ControlValue.substring(0, i) + ControlValue.substring(i+1, nLen);
      i--;
      nLen--;
    }
  }

  if (fTrackTimeInDays)
  {
    nMaxEntry = 1;
    strInvalidEntryMessage = strInvalidDayEntry;
    nLen = ControlValue.length;
    for (i = 0; i < nLen; i++)
    {
      if (ControlValue.charAt(i) == ":")
      {
        ControlValue = ControlValue.substring(0, i) + ControlValue.substring(i+1, nLen);
        i--;
        nLen--;
      }
    }
    InputControl.value = ControlValue;
  }

  if(ControlValue == "")
  {
    InputControl.value = "";
    g_fTimeInputCheckError = false;
    return InputControl.value;
  }

  if(ControlValue == "," || ControlValue == "." || ControlValue == ":")
  {
    InputControl.value = "";
    g_fTimeInputCheckError = false;
    return InputControl.value;
  }

  var nColonPos = ControlValue.search(':');

  if(nColonPos != -1)
  {
    var nHourPart = ControlValue.substring(0, nColonPos);
    if(nHourPart == "")
    {
      nHourPart = 0;
    }
    
    var nMinutePart = ControlValue.substring(nColonPos + 1, nLen);
    if(nMinutePart == "")
    {
      nMinutePart = 0;
    }
    
    nHourPart = parseInt(nHourPart, 10);
    nMinutePart = parseInt(nMinutePart, 10);

    var nTotalMinute = nHourPart * 60 + nMinutePart;
    var nResult = nTotalMinute / 60;

    if((nResult > nMaxEntry * nNumberOfResources) && (f24HourLimit))
    {
      window.alert(strInvalidEntryMessage);
      onBlurFocusAndSelect(InputControl);
      g_fTimeInputCheckError = true;
      return ControlValue;
    }

	  if(nMinutePart < 10)
	  {
	    nMinutePart = "0" + nMinutePart;
    }

    InputControl.value = nHourPart + ":" + nMinutePart;
    g_fTimeInputCheckError = false;
    return InputControl.value;
  }
  else
  {
    var ControlFloatValue = parseFloat(ControlValue);

    if((ControlFloatValue > nMaxEntry * nNumberOfResources) && (f24HourLimit))
    {
      window.alert(strInvalidEntryMessage);
      onBlurFocusAndSelect(InputControl);
      g_fTimeInputCheckError = true;
      return ControlValue;
    }
    else
    {
      InputControl.value = ControlValue;
      g_fTimeInputCheckError = false;
      return InputControl.value;
    }
  }
}






var g_inputControl = null;

function focusAndSelect()
{
  if (null != g_inputControl)
  {
    g_inputControl.focus();
    g_inputControl.select();
  }
}

function onBlurFocusAndSelect(InputControl)
{
  g_inputControl = InputControl;
  setTimeout("focusAndSelect();", 1);
}

function RemainInputCheck(InputControl, strDBValue, strWarning)
{
  var nDBValue = parseFloat(strDBValue);

  var ControlValue = InputControl.value;
  
  var nLen = ControlValue.length;
  for(var i=0; i<nLen; i++)
  {
    if((ControlValue.charAt(i) != "0") &&
       (ControlValue.charAt(i) != "1") &&
       (ControlValue.charAt(i) != "2") &&
       (ControlValue.charAt(i) != "3") &&
       (ControlValue.charAt(i) != "4") &&
       (ControlValue.charAt(i) != "5") &&
       (ControlValue.charAt(i) != "6") &&
       (ControlValue.charAt(i) != "7") &&
       (ControlValue.charAt(i) != "8") &&
       (ControlValue.charAt(i) != "9") &&
       (ControlValue.charAt(i) != ":") &&
       (ControlValue.charAt(i) != ".") &&
       (ControlValue.charAt(i) != ","))
    {
      ControlValue = ControlValue.substring(0, i) + ControlValue.substring(i+1, nLen);
      i--;
      nLen--;
    }
  }

  if(ControlValue == "")
  {
    InputControl.value = "";
    return;
  }

  if(ControlValue == "," || ControlValue == "." || ControlValue == ":")
  {
    InputControl.value = "";
    return;
  }

  var nColonPos = ControlValue.search(':');

  if(nColonPos != -1)
  {
    var nHourPart = ControlValue.substring(0, nColonPos);
    if(nHourPart == "")
    {
      nHourPart = 0;
    }
    
    var nMinutePart = ControlValue.substring(nColonPos + 1, nLen);
    if(nMinutePart == "")
    {
      nMinutePart = 0;
    }
    
    nHourPart = parseInt(nHourPart, 10);
    nMinutePart = parseInt(nMinutePart, 10);

    var nTotalMinute = nHourPart * 60 + nMinutePart;

    if(nTotalMinute != nDBValue)
    {
      var fConfirm = true;
      fConfirm = window.confirm(strWarning);
      if(!fConfirm)
      {
        InputControl.value = "";
        return;
      }
    }

    if(nMinutePart < 10)
    {
      nMinutePart = "0" + nMinutePart;
    }

    InputControl.value = nHourPart + ":" + nMinutePart;
    return;
  }
  else
  {
    var ControlFloatValue = parseFloat(ControlValue);

    if(ControlFloatValue != nDBValue)
    {
      var fConfirm = true;
      fConfirm = window.confirm(strWarning);
      if(!fConfirm)
      {
        InputControl.value = "";
        return;
      }
    }
    else
    {
      InputControl.value = ControlValue;
      return;
    }
  }
}

function PositiveFloatInputCheck(InputControl, strInvalidNumber, strNonPositiveNumber, fIsEuropean)
{
  var strControlValue = InputControl.value;
  
  if(strControlValue == "")
  {
    return false;
  } 
  if (fIsEuropean)
  {
    strControlValue = strControlValue.replace(".", "");
    strControlValue = strControlValue.replace(",", ".");
  } 
  var nControlValue = parseFloat(strControlValue, 10);

  var fCheck = PositiveCheck(nControlValue);
  if(fCheck == true)
  {
    strControlValue = PVToFixed(nControlValue, 2);
    var nRemainderPos = strControlValue.indexOf(".");
    if ( nRemainderPos > -1 )
    {
      var strRemainder = strControlValue.slice(nRemainderPos+1); 
      if ( strRemainder.charAt(1) == "0" )
      {
        if ( strRemainder.charAt(0) == "0" )
        {
          strControlValue = PVToFixed(nControlValue, 0);
        }
        else
        {
          strControlValue = PVToFixed(nControlValue, 1);
        }
      }
    }
    else 
    {
      strControlValue = PVToFixed(nControlValue, 0);
    }
       
    if (fIsEuropean)
    {
      strControlValue = strControlValue.replace(".", ",");
    }
    InputControl.value = strControlValue;
    return true;
  }
  else
  {
    if(isNaN(nControlValue))
    {
      window.alert(strInvalidNumber);
      onBlurFocusAndSelect(InputControl);
      return false;
    }
    else if(nControlValue < 0)
    {
      window.alert(strNonPositiveNumber);
      onBlurFocusAndSelect(InputControl);
      return false;
    }
  }
}

function IntegerFloatInputCheck(InputControl, strInvalidNumber)
{
  var ControlValue = InputControl.value;
  if(ControlValue == "")
  {
    return;
  } 
  ControlValue = parseFloat(ControlValue, 10);
  if(isNaN(ControlValue))
  {
    window.alert(strInvalidNumber);
    onBlurFocusAndSelect(InputControl);
  }
  else
  {
    InputControl.value = ControlValue;
    return;
  }  
}


;
(function ($, undefined) {
  $.widget("Planview.pvautocomplete", $.ui.autocomplete,
  {
    
    sourceArray: [],

    

    options:
    {
      












      pushSourceItems: false,

      


      suppressMenu: false
    },

    _create: function () {
      
      $.ui.autocomplete.prototype._create.call(this);

      
      if (this.options.pushSourceItems)
        this.source = this.sourceCallback;
    },

    


    sourceCallback: function (request, response) {
      response($.ui.autocomplete.filter(this.sourceArray, request.term));
    },

    


    clearSourceItems: function () {
      this.sourceArray.length = 0;
    },

    



    pushSourceItem: function (item) {
      if (!this.options.pushSourceItems)
        throw new Planview.AssertException("Option pushSourceItems must be true");

      this.sourceArray.push(item);
    },

    







    _response: function (content) {
      






      this._trigger("response", null, { content: content });

      
      $.ui.autocomplete.prototype._response.call(this, content);
    },

    




    _suggest: function (items) {
      if (this.options.suppressMenu)
        return;

      
      $.ui.autocomplete.prototype._suggest.call(this, items);
    }
  });

})(jQuery);

;

; (function($, undefined) {
  'use strict';

  Planview.RegisterNamespace("Planview.Core");
  var pvc = Planview.Core;

  


  pvc.portalType = {
    Application: "APPL_PTF",
    Asset: "ASSET_PTF",
    Capacity: "CAPACITY",
    Default: "DEFAULT",
    Homeview: "HOMEVIEW",
    Investment: "INVESTMENT",
    Organization: "ORG",
    Portfolio: "PORTFOLIO",
    Product: "PRODUCT",
    Project: "PROJECT",
    Work: "PROJECT",
    Request: "REQUEST",
    Resource: "RESOURCE",
    Service: "SERV_PTF",
    Strategy: "STRATEGY",
    CostCenter: "COSTCENTER",
    None: "PORTAL"
  };
  

})(jQuery);

; (function ($, undefined) {
  'use strict';

  Planview.RegisterNamespace("Planview.Core");
  var pvc = Planview.Core;

  


  pvc.functionalArea = {
    FinancialPlan: "FM_FINPLAN",
    InvestmentPlanning: "INV_PLAN",
    PortfolioHub: "PORTF_HUB",
    ProjectManager: "PROJ_MGR",
    RoadMap: "ROAD_MAP"
  };


})(jQuery);

; (function ($, undefined) {
  'use strict';

  Planview.RegisterNamespace("Planview.Core");
  Planview.RegisterNamespace("Planview.Visualization.Analytics");

  var pvc = Planview.Core;
  var pva = Planview.Visualization.Analytics;

  

  pvc.PageId = {
    MyPlanview: 1,
    PortfolioView: 2,
    EntityView: 3,
    ProjectResourceManager: 4,
    AdministerVisuals: 5,
    InvestmentPlanningManager: 6,
    ResourceManager: 7
  };

  

  pvc.IPageModel = function (spec, my) {
    my = my || {};
    var that = {};

    var getPortalType = function () {
      return spec.portalType;
    };
    
    var getPageId = function () { return Planview.NotImplemented("pvc.IPageModel.getPageId()"); };
    var getLocalStorageContextKey = function () { return Planview.NotImplemented("pvc.IPageModel.getContextKey"); };
    var getRibbonDriver = function () { return Planview.NotImplemented("pvc.IPageModel.getRibbonDriver"); };
    var isRibbonVisible = function () { return Planview.NotImplemented("pvc.IPageModel.isRibbonVisible()"); };
    var isTrayVisible = function () { return Planview.NotImplemented("pvc.IPageModel.isTrayVisible()"); };

    that.getPortalType = getPortalType;
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;
    that.isTrayVisible = isTrayVisible;

    return that;
  };

  


  pvc.AbstractPageModel = function (spec, my) {
    var isTrayVisible = function () { return true; };
    var that = pvc.IPageModel(spec, my);

    
    
    var getEntityType = function (entityType) { return entityType; } 

    that.isTrayVisible = isTrayVisible;
    that.getEntityType = getEntityType;

    return that;
  };
  
  


  pvc.MyPlanviewPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.MyPlanview;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType();
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.MyPlanviewRibbonDriver(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return true;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };

  


  pvc.PortfolioViewPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.PortfolioView;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType() + "_PORTFOLIO";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.PortfolioRibbonDriver(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
        return (this.getPortalType() !== pvc.portalType.CostCenter
             && this.getPortalType() !== pvc.portalType.Organization
             && this.getPortalType() !== pvc.portalType.Capacity
             && spec.mode !== "FP");
    };

    






    var getEntityType = function(entityType) {
      if (spec.mode === "RES_DTL") { return '$Res_DTL'; }
      return entityType;
    }

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;
    that.getEntityType = getEntityType;

    return that;
  };

  


  pvc.EntityViewPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.EntityView;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType() + "_ENTITY";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.EntityRibbonDriver(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return (this.getPortalType() === pvc.portalType.Work);
      
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };

  


  pvc.ProjectResourcePageModel = function (spec, my) {
    var that;

    var getStructureCode = function() {
      return spec.structureCode;
    };

    var getPageId = function () {
      return pvc.PageId.ProjectResourceManager;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType() + "_PRM";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ProjectResourceRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    


    var getWorkEnitityId = function() {
      return spec.workEntityId;
    };
    
    


    var getSelectedTab =  function () {
      return spec.selectedTab;
    };
    
    that                           = pvc.AbstractPageModel(spec, my);
    that.getPageId                 = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver           = getRibbonDriver;
    that.isRibbonVisible           = isRibbonVisible;
    that.getStructureCode          = getStructureCode;
    that.getWorkEnitityId          = getWorkEnitityId;
    that.getSelectedTab            = getSelectedTab;
    return that;
  };

  


  pvc.ProjectResourcePageModalModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.ProjectResourceManager;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType() + "_PRM";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ProjectResourceRibbonController(ribbonManagerSpec);
    };


    

    var getRibbonTileDriver = function() {
      return undefined;
    };
    
    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;
    that.getRibbonTileDriver = getRibbonTileDriver;

    return that;
  };
  
  


  pvc.ResourceManagerPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.ResourceManager;
    };

    


    var getLocalStorageContextKey = function () {
      return this.getPortalType() + "_RAM";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ProjectResourceRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;
    return that;
  };


  


  pvc.ManageJobStreamsPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.ManageJobStreams;
    };

    


    var getLocalStorageContextKey = function () {
      return "ManageJobStreamPage";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ManageJobStreamsRibbonController(ribbonManagerSpec);
    };
    

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };

 


  pvc.AdministerVisualsPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.AdministerVisuals;
    };
    
    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };  

  pvc.ProductAssociationsPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return 0;
    };

    


    var getLocalStorageContextKey = function () {
      return "ProductAssociationsPage";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ProductAssociationsRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };
  
  pvc.StrategyAssociationsPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return 0;
    };

    


    var getLocalStorageContextKey = function () {
      return "StrategyAssociationsPage";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.StrategyAssociationsRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };
  
  pvc.InvestmentPlanningManagerPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return pvc.PageId.InvestmentPlanningManager;
    };
    
    var getLocalStorageContextKey = function () {
      return "InvestmentPlanningManagerPage";
    };

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.ProjectResourceRibbonController(ribbonManagerSpec);
    };

    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };
  
  pvc.SponsorshipPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return 0;
    };

    


    var getLocalStorageContextKey = function () {
      return "SponsorshipPage";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.SponsorshipRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };
  
  pvc.RollDownPageModel = function (spec, my) {
    var that;

    var getPageId = function () {
      return 0;
    };

    


    var getLocalStorageContextKey = function () {
      return "RollDownPage";
    };

    

    var getRibbonDriver = function (ribbonManagerSpec) {
      return pva.RollDownRibbonController(ribbonManagerSpec);
    };

    


    var isRibbonVisible = function () {
      return false;
    };

    that = pvc.AbstractPageModel(spec, my);
    that.getPageId = getPageId;
    that.getLocalStorageContextKey = getLocalStorageContextKey;
    that.getRibbonDriver = getRibbonDriver;
    that.isRibbonVisible = isRibbonVisible;

    return that;
  };
})(jQuery);

; (function ($, undefined) {

  Planview.RegisterNamespace("Planview.Core");

  var pvc = Planview.Core;

  pvc.ResizeHelper = function(spec, my) {
    my = my || {};

    var resizeEvent = spec.resizeEvent || "resize.resizeHelper"; 
    var resizeElement = spec.resizeElement || window; 
    var $window = $(resizeElement); 

    var $logElement = $(spec.logElement),
      resizeCallback = spec.resizeCallback,
      windowWidth = 0, 
      windowHeight = 0,
      resizeDelay = 100,
      resizeTimer = undefined,
      that = {};

    


    var log = function(msg) {
      if (Planview.isDefined($logElement))
        $logElement.append('<div class="log-msg">' + msg + '</div>');
    };

    


    var stopResizeTimer = function() {
      if (resizeTimer)
        clearTimeout(resizeTimer);
    };

    














    var throttleResize = function(event) {
      log('Raw Resize Event...');
      var forced = (event.force);
      
      stopResizeTimer();
      
      if (forced) {
        safeResize(forced);
      } else {
        resizeTimer = setTimeout(function () {
          safeResize(forced);
        }, resizeDelay);
      }
      
    };

    




    var safeResize = function(forced) {
      log('...Throttled Resize Event...');

      var curWindowWidth = $window.width();
      var curWindowHeight = $window.height();

      if ((!forced) && (curWindowWidth === windowWidth) && (curWindowHeight === windowHeight))
        return;

      windowWidth = curWindowWidth;
      windowHeight = curWindowHeight;

      onActualResize();
    };

    




    var onActualResize = function() {
      log('......Actual Resize Event:' + '[' + windowWidth + 'x' + windowHeight + ']');

      if (resizeCallback)
        resizeCallback(windowWidth, windowHeight, $window);
    };

    



    var on = function() {
      log('Starting... Resize the browser window');
      $(window).on(resizeEvent, throttleResize);

      
      $(window).trigger(resizeEvent);
    };

    


    var off = function() {
      log('Stopped...');
      $(window).off(resizeEvent);
    };

    that.on = on;
    that.off = off;

    log('Created');

    return that;
  };
  
})(jQuery);

; (function ($, undefined) {

  Planview.RegisterNamespace("Planview.Core");

  var pvc = Planview.Core;

  



  pvc.EventThrottler = function (spec, my) {
    my = my || {};

    var event = spec.event;
    var element = spec.element;
    var $element = $(element);
    var delay = spec.delay || 16;
    
    var callback = spec.callback;

    var $logElement = $(spec.logElement),
      timer = null,
      that = {};

    


    var log = function (msg) {
      if (Planview.isDefined($logElement))
        $logElement.append('<div class="log-msg">' + msg + '</div>');
    };

    



    var onActual = function (e) {
      log('Raw Event Fired...');
      if (timer === null) {
        callback(e, $element);
        timer = setTimeout(throttle, delay);
      }
    };

    


    var throttle = function (e) {
      log('......Actual Event Fired');

      timer = null;
    };

    


    var on = function () {
      log('Starting event throttling for: '+event);
      $element.on(event, onActual);
    };

    


    var off = function () {
      log('Stopped...');
      $element.off(event);
    };

    that.on = on;
    that.off = off;

    log('Created');

    return that;
  };

})(jQuery);

(function ($, undefined) {

    var pvc = Planview.RegisterNamespace("Planview.Core");

    pvc.IContentPage = function (spec, my) {
        spec = spec || {};
        my = my || {};

        var make = function () { return Planview.NotImplemented("pvc.IContentPage.make()"); };

        var that = {};
        that.make = make;
        return that;
    };

})(jQuery);

(function ($, undefined) {

    Planview.RegisterNamespace("Planview.Core");

    var pvc = Planview.Core;

    var $lpWidget;

    pvc.AbstractContentPage = function (spec, my) {
        my = my || {};

        var makeLandingPageWidget = function (lpSpec) {
            lpSpec = lpSpec || {};
            var lpOptions = {
                inDevMode: false,
                tabsVisible: true,
                showMoreTab: false,
                height: 400
            };

            $lpWidget = $(spec.element).LandingPageWidget($.extend(lpOptions, lpSpec));
            return $lpWidget;
        };

        var that = pvc.IContentPage(spec, my);
        that.makeLandingPageWidget = makeLandingPageWidget;

        return that;
    };

})(jQuery);

;
(function ($, undefined) {

    Planview.RegisterNamespace("Planview.Core");

    var pvc = Planview.Core;

    pvc.AbstractDialogContentController = function (spec, my) {

        var that, contentPage, tabsPaddingLeft, tabsPaddingRight;
        var my = my || {};
        var spec = spec || {};

        var classes = {
            contentContainer: 'prm-dialog-content-container',
            loadingIndicator: 'loadingIndicator',
            dialogTitleBar: 'ui-dialog-titlebar',
            dialogButtonBar: 'ui-dialog-buttonpane',
            gridContainer: 'gridHolder',
            preferenceContainer: 'prm-dialog-preference-container',
            dialogTitle: 'ui-dialog-title',
            dialogTitleLabel: 'ui-dialog-title-label',
            dialogTitleDescription: 'ui-dialog-title-description',
            closeButton: 'ui-dialog-close-button',
            dockButton: 'ui-dialog-dock-button',
            tabsWidget: 'pvlp-tabs-list',
            selectedTab: 'ui-tabs-selected',
            collapsedText: 'collapsed-text'
        };

        var selectors = {
            contentContainer: '.' + classes.contentContainer,
            loadingIndicator: '.' + classes.loadingIndicator,
            titleBar: '.' + classes.dialogTitleBar,
            buttonBar: '.' + classes.dialogButtonBar,
            grid: '.' + classes.gridContainer,
            preferenceContainer: '.' + classes.preferenceContainer,
            dialogTitle: '.' + classes.dialogTitle,
            dialogTitleLabel: '.' + classes.dialogTitleLabel,
            dialogTitleDescription: '.' + classes.dialogTitleDescription,
            closeButton: '.' + classes.closeButton,
            dockButton: '.' + classes.dockButton,
            tabsWidget: '.' + classes.tabsWidget,
            selectedTab: 'ul > li.' + classes.selectedTab
        };

        


        var makeDialog = function (dialogSpec, element) {
            var dialogOptions = {
                autoOpen: true,
                width: 808,
                height: 480,
                minWidth: 490,
                minHeight: 210,
                zIndex: 10002
            };

            var $dialog = element.pvdialog($.extend(dialogOptions, dialogSpec))
              .one("pvdialogclose", my.onDialogClose);

            return $dialog;
        };

        


        var dialogResizer = function (event, target) {
            var $target = $(target);
            var titleBar = $target.prev(selectors.titleBar);
            var buttonBar = $target.nextAll(selectors.buttonBar);

            var containerHeight = $target.parent().height();
            var containerWidth = $target.parent().width();
            
            var titleBarHeight = titleBar.is(':visible') ? titleBar.outerHeight(true) : 0;
            var buttonBarHeight = buttonBar.is(':visible') ? buttonBar.outerHeight(true) : 0;
            
            var height = containerHeight - titleBarHeight - buttonBarHeight;
            var width = containerWidth;
            
            $target.width(width).height(height);

            var dimensions = {
                width: width,
                height: height
            };

            
            if (Planview.isDefined($target.data('LandingPageWidget'))) {
                $target.LandingPageWidget("option", "dimensions", dimensions);
            }
            $target.trigger('pvdialogresize1');//ProjectAndResourceGridController.js will frequently 'off' this event
        };

        


        var onDialogResize = function (event, ui) {
            dialogResizer(event, event.target);
        };

        



        var onDockAdjustContent = function (widget) {
            var $tabs = $(selectors.tabsWidget, widget);
            var pxRemover = /px$/;
            tabsPaddingLeft = tabsPaddingLeft || parseInt($tabs.css('padding-left').replace(pxRemover, ""));
            tabsPaddingRight = tabsPaddingRight || parseInt($tabs.css('padding-right').replace(pxRemover, ""));

            
            $(selectors.dialogTitleLabel, widget).hide();

            var titleWidth = $(selectors.dialogTitle, widget).width();
            var dockWidth = $(selectors.dockButton, widget).outerWidth();
            var closeWidth = $(selectors.closeButton, widget).outerWidth();

            var $dialogTitleDescription = $(selectors.dialogTitleDescription, widget);

            
            $dialogTitleDescription.width(160).addClass(classes.collapsedText);

            $tabs.css({
                'padding-left': tabsPaddingLeft + 160 + 16,
                'padding-right': tabsPaddingRight + dockWidth + closeWidth
            });

        };

        


        var onUndockAdjustContent = function (widget) {
            $(selectors.dialogTitleDescription, widget).removeClass(classes.collapsedText);
            $(selectors.dialogTitleLabel, widget).show();
            var $tabs = $(selectors.tabsWidget, widget);
            $tabs.css({ 'padding-left': tabsPaddingLeft, 'padding-right': tabsPaddingRight });
        };

        


        var setupBindings = function (element) {
            element.on('pvdialogresizestop', that.onDialogResize);

            var resizeThrottler = pvc.EventThrottler({
                callback: dialogResizer,
                element: element,
                delay: 15,
                event: 'pvdialogresize'
            }).on();

            element.trigger('pvdialogresize');
        };

        


        var onTabShow = function (event, ui) {


        };

        


        var onDialogClose = function (event) {
            $(my.selectors.contentContainer, this).remove();
            $(my.selectors.loadingIndicator, this).remove();

            $(this).data('pvdialog').destroy();
            $(this).remove();
        };

        that = {};

        my.classes = classes;
        my.selectors = selectors;
        my.onDialogClose = onDialogClose;
        my.dialogResizer = dialogResizer;
        my.onDockAdjustContent = onDockAdjustContent;
        my.onUndockAdjustContent = onUndockAdjustContent;
        my.makeDialog = makeDialog;
        my.setupBindings = setupBindings;

        that.onDialogResize = onDialogResize;
        that.dialogResizer = dialogResizer;

        that.onTabShow = onTabShow;

        return that;
    };
})(jQuery);

;
(function($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.Direction = {
    Top: 'top',
    Bottom: 'bottom',
    Right: 'right',
    Left: 'left'
  };

  pvc.Orientation = {
    Horizontal: 'horizontal',
    Vertical: 'vertical'
  };

  pvc.Hierarchy = {
    Expanded: 'expanded',
    Collapsed: 'collapsed'
  };

  pvc.RootHierarchyState = {
    AllExpanded: 'AllEpanded',
    AllCollapsed: 'AllCollapsed',
    Mixed: 'Mixed'
  };

}(jQuery));

;
(function($, undefined) {
  'use strict';

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.LayoutTypes = {
    Border: 'border',
    Box: 'box',
    Split: 'split'
    
  };
  
})(jQuery);

(function ($, undefined) {

  $.widget("Planview.AbstractLayout",
  {
    options: {
    },

    

    _create: function () {
      this.remainingSpace = { width: 0, height: 0 };
    },

    

    _init: function () {
    },

    

    _setOption: function () {
      $.Widget.prototype._setOption.apply(this, arguments);
    },

    

    destroy: function () {
      $.Widget.prototype.destroy.call(this);
    },

    

    layout: function (parentWidth, parentHeight) {},

    


    _reduceRemainingSpaceBy: function (width, height) {
      var widthToReduce = (width > this.remainingSpace.width) ? this.remainingSpace.width : width;
      var heightToReduce = (height > this.remainingSpace.height) ? this.remainingSpace.height : height;

      this.remainingSpace.width -= widthToReduce;
      this.remainingSpace.height -= heightToReduce;
    },
    
    

    _addContainer: function (container, location) {}
  });

})(jQuery);

(function ($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.BorderLayout =
  {
    north: 'north',
    south: 'south',
    west: 'west',
    east: 'east',
    center: 'center'
  };

  $.widget("Planview.BorderLayout", $.Planview.AbstractLayout,
  {
    options: {},

    classes: {
      north: 'border-layout-north',
      south: 'border-layout-south',
      west: 'border-layout-west',
      east: 'border-layout-east',
      center: 'border-layout-center'
    },
    
    

    _create: function() {
      $.Planview.AbstractLayout.prototype._create.call(this);
      
      this.slots = {
        northContainer: undefined,
        southContainer: undefined,
        westContainer: undefined,
        eastContainer: undefined,
        centerContainer: undefined
      };

      this.remainingSpace = {
        width: 0,
        height: 0
      };
    },

    


    layout: function (parentWidth, parentHeight) {
      $.Planview.AbstractLayout.prototype.layout.apply(this, arguments);
      
      this.remainingSpace.width = parentWidth;
      this.remainingSpace.height = parentHeight;

      this._layoutNorth();
      this._layoutSouth();
      this._layoutWest();
      this._layoutEast();
      this._layoutCenter();
    },

    

    _layoutNorth: function () {
      var $containerWidget, height;
      
      if (this.slots.northContainer) {
        $containerWidget = this.slots.northContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);

        height = $containerWidget.element.outerHeight(true);
        this._reduceRemainingSpaceBy(0, height);
      }
    },
    
    

    _layoutSouth: function () {
      var $containerWidget, height;
      
      if (this.slots.southContainer) {
        $containerWidget = this.slots.southContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);

        height = $containerWidget.element.outerHeight(true);
        this._reduceRemainingSpaceBy(0, height);
      }
    },
    
    

    _layoutWest: function () {
      var $containerWidget, width;
        
      if (this.slots.westContainer) {
        $containerWidget = this.slots.westContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);
        
        width = $containerWidget.element.outerWidth(true);
        this._reduceRemainingSpaceBy(width, 0);
      }
    },
    
    

    _layoutEast: function () {
      var $containerWidget, width;
      
      if (this.slots.eastContainer) {
        $containerWidget = this.slots.eastContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);
        
        width = $containerWidget.element.outerWidth(true);
        this._reduceRemainingSpaceBy(width, 0);
      }
    },
    
    

    _layoutCenter: function () {
      var $containerWidget, width, height;
      
      if (this.slots.centerContainer) {
        $containerWidget = this.slots.centerContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);

        width = $containerWidget.element.outerWidth(true);
        height = $containerWidget.element.outerHeight(true);
        this._reduceRemainingSpaceBy(width, height);
      }
    },
    

      
    


    loadContainer: function(containerSpec) {
      if (!containerSpec.center) {
        containerSpec.center = $('<div id="dummy"></div>').ContainerWidget({ width: 'STRETCH', height: 'STRETCH' }).data().ContainerWidget;
      }

      this._addContainer(containerSpec.north, pvc.BorderLayout.north);
      this._addContainer(containerSpec.west, pvc.BorderLayout.west);
      this._addContainer(containerSpec.center, pvc.BorderLayout.center);
      this._addContainer(containerSpec.east, pvc.BorderLayout.east);
      this._addContainer(containerSpec.south, pvc.BorderLayout.south);
    },

    

    _addContainer: function (containerWidget, location) {
      if (!containerWidget)
        return;

      containerWidget.element.css('min-height', "1px");
      containerWidget.element.css('min-width', "1px");
      
      switch (location) {
        case pvc.BorderLayout.north:
          containerWidget.element.addClass(this.classes.north);
          containerWidget.option('width', 'STRETCH');
          this.slots.northContainer = containerWidget;
          this.element.append(containerWidget.element);
          break;
        case pvc.BorderLayout.south:
          containerWidget.element.addClass(this.classes.south);
          containerWidget.option('width', 'STRETCH');
          this.slots.southContainer = containerWidget;
          this.element.append(containerWidget.element);
          break;
        case pvc.BorderLayout.west:
          containerWidget.element.addClass(this.classes.west);
          containerWidget.option('height', 'STRETCH');
          this.slots.westContainer = containerWidget;
          this.element.append(containerWidget.element);
          break;
        case pvc.BorderLayout.east:
          containerWidget.element.addClass(this.classes.east);
          containerWidget.option('height', 'STRETCH');
          this.slots.eastContainer = containerWidget;
          this.element.append(containerWidget.element);
          break;
        case pvc.BorderLayout.center:
          containerWidget.element.addClass(this.classes.center);
          containerWidget.option('width', 'STRETCH');
          containerWidget.option('height', 'STRETCH');
          this.slots.centerContainer = containerWidget;
          this.element.append(containerWidget.element);
          break;
        default:
          console.warn('Unrecognized container location %s', location);
          break;
      }
    }
  });

})(jQuery);

(function ($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.BoxLayout =
  {
    xAxis: 'xAxis',
    yAxis: 'yAxis'
  };

  $.widget("Planview.BoxLayout", $.Planview.AbstractLayout,
  {
    options: {
      orientation: pvc.BoxLayout.yAxis
    },

    classes: {
      xAxis: 'box-layout-x-axis',
      yAxis: 'box-layout-y-axis'
    },

    scrollbarsInstalled: false,

    

    _create: function () {
      $.Planview.AbstractLayout.prototype._create.call(this);

      this.containers = [];
    },

    

    layout: function (parentWidth, parentHeight) {
      var that, height, width;

      that = this;
      
      $.Planview.AbstractLayout.prototype.layout.apply(this, arguments);

      this.remainingSpace.width = (this.options.orientation === pvc.BoxLayout.yAxis && this.scrollbarsInstalled) ? parentWidth - Planview.Browser.ScrollbarDimensions().width : parentWidth;
      this.remainingSpace.height = (this.options.orientation === pvc.BoxLayout.xAxis && this.scrollbarsInstalled) ? parentHeight - Planview.Browser.ScrollbarDimensions().height : parentHeight;

      $.each(this.containers, function(i, $containerWidget) {
        $containerWidget.layout(that.remainingSpace.width, that.remainingSpace.height);
        
        if (that.options.orientation === pvc.BoxLayout.yAxis) {
          height = $containerWidget.element.outerHeight(true);
          that._reduceRemainingSpaceBy(0, height);
        }
        else if (that.options.orientation === pvc.BoxLayout.xAxis) {
          width = $containerWidget.element.outerWidth(true);
          that._reduceRemainingSpaceBy(width, 0);
        }
      });

      this._maintainScrollbars(parentWidth, parentHeight);
    },
    
    

    _maintainScrollbars: function(parentWidth, parentHeight) {
      
      if (!this.scrollbarsInstalled && this._needsScrollbars()) {
        this._installScrollbars(parentWidth, parentHeight);
      }
        
      else if (this.scrollbarsInstalled && !this._needsScrollbars()) {
        this._uninstallScrollbars(parentWidth, parentHeight);
      }
    },

    

    _installScrollbars: function(parentWidth, parentHeight) {
      this.element.css('overflow', 'auto');
      this.scrollbarsInstalled = true;
      this.layout(parentWidth, parentHeight);
    },
    
    

    _uninstallScrollbars: function(parentWidth, parentHeight) {
      this.element.css('overflow', 'hidden');
      this.scrollbarsInstalled = false;
      this.layout(parentWidth, parentHeight);
    },

    

    _needsScrollbars: function() {
      return ((this.options.orientation === pvc.BoxLayout.xAxis && this.remainingSpace.width === 0) ||
        ((this.options.orientation === pvc.BoxLayout.yAxis) && this.remainingSpace.height === 0));
    },

    

    add: function(containerWidget) {
      this._addContainer(containerWidget);
    },

    

    clear: function() {
      var containerWidget;
      
      while (this.containers.length > 0) {
        containerWidget = this.containers.pop();
        containerWidget.element.remove();
      }
    },

    

    _addContainer: function (containerWidget, location) {
      if (!containerWidget)
        return;

      if (this.options.orientation === pvc.BoxLayout.yAxis) {
        containerWidget.option('width', 'STRETCH');
      } else {
        containerWidget.element.css('display', 'inline-block');
        containerWidget.option('height', 'STRETCH');
      }

      this.containers.push(containerWidget);
      this.element.append(containerWidget.element);
    },
    
    

    getContainerCount: function() {
      return this.containers.length;
    }
    
  });

})(jQuery);

(function($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");

  $.widget("Planview.SplitLayout", $.Planview.AbstractLayout,
  {
    options: {
      splitterSize: 8,
      
      orientation: pvc.Orientation.Vertical,
      position: 300, 
      positionedFrom: pvc.Direction.Left
    },

    classes: {
      first: 'split-layout-first',
      second: 'split-layout-second',
      
      vertical: 'split-layout-vertical',
      horizontal: 'split-layout-horizontal'
    },
    
    _create: function() {
      $.Planview.AbstractLayout.prototype._create.call(this);

      this.slots = {
        firstContainer: undefined,
        secondContainer: undefined,
        splitter: undefined
      };
    },
    
    

    _setOption: function (option, value) {
      $.Planview.AbstractLayout.prototype._setOption.apply(this, arguments);
    },
  
    

    layout: function(parentWidth, parentHeight) {
      $.Planview.AbstractLayout.prototype.layout.apply(this, arguments);
      
      this.remainingSpace.width = parentWidth;
      this.remainingSpace.height = parentHeight;

      this._layoutFirstPane();
      this._layoutSecondPane();
    },
    
    

    _layoutFirstPane: function() {
      var $containerWidget, width, height, orientation, splitterPosition, splitterSize;

      orientation = this.options.orientation;
      splitterPosition = this._calculateSplitterPosition();
      splitterSize = this.options.splitterSize;

      if (this.slots.firstContainer) {
        $containerWidget = this.slots.firstContainer;
        
        if (orientation === pvc.Orientation.Vertical) {
          $containerWidget.layout(splitterPosition, this.remainingSpace.height);
          width = $containerWidget.element.outerWidth(true) + splitterSize;
          this._reduceRemainingSpaceBy(width, 0);
        }
        else if (orientation === pvc.Orientation.Horizontal) {
          $containerWidget.layout(this.remainingSpace.width, splitterPosition);
          height = $containerWidget.element.outerHeight(true) + splitterSize;
          this._reduceRemainingSpaceBy(0, height);
        }
      }
    },

    

    _layoutSecondPane: function () {
      var $containerWidget, width, height, orientation;

      orientation = this.options.orientation;

      if (this.slots.secondContainer) {
        $containerWidget = this.slots.secondContainer;
        $containerWidget.layout(this.remainingSpace.width, this.remainingSpace.height);

        if (orientation === pvc.Orientation.Vertical) {
          width = $containerWidget.element.outerWidth(true);
          this._reduceRemainingSpaceBy(width, 0);
        }
        else if (orientation === pvc.Orientation.Horizontal) {
          height = $containerWidget.element.outerHeight(true);
          this._reduceRemainingSpaceBy(0, height);
        }
      }
    },
    
    

    loadContainer: function(containerSpec) {
      this._addFirstPane(containerSpec.pane1);
      this._addSplitter(containerSpec.splitter);
      this._addSecondPane(containerSpec.pane2);
    },
    
    

    _addFirstPane: function(containerWidget) {
      containerWidget.element.addClass(this.classes.first);
      
      if (this.options.orientation === pvc.Orientation.Vertical)
        containerWidget.element.addClass(this.classes.vertical);
      else
        containerWidget.element.addClass(this.classes.horizontal);

      containerWidget.option('width', 'STRETCH');
      containerWidget.option('height', 'STRETCH');
      this.slots.firstContainer = containerWidget;
      this.element.append(containerWidget.element);
    },
    
    

    _addSecondPane: function(containerWidget) {
      containerWidget.element.addClass(this.classes.second);

      if (this.options.orientation === pvc.Orientation.Vertical)
        containerWidget.element.addClass(this.classes.vertical);
      else
        containerWidget.element.addClass(this.classes.horizontal);
      
      containerWidget.option('width', 'STRETCH');
      containerWidget.option('height', 'STRETCH');
      this.slots.secondContainer = containerWidget;
      this.element.append(containerWidget.element);
    },
    
    

    _addSplitter: function(splitter) {
      this.slots.splitter = splitter;
      this.element.append(splitter);
    },
    
    

    _calculateSplitterPosition: function () {
      var orientation, positionFrom, splitterValue, positionType, maxPosition, position;

      orientation = this.options.orientation;
      positionFrom = this.options.positionedFrom;

      positionType = this._getPositionType(this.options.position);

      splitterValue = positionType === pvc.PositionType.Percentage ? this._calculateRelativePositionFromPercentPosition(this.options.position) : this.options.position;

      switch (orientation) {
        case pvc.Orientation.Horizontal:
          {
            maxPosition = this.element.height();
            switch (positionFrom) {
              case pvc.Direction.Bottom:
                {
                  position = this.element.height() - splitterValue;
                  break;
                }
              case pvc.Direction.Top:
              default:
                {
                  position = splitterValue;
                }
            }
            break;
          }
        case pvc.Orientation.Vertical:
        default:
          {
            maxPosition = this.element.width();
            switch (positionFrom) {
              case pvc.Direction.Right:
                {
                  position = this.element.width() - splitterValue;
                  break;
                }
              case pvc.Direction.Left:
              default:
                {
                  position = splitterValue;
                }
            }
          }
      }

      return Planview.getBoundedValue(position, 0, maxPosition - this.options.splitterSize);
    },
    
    

    _calculateRelativePositionFromRawPosition: function (position) {
      var orientation, positionFrom, splitterValue;

      orientation = this.options.orientation;
      positionFrom = this.options.positionedFrom;
      splitterValue = position;

      switch (orientation) {
        case pvc.Orientation.Horizontal:
          {
            switch (positionFrom) {
              case pvc.Direction.Bottom:
                {
                  return this.element.height() - splitterValue;
                }
              case pvc.Direction.Top:
              default:
                {
                  return splitterValue;
                }
            }
          }

        case pvc.Orientation.Vertical:
        default:
          {
            switch (positionFrom) {
              case pvc.Direction.Right:
                {
                  return this.element.width() - splitterValue;
                }
              case pvc.Direction.Left:
              default:
                {
                  return splitterValue;
                }
            }
          }
      }
    },
    
    

    _calculateRelativePositionFromPercentPosition: function (position) {
      var orientation, splitterValue;

      orientation = this.options.orientation;
      position = this._parsePercentBasedPosition(position);

      switch (orientation) {
        case pvc.Orientation.Horizontal:
          {
            splitterValue = (position / 100) * this.element.height();
            break;
          }
        case pvc.Orientation.Vertical:
        default:
          {
            splitterValue = (position / 100) * this.element.width();
            break;
          }
      }

      splitterValue = Math.round(splitterValue);
      return this._calculateRelativePositionFromRawPosition(splitterValue);
    },
    
    

    _parsePercentBasedPosition: function (position) {
      var match, percent;

      match = position.match(/^(\d+(?:\.\d+)?)(%)$/);
      if (match) {
        percent = parseInt(match[1], 10);
        if (match[2] === '%') {
          return percent;
        }
        else
          throw new Error('Attempted to retrieve invalid position value: ' + position);
      }
      else
        throw new Error('Attempted to retrieve invalid position value: ' + position);
    },
    
    

    _getPositionType: function (position) {
      if (typeof position === 'number')
        return pvc.PositionType.Pixel;
      else if (typeof position === 'string')
        return pvc.PositionType.Percentage;
      else
        throw new Error('Attempted to retrieve invalid position type from: ' + position);
    }
    
  });

})(jQuery);

(function($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");
  
  $.widget("Planview.ContainerWidget", $.ui.mouse, {
    options: {
      debug: false,
      width: 100,
      height: 100,
      
      layout: { type: pvc.LayoutTypes.Border }
    },
    
    layoutManager: undefined,
    layoutCount: 0,
    
    

    _create: function () {
      $.Widget.prototype._create.call(this);
      
      var layoutOptions;

      if (this.options.debug) {
        this.element.addClass("debug");
      }
      
      this.element.addClass('container-widget border-box-sized');

      layoutOptions = $.extend({}, this.options.layout);

      if (this.options.layout.type === pvc.LayoutTypes.Border) {
        this.element.attr('layout', 'border-layout');
        this.layoutManager = $(this.element).BorderLayout(layoutOptions).data().BorderLayout; 
      }
      else if (this.options.layout.type === pvc.LayoutTypes.Box) {
        this.element.attr('layout', 'box-layout');
        this.layoutManager = $(this.element).BoxLayout(layoutOptions).data().BoxLayout; 
      }
      else if (this.options.layout.type === pvc.LayoutTypes.Split) {
        this.element.attr('layout', 'split-layout');
        this.layoutManager = $(this.element).SplitLayout(layoutOptions).data().SplitLayout; 
      }
    },

    

    _init: function () {
      
      
      if (this.options.debug)
        Planview.console.log('_init: %s', this.element.attr('id'));
    },

    

    _setOption: function (option, value) {
      if (this.options.debug) {
        Planview.console.log('_setOption: %s %s->%s', this.element.attr('id'), option, value);
      }
      
      $.Widget.prototype._setOption.apply(this, arguments);

      switch (option) {
        case 'width':
          this.options.width = value;
          break;
        case 'height':
          this.options.height = value;
          break;
      }
    },

    

    destroy: function () {
      this.element.children("*").remove();

      this.element.removeClass('debug container-widget border-box-sized');
      this.element.removeAttr('layout');
      
      $.Widget.prototype.destroy.call(this);

      this.layoutManager.destroy(); 
    },
    
    

    layout: function (parentWidth, parentHeight) {
      this.lastSize = {
        width: parentWidth,
        height: parentHeight
      };
      
      if (this.options.debug) {
        Planview.console.group('[Layout of: %s] [Remaining Parent Size: %sx%s]', this.element.attr('id'), parentWidth, parentHeight);
      }
      
      var size = this._calculateSize(parentWidth, parentHeight);
      this._size(size.width, size.height);
      var zoomMod = getDevicePixelZoomMod();

      var availableInnerWidth = this.element.width() - zoomMod;
      var availableInnerHeight = this.element.height() - zoomMod;
      this.layoutManager.layout(availableInnerWidth, availableInnerHeight);

      if (this.options.debug) {
        Planview.console.groupEnd();
      }
    },
    
    

    reLayout: function () {
      if (this.lastSize)
        this.layout(this.lastSize.width, this.lastSize.height);
      else
        console.warn('Will not perform reLayout. No "lastSize" attribute defined to layout against.');
    },
      
    

    _calculateSize: function(parentWidth, parentHeight) {
      return {
        width: this._calculateWidth(parentWidth),
        height: this._calculateHeight(parentHeight)
      };
    },

    

    _calculateWidth: function (parentWidth) {
      var margins = this.element.outerWidth(true) - this.element.outerWidth();

      return (this.options.width === 'STRETCH') ? parentWidth - margins : this.options.width - margins;
    },

    

    _calculateHeight: function (parentHeight) {
      var margins = this.element.outerHeight(true) - this.element.outerHeight();
      
      return (this.options.height === 'STRETCH') ? parentHeight - margins : this.options.height - margins;
    },
    
    
















    _size: function (width, height) {
      var widthToSet, heightToSet;
      widthToSet = width > 0 ? width : 0; 
      heightToSet = height > 0 ? height : 0; 
      
      this.element.css('width', widthToSet);
      this.element.css('height', heightToSet);
      
      this._onSized(widthToSet, heightToSet);
    },
    
    

    _onSized: function(width, height) {
      this._trigger('sized', null, {
        layoutCount: ++this.layoutCount,
        specifiedWidth: this.options.width,
        specifiedHeight: this.options.height,
        calculatedWidth: width,
        calculatedHeight: height
      });
    }

  });

})(jQuery);

(function ($, undefined) {

  var pvc = Planview.RegisterNamespace("Planview.Core");

  $.widget("Planview.PageContainerWidget", $.Planview.ContainerWidget,
  {
    options: {
      
      topOffset: 0,
      
      width: 'STRETCH',
      height: 'STRETCH'
    },

    resizeHelper: undefined,

    

    _create: function () {
      $.Planview.ContainerWidget.prototype._create.call(this);
      
      this.validate();

      this.element.addClass('page-widget');

      
      this.resizeHelper = pvc.ResizeHelper({
        resizeCallback: $.proxy(this.layout, this)
      });
      this.resizeHelper.on();
    },

    

    validate: function () {
      var overflowSetting = $('body').css('overflow');
      if (overflowSetting !== 'hidden') {
        console.warn('Body has a css overflow of "%s". This needs to be set to "hidden". If not, sometimes blank space will appear where scrollbars were previously rendered in the resize cycle.', overflowSetting);
      }
    },

    

    _setOption: function () {
      $.Planview.ContainerWidget.prototype._setOption.apply(this, arguments);
    },

    

    destroy: function () {
      this.element.children("*").remove();

      this.element.removeClass('page-widget');
      this.resizeHelper.off();

      $.Planview.ContainerWidget.prototype.destroy.call(this);
    },
    
    

    layout: function (parentWidth, parentHeight) {
      $.Planview.ContainerWidget.prototype.layout.apply(this, arguments);

      this._onPageLayoutComplete();
    },

    


    _onPageLayoutComplete: function() {
      this._trigger('layoutComplete', null, {});
    },
    
    

    _calculateWidth: function (parentWidth) {
      return parentWidth;
    },

    

    _calculateHeight: function (parentHeight) {
      return parentHeight - this.options.topOffset;
    }

  });

})(jQuery);

(function (undefined) {
  "use strict";

  var pvc;

  pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.Access = {
    NA: '',
    ReadOnly: 'RO',
    ReadWrite: 'EX'
  };
})();



(function ($, undefined) {
  

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.PositionType =
  {
    Percentage: 'percent',
    Pixel: 'pixel'
  };

  $.widget("Planview.DefaultSplitter", $.Planview.ContainerWidget, {
    options: {
      pane1: $('<div>pane1</div>').ContainerWidget().data().ContainerWidget,
      pane2: $('<div>pane2</div>').ContainerWidget().data().ContainerWidget,
      
      orientation: pvc.Orientation.Vertical,     
      position: 300,                             
      positionedFrom: pvc.Orientation.Left,      
      
      locked: false,                             
      liveUpdate: false,                         
      
      minDraggableDistanceFromEdge: 0,           
      useBoundsDelegate: false,                  
      boundsDelegate: undefined,                 
      stepIncrement: 15                          
    },

    classes: {
      splitterWidget: 'pv-splitter-pane splitter2',
      vertical: {
        splitter: 'vsplitter'
      
      },
      horizontal: {
        splitter: 'hsplitter'
      }
    },

    userManipulated: false,
    
    

    _create: function () {
      
      this.options.layout = {
        type: pvc.LayoutTypes.Split,
        
        splitterSize: 8,
        orientation: this.options.orientation,
        position: this.options.position,
        positionedFrom: this.options.positionedFrom
      };

      $.Planview.ContainerWidget.prototype._create.call(this);

      this.element.addClass(this.classes.splitterWidget);

      this.splitter = this._createSplitter();

      this.layoutManager.loadContainer({
        pane1: this.options.pane1,
        pane2: this.options.pane2,
        splitter: this.splitter
      });
    },

    

    _init: function () {
      
      $.Planview.ContainerWidget.prototype._init.call(this);
    },

    














    reconstituteLegalPosition: function () {
      this._setOption('position', this.options.position);
    },

    

    _setOption: function (option, value) {
      
      switch(option) {
        case 'position':
          {
            var relativePosition = this._calculateRelativePosition(value);

            if (this.userManipulated) {
              
              
              this._triggerPositionChanged(relativePosition);
            }

            
            value = relativePosition;

            this.layoutManager._setOption(option, relativePosition);
            this.reLayout();
            break;
          }
        case 'positionedFrom':
          {
            this.layoutManager._setOption(option, value);
            this.reLayout();
            break;
          }
        case 'locked':
          {
            this._setLocked(value);
            break;
          }    
      }
      
      

      $.Planview.ContainerWidget.prototype._setOption.apply(this, arguments);

    },

    








    _calculateRelativePosition: function(position){
      var relativePosition, bounds;
      
      if (this.userManipulated)
      {
        relativePosition = this.layoutManager._calculateRelativePositionFromRawPosition(position);
      } else
      {
        if (this.layoutManager._getPositionType(position) === pvc.PositionType.Percentage) {
          relativePosition = this.layoutManager._calculateRelativePositionFromPercentPosition(position);
        } else {
          relativePosition = position;
        }
      }

      relativePosition = this._confinePositionToLegalBounds(relativePosition);

      return relativePosition;
    },

    


    _confinePositionToLegalBounds: function (relativePosition) {
      var bounds, originalPosition;

      bounds = this._getLegalBounds();
      originalPosition = relativePosition;
      relativePosition = Planview.getBoundedValue(relativePosition, bounds.min, bounds.max);
      
      if (originalPosition !== relativePosition)
        console.warn('Given splitter position of %spx modified to %spx to conform to legal bounds.', originalPosition, relativePosition);

      return relativePosition;
    },

    


    _getLegalBounds: function(){
      var bounds;

      if (this._canUseBoundingDelegate()) {
        bounds = this.options.boundsDelegate({ sourceSplitter: this });
      }
      else {
        bounds = {
          min: this.options.minDraggableDistanceFromEdge,
          max: Planview.MaxInt
        };
      }

      return bounds;
    },


    


    _canUseBoundingDelegate: function () {
      return this.options.useBoundsDelegate && $.isFunction(this.options.boundsDelegate);
    },

    

    destroy: function () {
      this.element.children("*").remove();

      $.Planview.ContainerWidget.prototype.destroy.call(this);
    },

    

    _createSplitter: function () {
      var splitter, that = this;

      splitter = (this.options.orientation === pvc.Orientation.Vertical) ? this._createVerticalSplitterMarkup() : this._createHorizontalSplitterMarkup();

      splitter.draggable({
        axis: (this.options.orientation === pvc.Orientation.Vertical) ? 'x' : 'y',
        containment: 'parent',

        helper: (this.options.liveUpdate) ? 'clone' : 'original',

        drag: (this.options.liveUpdate) ? function () {
          var theSplitter = $('.ui-draggable-dragging');
          that._onSplitterPositionChanged(theSplitter);
        } : undefined,

        stop: (!this.options.liveUpdate) ? function () {
          var theSplitter = $(this);
          that._onSplitterPositionChanged(theSplitter);
        } : undefined

      });
      
      splitter.attr("tabindex", -1);
      splitter.on('keydown', $.proxy(that._keyHandler, this));

      return splitter;
    },

    

    _keyHandler: function (e) {
      if (!e.ctrlKey && e.shiftKey && e.keyCode == 73) {
        
        this._moveFocusOut();
        return;
      }
      if (e.keyCode === 9 && e.shiftKey) {
        
        this.options.pane1.element.focus();
        return;
      }
      if (e.keyCode === 9) {
        
        this.options.pane2.element.focus();
        var splitterFocus = this.splitter.is(':focus');
        if (!splitterFocus) {
          
          e.preventDefault();
        }
        return;
      }

      if (this.options.orientation === pvc.Orientation.Vertical) {
        
        if (e.keyCode === 37) {
          
          this._userMove(-this.options.stepIncrement);
          return;
        }
        if (e.keyCode === 39) {
          
          this._userMove(this.options.stepIncrement);
          return;
        }
      } else {
        
        if (e.keyCode === 38) {
          
          this._userMove(-this.options.stepIncrement);
          return;
        }
        if (e.keyCode === 40) {
          
          this._userMove(this.options.stepIncrement);
          return;
        }
      }
    },

    

    _userMove: function (moveAmount) {
      this.userManipulated = true;
      this._setOption('position', this.options.position + moveAmount);
      this.userManipulated = false;
    },

    

    _moveFocusOut: function () {
      var next = Planview.findNextElementInDom($(this.element).parent(), ':tabbable');
      if ($(next).is('body')) {
        
        $(':tabbable:first')[0].focus();
      } else {
        next.focus();
      }

    },

      

    _createVerticalSplitterMarkup: function () {
      var markup = $('<div></div>').addClass(this.classes.vertical.splitter);

      return markup;
    },

    

    _createHorizontalSplitterMarkup: function () {
      var markup = $('<div></div>').addClass(this.classes.horizontal.splitter);

      return markup;
    },

    


    _onSplitterPositionChanged: function (splitter) {

      var position = (this.options.orientation === pvc.Orientation.Vertical ? splitter.position().left : splitter.position().top);

      this.userManipulated = true;
      this._setOption('position', position);
      this.userManipulated = false;

      $(this.splitter).css('top', 0);
      $(this.splitter).css('left', 0);
    },
    
    

    _setLocked: function(locked) {
      if (locked)
        this.splitter.draggable('disable');
      else
        this.splitter.draggable('enable');
    },
    
    




    _triggerPositionChanged: function(relativePosition) {
      this._trigger('positionChanged', null, { position: relativePosition });
    },
    
    

    getState: function() {
      return {
        orientation: this.options.orientation,
        position: this.options.position,
        positionedFrom: this.options.positionedFrom,
        locked: this.options.locked,
        liveUpdate: this.options.liveUpdate
      };
    }
    
  });

})(jQuery);



(function ($, undefined) {
  

  var pvc = Planview.RegisterNamespace("Planview.Core");

  pvc.SplitterState = {
    Open: 'open',
    
    ClosedLeft: 'closedLeft',
    ClosedRight: 'closedRight',
    
    ClosedTop: 'closedTop',
    ClosedBottom: 'closedBottom'
  };

  $.widget("Planview.CollapsibleSplitter", $.Planview.DefaultSplitter, {
    
    options: {
      openPosition: 200,
      closedSize: 10,
      
      state: pvc.SplitterState.Open
    },

    classes: {
      
      vertical: {
        splitter: 'vsplitter',
        buttons:
        {
          container: 'v-btns',
          left: 'v-btn-left',
          right: 'v-btn-right',
          dock: {
            leftIcon: 'dock-left-icon',
            rightIcon: 'dock-right-icon'
          }
        }
      },
      
      horizontal: {
        buttons:
        {
          container: 'h-btns',
          top: 'h-btn-top',
          bottom: 'h-btn-bottom',
          dock: {
            topIcon: 'dock-top-icon',
            bottomIcon: 'dock-bottom-icon'
          }
        }
      }
    },
    
    

    _init: function () {
      $.Planview.DefaultSplitter.prototype._init.call(this);
      
      var buttonContainer;

      this.splitter.children().remove();

      if (this.options.orientation === pvc.Orientation.Vertical) {
        this.midContentContainer = $('<div class="vertical-mid-content"></div>');
        buttonContainer = $('<div class="' + this.classes.vertical.buttons.container + '"></div>');
      } else {
        this.midContentContainer = $('<div class="horizontal-mid-content"></div>');
        buttonContainer = $('<div class="' + this.classes.horizontal.buttons.container + '"></div>');
      }

      this.midContentContainer.append(buttonContainer);
      this.splitter.append(this.midContentContainer);
      
      this._createAndBindButtons();
    },

    

    _setOption: function (option, value) {
      
      $.Planview.DefaultSplitter.prototype._setOption.apply(this, arguments);

      switch (option) {
        case 'state':
          {
            if (value === pvc.SplitterState.Open)
              this._doOpen();
            else if (value === pvc.SplitterState.ClosedLeft)
              this._doClose(pvc.Direction.Left);
            else if (value === pvc.SplitterState.ClosedRight)
              this._doClose(pvc.Direction.Right);
            else if (value === pvc.SplitterState.ClosedTop)
              this._doClose(pvc.Direction.Top);
            else if (value === pvc.SplitterState.ClosedBottom)
              this._doClose(pvc.Direction.Bottom);
            break;
          }  
      }
    },

    


    _getButtonClass: function () {
      if (this.options.orientation === pvc.Orientation.Vertical) {
        return this.classes.vertical.buttons.left;
      } else {
        return this.classes.horizontal.buttons.top;
      }
    },

    


    _getOpenButtonIconClass: function () {
      if (this.options.orientation === pvc.Orientation.Vertical) {
        return (this.options.positionedFrom === pvc.Direction.Left) ? this.classes.vertical.buttons.dock.rightIcon : this.classes.vertical.buttons.dock.leftIcon;
      } else {
        return (this.options.positionedFrom === pvc.Direction.Top) ? this.classes.horizontal.buttons.dock.bottomIcon : this.classes.horizontal.buttons.dock.topIcon;
      }
    },

    


    _getCloseButtonIconClass: function (toDirection) {
      if (this.options.orientation === pvc.Orientation.Vertical) {
        return (toDirection === pvc.Direction.Left) ? this.classes.vertical.buttons.dock.leftIcon : this.classes.vertical.buttons.dock.rightIcon;
      } else {
        return (toDirection === pvc.Direction.Top) ? this.classes.horizontal.buttons.dock.topIcon : this.classes.horizontal.buttons.dock.bottomIcon;
      }
    },

    


    _getEmptyButtonContainer: function () {
      var isVertical = (this.options.orientation === pvc.Orientation.Vertical);

      var buttonContainer = (isVertical) ? $(this.splitter).find('.' + this.classes.vertical.buttons.container) : $(this.splitter).find('.' + this.classes.horizontal.buttons.container);
      buttonContainer.children().remove();

      return buttonContainer;
    },
    
    


    _createAndBindButtons: function () {
      var buttonContainer = this._getEmptyButtonContainer();

      if ((this.options.state === pvc.SplitterState.Open))
        this._createAndBindOpenedButtons(buttonContainer);
      else
        this._createAndBindClosedButtons(buttonContainer);

    },

    


    _createAndBindOpenedButtons: function(buttonContainer) {
      var isVertical, button1, button2;
      
      isVertical = (this.options.orientation === pvc.Orientation.Vertical);

      button1 = this._createAndBindCloseButton( (isVertical) ? pvc.Direction.Left : pvc.Direction.Top);
      button2 = this._createAndBindCloseButton( (isVertical) ? pvc.Direction.Right: pvc.Direction.Bottom);

      buttonContainer.append(button1);
      buttonContainer.append(button2);
    },

    


    _createAndBindClosedButtons: function(buttonContainer) {
      var button;

      button = this._createAndBindOpenButton();
      buttonContainer.append(button);
    },
    
    


    _createAndBindOpenButton: function () {
      var button, buttonClass, iconClass;

      buttonClass = this._getButtonClass();
      iconClass = this._getOpenButtonIconClass();

      button = $('<div class="' + buttonClass + '">' +
        '<div class="' + iconClass + '"></div>' +
        '</div>');

      this._bindOpenButton(button);
      
      return button;
    },
    
    


    _createAndBindCloseButton: function (toDirection) {
      var button, buttonClass, iconClass;

      buttonClass = this._getButtonClass();
      iconClass = this._getCloseButtonIconClass(toDirection);

      button = $('<div class="' + buttonClass + '">' +
        '<div class="' + iconClass + '"></div>' +
        '</div>');

      this._bindCloseButton(button, toDirection);
      
      return button;
    },

    


    _bindOpenButton: function(button) {
      button.one('click', $.proxy(this._setOption, this, 'state', pvc.SplitterState.Open));
    },

    


    _bindCloseButton: function(button, closeDirection) {
      switch(closeDirection) {
        case pvc.Direction.Left:
          button.one('click', $.proxy(this._setOption, this, 'state', pvc.SplitterState.ClosedLeft));
          break;
        case pvc.Direction.Right:
          button.one('click', $.proxy(this._setOption, this, 'state', pvc.SplitterState.ClosedRight));
          break;
        case pvc.Direction.Top:
          button.one('click', $.proxy(this._setOption, this, 'state', pvc.SplitterState.ClosedTop));
          break;
        case pvc.Direction.Bottom:
          button.one('click', $.proxy(this._setOption, this, 'state', pvc.SplitterState.ClosedBottom));
          break;
      }
    },
    
    


    _doOpen: function () {
      this._setOption('position', this.options.openPosition);

      if (this.options.orientation === pvc.Orientation.Vertical)
        this._setOption('positionedFrom', pvc.Direction.Left);
      else
        this._setOption('positionedFrom', pvc.Direction.Top);

      this._createAndBindButtons();
    },

    


    _doClose: function (toDirection) {
      
      this.options.openPosition = this.options.position;
      
      this._setOption('positionedFrom', toDirection);
      this._setOption('position', this.options.closedSize);

      this._createAndBindButtons();
    },
    
    
    _keyHandler: function (e) {
      if (this.options.orientation === pvc.Orientation.Vertical) {
        
        if (e.keyCode === 37 && e.ctrlKey) {
          
          if (this.options.state === pvc.SplitterState.Open) {
            this._setOption('state', pvc.SplitterState.ClosedLeft)
          } else if (this.options.state === pvc.SplitterState.ClosedRight) {
            this._setOption('state', pvc.SplitterState.Open)
          }
          return;
        }
        if (e.keyCode === 39 && e.ctrlKey) {
          
          if (this.options.state === pvc.SplitterState.Open) {
            this._setOption('state', pvc.SplitterState.ClosedRight)
          } else if (this.options.state === pvc.SplitterState.ClosedLeft) {
            this._setOption('state', pvc.SplitterState.Open)
          }
          return;
        }
      } else {
        
        if (e.keyCode === 38 && e.ctrlKey) {
          
          if (this.options.state === pvc.SplitterState.Open) {
            this._setOption('state', pvc.SplitterState.ClosedTop)
          } else if (this.options.state === pvc.SplitterState.ClosedBottom) {
            this._setOption('state', pvc.SplitterState.Open)
          }
          return;
        }
        if (e.keyCode === 40 && e.ctrlKey) {
          
          if (this.options.state === pvc.SplitterState.Open) {
            this._setOption('state', pvc.SplitterState.ClosedBottom)
          } else if (this.options.state === pvc.SplitterState.ClosedTop) {
            this._setOption('state', pvc.SplitterState.Open)
          }
          return;
        }
        
      }

      
      $.Planview.DefaultSplitter.prototype._keyHandler.call(this, e);
    },

    

    getState: function () {
      
      if (this.options.state === pvc.SplitterState.Open)
        this.options.openPosition = this.options.position;

      var superState = $.Planview.DefaultSplitter.prototype.getState.apply(this, arguments);

      return $.extend({}, superState, {
        state: this.options.state,
        openPosition: this.options.openPosition
      });
    },

    _onSplitterPositionChanged: function ($splitter) {
      var vertical = (this.options.orientation === pvc.Orientation.Vertical),
          dimension = vertical ? 'width' : 'height',
          anchor = vertical ? pvc.Direction.Left : pvc.Direction.Top,
          rawPosition = vertical ? $splitter.position().left : $splitter.position().top,
          position;

      if (this.options.state !== pvc.SplitterState.Open) {
        $.Planview.DefaultSplitter.prototype._setOption.call(this, 'state', pvc.SplitterState.Open);
        this._setOption('positionedFrom', vertical ? pvc.Direction.Left : pvc.Direction.Top);
      }

      if (this.options.positionedFrom !== anchor) {
        position = this.layoutManager.element[dimension]() - rawPosition;
      } else {
        position = rawPosition;
      }

      this.userManipulated = true;
      this._setOption('position', position);
      this.userManipulated = false;

      $(this.splitter).css('top', 0);
      $(this.splitter).css('left', 0);

      this._createAndBindButtons();
    }

  });

})(jQuery);



(function ($, undefined) {
  

  var pvc = Planview.RegisterNamespace("Planview.Core");

  $.widget("Planview.DrawerSplitter", $.Planview.CollapsibleSplitter, {

    options: {

    },

    



    _createAndBindOpenedButtons: function (buttonContainer) {
      var closeButton;

      closeButton = this._createAndBindCloseButton(this.options.positionedFrom);

      buttonContainer.append(closeButton);
    },

    



    _doOpen: function () {
      this._setOption('position', this.options.openPosition);
      this._setOption('locked', false);

      this._createAndBindButtons();
    },

    



    _doClose: function () {
      
      this.options.openPosition = this.options.position;

      this._setOption('position', this.options.closedSize);
      this._setOption('locked', true);

      this._createAndBindButtons();
    }

  });

})(jQuery);



(function ($, undefined) {
  

  var pvc = Planview.RegisterNamespace("Planview.Core");

  $.widget("Planview.AlertsSplitter", $.Planview.DrawerSplitter, {

    options: {
      alertCount: 0,
      minDraggableDistanceFromEdge: 40
    },

    



    _init: function () {
      var self;
      self = this;

      $.Planview.DrawerSplitter.prototype._init.apply(this, arguments);

      this.splitter.css('overflow', 'visible'); 

      this.alertCounter = $('<div class="alert-count">'+this.options.alertCount+'</div>');
      this.alertCounterFlyout = $('<div class="alert-count-indicator"></div>');

      this.alertCounterFlyout.append(this.alertCounter);

      this.alertCounterFlyout.on("click", function () {
        self._setOption("state", pvc.SplitterState.Open);
      });

      this.midContentContainer.append(this.alertCounterFlyout);
    },
    
    


    _setOption: function (option, value) {
      
      switch(option) {
        case 'alertCount':
          {
            this._updateAlertCount(value);
            break;
          }
      }

      $.Planview.DrawerSplitter.prototype._setOption.apply(this, arguments);
    },
    
    



    _doOpen: function () {
      $.Planview.DrawerSplitter.prototype._doOpen.apply(this, arguments);

      this.alertCounterFlyout.hide();
    },
    
    



    _doClose: function () {
      $.Planview.DrawerSplitter.prototype._doClose.apply(this, arguments);
      this.alertCounterFlyout.show();
    },
    
    


    _updateAlertCount: function(value) {
      this.alertCounter.text(value);
    }
  });

})(jQuery);

;
(function($, undefined) {

  Planview.RegisterNamespace("Planview.Core");
  var pvc = Planview.Core;
  
  


  pvc.FinishingButton = {
    Ok: 'ok',
    Yes: 'yes',
    Save: 'save',
    Apply: 'apply',
    Done: 'done',
    Confirm: 'confirm',
    New: 'new',
    Edit: 'edit',
    Delete: 'delete',
    Preview: 'preview'
  };

  


  pvc.ExitButton = {
    No: 'no',
    Cancel: 'cancel',
    Close: 'close'
  };

  



  $(function () {
    pvc.ButtonMap = function () {
      var map = [];
      if (Planview.ResourceManager) {
        map[pvc.FinishingButton.Ok] = { text: Planview.ResourceManager.GetString("Common.OKButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Yes] = { text: Planview.ResourceManager.GetString("Common.CommonYes"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Save] = { text: Planview.ResourceManager.GetString("Common.SaveButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Apply] = { text: Planview.ResourceManager.GetString("Common.CommonApplyButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Done] = { text: Planview.ResourceManager.GetString("Common.CommonDone"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Confirm] = { text: Planview.ResourceManager.GetString("Common.CommonConfirmButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.New] = { text: Planview.ResourceManager.GetString("Common.CommomDialogNewButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Edit] = { text: Planview.ResourceManager.GetString("Common.CommonEditButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Delete] = { text: Planview.ResourceManager.GetString("Common.CommonDeleteButton"), style: 'pv-left button11 green-button' };
        map[pvc.FinishingButton.Preview] = { text: Planview.ResourceManager.GetString("Common.CommonPreviewButton "), style: 'pv-left button11 green-button' };
        map[pvc.ExitButton.No] = { text: Planview.ResourceManager.GetString("Common.CommonNo"), style: 'pv-left button11 gray-button' };
        map[pvc.ExitButton.Cancel] = { text: Planview.ResourceManager.GetString("Common.CancelButton"), style: 'pv-left button11 gray-button' };
        map[pvc.ExitButton.Close] = { text: Planview.ResourceManager.GetString("Common.CommonCloseButton"), style: 'pv-left button11 gray-button' };
      }
      return map;
    }();
  });

})(jQuery);


;
(function ($, undefined) {
  
  var pvgh = Planview.GridHelper;

  var $closeButton, $dockButton;

  var classes = {
    titleBar: 'ui-dialog-titlebar',
    dialogTitle: 'ui-dialog-title',
    bottomTray: 'pvdialog-tray',
    closeButton: 'ui-dialog-titlebar-close',
    dockButton: 'ui-dialog-dock-button',
    docked: 'ui-dialog-docked',
    resizeHandle: 'ui-resizable-handle',
    roundedCorners: 'ui-corner-all',
    splitterResizeListener: 'splitter-resize-listener',
    uiStateHover: 'ui-state-hover',
    buttonTray: 'ui-dialog-buttonpane'
  };

  var selectors = {
    bottomTray: '.' + classes.bottomTray,
    closeButton: '.' + classes.closeButton,
    titleBar: '.' + classes.titleBar,
    dialogTitle: '.' + classes.dialogTitle,
    dockButton: '.' + classes.dockButton,
    resizeHandle: '.' + classes.resizeHandle,
    docked: '.' + classes.docked,
    uiStateHover: '.' + classes.uiStateHover,
    buttonTray: '.' + classes.buttonTray
  };

  var guidCounter = 0;

  
  selectors.dialogFrame = selectors.titleBar + ', ' + selectors.resizeHandle;
  selectors.titleBarElements = 
    [selectors.dialogTitle, selectors.dockButton, selectors.closeButton].join(', ');

  $.fn.exists = function() {
    return this.length !== 0;
  };
  
  





  
  
  
  
  $.widget("Planview.pvdialog", $.ui.dialog,
  {

    


    options:
    {
      title: "Planview Dialog",
      dialogClass: "analyticManagerDialog",
      dockable: false, 
      dockOptions: undefined, 
      





      
      bottomTrayElements: [],
      containmentElement: undefined
},

    

    _create: function () {
      this.options.selectors = selectors;

      
      $.ui.dialog.prototype._create.call(this);
      
      this.guid = guidCounter++;
      
      this._setOption('bottomTrayElements', this.options.bottomTrayElements);
      
      this._state = {
        isOpen: false
      };

      this._setOption('dockable', this.options.dockable);
      this._setOption('dockOptions', this.options.dockOptions);
      this._setDraggableArea();
    },

    

    _init: function () {
      var id;
      $.ui.dialog.prototype._init.call(this);

      id = this.options.dialogId ? this.options.dialogId : 'dialog_' + this.guid;
      
      this.widget().attr('id', id);

      this._bindEvents();
    },
    
    


    open: function(){
      $.ui.dialog.prototype.open.call(this);

      var widget = this.widget();
      var opts = this.options;
      
      this._state.isOpen = true;

      
      if (!widget.is(':visible')) {
        widget.show();
      }
      else if(this.options.dockable && ! this.isDocked() ) {
        this._storePositionState();
      }
      
      if (this.options.dockable &&  this.options.dockOptions.openInDock) {
        this._dock(true);
      }
      else if (this.isDocked() && !opts.dockOptions.openInDock) {
        this._undock();
      }
      else if(Planview.hasValue(this._state.width)) {
        widget.width(this._state.width);
        widget.height(this._state.height);
        widget.css({
          position: 'absolute',
          top: this._state.top,
          left: this._state.left,
          'z-index': this._state.zIndex
        });
        
        this.element.trigger('pvdialogresize');
      }
    },

    


    close: function(){
      var widget = this.widget();
      var opts = this.options;
      
      this._state.isOpen = false;

      
      widget.find(selectors.uiStateHover).removeClass(classes.uiStateHover);
      
      if (opts.dockable) {
        if (this.isDocked()) {
          
          
          widget.appendTo('body');
          this._onSplitterDestroy({ data: this });
          
          widget.off('splitter.resize', this._onSplitterResize);
          opts.dockOptions.$dockContainer.splitter('destroy');
        }
        else {
          
          this._storePositionState();
        }
        widget.hide();
      } else {
        $.ui.dialog.prototype.close.call(this);
      }
    },

    

    destroy: function () {
      
      this.element
        .unbind('.pvdialog')
        .removeData('pvdialog');
      
      $.ui.dialog.prototype.destroy.call(this);
    },

    




    _setOption: function (option, value) {
      $.ui.dialog.prototype._setOption.call(this, option, value);

      switch (option) {
        case "bottomTrayElements":
          {
            this._setBottomTrayElements(value);
            break;
          }
        case 'dockable':
          {
            this._setDockable(value);
            break;
          }
        case 'dockOptions':
          {
            this._setDockOptions(value);
            break;
          }
        case 'noSizeWidth' :
          {
            this.options.width = value;
            this._state.width = value;
            break;
          }
        case 'noSizeHeight' :
          {
            this.options.height = value;
            this._state.height = value;
            break;
          }
        case 'noSizeZIndex':
          {
            this.options.zIndex = value;
            this._state.zIndex = value;
            break;
          }
        case 'noSizePosition':
          {
            this.options.position = value;
            if ($.isArray(value) && value.length == 2) {
              this._state.left = value[0];
              this._state.top = value[1];
            }
            break;
          }
      }
    },
    
    







    _createButtons: function (buttons) {
      
      $.ui.dialog.prototype._createButtons.call(this, buttons);

      var buttonTray = this.widget().find(".ui-dialog-buttonpane");
      var buttonPaneExists = buttonTray.exists();

      if (buttonPaneExists) {
        
        
        buttonTray.find('button').attr('tabindex', 0);
        buttonTray.prepend("<div class='" + classes.bottomTray + "'></div>");
      }
      
        
    },
    
    


    _setBottomTrayElements: function (bottomTrayElements) {
      var tray = this.widget().find(selectors.bottomTray);

      tray.empty();

      $.each(bottomTrayElements, function (i, v) {
        tray.append($(v));
      });
    },
    
    


    _setDockable: function(value){
      $dockButton = this.widget().find(selectors.dockButton);
      $closeButton = this.widget().find(selectors.closebutton);

      if (value) {
        if ($dockButton.exists()) {
          $dockButton.show();
        }
        else {
          $dockButton = $(this._createDockButtonMarkup());
          this.widget().find(selectors.titleBar).append($dockButton);
          this._setupDockButtonBindings($dockButton);
        }
      } else {
        $dockButton.hide();
      }
    },

    


    _setDockOptions: function (value) {
      if (Planview.isDefined(value))
        this._state.splitterPosition = value.splitterPosition;
    },

    


    _setupDockButtonBindings: function($dockButton){
      
      $dockButton.hover(function (e) {
        $dockButton.addClass('ui-state-hover');
      }, function (e) {
        $dockButton.removeClass('ui-state-hover');
      });
      var self = this;
      $dockButton.on('click', null, self, this._onDockButtonClicked);
      $dockButton.on('keydown', null, self, function(e) {
        if (e.keyCode === 13 || e.keyCode === 32) {
          self._onDockButtonClicked(e);
        }
      });
    },

    



    _onDockButtonClicked: function(e){
      var message = 'DockButton Clicked: ';
      var self = e.data;

      if (self.isDocked()) {
        message += 'undocking';
        self.options.dockOptions.openInDock = false;
        self._undock();
      }
      else {
        message += 'docking';
        self.options.dockOptions.openInDock = true;
        self._dock();
      }
      
      self.widget().find(selectors.uiStateHover).removeClass(classes.uiStateHover);
      console.log(message);
    },

    






    _dock: function(ignoreDimensions){
      var widget = this.widget();
      var opts = this.options;
      var self = this; 
      ignoreDimensions = ignoreDimensions || false;
      
      $(selectors.dialogFrame, widget).hide();
      widget.removeClass(classes.roundedCorners).addClass(classes.docked);

      
      if (!ignoreDimensions) {
        this._storePositionState();
      }

      widget.css({
        top: 'auto',
        left: 'auto',
        'z-index': 500,
        height: 'auto',
        width: 'auto'
      });
      
      this._state.zIndex = 500;
      this.options.zIndex = 500;
      
      
      if (Planview.hasValue(opts.dockOptions) && opts.dockOptions.$dockContainer.exists()) {
        
        if (!$.contains(opts.dockOptions.$dockContainer[0], widget[0])) {
          widget.appendTo(opts.dockOptions.$dockContainer);
          
          $(selectors.titleBarElements, widget).addClass(classes.docked).appendTo(widget);
        }
        
        if (!opts.dockOptions.$dockContainer.is(':data(splitter)')) {
          
          opts.dockOptions.$dockContainer.splitter({
            orientation: 'horizontal',
            relativePosition: this._state.splitterPosition
          });

          
          var $dockContent = opts.dockOptions.$dockContainer.children().first();
          $dockContent.addClass(classes.splitterResizeListener);
          
          if (Planview.isFunction(self.options.dockOptions.dockContentResizeCallback)) {
            $dockContent.on('splitter.resize', null, $dockContent, self.options.dockOptions.dockContentResizeCallback);
          }

          
          
          widget.addClass(classes.splitterResizeListener);
          widget.on('splitter.resize', null, self, this._onSplitterResize);

          
          this.options.dockOptions.onDockAdjustContent(widget);

          opts.dockOptions.$dockContainer.children('.splitter-resize-listener').trigger('splitter.resize');
        }
        else {
          
          this._onSplitterResize({ data: self }); 
        }
      }
    },
    
    


    _undock: function(){
      var widget = this.widget();
      var self = this;
      $(selectors.dialogFrame, widget).show();
      
      widget.addClass(classes.roundedCorners).removeClass(classes.docked);
      $('body').append(widget);
      
      $(selectors.titleBarElements, widget).removeClass(classes.docked).appendTo(widget.find(selectors.titleBar));
      
      this.options.dockOptions.onUndockAdjustContent(this.widget());
      
      widget.width(this._state.width);
      widget.height(this._state.height);
      widget.css({
        position: 'absolute',
        top: this._state.top,
        left: this._state.left,
        'z-index': this._state.zIndex
      });

      this._onSplitterDestroy({ data: self });

      widget.off('splitter.resize', this._onSplitterResize);
      this.options.dockOptions.$dockContainer.splitter('destroy');
    },

    


    _storePositionState: function(){
      var widget = this.widget();
      this._state.width = widget.width();
      this._state.height = widget.height();
      this._state.top = widget.position().top;
      this._state.left = widget.position().left;
      this._state.zIndex = isNaN(parseInt(widget.css('z-index'))) ? 10003 : parseInt(widget.css('z-index')); 
    },

    


    getDialogState: function() {
      var widget = this.widget();
      var docked = this.isDocked();
      
      if (!docked && this._state.isOpen) {
        this._storePositionState();
      }
      
      var state = {
        width: this._state.width,
        height: this._state.height,
        top: this._state.top, 
        left: this._state.left,
        
        dockable: this.options.dockable,
        isDocked: docked,
        splitterPosition: this._state.splitterPosition,
        isOpen: this._state.isOpen
      };
      
      
      if (docked && this._state.isOpen) {
        state.splitterPosition = this.options.dockOptions.$dockContainer.splitter('relativePosition');
      }
      return state;
    },

    



    _onSplitterResize: function(e){
      var self = e.data;
      var $dockContent = self.options.dockOptions.$dockContainer.children().first();
      
      
      
      
      
      if (Planview.isFunction(self.options.dockOptions.dialogResizeCallback)) {
        self.options.dockOptions.dialogResizeCallback(e, self.element);
      }
      
      if (Planview.isFunction(e.stopPropagation)) {
        e.stopPropagation();
      }
    },
    



    _onSplitterDestroy: function(e){
      var self = e.data;
      
      
      this._state.splitterPosition = this.options.dockOptions.$dockContainer.splitter('relativePosition');

      $dockContent = self.options.dockOptions.$dockContainer.children().first();
      
      if (Planview.isFunction(self.options.dockOptions.dialogResizeCallback)) {
        self.options.dockOptions.dialogResizeCallback(e, self.element);
      }
      
      if (Planview.isFunction(self.options.dockOptions.dockContentResetCallback)) {
        self.options.dockOptions.dockContentResetCallback($dockContent);
      }
    },

    


    _createDockButtonMarkup: function () {
      var markup = [
        '<a class="ui-dialog-dock-button ui-corner-all" tabindex="0">',
          '<span class="ui-icon ui-dialog-dock-icon icon"></span>',
        '</a>'
      ].join('');
      return markup;
    },

    


    _bindEvents: function() {
      var parent = this.widget();

      parent.on('keydown', null, parent, function(e) {
        if (e.keyCode === 9) {
          if (e.shiftKey && e.target === $('#dialog_' + this.guid + ' :tabbable:first')[0]) {
            $($(e.data).find(':tabbable:last')[0]).focus();
            e.preventDefault();
          } else if (!e.shiftKey && e.target == $('#dialog_' + this.guid + ' :tabbable:last')[0]) {
            $($(e.data).find(':tabbable:first')[0]).focus();
            e.preventDefault();
          }
        }
      });
    },

    


    isDocked: function(){
      return this.widget().hasClass(classes.docked);
    },
    


    isOpen: function() {
      return this._state.isOpen;
    },

    _setDraggableArea: function () {
      var container;

      container = this.options.containmentElement;

      if (!this.options.draggable) {
        return;
      }

      
      if (!container) {
        this.uiDialog.draggable({ containment: 'document' });
      } else {
        this.uiDialog.draggable({ containment: container.selector });
      }
    }
  });

})(jQuery);

;


;
(function ($, undefined) {
  "use strict";
  var uuid;
  uuid = 0;

  Planview.RegisterNamespace("Planview.Core");
  var pvc = Planview.Core;

  pvc.DialogMetaType = {
    Standard: 0,
    Config: 1
  };
  



  pvc.StandardDialogType = {
    Information: 0,
    Confirmation: 1,
    Success: 2,
    Warning: 3,
    Error: 4,
    Configuration: 5,
    PlusNew: 6
  };

  pvc.ConfigurationDialogType = {
    Standard: 0,
    Preferences: 1,
    PlusNew: 2,
    Export: 3,
    Edit: 4
  };

  


  pvc.StandardDialogTypeMap = [];
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Information] = {iconClass: "icon30x30",  icon: "info-icon-30x30", dialogClass: "info-dialog", exitButton: false };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Confirmation] = { iconClass: "icon30x30", icon: "confirmation-icon-30x30", dialogClass: "confirmation-dialog", exitButton: true };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Success] = { iconClass: "icon30x30", icon: "success-icon-30x30", dialogClass: "success-dialog", exitButton: false };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Warning] = { iconClass: "icon30x30", icon: "warning-icon-30x30", dialogClass: "warning-dialog", exitButton: false };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Error] = { iconClass: "icon30x30", icon: "error-icon-30x30", dialogClass: "error-dialog", exitButton: false };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.Configuration] = { iconClass: "icon30x30", icon: "wrench-icon-30x30", dialogClass: "configuration-dialog", exitButton: false };
  pvc.StandardDialogTypeMap[pvc.StandardDialogType.PlusNew] = { iconClass: "icon30x30", icon: "plus-sign-icon-30x30", dialogClass: "configuration-dialog", exitButton: false };

  pvc.ConfigurationDialogTypeMap = [];
  pvc.ConfigurationDialogTypeMap[pvc.ConfigurationDialogType.Standard] = { iconClass: "icon38x30", icon: "gears-icon-38x30", dialogClass: "configuration-dialog", exitButton: true };
  pvc.ConfigurationDialogTypeMap[pvc.ConfigurationDialogType.Preferences] = { iconClass: "icon30x30", icon: "wrench-icon-30x30", dialogClass: "configuration-dialog", exitButton: true };
  pvc.ConfigurationDialogTypeMap[pvc.ConfigurationDialogType.PlusNew] = { iconClass: "icon30x30", icon: "plus-sign-icon-30x30", dialogClass: "configuration-dialog", exitButton: true };
  pvc.ConfigurationDialogTypeMap[pvc.ConfigurationDialogType.Export] = { iconClass: "icon30x30", icon: "share-icon-30x30", dialogClass: "configuration-dialog", exitButton: true };
  pvc.ConfigurationDialogTypeMap[pvc.ConfigurationDialogType.Edit] = { iconClass: "icon34x30", icon: "edit-icon-34x30", dialogClass: "configuration-dialog", exitButton: true };

  pvc.isWarningOrErrorDialogShowing = function() {
    var warningClass = pvc.StandardDialogTypeMap[pvc.StandardDialogType.Warning].dialogClass;
    var errorClass = pvc.StandardDialogTypeMap[pvc.StandardDialogType.Error].dialogClass;

    return ($('.' + warningClass).length !== 0) ||
           ($('.' + errorClass).length !== 0);
  };

  $.widget("Planview.standarddialog", $.Planview.pvdialog,
    {
      options: {
        widgetId: "standarddialog",
        
        dialogType: pvc.StandardDialogType.Information,
        dialogMap: pvc.StandardDialogTypeMap,

        title: 'Standard Dialog',
        content: 'This is a standard dialog. Change this content by setting the "content" option.',

        
        finishingButtonType: pvc.FinishingButton.Ok,
        exitButtonType: pvc.ExitButton.Cancel,

        
        showSuppressDialogOption: false,

        modal: true,
        resizable: false,
        zIndex: 10000,
        width: 450,
        debug: false,
        finishingButtonEnabled: true,

        
        close: function (event, data) {
          $(this).remove();
        },
        
        
        contentContainerSized: undefined
      },

      

      _create: function () {
        var self, $iconContainer, $contentContainer, $dialogContainer;
        self = this;

        this.baseId = "standard-dialog-" + uuid++;

        
        if (this.options.contentWidth) { this.options.width = this.options.contentWidth + 50; }

        
        if (this.options.message) {
          this.options.content = this.options.message;
          console.log("DIALOG USING MESSAGE");
        }

        $iconContainer = this._getIcon().ContainerWidget({ width: 60, debug: this._getDebugOption() }).data().ContainerWidget;
        $contentContainer = this._getContent().ContainerWidget({ debug: this._getDebugOption() }).data().ContainerWidget;
        $dialogContainer = this._getDialogContainer().ContainerWidget(
          { debug: this._getDebugOption() }).data().ContainerWidget;
        $dialogContainer.layoutManager.loadContainer({
          west: $iconContainer,
          center: $contentContainer
        });

        this.element.append($dialogContainer.element);

        $.Planview.pvdialog.prototype._create.call(this);

        this._setOption("dialogClass", "pvdialog " + this.options.dialogMap[this.options.dialogType].dialogClass);
        this._setOption("buttons", this._createDialogButtons(this.options.finishingButtonEnabled));
        this._setOption("bottomTrayElements", this._createSuppressDialogButton());
        this._setOption("showSuppressDialogOption", this.options.showSuppressDialogOption);
        $(this.element).on(this.options.widgetId + "resizestop", function () {
          self._layoutContent();
        });

        $(this.element).on(this.options.widgetId + "open", function () {
          self._layoutContent();
        });

        $contentContainer.element.on('containerwidgetsized', null, { that: this }, this._onContentContainerSized);
        this.$iconContainer = $iconContainer;
        this.$contentContainer = $contentContainer;
      },

      hasOpenedFlagHack: false, 
      hasOpenedMagicNumberHack: 6,
      

      


      _onContentContainerSized: function(event, data) {
        var that = event.data.that;
        
        if (that.options.contentContainerSized)
          that.options.contentContainerSized({ width: data.calculatedWidth, height: data.calculatedHeight, widget:that });
      },

      

      _layoutContent: function () {
        var $widget, $titleTray, $buttonTray, $dialogContainer,
            widgetHeight, widgetWidth, titleBarHeight, buttonTrayHeight, height, width;

        $widget = this.widget();
        $titleTray = $($widget.find(this.options.selectors.titleBar));
        $buttonTray = $($widget.find(this.options.selectors.buttonTray));

        widgetWidth = $widget.outerWidth() - $("." + "ui-resizable-e").outerWidth() - $("." + "ui-resizable-w").outerWidth();
        widgetHeight = $widget.outerHeight(true) - $("." + "ui-resizable-n").outerHeight() - $("." + "ui-resizable-s").outerHeight();
        if (this.hasOpenedFlagHack) {
          
          
          
          widgetHeight -= this.hasOpenedMagicNumberHack;
        }
        this.hasOpenedFlagHack = true;
        titleBarHeight = $titleTray.outerHeight();
        buttonTrayHeight = $buttonTray.outerHeight();

        

        height = widgetHeight - titleBarHeight - buttonTrayHeight;

        
        width = widgetWidth - (this.options.resizable ? 4 : 20);
        console.log(this.baseId + " width: " + width + " height: " + height);

        
        $dialogContainer = $("#" + this._getDialogContainerId(), this.element).ContainerWidget().data().ContainerWidget;
        $dialogContainer.layoutManager.layout(width, height);
      },

      

      _setOption: function (option, value) {
        $.Planview.pvdialog.prototype._setOption.call(this, option, value);

        switch (option) {
          case "showSuppressDialogOption":
            {
              this._setShowSuppressDialogOption(value);
              break;
            }
        }
      },

      


      _setShowSuppressDialogOption: function (value) {
        var $container = $("#" + this.getSuppressContainerId());

        value ? $container.show() : $container.hide();
      },

      getSuppressContainerId: function () {
        return this.baseId + '-suppress-container-';
      },

      


      _createSuppressDialogButton: function () {
        
        var suppressDialogMessage = "Don't show this message again";

        var markup =
          ['<div id="' + this.getSuppressContainerId() + '">' +
            '<input id="suppressDialog" type="checkbox">' +
            '<label for="suppressDialog">' + suppressDialogMessage + '</label>' +
          '</div>']
        ;

        return markup;
      },

      


      _createDialogButtons: function (finishingButtonEnabled) {
        var buttons = [];

        if (this.options.dialogMap[this.options.dialogType].exitButton) {
          buttons.push(this._createExitButton(this.options.exitButtonType));
        }

        buttons.push(this._createFinishingButton(this.options.finishingButtonType, finishingButtonEnabled));

        return buttons;
      },

      



      _createFinishingButton: function (finishingButtonType, finishingButtonEnabled) {
        return {
          text: pvc.ButtonMap[finishingButtonType].text,
          'class': pvc.ButtonMap[finishingButtonType].style,
          click: this._finishHandler,
          disabled: !finishingButtonEnabled
        };
      },

      



      _createExitButton: function (exitButtonType) {
        return {
          text: pvc.ButtonMap[exitButtonType].text,
          'class': pvc.ButtonMap[exitButtonType].style,
          click: this._exitHandler
        };
      },

      _getDialogContainerId: function () {
        return this.baseId + "-container";
      },

      



      _getDialogContainer: function () {
        var markup = '<div id="' + this._getDialogContainerId() + '" class="dialog-content-wrapper" ></div>';

        return $(markup);
      },

      


      _getIcon: function () {
        var iconClass, icon, markup, $iconContainer;

        iconClass = this.options.dialogMap[this.options.dialogType].iconClass;
        icon = this.options.dialogMap[this.options.dialogType].icon;
        markup = '<div id="' + this.baseId + '-icon" class="dialog-container-widget">' +
                   '<div class="dialog-container-content-table icon-table">' +
                     '<div class="dialog-container-content-cell icon">' +
                       '<span class="icon ' + iconClass + ' pv-dialog-icon ' + icon + ' "></span>' +
                     '</div>' +
                   '</div>' +
                 '</div>';

        $iconContainer = $(markup);
        return $iconContainer;
      },

      


      _getContent: function () {
        var markup, $content, content, $contentContainer, contentBorderClass;

        contentBorderClass = this.options.contentBorder ? " contentBorder" : "";
        content = this.options.content;
        
        $content = typeof content === "string"
          ? content.substring(0, 1) === '<' ? $(content) : $("<span>" + content + "</span>")
          : content;


        markup = '<div  id="' + this.baseId + '-content" class="dialog-container-widget">' +
                   '<div class="dialog-container-content-table' + contentBorderClass + '">' +
                     '<div class="dialog-container-content-cell">' +
                       '<div class="dialog-text">' +
                       '</div>' +
                     '</div>' +
                   '</div>' +
                 '</div>';

        $contentContainer = $(markup);
        $(".dialog-text", $contentContainer).append($content);

        return $contentContainer;
      },

      



      _finishHandler: function (event) {
        var widget = $(this).data().standarddialog;

        
        var data = {};
        data.buttonType = widget.options.finishingButtonType;
        widget._fireOnFinish(event, data, widget);
      },

      



      _exitHandler: function (event) {
 
        var widget = $(this).data().standarddialog;

        
        var data = {};
        data.buttonType = widget.options.exitButtonType;

        widget._fireOnFinish(event, data, widget);
      },

      _getDebugOption: function () {
        return this.options.debug ? true : false;
      },

      




      _fireOnFinish: function (event, data, widget) {
        
        data.showingSuppressDialogOption = widget.options.showSuppressDialogOption;
        data.shouldSuppressDialog = $('#suppressDialog').is(':checked');
        data.widget = widget;
        
        widget._trigger('onFinish', event, data);
        widget.close();
      },

      setFinishingButtonEnablement: function (enabled) {
        this._setOption("buttons", this._createDialogButtons(enabled));

      }
    });

  $.widget("Planview.configdialog", $.Planview.standarddialog,
    {
      options: {
        widgetId: "configdialog",
        dialogType: pvc.ConfigurationDialogTypeMap.Standard,
        dialogMap: pvc.ConfigurationDialogTypeMap,
        resizable: true,
        closeOnFinish: false,
        contentBorder: false
      },
      _create: function () {
        $.Planview.standarddialog.prototype._create.call(this);
      },


      


      _exitHandler: function (event) {
        var widget, data;

        widget = $(this).data().configdialog;

        
        data = {};
        data.buttonType = widget.options.exitButtonType;
        widget._fireOnFinish(event, data, widget);
      },

      



      _finishHandler: function (event) {
        var widget, data, configOptions, genId, elId;

        genId = 0;
        widget = $(this).data().configdialog;

        
        data = {};
        data.buttonType = widget.options.finishingButtonType;
        if ("save" === data.buttonType) {
          configOptions = {};
          configOptions.ids = [];
          $("input, select", $(this)).each(function (i, e) {
            if (e.id) {
              elId = e.id; 
            }
            else {
              elId = e.type + genId++;
              console.log("ConfigDialog: Missing id on element");
            }
            configOptions.ids.push(elId);

            
            configOptions[elId] = "checkbox" == e.type || "radio" == e.type ? e.checked : e.value;
          });
          data.configOptions = configOptions;
          
        }
        widget._fireOnFinish(event, data, widget);
      },

      




      _fireOnFinish: function (event, data, widget) {
        
        data.showingSuppressDialogOption = widget.options.showSuppressDialogOption;
        data.shouldSuppressDialog = $('#suppressDialog').is(':checked');
        data.widget = widget;
        
        widget._trigger('onFinish', event, data);

        
        
        if (widget.options.closeOnFinish) {
          widget.close();
        }
      }
    });

})(jQuery);

;

;
(function ($, undefined) {
  'use strict';

  Planview.RegisterNamespace("Planview.Core");
  var pvc = Planview.Core;

  pvc.TheDialogFactory = function() {

    


    var make = function (spec) {
      var metaType, dialog;
      metaType = spec.metaType ? spec.metaType : pvc.DialogMetaType.Standard;
      
      switch (metaType) {
        case pvc.DialogMetaType.Config:
          dialog = $('<div></div>').configdialog(spec);
          break;
        case pvc.DialogMetaType.Standard:
        default:
          dialog = $('<div></div>').standarddialog(spec);
          break;
      }
      return dialog;
    };
    
    var that = {};
    that.make = make;
    
    return that;
  };

})(jQuery);

;

(function ($) {
  Planview.RegisterNamespace("Planview.FinancialPlanningContext");

  Planview.FinancialPlanningContext = {
    WorkingVersion: { Id: null, Description: null },
    ComparisonVersion: { Id: null, Description: null },
    Model: { Id: null, Description: null, HorizonDescription: null, SummationAllowed: false },
    Currency: { Code: null, Country: null },
    ComparisonOn: false,
    Warning: null
  };

  $.widget("Planview.FpVersionControl",
  {
    FpvcMenu: {},
    fpVersionControlPopup: {},
    options: {},
    modelSelector: null,
    workingVersionSelector: null,
    comparisonVersionSelector: null,
    excelMenuHelper: {},
      
    _create: function () {
      FpvcMenu = PvMenuHelper._create({
        triggerEl: this.options.triggerElement,
        id: "fpVersionControl-",
        origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
        popupCssClass: "pvPopup subBanner",
        animateOpen: true
      });

      this.overrideOptions();
      this.refreshMenu();
      if (this.options.IsImportExportAllowed) {
        excelMenuHelper = this.populateExcelDropDown();
      }
    },

    resetOptions: function(newOptions) {
      this.options = newOptions;
      this.overrideOptions();
      this.refreshMenu();
    },
    
    overrideOptions: function () {
      
      if (Planview.FinancialPlanningContext != undefined) {
        if (Planview.FinancialPlanningContext.Model != undefined) {
          this.options.ModelId = Planview.FinancialPlanningContext.Model.Id;
        }
        if (Planview.FinancialPlanningContext.WorkingVersion != undefined) {
          this.options.VersionId = Planview.FinancialPlanningContext.WorkingVersion.Id;
        }
        if (Planview.FinancialPlanningContext.ComparisonVersion != undefined) {
          this.options.ComparisonVersionId = Planview.FinancialPlanningContext.ComparisonVersion.Id;
        }

        this.enableComparisonMode(Planview.FinancialPlanningContext.ComparisonOn);
      }
    },
    
    refreshMenu: function () {
      setTimeout(function () {
        window.pvWaitingIndicator.showBodyShield();
        Planview.FpVersionTooltipHelper.hide();
      }, 400);

      FpvcMenu.setOnAfterHide(function () {
        setTimeout(function () {
          if ($('.mainTabMenu:visible').length < 1) {
            window.pvWaitingIndicator.hideBodyShield(); 
          }
        }, 600);
      });
      FpvcMenu.showMenu(this.createWidgetMarkup());
      this.enableComparisonMode(this.options.ComparisonOn);
      this.populateDropDowns();
      this.attachEvents();
    },

    toggle: function () {
      if ($("#pv-FpVersionControl-Wrapper").is(":visible")) {
        FpvcMenu.hideMenu();
        window.pvWaitingIndicator.hideBodyShield();
      } else {
        this.show();
      }
    },
    
    show: function () {
      setTimeout(function () {
        window.pvWaitingIndicator.showBodyShield();
        Planview.FpVersionTooltipHelper.hide();
      }, 400);
      
      FpvcMenu.showMenu();
      this.populateDropDowns();
      this.attachEvents();
    },
    
    attachEvents: function() {
      var that = this;

      if (this.options.IsPortfolioLoadable == "true") {
        $("#pv-FpVersionControl-load-button").removeClass("disabledText");
        $("#pv-FpVersionControl-load-button").on("click", function() {
          if (that.options.LoadUrl && that.options.LoadUrl != "") {
            that.toggle();
            ModalWindowHelper.OpenModalWindow('LoadVersion', that.options.rootUrl + that.options.LoadUrl, null, null, null, null, false);
          }
        });
      }

      if (this.options.IsImportExportAllowed) {
        $("#pv-FpVersionControl-excel-button").removeClass("disabledText");
        $("#pv-FpVersionControl-excel-button").on("click", function () {
          if ($("#excelOptionspvPopup").is(":visible")) {
            excelMenuHelper.hideMenu();
          } else {
            excelMenuHelper.showMenu(null, this, this);
          }
        });
      }

      $("#pv-FpVersionControl-comparisonBehavior-comparisonOnButton").on("click", function () {
        that.enableComparisonMode(true);
      });
      
      $("#pv-FpVersionControl-comparisonBehavior-comparisonOffButton").on("click", function () {
        that.enableComparisonMode(false);
      });

      $("#pv-FpVersionControl-apply-button").on("click", function () {
        var versionsForCurrentModel = that.getVersionsForCurrentModel();

        if (that.modelSelector != undefined) {
          that.options.ModelId = that.modelSelector.selectedItem.value;
          Planview.FinancialPlanningContext.Model.Id = that.modelSelector.selectedItem.value;
          Planview.FinancialPlanningContext.Model.Description = that.modelSelector.selectedItem.displayText;
          Planview.FinancialPlanningContext.Model.HorizonDescription = that.modelSelector.selectedItem.HorizonDescription;
          Planview.FinancialPlanningContext.Model.SummationAllowed = that.modelSelector.selectedItem.SummationAllowed;
        }

        if (that.workingVersionSelector != undefined) {
          Planview.FinancialPlanningContext.WorkingVersion.Id = that.workingVersionSelector.selectedItem.value;
          Planview.FinancialPlanningContext.WorkingVersion.Description = that.workingVersionSelector.selectedItem.displayText;
        } else {
          if (versionsForCurrentModel.length > 0) {
            Planview.FinancialPlanningContext.WorkingVersion.Id = versionsForCurrentModel[0].key; 
            Planview.FinancialPlanningContext.WorkingVersion.Description = versionsForCurrentModel[0].value;
          }
        }
        
        if (that.comparisonVersionSelector != undefined) {
          Planview.FinancialPlanningContext.ComparisonVersion.Id = that.comparisonVersionSelector.selectedItem.value;
          Planview.FinancialPlanningContext.ComparisonVersion.Description = that.comparisonVersionSelector.selectedItem.displayText;
        } else {
          if (versionsForCurrentModel.length > 0) {
            Planview.FinancialPlanningContext.ComparisonVersion.Id = versionsForCurrentModel[0].key; 
            Planview.FinancialPlanningContext.ComparisonVersion.Description = versionsForCurrentModel[0].value;
          }
        }

        Planview.FinancialPlanningContext.ComparisonOn = that.options.ComparisonOn;

        $.each(versionsForCurrentModel, function (versionIndex, versionKeyPair) {
          if (versionKeyPair.key == Planview.FinancialPlanningContext.WorkingVersion.Id) {
            $("#banner-title-bar-fp-preference-button-text").html(versionKeyPair.value); 
          }
        });

        that.options.VersionId = Planview.FinancialPlanningContext.WorkingVersion.Id;
        that.options.ComparisonVersionId = Planview.FinancialPlanningContext.ComparisonVersion.Id;
        
        Planview.FpVersionTooltipHelper.handleUpdate();

        var universalProxy = new serviceHelper.jsonServiceProxy(that.options.rootUrl + 'services/UniversalPortfolioQueryServiceJSON.svc/');
        universalProxy.invoke("SaveFinancialPlanningPreferences",
          {
            versionId: Planview.FinancialPlanningContext.WorkingVersion.Id,
            comparisonVersionId: Planview.FinancialPlanningContext.ComparisonVersion.Id,
            comparisonOn: Planview.FinancialPlanningContext.ComparisonOn
          },
          function () {
            that.toggle();
            if (window.RefreshWithoutCacheDrop) {
              window.RefreshWithoutCacheDrop();
            };
            that.destroy();
          },
          function (err) { alert("Error getting financial version control: " + err); });
      });
    },
    
    enableComparisonMode: function (fEnable) {
      this.options.ComparisonOn = fEnable;

      var $onButton = $("#pv-FpVersionControl-comparisonBehavior-comparisonOnButton");
      var $offButton = $("#pv-FpVersionControl-comparisonBehavior-comparisonOffButton");
      
      if (fEnable) {
        $onButton.removeClass("gray-button").addClass("blue-button");
        $offButton.removeClass("blue-button").addClass("gray-button");
      }
      else {
        $offButton.removeClass("gray-button").addClass("blue-button");
        $onButton.removeClass("blue-button").addClass("gray-button");
      }
    },

    destroy: function () {
      this.options.markWidgetAsStale(); 
    },

    createWidgetMarkup: function () {
      var markup =
        '<div id="pv-FpVersionControl-Wrapper" class="pvPopup-content-container" style="background-color: white; font-weight:normal; color: black !important;">' +
          '<div style="padding:10px; border-bottom: 1px solid #474747;">' +
            '<div>' + this.options.ModelLabel + '</div>';

      if (this.options.Models.length < 2) {
        markup += '<div style="font-weight:normal; display:inline-block; width: 320px; text-overflow:ellipsis; overflow:hidden; white-space: nowrap;" title="' + this.options.ModelDescription + '">' +
                    '<span id="pv-FpVersionControl-model">' +
                     this.options.ModelDescription +
                    '</span>' +
                  '</div>';
      } else {
        markup +=
      '<div style="font-weight:normal;">' +
        '<span id="pv-FpVersionControl-model" class="pvSelectContainer tertiary form-field">' +
          '<span class="selectedText" style="display:inline-block; width: 300px; text-overflow:ellipsis; overflow:hidden;"></span>' +
          '<span class="affordance" style="display:inline-block; float:right; padding-top:5px; padding-right:2px;">▼</span>' +
        '</span>' +
      '</div>';
      }

      markup +=
        '<div style="padding-top: 10px;">' + this.options.VersionLabel + '</div>' +
        '<div id="pv-FpVersionControl-version-div" style="font-weight:normal; display:inline-block;"></div>' +
        '<div style="padding-top: 10px;">' + this.options.ComparisonButtonLabel + '</div>' +
        '<div>' +
        '<button id="pv-FpVersionControl-comparisonBehavior-comparisonOffButton" class="button11 tertiary blue-button toggle-button toggle-button-left" type="button">' +
          this.options.ComparisonButtonOffLabel +
          '</button>' +
          '<button id="pv-FpVersionControl-comparisonBehavior-comparisonOnButton" class="button11 tertiary gray-button toggle-button toggle-button-right" type="button">' +
          this.options.ComparisonButtonOnLabel +
          '</button>' +
          
        '</div>' +
        '<div style="padding-top: 10px;">' + this.options.ComparisonVersionLabel + '</div>' +
        '<div id="pv-FpVersionControl-comparison-version-div" style="font-weight:normal; display:inline-block;"></div>' +
        '<div style="text-align: right; padding-top: 10px;">' +
          '<span id="pv-FpVersionControl-apply-button" class="button11 green-button">' + this.options.ApplyButtonLabel + '</span>' +
        '</div>' +
      '</div>' +
      '<div style="text-align: right;">';

      if (this.options.IsImportExportAllowed) {
        markup += '<span id="pv-FpVersionControl-excel-button" class="button11 gray-button disabledText" style="float:left;">' + this.options.ExcelButtonLabel + '<span class="affordance">&#9660;</span>' + '</span>';
      }

      if (this.options.IsPortfolioLoadable == "true") {
        if (this.options.LoadUrl && this.options.LoadUrl != "") {
          markup += ' <span id="pv-FpVersionControl-load-button" class="button11 gray-button">' + this.options.LoadButtonLabel + '</span>';
        } else {
          markup += ' <span id="pv-FpVersionControl-load-button-disabled" class="button11 gray-button disabledText" title="' + this.options.LoadDeniedReason + '">' + this.options.LoadButtonLabel + '</span>';
        }
      }

      markup+=
      '</div>' +
    '</div>';
      
      return markup;
    },
    
    populateDropDowns: function () {
      if (this.modelSelector && this.modelSelector.destroy) {
        this.modelSelector.destroy();
      }
      this.modelSelector = this.populateModelDropDown();
      
      this.repopulateVersionDropDowns();
    },
    
    populateModelDropDown: function() {
      var that = this;
      var selectedItem;
      var modelItems = [];
      var modelClickAction = function (args) {
        args[0].originalEvent.stopImmediatePropagation();  
        that.repopulateVersionDropDowns();
        $("#pv-FpVersionControl-load-button").addClass("disabledText");
        $("#pv-FpVersionControl-load-button").off("click");
        $("#pv-FpVersionControl-excel-button").addClass("disabledText");
        $("#pv-FpVersionControl-excel-button").off("click");
      };

      $.each(this.options.Models, function(index, jsstring) {
        var model = eval('(' + jsstring + ')');
        
        var item = {
          displayText: model.Description,
          value: model.Id,
          clickAction: modelClickAction,
          afterSelect: FpvcMenu.positionOnOriginElement,
          HorizonDescription: model.HorizonDescription,
          SummationAllowed: model.SummationAllowed
        };
        if (model.Id == that.options.ModelId) {
          selectedItem = item;
        }

        modelItems.push(item);
      });

      var modelSelectMenuHelper = pvSelectMenuHelper._create({
        triggerEl: $("#pv-FpVersionControl-model"),
        id: "modelOptions",
        selectItems: modelItems,
        popupCssClass: "pvPopup",
        selectCssClass: "pvSelectMenu"
      });

      modelSelectMenuHelper.populateSelect();

      if (selectedItem) {
        modelSelectMenuHelper.setSelection(selectedItem, true);
      }

      return modelSelectMenuHelper;
    },
    
    repopulateVersionDropDowns: function () {
      if (this.workingVersionSelector != undefined && this.workingVersionSelector.destroy != undefined) {
        this.workingVersionSelector.destroy();
      }

      if (this.comparisonVersionSelector != undefined && this.comparisonVersionSelector.destroy != undefined) {
        this.comparisonVersionSelector.destroy();
      }
      
      this.workingVersionSelector = this.populateVersionDropDown("pv-FpVersionControl-version-div", "pv-FpVersionControl-version",this.options.VersionId);
      this.comparisonVersionSelector = this.populateVersionDropDown("pv-FpVersionControl-comparison-version-div", "pv-FpVersionControl-comparison-version",this.options.ComparisonVersionId);
    },

    populateVersionDropDown: function (versionDivId, versionDropDownId, selectedVersionId) {
      var versionsForCurrentModel = this.getVersionsForCurrentModel();
      
      if (versionsForCurrentModel.length == 0) {
        
        return nullTexts;
      }

      if (versionsForCurrentModel.length > 1) {
        $("#" + versionDivId).html(
          '<span id="' + versionDropDownId + '" class="pvSelectContainer tertiary form-field">' +
            '<span class="selectedText" style="display:inline-block; width: 300px; text-overflow:ellipsis; overflow:hidden;"></span>' +
            '<span class="affordance" style="display:inline-block; float:right; padding-top:5px; padding-right:2px;">▼</span>' +
          '</span>');
      } else {
        $("#" + versionDivId).html(
          '<div style="font-weight:normal; display:inline-block; width: 300px; text-overflow:ellipsis; overflow:hidden; white-space: nowrap;" title="' + versionsForCurrentModel[0].value + '">' +
             versionsForCurrentModel[0].value +
          '</div>');

        return null;
      }

      var selectedItem;
      var versionItems = [];
      var versionClickAction = function (args) {
        args[0].originalEvent.stopImmediatePropagation(); 
        $("#pv-FpVersionControl-load-button").addClass("disabledText");
        $("#pv-FpVersionControl-load-button").off("click");
        $("#pv-FpVersionControl-excel-button").addClass("disabledText");
        $("#pv-FpVersionControl-excel-button").off("click");
      };

      $.each(versionsForCurrentModel, function (index, keyPair) {
        var item = {
          displayText: keyPair.value,
          value: keyPair.key,
          clickAction: versionClickAction,
          afterSelect: FpvcMenu.positionOnOriginElement
        };
        if (keyPair.key == selectedVersionId) {
          selectedItem = item;
        }
        
        if (!selectedItem) {
          selectedItem = item; 
        }

        versionItems.push(item);
      });

      var versionSelectMenuHelper = pvSelectMenuHelper._create({
        triggerEl: $("#" +versionDropDownId),
        id: versionDropDownId + "-Options",
        selectItems: versionItems,
        popupCssClass: "pvPopup",
        selectCssClass: "pvSelectMenu"
      });

      versionSelectMenuHelper.populateSelect();

      if (selectedItem) {
        versionSelectMenuHelper.setSelection(selectedItem, true);
      }

      return versionSelectMenuHelper;
    },

    getVersionsForCurrentModel: function () {
      var that = this;
      var versions = [];

      var currentModelId;
      if (that.modelSelector == undefined) {
        currentModelId = that.options.ModelId;
      } else {
        currentModelId = that.modelSelector.selectedItem.value;
      }

      $.each(this.options.Versions, function (modelIndex, modelKeyPair) {
        if (modelKeyPair.key == currentModelId) {
          $.each(modelKeyPair.value, function (versionIndex, versionKeyPair) {
            versions.push(versionKeyPair);
          });
        }
      });

      return versions;
    },
    
    populateExcelDropDown: function () {
      var menuItems = [];
      var that = this;

      menuItems.push(
        {
          displayText: this.options.ExportToExcelLabel,
          value: "export",
          clickAction: function (args) {
            OpenChildWindow(that.options.rootUrl + "ifm/ImportExport/ExportXmlFileMessage.aspx", "ExportMessage", 450, 250, 200, 200);
            document.location.href = that.options.rootUrl + "ifm/ImportExport/ExportXmlFile.aspx?mode=portfolio&portfolioCode=" + that.options.PortfolioCode + "&versionId=" + that.options.VersionId;
          },
          afterSelect: FpvcMenu.positionOnOriginElement
        });

      menuItems.push(
        {
          displayText: this.options.ImportFromExcelLabel,
          value: "import",
          clickAction: function (args) {
            ModalWindowHelper.OpenModalWindow("ImportFromExcel",
                                              that.options.rootUrl + "ifm/ImportExport/ImportFileDialog.aspx?mode=portfolio&portfolioCode=" + that.options.PortfolioCode + "&versionId=" + that.options.VersionId + "&importType=Financial",
                                               550, 105, null, null, false);
          },
          afterSelect: FpvcMenu.positionOnOriginElement
        });
      
      menuItems.push(
        {
          displayText: this.options.ReviewXmlImportsAndExportsLabel,
          value: "log",
          clickAction: function (args) {
            document.location.href = that.options.rootUrl + "ifm/ImportExport/ViewImportsAndExports.aspx?logType=Financial";
          },
          afterSelect: FpvcMenu.positionOnOriginElement
        });

      var excelSelectMenuHelper = pvSelectMenuHelper._create({
        triggerEl: $("#pv-FpVersionControl-excel-button"),
        id: "excelOptions",
        selectItems: menuItems,
        popupCssClass: "pvPopup",
        selectCssClass: "pvSelectMenu",
        selectDefault: false
      });

      excelSelectMenuHelper.populateSelect();

      return excelSelectMenuHelper;
    }
  });
})(jQuery);

(function ($, undefined) {
  var tooltip,
      $fpSettingsTooltipTrigger,
      titleLabel,
      modelLabel,
      planningHorizonLabel,
      currencyLabel,
      versionLabel,
      context,
      staleData;

  context = Planview.FinancialPlanningContext;

  Planview.FpVersionTooltipHelper = {
    activate: function () {
      if (isNullOrUndefined(tooltip) || staleData) {
        if (staleData && tooltip) {
          tooltip.destroy();
          tooltip = null;
        }
        tooltip = PvTooltipHelper._create({
          triggerEl: $fpSettingsTooltipTrigger,
          origins: { baseOrigin: "bottom right", popupOrigin: "top right" },
          id: "FpVersionTooltip",
          content: this.getTooltipMarkup(),
          title: this.getTitleLabel(),
          animateOpen: true
        });
      };

      if ($("#pv-FpVersionControl-Wrapper").is(":visible")) {
        tooltip.hide();
      } else {
        if (!tooltip.showing) {
          tooltip.show();
        }
      }
      staleData = false;
    },
    handleTriggerClick: function() {
      if(!isNullOrUndefined(tooltip) && tooltip.showing){
        tooltip.hide();
      }
    },
    hide: function() {
      tooltip.hide();
    },

    handleUpdate: function(){
      staleData = true;
    },

    getTooltipMarkup: function(){
      return this.getFpSettingsMarkup();
    },

    getFpSettingsMarkup: function(fpSettingsDto){
      var markup;

      markup = !Planview.isNullOrEmpty(context.Warning)
             ?  [
                 "<table>",
                   "<tr>",
                     "<td colspan='2'>" + context.Warning + "</td>",
                   "</tr>",
                   "<tr>",
                     "<td class='tooltip-label'>",
                       "<span>" + this.getCurrencyLabel() + ":</span>",
                     "</td>",
                     "<td class='tooltip-text'>",
                       "<span id='fpTooltipCurrencyText' title='" + this.getCurrencyText() + "'>" + this.getCurrencyText() + "</span>",
                     "</td>",
                   "</tr>",
                   "<tr>",
                 "</table>"
              ].join('')
        
             :  [
                 "<table>",
                   "<tr>",
                     "<td class='tooltip-label'>",
                       "<span>" + this.getModelLabel() + ":</span>",
                     "</td>",
                     "<td class='tooltip-text'>",
                       "<span id='fpTooltipModelText' title='" + this.getModelText() + "'>" + this.getModelText() + "</span>",
                     "</td>",
                   "</tr>",
                   "<tr>",
                     "<td class='tooltip-label'>",
                       "<span>" + this.getPlanningHorizonLabel() + ":</span>",
                     "</td>",
                     "<td class='tooltip-text'>",
                       "<span id='fpTooltipPlanningHorizonText' title='" + this.getPlanningHorizonText() + "'>" + this.getPlanningHorizonText() + "</span>",
                     "</td>",
                   "</tr>",
                   "<tr>",
                     "<td class='tooltip-label'>",
                       "<span>" + this.getCurrencyLabel() + ":</span>",
                     "</td>",
                     "<td class='tooltip-text'>",
                       "<span id='fpTooltipCurrencyText' title='" + this.getCurrencyText() + "'>" + this.getCurrencyText() + "</span>",
                     "</td>",
                   "</tr>",
                   "<tr>",
                     "<td class='tooltip-label'>",
                       "<span>" + this.getVersionLabel() + ":</span>",
                     "</td>",
                     "<td class='tooltip-text'>",
                       "<span id='fpTooltipVersionText' title='" + this.getVersionText() + "'>" + this.getVersionText() + "</span>",
                     "</td>",
                   "</tr>",
                 "</table>"
               ].join('');

      return markup;
    },
    updateTooltip: function(){
      $("#fpTooltipModelText", tooltip.$div).html(this.getModelText()).attr("title", this.getModelText());
      $("#fpTooltipPlanningHorizonText", tooltip.$div).html(this.getPlanningHorizonText()).attr("title", this.getPlanningHorizonText());
      $("#fpTooltipCurrencyText", tooltip.$div).html(this.getCurrencyText()).attr("title", this.getCurrencyText());
      $("#fpTooltipVersionText", tooltip.$div).html(this.getVersionText()).attr("title", this.getVersionText());
    },
    getTitleLabel: function(){
      if (isNullOrUndefined(titleLabel)) {
        titleLabel = Planview.ResourceManager.GetString("Common.CommonFinancialPlanSettings");
      }
      return titleLabel;
    },
    getModelLabel: function () {
      if (isNullOrUndefined(modelLabel)) {
        modelLabel = Planview.ResourceManager.GetString("Common.CommonModel");
      }
      return modelLabel;
    },
    getModelText: function(){
      return context.Model.Description;
    },
    getPlanningHorizonLabel: function () {
      if (isNullOrUndefined(planningHorizonLabel)) {
        planningHorizonLabel = Planview.ResourceManager.GetString("Common.CommonPlanningHorizon");
      }
      return planningHorizonLabel;
    },
    getPlanningHorizonText: function(){
      return context.Model.HorizonDescription;
    },
    getCurrencyLabel: function () {
      if (isNullOrUndefined(currencyLabel)) {
        currencyLabel = Planview.ResourceManager.GetString("Common.CommomCurrency");
      }
      return currencyLabel;
    },
    getCurrencyText: function(){
      return context.Currency.Code + " (" + context.Currency.Country + ")";
    },
    getVersionLabel: function () {
      if (isNullOrUndefined(versionLabel)) {
        versionLabel = Planview.ResourceManager.GetString("Common.CommonVersion");
      }
      return versionLabel;
    },
    getVersionText: function () {
      return context.WorkingVersion.Description;
    }
  }

  $(document).ready(function () {
    var mouseEnterTimer;
    var mouseLeaveHandler;
    var timerDelay;

    timerDelay = 450;
    mouseLeaveHandler = function () {
      
      clearTimeout(mouseEnterTimer);
    };

    
    $fpSettingsTooltipTrigger = $("#fp-preferenceContainer");
    $fpSettingsTooltipTrigger.on("mouseenter", function () {
      mouseEnterTimer = setTimeout(function () {
        Planview.FpVersionTooltipHelper.activate();
        $fpSettingsTooltipTrigger.off("mouseleave", mouseLeaveHandler);
      }, timerDelay);
      $fpSettingsTooltipTrigger.one("mouseleave", mouseLeaveHandler);
    });
    $fpSettingsTooltipTrigger.on("click", function () { Planview.FpVersionTooltipHelper.handleTriggerClick(); });
  });

})(jQuery);

/*! jQuery Timepicker Addon - v1.4.4 - 2014-03-29
* http://trentrichardson.com/examples/timepicker
* Copyright (c) 2014 Trent Richardson; Licensed MIT */
(function ($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.4.4"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function () {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			timeOnlyShowDate: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			maxTime: null,
			minTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		maxTime: null,
		minTime: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour', 'minute', 'second', 'millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @param  {Object} settings  object - the new settings to use as defaults (anonymous object)
		* @return {Object} the manager object
		*/
		setDefaults: function (settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function ($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
				fns = {},
				overrides, i;

			for (var attrName in this._defaults) {
				if (this._defaults.hasOwnProperty(attrName)) {
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

			overrides = {
				beforeShow: function (input, dp_inst) {
					if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
						return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
					}
				},
				onChangeMonthYear: function (year, month, dp_inst) {
					// Update the time as well : this prevents the time from disappearing from the $input field.
					tp_inst._updateDateTime(dp_inst);
					if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
						tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
					}
				},
				onClose: function (dateText, dp_inst) {
					if (tp_inst.timeDefined === true && $input.val() !== '') {
						tp_inst._updateDateTime(dp_inst);
					}
					if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
						tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
					}
				}
			};
			for (i in overrides) {
				if (overrides.hasOwnProperty(i)) {
					fns[i] = opts[i] || null;
				}
			}

			tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
				evnts: fns,
				timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
			});
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function (val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function (val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat +
					(tp_inst._defaults.pickerTimeFormat ? tp_inst._defaults.pickerTimeFormat : '') +
					(tp_inst._defaults.altTimeFormat ? tp_inst._defaults.altTimeFormat : ''));

			// controlType is string - key to our this._controls
			if (typeof(tp_inst._defaults.controlType) === 'string') {
				if (tp_inst._defaults.controlType === 'slider' && typeof($.ui.slider) === 'undefined') {
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else {
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720, -660, -600, -570, -540, -480, -420, -360, -300, -270, -240, -210, -180, -120, -60,
					0, 60, 120, 180, 210, 240, 270, 300, 330, 345, 360, 390, 420, 480, 525, 540, 570, 600, 630, 660, 690, 720, 765, 780, 840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl = timezoneList.length, tzi = 0, tzv = null;
			if (tzl > 0 && typeof timezoneList[0] !== 'object') {
				for (; tzi < tzl; tzi++) {
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null ? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) :
							((new Date()).getTimezoneOffset() * -1);
			tp_inst.hour = tp_inst._defaults.hour < tp_inst._defaults.hourMin ? tp_inst._defaults.hourMin :
							tp_inst._defaults.hour > tp_inst._defaults.hourMax ? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute < tp_inst._defaults.minuteMin ? tp_inst._defaults.minuteMin :
							tp_inst._defaults.minute > tp_inst._defaults.minuteMax ? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second < tp_inst._defaults.secondMin ? tp_inst._defaults.secondMin :
							tp_inst._defaults.second > tp_inst._defaults.secondMax ? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec < tp_inst._defaults.millisecMin ? tp_inst._defaults.millisecMin :
							tp_inst._defaults.millisec > tp_inst._defaults.millisecMax ? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec < tp_inst._defaults.microsecMin ? tp_inst._defaults.microsecMin :
							tp_inst._defaults.microsec > tp_inst._defaults.microsecMax ? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function () {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined && tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined && tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined && tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined && tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function () {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function (dp_inst) {
			var currDT = (this.$altInput && this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function (timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function () {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i = 0,
				l = 0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 && o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '<div class="ui-timepicker-div' + (o.isRTL ? ' ui-timepicker-rtl' : '') + '"><dl>' + '<dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '>' + o.timeText + '</dt>' +
								'<dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '></dd>';

				// Create the markup
				for (i = 0, l = this.units.length; i < l; i++) {
					litem = this.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o['show' + uitem] !== null ? o['show' + uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem + 'Max'] - ((o[litem + 'Max'] - o[litem + 'Min']) % o['step' + uitem])), 10);
					gridSize[litem] = 0;

					html += '<dt class="ui_tpicker_' + litem + '_label"' + (show ? '' : noDisplay) + '>' + o[litem + 'Text'] + '</dt>' +
								'<dd class="ui_tpicker_' + litem + '"><div class="ui_tpicker_' + litem + '_slider"' + (show ? '' : noDisplay) + '></div>';

					if (show && o[litem + 'Grid'] > 0) {
						html += '<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';

						if (litem === 'hour') {
							for (var h = o[litem + 'Min']; h <= max[litem]; h += parseInt(o[litem + 'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm ? 'hht' : 'HH', {hour: h}, o);
								html += '<td data-for="' + litem + '">' + tmph + '</td>';
							}
						}
						else {
							for (var m = o[litem + 'Min']; m <= max[litem]; m += parseInt(o[litem + 'Grid'], 10)) {
								gridSize[litem]++;
								html += '<td data-for="' + litem + '">' + ((m < 10) ? '0' : '') + m + '</td>';
							}
						}

						html += '</tr></table></div>';
					}
					html += '</dd>';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null ? o.showTimezone : this.support.timezone;
				html += '<dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '>' + o.timezoneText + '</dt>';
				html += '<dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '></dd>';

				// Create the elements from string
				html += '</dl></div>';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">' + '<div class="ui-datepicker-title">' + o.timeOnlyTitle + '</div>' + '</div>');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for (i = 0, l = tp_inst.units.length; i < l; i++) {
					litem = tp_inst.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o['show' + uitem] !== null ? o['show' + uitem] : this.support[litem];

					// add the slider
					tp_inst[litem + '_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_' + litem + '_slider'), litem, tp_inst[litem], o[litem + 'Min'], max[litem], o['step' + uitem]);

					// adjust the grid and add click event
					if (show && o[litem + 'Grid'] > 0) {
						size = 100 * gridSize[litem] * o[litem + 'Grid'] / (max[litem] - o[litem + 'Min']);
						$tp.find('.ui_tpicker_' + litem + ' table').css({
							width: size + "%",
							marginLeft: o.isRTL ? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL ? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function (e) {
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g), 10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if (f === 'hour') {
									if (ap.indexOf('p') !== -1 && n < 12) {
										n += 12;
									}
									else {
										if (ap.indexOf('a') !== -1 && n === 12) {
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f + '_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid > 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('<select></select>').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function (val, idx) {
					return $("<option />").val(typeof val === "object" ? val.value : val).text(typeof val === "object" ? val.label : val);
				}));
				if (typeof(this.timezone) !== "undefined" && this.timezone !== null && this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset() * -1;
					if (local_timezone === this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) !== "undefined" && this.hour !== null && this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function () {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function () { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function () {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl ? 'marginRight' : 'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl ? 'marginRight' : 'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function (dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null && $.datepicker._get(dp_inst, 'minDateTime') !== undefined && dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour <= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute <= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second <= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if (this.millisec <= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec < this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null && $.datepicker._get(dp_inst, 'maxDateTime') !== undefined && dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour >= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute >= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second >= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec >= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec > this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (dp_inst.settings.minTime!==null) {
				var tempMinTime=new Date("01/01/1970 " + dp_inst.settings.minTime);
				if (this.hour<tempMinTime.getHours()) {
					this.hour=this._defaults.hourMin=tempMinTime.getHours();
					this.minute=this._defaults.minuteMin=tempMinTime.getMinutes();
				} else if (this.hour===tempMinTime.getHours() && this.minute<tempMinTime.getMinutes()) {
					this.minute=this._defaults.minuteMin=tempMinTime.getMinutes();
				} else {
					if (this._defaults.hourMin<tempMinTime.getHours()) {
						this._defaults.hourMin=tempMinTime.getHours();
						this._defaults.minuteMin=tempMinTime.getMinutes();
					} else if (this._defaults.hourMin===tempMinTime.getHours()===this.hour && this._defaults.minuteMin<tempMinTime.getMinutes()) {
						this._defaults.minuteMin=tempMinTime.getMinutes();
					} else {
						this._defaults.minuteMin=0;
					}
				}
			}
			
			if (dp_inst.settings.maxTime!==null) {
				var tempMaxTime=new Date("01/01/1970 " + dp_inst.settings.maxTime);
				if (this.hour>tempMaxTime.getHours()) {
					this.hour=this._defaults.hourMax=tempMaxTime.getHours();
					this.minute=this._defaults.minuteMax=tempMaxTime.getMinutes();
				} else if (this.hour===tempMaxTime.getHours() && this.minute>tempMaxTime.getMinutes()) {
					this.minute=this._defaults.minuteMax=tempMaxTime.getMinutes();
				} else {
					if (this._defaults.hourMax>tempMaxTime.getHours()) {
						this._defaults.hourMax=tempMaxTime.getHours();
						this._defaults.minuteMax=tempMaxTime.getMinutes();
					} else if (this._defaults.hourMax===tempMaxTime.getHours()===this.hour && this._defaults.minuteMax>tempMaxTime.getMinutes()) {
						this._defaults.minuteMax=tempMaxTime.getMinutes();
					} else {
						this._defaults.minuteMax=59;
					}
				}
			}
			
			if (adjustSliders !== undefined && adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10),
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax, step: this._defaults.stepHour });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax, step: this._defaults.stepMinute });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax, step: this._defaults.stepSecond });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax, step: this._defaults.stepMillisec });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax, step: this._defaults.stepMicrosec });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function () {
			if (!this._defaults.showTimepicker) {
                                return;
			}
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) === 'object') {
				hour = false;
			}
			if (typeof(minute) === 'object') {
				minute = false;
			}
			if (typeof(second) === 'object') {
				second = false;
			}
			if (typeof(millisec) === 'object') {
				millisec = false;
			}
			if (typeof(microsec) === 'object') {
				microsec = false;
			}
			if (typeof(timezone) === 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}
			if (timezone !== false) {
				timezone = timezone.toString();
			}

			var ampm = o[hour < 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (
						hour !== parseInt(this.hour,10) || // sliders should all be numeric
						minute !== parseInt(this.minute,10) ||
						second !== parseInt(this.second,10) ||
						millisec !== parseInt(this.millisec,10) ||
						microsec !== parseInt(this.microsec,10) ||
						(this.ampm.length > 0 && (hour < 12) !== ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) ||
						(this.timezone !== null && timezone !== this.timezone.toString()) // could be numeric or "EST" format, so use toString()
					);

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if (pickerTimeFormat === o.timeFormat) {
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else {
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
				//this.$input.focus(); // may automatically open the picker on setDate
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function () {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect && inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function (dp_inst) {
			dp_inst = this.inst || dp_inst;
			var dtTmp = (dp_inst.currentYear > 0?
							new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay) :
							new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
				dt = $.datepicker._daylightSavingAdjust(dtTmp),
				//dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
				//dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null && this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if (dp_inst.lastVal === "") {
                dp_inst.currentYear = dp_inst.selectedYear;
                dp_inst.currentMonth = dp_inst.selectedMonth;
                dp_inst.currentDay = dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined && (dp_inst.lastVal.length > 0 && this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === false) {
				formattedDateTime = this.formattedTime;
			} else if ((this._defaults.timeOnly !== true && (this._defaults.alwaysSetTime || timeAvailable)) || (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === true)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput && this._defaults.timeOnly === false && this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if (!this._defaults.timeOnly) {
					if (this._defaults.altFormat) {
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else {
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime) {
						altFormattedDateTime += altSeparator;
					}
				}

				if (this._defaults.altTimeFormat) {
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else {
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function () {
			if (!this.$input.val() && this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function (tp_inst, obj, unit, val, min, max, step) {
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60->0 instead of 0->60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl ? val * -1 : val,
						min: rtl ? max * -1 : min,
						max: rtl ? min * -1 : max,
						step: step,
						slide: function (event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl ? ui.value * -1 : ui.value);
							tp_inst._onTimeChange();
						},
						stop: function (event, ui) {
							tp_inst._onSelectHandler();
						}
					});
				},
				options: function (tp_inst, obj, unit, opts, val) {
					if (tp_inst._defaults.isRTL) {
						if (typeof(opts) === 'string') {
							if (opts === 'min' || opts === 'max') {
								if (val !== undefined) {
									return obj.slider(opts, val * -1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min,
							max = opts.max;
						opts.min = opts.max = null;
						if (min !== undefined) {
							opts.max = min * -1;
						}
						if (max !== undefined) {
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if (typeof(opts) === 'string' && val !== undefined) {
						return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function (tp_inst, obj, unit, val) {
					if (tp_inst._defaults.isRTL) {
						if (val !== undefined) {
							return obj.slider('value', val * -1);
						}
						return Math.abs(obj.slider('value'));
					}
					if (val !== undefined) {
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function (tp_inst, obj, unit, val, min, max, step) {
					var sel = '<select class="ui-timepicker-select" data-unit="' + unit + '" data-min="' + min + '" data-max="' + max + '" data-step="' + step + '">',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for (var i = min; i <= max; i += step) {
						sel += '<option value="' + i + '"' + (i === val ? ' selected' : '') + '>';
						if (unit === 'hour') {
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig, '')), {hour: i}, tp_inst._defaults);
						}
						else if (unit === 'millisec' || unit === 'microsec' || i >= 10) { sel += i; }
						else {sel += '0' + i.toString(); }
						sel += '</option>';
					}
					sel += '</select>';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function (e) {
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function (tp_inst, obj, unit, opts, val) {
					var o = {},
						$t = obj.children('select');
					if (typeof(opts) === 'string') {
						if (val === undefined) {
							return $t.data(opts);
						}
						o[opts] = val;
					}
					else { o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function (tp_inst, obj, unit, val) {
					var $t = obj.children('select');
					if (val !== undefined) {
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker.
		*/
		timepicker: function (o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o === 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function () {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function (o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) === 'string') {
				if (o === 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function () {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function () {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function (dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function (timeFormat, timeString, options) {
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g, '').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function (f, s, o) {

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function (amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function (val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function (timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i < finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] === -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
							case 'h':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 'm':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 's':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 'l':
								return '(\\d?\\d?\\d)';
							case 'c':
								return '(\\d?\\d?\\d)';
							case 'z':
								return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
							case 't':
								return getPatternAmpm(o.amNames, o.pmNames);
							default:    // literal escaped in quotes
								return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm === 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm === 'AM' && treg[order.h] === '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm === 'PM' && treg[order.h] !== '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 && treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function (f, s, o) {
			try {
				var d = new Date('2012-01-01 ' + s);
				if (isNaN(d.getTime())) {
					d = new Date('2012-01-01T' + s);
					if (isNaN(d.getTime())) {
						d = new Date('01/01/2012 ' + s);
						if (isNaN(d.getTime())) {
							throw "Unable to parse time with native Date: " + s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset() * -1
				};
			}
			catch (err) {
				try {
					return strictParse(f, s, o);
				}
				catch (err2) {
					$.timepicker.log("Unable to parse \ntimeString: " + s + "\ntimeFormat: " + f);
				}
			}
			return false;
		}; // end looseParse
		
		if (typeof o.parse === "function") {
			return o.parse(timeFormat, timeString, o);
		}
		if (o.parse === 'loose') {
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/**
	 * Public utility to format the time
	 * @param {string} format format of the time
	 * @param {Object} time Object not a Date for timezones
	 * @param {Object} [options] essentially the regional[].. amNames, pmNames, ampm
	 * @returns {string} the formatted time
	 */
	$.datepicker.formatTime = function (format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour > 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
			switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, true);
			case 'T':
				return ampmName.charAt(0).toUpperCase();
			case 'TT':
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/'/g, "");
			}
		});

		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesn't close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function (id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst && inst.settings.showTimepicker) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function (inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst && $.datepicker._curInst !== inst && $.datepicker._datepickerShowing && $.datepicker._lastInput !== input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function (event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null ? tp_inst._defaults.showTimezone : tp_inst.support.timezone,
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') +
											" " + tp_inst._defaults.separator +
											tp_inst._defaults.timeSuffix +
											(tz ? tp_inst._defaults.timezoneList.join('') : '') +
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) +
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr < ' ' || !dateChars || datetimeChars.indexOf(chr) > -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	* Update any alternate field to synchronise with the main field.
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	$.datepicker._updateAlternate = function (inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '',
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator,
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if (!tp_inst._defaults.timeOnly && !tp_inst._defaults.altFieldTimeOnly && date !== null) {
					if (tp_inst._defaults.altFormat) {
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else {
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else {
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function (event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function (id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable & enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function (target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			inst.settings.showTimepicker = false;
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function (target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			inst.settings.showTimepicker = true;
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function (inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function (target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date === "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() === 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function (target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if (typeof(date) === 'string') {
			date = new Date(date);
			if (!date.getTime()) {
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if (tp_inst && tp_date) {
			// look out for DST if tz wasn't specified
			if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
				tp_inst.timezone = tp_date.getTimezoneOffset() * -1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function (target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if (inst.lastVal === undefined) {
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date && tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if (tp_inst.timezone != null) {
          // look out for DST if tz wasn't specified
					if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
						tp_inst.timezone = date.getTimezoneOffset() * -1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function (format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") >= 0) {
				date = this._base_parseDate(format, value.substring(0, value.length - (err.length - err.indexOf(':') - 2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function (inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function (target, name, value) {
		var inst = this._getInst(target),
			name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
			if (typeof name === 'string') { // if min/max was set with the string
				if (name === 'minDate' || name === 'minDateTime') {
					min = value;
				} else if (name === 'maxDate' || name === 'maxDateTime') {
					max = value;
				} else if (name === 'onSelect') {
					onselect = value;
				} else if (overrides.hasOwnProperty(name)) {
					if (typeof (value) === 'undefined') {
						return overrides[name];
					}
					fns[name] = value;
					name_clone = {}; //empty results in exiting function after overrides updated
				}
			} else if (typeof name === 'object') { //if min/max was set with the JSON
				if (name.minDate) {
					min = name.minDate;
				} else if (name.minDateTime) {
					min = name.minDateTime;
				} else if (name.maxDate) {
					max = name.maxDate;
				} else if (name.maxDateTime) {
					max = name.maxDateTime;
				}
				for (prop in overrides) {
					if (overrides.hasOwnProperty(prop) && name[prop]) {
						fns[prop] = name[prop];
					}
				}
			}
			for (prop in fns) {
				if (fns.hasOwnProperty(prop)) {
					overrides[prop] = fns[prop];
					if (!name_clone) { name_clone = $.extend({}, name); }
					delete name_clone[prop];
				}
			}
			if (name_clone && isEmptyObject(name_clone)) { return; }
			if (min) { //if min was set
				if (min === 0) {
					min = new Date();
				} else {
					min = new Date(min);
				}
				tp_inst._defaults.minDate = min;
				tp_inst._defaults.minDateTime = min;
			} else if (max) { //if max was set
				if (max === 0) {
					max = new Date();
				} else {
					max = new Date(max);
				}
				tp_inst._defaults.maxDate = max;
				tp_inst._defaults.maxDateTime = max;
			} else if (onselect) {
				tp_inst._defaults.onSelect = onselect;
			}
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function (obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(prop)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function (target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function (timeFormat) {
		var tf = timeFormat.replace(/'.*?'/g, '').toLowerCase(), // removes literals
			isIn = function (f, t) { // does the format contain the token?
					return f.indexOf(t) !== -1 ? true : false;
				};
		return {
				hour: isIn(tf, 'h'),
				minute: isIn(tf, 'm'),
				second: isIn(tf, 's'),
				millisec: isIn(tf, 'l'),
				microsec: isIn(tf, 'c'),
				timezone: isIn(tf, 'z'),
				ampm: isIn(tf, 't') && isIn(timeFormat, 'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function (hour) {
		hour %= 12;

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	var computeEffectiveSetting = function (settings, property) {
		return settings && settings[property] ? settings[property] : $.timepicker._defaults[property];
	};

	/*
	* Splits datetime string into date and time substrings.
	* Throws exception when date can't be parsed
	* Returns {dateString: dateString, timeString: timeString}
	*/
	var splitDateTime = function (dateTimeString, timeSettings) {
		// The idea is to get the number separator occurrences in datetime and the time format requested (since time has
		// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
		var separator = computeEffectiveSetting(timeSettings, 'separator'),
			format = computeEffectiveSetting(timeSettings, 'timeFormat'),
			timeParts = format.split(separator), // how many occurrences of separator may be in our format?
			timePartsLen = timeParts.length,
			allParts = dateTimeString.split(separator),
			allPartsLen = allParts.length;

		if (allPartsLen > 1) {
			return {
				dateString: allParts.splice(0, allPartsLen - timePartsLen).join(separator),
				timeString: allParts.splice(0, timePartsLen).join(separator)
			};
		}

		return {
			dateString: dateTimeString,
			timeString: ''
		};
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function (dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date,
			parts,
			parsedTime;

		parts = splitDateTime(dateTimeString, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, parts.dateString, dateSettings);

		if (parts.timeString === '') {
			return {
				date: date
			};
		}

		parsedTime = $.datepicker.parseTime(timeFormat, parts.timeString, timeSettings);

		if (!parsedTime) {
			throw 'Wrong time format';
		}

		return {
			date: date,
			timeObj: parsedTime
		};
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function (tp_inst, date) {
		if (tp_inst && tp_inst.timezone_select) {
			var now = date || new Date();
			tp_inst.timezone_select.val(-now.getTimezoneOffset());
		}
	};

	/*
	* Create a Singleton Instance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @param {number} tzMinutes if not a number, less than -720 (-1200), or greater than 840 (+1400) this value is returned
	 * @param {boolean} iso8601 if true formats in accordance to iso8601 "+12:45"
	 * @return {string}
	 */
	$.timepicker.timezoneOffsetString = function (tzMinutes, iso8601) {
		if (isNaN(tzMinutes) || tzMinutes > 840 || tzMinutes < -720) {
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601 ? ':' : '',
			tz = (off >= 0 ? '+' : '-') + ('0' + Math.abs(hours)).slice(-2) + iso + ('0' + Math.abs(minutes)).slice(-2);
		
		if (tz === '+00:00') {
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @param  {string} tzString formatted like "+0500", "-1245", "Z"
	 * @return {number} the offset minutes or the original string if it doesn't match expectations
	 */
	$.timepicker.timezoneOffsetNumber = function (tzString) {
		var normalized = tzString.toString().replace(':', ''); // excuse any iso8601, end up with "+1245"

		if (normalized.toUpperCase() === 'Z') { // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if (!/^(\-|\+)\d{4}$/.test(normalized)) { // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((normalized.substr(0, 1) === '-' ? -1 : 1) * // plus or minus
					((parseInt(normalized.substr(1, 2), 10) * 60) + // hours (converted to minutes)
					parseInt(normalized.substr(3, 2), 10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @param  {Date} date
	 * @param  {string} toTimezone formatted like "+0500", "-1245"
	 * @return {Date}
	 */
	$.timepicker.timezoneAdjust = function (date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if (!isNaN(toTz)) {
			date.setMinutes(date.getMinutes() + -date.getTimezoneOffset() - toTz);
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the timepicker() call
	 * @return {jQuery}
	 */
	$.timepicker.timeRange = function (startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @param  {string} method Can be used to specify the type of picker to be added
	 * @return {jQuery}
	 */
	$.timepicker.datetimeRange = function (startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return {jQuery}
	 */
	$.timepicker.dateRange = function (startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {string} method Can be used to specify the type of picker to be added
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return {jQuery}
	 */
	$.timepicker.handleRange = function (method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		// for the mean time this fixes an issue with calling getDate with timepicker()
		var timeOnly = false;
		if(method === 'timepicker'){
			timeOnly = true;
			method = 'datetimepicker';
		}

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if (startdt !== null) {
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if (options.minInterval > 0 && minDate > enddt) { // minInterval check
					endTime[method]('setDate', minDate);
				}
				else if (options.maxInterval > 0 && maxDate < enddt) { // max interval check
					endTime[method]('setDate', maxDate);
				}
				else if (startdt > enddt) {
					other[method]('setDate', changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if (date !== null && options.minInterval > 0) {
				if (option === 'minDate') {
					date.setMilliseconds(date.getMilliseconds() + options.minInterval);
				}
				if (option === 'maxDate') {
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}

		$.fn[method].call(startTime, $.extend({
			timeOnly: timeOnly,
			onClose: function (dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function (selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			timeOnly: timeOnly,
			onClose: function (dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function (selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @param  {Object} err pass any type object to log to the console during error or debugging
	 * @return {void}
	 */
	$.timepicker.log = function (err) {
		if (window.console) {
			window.console.log(err);
		}
	};

	/*
	 * Add util object to allow access to private methods for testability.
	 */
	$.timepicker._util = {
		_extendRemove: extendRemove,
		_isEmptyObject: isEmptyObject,
		_convert24to12: convert24to12,
		_detectSupport: detectSupport,
		_selectLocalTimezone: selectLocalTimezone,
		_computeEffectiveSetting: computeEffectiveSetting,
		_splitDateTime: splitDateTime,
		_parseDateTimeInternal: parseDateTimeInternal
	};

	/*
	* Microsecond support
	*/
	if (!Date.prototype.getMicroseconds) {
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function () { return this.microseconds; };
		Date.prototype.setMicroseconds = function (m) {
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m / 1000));
			this.microseconds = m % 1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.4.4";

})(jQuery);












var jscolor = {


	dir : '', 
	bindClass : 'color', 
	binding : true, 
	preloading : true, 


	install : function() {
		jscolor.addEvent(window, 'load', jscolor.init);
	},


	init : function() {
		if(jscolor.binding) {
			jscolor.bind();
		}
		if(jscolor.preloading) {
			jscolor.preload();
		}
	},


	getDir : function() {
	  if (!jscolor.dir) {
      
	    
	    jscolor.dir = Planview.getAppPath() + "/Visualization/Scripts/ColorPicker/";
			
		}
		return jscolor.dir;
	},


	detectDir : function() {
		var base = location.href;

		var e = document.getElementsByTagName('base');
		for(var i=0; i<e.length; i+=1) {
			if(e[i].href) { base = e[i].href; }
		}

		var e = document.getElementsByTagName('script');
		for(var i=0; i<e.length; i+=1) {
			if(e[i].src && /(^|\/)jscolor\.js([?#].*)?$/i.test(e[i].src)) {
				var src = new jscolor.URI(e[i].src);
				var srcAbs = src.toAbsolute(base);
				srcAbs.path = srcAbs.path.replace(/[^\/]+$/, ''); 
				srcAbs.query = null;
				srcAbs.fragment = null;
				return srcAbs.toString();
			}
		}
		return false;
	},


	bind : function() {
		var matchClass = new RegExp('(^|\\s)('+jscolor.bindClass+')(\\s*(\\{[^}]*\\})|\\s|$)', 'i');
		var e = document.getElementsByTagName('input');
		for(var i=0; i<e.length; i+=1) {
			var m;
			if(!e[i].color && e[i].className && (m = e[i].className.match(matchClass))) {
				var prop = {};
				if(m[4]) {
					try {
						prop = (new Function ('return (' + m[4] + ')'))();
					} catch(eInvalidProp) {}
				}
				e[i].color = new jscolor.color(e[i], prop);
			}
		}
	},


	preload : function() {
		for(var fn in jscolor.imgRequire) {
			if(jscolor.imgRequire.hasOwnProperty(fn)) {
				jscolor.loadImage(fn);
			}
		}
	},


	images : {
		pad : [ 181, 101 ],
		sld : [ 16, 101 ],
		cross : [ 15, 15 ],
		arrow : [ 7, 11 ]
	},


	imgRequire : {},
	imgLoaded : {},


	requireImage : function(filename) {
		jscolor.imgRequire[filename] = true;
	},


	loadImage : function(filename) {
		if(!jscolor.imgLoaded[filename]) {
			jscolor.imgLoaded[filename] = new Image();
			jscolor.imgLoaded[filename].src = jscolor.getDir()+filename;
		}
	},


	fetchElement : function(mixed) {
		return typeof mixed === 'string' ? document.getElementById(mixed) : mixed;
	},


	addEvent : function(el, evnt, func) {
		if(el.addEventListener) {
			el.addEventListener(evnt, func, false);
		} else if(el.attachEvent) {
			el.attachEvent('on'+evnt, func);
		}
	},


	fireEvent : function(el, evnt) {
		if(!el) {
			return;
		}
		if(document.createEvent) {
			var ev = document.createEvent('HTMLEvents');
			ev.initEvent(evnt, true, true);
			el.dispatchEvent(ev);
		} else if(document.createEventObject) {
			var ev = document.createEventObject();
			el.fireEvent('on'+evnt, ev);
		} else if(el['on'+evnt]) { 
			el['on'+evnt]();
		}
	},


	getElementPos : function(e) {
		var e1=e, e2=e;
		var x=0, y=0;
		if(e1.offsetParent) {
			do {
				x += e1.offsetLeft;
				y += e1.offsetTop;
			} while(e1 = e1.offsetParent);
		}
		while((e2 = e2.parentNode) && e2.nodeName.toUpperCase() !== 'BODY') {
			x -= e2.scrollLeft;
			y -= e2.scrollTop;
		}
		return [x, y];
	},


	getElementSize : function(e) {
		return [e.offsetWidth, e.offsetHeight];
	},


	getRelMousePos : function(e) {
		var x = 0, y = 0;
		if (!e) { e = window.event; }
		if (typeof e.offsetX === 'number') {
			x = e.offsetX;
			y = e.offsetY;
		} else if (typeof e.layerX === 'number') {
			x = e.layerX;
			y = e.layerY;
		}
		return { x: x, y: y };
	},


	getViewPos : function() {
		if(typeof window.pageYOffset === 'number') {
			return [window.pageXOffset, window.pageYOffset];
		} else if(document.body && (document.body.scrollLeft || document.body.scrollTop)) {
			return [document.body.scrollLeft, document.body.scrollTop];
		} else if(document.documentElement && (document.documentElement.scrollLeft || document.documentElement.scrollTop)) {
			return [document.documentElement.scrollLeft, document.documentElement.scrollTop];
		} else {
			return [0, 0];
		}
	},


	getViewSize : function() {
		if(typeof window.innerWidth === 'number') {
			return [window.innerWidth, window.innerHeight];
		} else if(document.body && (document.body.clientWidth || document.body.clientHeight)) {
			return [document.body.clientWidth, document.body.clientHeight];
		} else if(document.documentElement && (document.documentElement.clientWidth || document.documentElement.clientHeight)) {
			return [document.documentElement.clientWidth, document.documentElement.clientHeight];
		} else {
			return [0, 0];
		}
	},


	URI : function(uri) { 

		this.scheme = null;
		this.authority = null;
		this.path = '';
		this.query = null;
		this.fragment = null;

		this.parse = function(uri) {
			var m = uri.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);
			this.scheme = m[3] ? m[2] : null;
			this.authority = m[5] ? m[6] : null;
			this.path = m[7];
			this.query = m[9] ? m[10] : null;
			this.fragment = m[12] ? m[13] : null;
			return this;
		};

		this.toString = function() {
			var result = '';
			if(this.scheme !== null) { result = result + this.scheme + ':'; }
			if(this.authority !== null) { result = result + '//' + this.authority; }
			if(this.path !== null) { result = result + this.path; }
			if(this.query !== null) { result = result + '?' + this.query; }
			if(this.fragment !== null) { result = result + '#' + this.fragment; }
			return result;
		};

		this.toAbsolute = function(base) {
			var base = new jscolor.URI(base);
			var r = this;
			var t = new jscolor.URI;

			if(base.scheme === null) { return false; }

			if(r.scheme !== null && r.scheme.toLowerCase() === base.scheme.toLowerCase()) {
				r.scheme = null;
			}

			if(r.scheme !== null) {
				t.scheme = r.scheme;
				t.authority = r.authority;
				t.path = removeDotSegments(r.path);
				t.query = r.query;
			} else {
				if(r.authority !== null) {
					t.authority = r.authority;
					t.path = removeDotSegments(r.path);
					t.query = r.query;
				} else {
					if(r.path === '') {
						t.path = base.path;
						if(r.query !== null) {
							t.query = r.query;
						} else {
							t.query = base.query;
						}
					} else {
						if(r.path.substr(0,1) === '/') {
							t.path = removeDotSegments(r.path);
						} else {
							if(base.authority !== null && base.path === '') {
								t.path = '/'+r.path;
							} else {
								t.path = base.path.replace(/[^\/]+$/,'')+r.path;
							}
							t.path = removeDotSegments(t.path);
						}
						t.query = r.query;
					}
					t.authority = base.authority;
				}
				t.scheme = base.scheme;
			}
			t.fragment = r.fragment;

			return t;
		};

		function removeDotSegments(path) {
			var out = '';
			while(path) {
				if(path.substr(0,3)==='../' || path.substr(0,2)==='./') {
					path = path.replace(/^\.+/,'').substr(1);
				} else if(path.substr(0,3)==='/./' || path==='/.') {
					path = '/'+path.substr(3);
				} else if(path.substr(0,4)==='/../' || path==='/..') {
					path = '/'+path.substr(4);
					out = out.replace(/\/?[^\/]*$/, '');
				} else if(path==='.' || path==='..') {
					path = '';
				} else {
					var rm = path.match(/^\/?[^\/]*/)[0];
					path = path.substr(rm.length);
					out = out + rm;
				}
			}
			return out;
		}

		if(uri) {
			this.parse(uri);
		}

	},


	
	
	
	

	color : function(target, prop) {


		this.required = true; 
		this.adjust = true; 
		this.hash = false; 
		this.caps = true; 
		this.slider = true; 
		this.valueElement = target; 
		this.styleElement = target; 
		this.onImmediateChange = null; 
		this.hsv = [0, 0, 1]; 
		this.rgb = [1, 1, 1]; 
		this.minH = 0; 
		this.maxH = 6; 
		this.minS = 0; 
		this.maxS = 1; 
		this.minV = 0; 
		this.maxV = 1; 

		this.pickerOnfocus = true; 
		this.pickerMode = 'HSV'; 
		this.pickerPosition = 'bottom'; 
		this.pickerSmartPosition = true; 
		this.pickerButtonHeight = 20; 
		this.pickerClosable = false;
		this.pickerCloseText = 'Close';
		this.pickerButtonColor = 'ButtonText'; 
		this.pickerFace = 10; 
		this.pickerFaceColor = 'ThreeDFace'; 
		this.pickerBorder = 1; 
		this.pickerBorderColor = 'ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight'; 
		this.pickerInset = 1; 
		this.pickerInsetColor = 'ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow'; 
		this.pickerZIndex = 10009;


		for(var p in prop) {
			if(prop.hasOwnProperty(p)) {
				this[p] = prop[p];
			}
		}


		this.hidePicker = function() {
			if(isPickerOwner()) {
				removePicker();
			}
		};


		this.showPicker = function() {
			if(!isPickerOwner()) {
				var tp = jscolor.getElementPos(target); 
				var ts = jscolor.getElementSize(target); 
				var vp = jscolor.getViewPos(); 
				var vs = jscolor.getViewSize(); 
				var ps = getPickerDims(this); 
				var a, b, c;
				switch(this.pickerPosition.toLowerCase()) {
					case 'left': a=1; b=0; c=-1; break;
					case 'right':a=1; b=0; c=1; break;
					case 'top':  a=0; b=1; c=-1; break;
					default:     a=0; b=1; c=1; break;
				}
				var l = (ts[b]+ps[b])/2;

				
				if (!this.pickerSmartPosition) {
					var pp = [
						tp[a],
						tp[b]+ts[b]-l+l*c
					];
				} else {
					var pp = [
						-vp[a]+tp[a]+ps[a] > vs[a] ?
							(-vp[a]+tp[a]+ts[a]/2 > vs[a]/2 && tp[a]+ts[a]-ps[a] >= 0 ? tp[a]+ts[a]-ps[a] : tp[a]) :
							tp[a],
						-vp[b]+tp[b]+ts[b]+ps[b]-l+l*c > vs[b] ?
							(-vp[b]+tp[b]+ts[b]/2 > vs[b]/2 && tp[b]+ts[b]-l-l*c >= 0 ? tp[b]+ts[b]-l-l*c : tp[b]+ts[b]-l+l*c) :
							(tp[b]+ts[b]-l+l*c >= 0 ? tp[b]+ts[b]-l+l*c : tp[b]+ts[b]-l-l*c)
					];
				}
				drawPicker(pp[a], pp[b]);
			}
		};


		this.importColor = function() {
			if(!valueElement) {
				this.exportColor();
			} else {
				if(!this.adjust) {
					if(!this.fromString(valueElement.value, leaveValue)) {
						styleElement.style.backgroundImage = styleElement.jscStyle.backgroundImage;
						styleElement.style.backgroundColor = styleElement.jscStyle.backgroundColor;
						styleElement.style.color = styleElement.jscStyle.color;
						this.exportColor(leaveValue | leaveStyle);
					}
				} else if(!this.required && /^\s*$/.test(valueElement.value)) {
					valueElement.value = '';
					styleElement.style.backgroundImage = styleElement.jscStyle.backgroundImage;
					styleElement.style.backgroundColor = styleElement.jscStyle.backgroundColor;
					styleElement.style.color = styleElement.jscStyle.color;
					this.exportColor(leaveValue | leaveStyle);

				} else if(this.fromString(valueElement.value)) {
					
				} else {
					this.exportColor();
				}
			}
		};


		this.exportColor = function(flags) {
			if(!(flags & leaveValue) && valueElement) {
				var value = this.toString();
				if(this.caps) { value = value.toUpperCase(); }
				if(this.hash) { value = '#'+value; }
				valueElement.value = value;
			}
			if(!(flags & leaveStyle) && styleElement) {
				styleElement.style.backgroundImage = "none";
				styleElement.style.backgroundColor =
					'#'+this.toString();
				styleElement.style.color =
					0.213 * this.rgb[0] +
					0.715 * this.rgb[1] +
					0.072 * this.rgb[2]
					< 0.5 ? '#FFF' : '#000';
			}
			if(!(flags & leavePad) && isPickerOwner()) {
				redrawPad();
			}
			if(!(flags & leaveSld) && isPickerOwner()) {
				redrawSld();
			}
		};


		this.fromHSV = function(h, s, v, flags) { 
			if(h !== null) { h = Math.max(0.0, this.minH, Math.min(6.0, this.maxH, h)); }
			if(s !== null) { s = Math.max(0.0, this.minS, Math.min(1.0, this.maxS, s)); }
			if(v !== null) { v = Math.max(0.0, this.minV, Math.min(1.0, this.maxV, v)); }

			this.rgb = HSV_RGB(
				h===null ? this.hsv[0] : (this.hsv[0]=h),
				s===null ? this.hsv[1] : (this.hsv[1]=s),
				v===null ? this.hsv[2] : (this.hsv[2]=v)
			);

			this.exportColor(flags);
		};


		this.fromRGB = function(r, g, b, flags) { 
			if(r !== null) { r = Math.max(0.0, Math.min(1.0, r)); }
			if(g !== null) { g = Math.max(0.0, Math.min(1.0, g)); }
			if(b !== null) { b = Math.max(0.0, Math.min(1.0, b)); }

			var hsv = RGB_HSV(
				r===null ? this.rgb[0] : r,
				g===null ? this.rgb[1] : g,
				b===null ? this.rgb[2] : b
			);
			if(hsv[0] !== null) {
				this.hsv[0] = Math.max(0.0, this.minH, Math.min(6.0, this.maxH, hsv[0]));
			}
			if(hsv[2] !== 0) {
				this.hsv[1] = hsv[1]===null ? null : Math.max(0.0, this.minS, Math.min(1.0, this.maxS, hsv[1]));
			}
			this.hsv[2] = hsv[2]===null ? null : Math.max(0.0, this.minV, Math.min(1.0, this.maxV, hsv[2]));

			
			var rgb = HSV_RGB(this.hsv[0], this.hsv[1], this.hsv[2]);
			this.rgb[0] = rgb[0];
			this.rgb[1] = rgb[1];
			this.rgb[2] = rgb[2];

			this.exportColor(flags);
		};


		this.fromString = function(hex, flags) {
			var m = hex.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);
			if(!m) {
				return false;
			} else {
				if(m[1].length === 6) { 
					this.fromRGB(
						parseInt(m[1].substr(0,2),16) / 255,
						parseInt(m[1].substr(2,2),16) / 255,
						parseInt(m[1].substr(4,2),16) / 255,
						flags
					);
				} else { 
					this.fromRGB(
						parseInt(m[1].charAt(0)+m[1].charAt(0),16) / 255,
						parseInt(m[1].charAt(1)+m[1].charAt(1),16) / 255,
						parseInt(m[1].charAt(2)+m[1].charAt(2),16) / 255,
						flags
					);
				}
				return true;
			}
		};


		this.toString = function() {
			return (
				(0x100 | Math.round(255*this.rgb[0])).toString(16).substr(1) +
				(0x100 | Math.round(255*this.rgb[1])).toString(16).substr(1) +
				(0x100 | Math.round(255*this.rgb[2])).toString(16).substr(1)
			);
		};


		function RGB_HSV(r, g, b) {
			var n = Math.min(Math.min(r,g),b);
			var v = Math.max(Math.max(r,g),b);
			var m = v - n;
			if(m === 0) { return [ null, 0, v ]; }
			var h = r===n ? 3+(b-g)/m : (g===n ? 5+(r-b)/m : 1+(g-r)/m);
			return [ h===6?0:h, m/v, v ];
		}


		function HSV_RGB(h, s, v) {
			if(h === null) { return [ v, v, v ]; }
			var i = Math.floor(h);
			var f = i%2 ? h-i : 1-(h-i);
			var m = v * (1 - s);
			var n = v * (1 - s*f);
			switch(i) {
				case 6:
				case 0: return [v,n,m];
				case 1: return [n,v,m];
				case 2: return [m,v,n];
				case 3: return [m,n,v];
				case 4: return [n,m,v];
				case 5: return [v,m,n];
			}
		}


		function removePicker() {
			delete jscolor.picker.owner;
			document.getElementsByTagName('body')[0].removeChild(jscolor.picker.boxB);
		}


		function drawPicker(x, y) {
			if(!jscolor.picker) {
				jscolor.picker = {
					box : document.createElement('div'),
					boxB : document.createElement('div'),
					pad : document.createElement('div'),
					padB : document.createElement('div'),
					padM : document.createElement('div'),
					sld : document.createElement('div'),
					sldB : document.createElement('div'),
					sldM : document.createElement('div'),
					btn : document.createElement('div'),
					btnS : document.createElement('span'),
					btnT : document.createTextNode(THIS.pickerCloseText)
				};
				jscolor.picker.box.id = 'jscolor-picker-container';
				jscolor.picker.btn.id = 'jscolor-picker-close-btn';
				for(var i=0,segSize=4; i<jscolor.images.sld[1]; i+=segSize) {
					var seg = document.createElement('div');
					seg.style.height = segSize+'px';
					seg.style.fontSize = '1px';
					seg.style.lineHeight = '0';
					jscolor.picker.sld.appendChild(seg);
				}
				jscolor.picker.sldB.appendChild(jscolor.picker.sld);
				jscolor.picker.box.appendChild(jscolor.picker.sldB);
				jscolor.picker.box.appendChild(jscolor.picker.sldM);
				jscolor.picker.padB.appendChild(jscolor.picker.pad);
				jscolor.picker.box.appendChild(jscolor.picker.padB);
				jscolor.picker.box.appendChild(jscolor.picker.padM);
				jscolor.picker.btnS.appendChild(jscolor.picker.btnT);
				jscolor.picker.btn.appendChild(jscolor.picker.btnS);
				jscolor.picker.box.appendChild(jscolor.picker.btn);
				jscolor.picker.boxB.appendChild(jscolor.picker.box);
			}

			var p = jscolor.picker;

			
			p.box.onmouseup =
			p.box.onmouseout = function() { target.focus(); };
			p.box.onmousedown = function() { abortBlur=true; };
			p.box.onmousemove = function(e) {
				if (holdPad || holdSld) {
					holdPad && setPad(e);
					holdSld && setSld(e);
					if (document.selection) {
						document.selection.empty();
					} else if (window.getSelection) {
						window.getSelection().removeAllRanges();
					}
					dispatchImmediateChange();
				}
			};
			if('ontouchstart' in window) { 
				var handle_touchmove = function(e) {
					var event={
						'offsetX': e.touches[0].pageX-touchOffset.X,
						'offsetY': e.touches[0].pageY-touchOffset.Y
					};
					if (holdPad || holdSld) {
						holdPad && setPad(event);
						holdSld && setSld(event);
						dispatchImmediateChange();
					}
					e.stopPropagation(); 
					e.preventDefault(); 
				};
				p.box.removeEventListener('touchmove', handle_touchmove, false)
				p.box.addEventListener('touchmove', handle_touchmove, false)
			}
			p.padM.onmouseup =
			p.padM.onmouseout = function() { if(holdPad) { holdPad=false; jscolor.fireEvent(valueElement,'change'); } };
			p.padM.onmousedown = function(e) {
				
				switch(modeID) {
					case 0: if (THIS.hsv[2] === 0) { THIS.fromHSV(null, null, 1.0); }; break;
					case 1: if (THIS.hsv[1] === 0) { THIS.fromHSV(null, 1.0, null); }; break;
				}
				holdSld=false;
				holdPad=true;
				setPad(e);
				dispatchImmediateChange();
			};
			if('ontouchstart' in window) {
				p.padM.addEventListener('touchstart', function(e) {
					touchOffset={
						'X': e.target.offsetParent.offsetLeft,
						'Y': e.target.offsetParent.offsetTop
					};
					this.onmousedown({
						'offsetX':e.touches[0].pageX-touchOffset.X,
						'offsetY':e.touches[0].pageY-touchOffset.Y
					});
				});
			}
			p.sldM.onmouseup =
			p.sldM.onmouseout = function() { if(holdSld) { holdSld=false; jscolor.fireEvent(valueElement,'change'); } };
			p.sldM.onmousedown = function(e) {
				holdPad=false;
				holdSld=true;
				setSld(e);
				dispatchImmediateChange();
			};
			if('ontouchstart' in window) {
				p.sldM.addEventListener('touchstart', function(e) {
					touchOffset={
						'X': e.target.offsetParent.offsetLeft,
						'Y': e.target.offsetParent.offsetTop
					};
					this.onmousedown({
						'offsetX':e.touches[0].pageX-touchOffset.X,
						'offsetY':e.touches[0].pageY-touchOffset.Y
					});
				});
			}

			
			var dims = getPickerDims(THIS);
			p.box.style.width = dims[0] + 'px';
			p.box.style.height = dims[1] + 'px';

			
			p.boxB.style.position = 'absolute';
			p.boxB.style.clear = 'both';
			p.boxB.style.left = x+'px';
			p.boxB.style.top = y+'px';
			p.boxB.style.zIndex = THIS.pickerZIndex;
			p.boxB.style.border = THIS.pickerBorder+'px solid';
			p.boxB.style.borderColor = THIS.pickerBorderColor;
			p.boxB.style.background = THIS.pickerFaceColor;

			
			p.pad.style.width = jscolor.images.pad[0]+'px';
			p.pad.style.height = jscolor.images.pad[1]+'px';

			
			p.padB.style.position = 'absolute';
			p.padB.style.left = THIS.pickerFace+'px';
			p.padB.style.top = THIS.pickerFace+'px';
			p.padB.style.border = THIS.pickerInset+'px solid';
			p.padB.style.borderColor = THIS.pickerInsetColor;

			
			p.padM.style.position = 'absolute';
			p.padM.style.left = '0';
			p.padM.style.top = '0';
			p.padM.style.width = THIS.pickerFace + 2*THIS.pickerInset + jscolor.images.pad[0] + jscolor.images.arrow[0] + 'px';
			p.padM.style.height = p.box.style.height;
			p.padM.style.cursor = 'crosshair';

			
			p.sld.style.overflow = 'hidden';
			p.sld.style.width = jscolor.images.sld[0]+'px';
			p.sld.style.height = jscolor.images.sld[1]+'px';

			
			p.sldB.style.display = THIS.slider ? 'block' : 'none';
			p.sldB.style.position = 'absolute';
			p.sldB.style.right = THIS.pickerFace+'px';
			p.sldB.style.top = THIS.pickerFace+'px';
			p.sldB.style.border = THIS.pickerInset+'px solid';
			p.sldB.style.borderColor = THIS.pickerInsetColor;

			
			p.sldM.style.display = THIS.slider ? 'block' : 'none';
			p.sldM.style.position = 'absolute';
			p.sldM.style.right = '0';
			p.sldM.style.top = '0';
			p.sldM.style.width = jscolor.images.sld[0] + jscolor.images.arrow[0] + THIS.pickerFace + 2*THIS.pickerInset + 'px';
			p.sldM.style.height = p.box.style.height;
			try {
				p.sldM.style.cursor = 'pointer';
			} catch(eOldIE) {
				p.sldM.style.cursor = 'hand';
			}

			
			function setBtnBorder() {
				var insetColors = THIS.pickerInsetColor.split(/\s+/);
				var pickerOutsetColor = insetColors.length < 2 ? insetColors[0] : insetColors[1] + ' ' + insetColors[0] + ' ' + insetColors[0] + ' ' + insetColors[1];
				p.btn.style.borderColor = pickerOutsetColor;
			}
			p.btn.style.display = THIS.pickerClosable ? 'block' : 'none';
			p.btn.style.position = 'absolute';
			p.btn.style.left = THIS.pickerFace + 'px';
			p.btn.style.bottom = THIS.pickerFace + 'px';
			p.btn.style.padding = '0 15px';
			p.btn.style.height = '18px';
			p.btn.style.border = THIS.pickerInset + 'px solid';
			setBtnBorder();
			p.btn.style.color = THIS.pickerButtonColor;
			p.btn.style.font = '12px sans-serif';
			p.btn.style.textAlign = 'center';
			try {
				p.btn.style.cursor = 'pointer';
			} catch(eOldIE) {
				p.btn.style.cursor = 'hand';
			}
			p.btn.onmousedown = function () {
				THIS.hidePicker();
			};
			p.btnS.style.lineHeight = p.btn.style.height;

			
			switch(modeID) {
				case 0: var padImg = 'hs.png'; break;
				case 1: var padImg = 'hv.png'; break;
			}
			p.padM.style.backgroundImage = "url('"+jscolor.getDir()+"cross.gif')";
			p.padM.style.backgroundRepeat = "no-repeat";
			p.sldM.style.backgroundImage = "url('"+jscolor.getDir()+"arrow.gif')";
			p.sldM.style.backgroundRepeat = "no-repeat";
			p.pad.style.backgroundImage = "url('"+jscolor.getDir()+padImg+"')";
			p.pad.style.backgroundRepeat = "no-repeat";
			p.pad.style.backgroundPosition = "0 0";

			
			redrawPad();
			redrawSld();

			jscolor.picker.owner = THIS;
			document.getElementsByTagName('body')[0].appendChild(p.boxB);
		}


		function getPickerDims(o) {
			var dims = [
				2*o.pickerInset + 2*o.pickerFace + jscolor.images.pad[0] +
					(o.slider ? 2*o.pickerInset + 2*jscolor.images.arrow[0] + jscolor.images.sld[0] : 0),
				o.pickerClosable ?
					4*o.pickerInset + 3*o.pickerFace + jscolor.images.pad[1] + o.pickerButtonHeight :
					2*o.pickerInset + 2*o.pickerFace + jscolor.images.pad[1]
			];
			return dims;
		}


		function redrawPad() {
			
			switch(modeID) {
				case 0: var yComponent = 1; break;
				case 1: var yComponent = 2; break;
			}
			var x = Math.round((THIS.hsv[0]/6) * (jscolor.images.pad[0]-1));
			var y = Math.round((1-THIS.hsv[yComponent]) * (jscolor.images.pad[1]-1));
			jscolor.picker.padM.style.backgroundPosition =
				(THIS.pickerFace+THIS.pickerInset+x - Math.floor(jscolor.images.cross[0]/2)) + 'px ' +
				(THIS.pickerFace+THIS.pickerInset+y - Math.floor(jscolor.images.cross[1]/2)) + 'px';

			
			var seg = jscolor.picker.sld.childNodes;

			switch(modeID) {
				case 0:
					var rgb = HSV_RGB(THIS.hsv[0], THIS.hsv[1], 1);
					for(var i=0; i<seg.length; i+=1) {
						seg[i].style.backgroundColor = 'rgb('+
							(rgb[0]*(1-i/seg.length)*100)+'%,'+
							(rgb[1]*(1-i/seg.length)*100)+'%,'+
							(rgb[2]*(1-i/seg.length)*100)+'%)';
					}
					break;
				case 1:
					var rgb, s, c = [ THIS.hsv[2], 0, 0 ];
					var i = Math.floor(THIS.hsv[0]);
					var f = i%2 ? THIS.hsv[0]-i : 1-(THIS.hsv[0]-i);
					switch(i) {
						case 6:
						case 0: rgb=[0,1,2]; break;
						case 1: rgb=[1,0,2]; break;
						case 2: rgb=[2,0,1]; break;
						case 3: rgb=[2,1,0]; break;
						case 4: rgb=[1,2,0]; break;
						case 5: rgb=[0,2,1]; break;
					}
					for(var i=0; i<seg.length; i+=1) {
						s = 1 - 1/(seg.length-1)*i;
						c[1] = c[0] * (1 - s*f);
						c[2] = c[0] * (1 - s);
						seg[i].style.backgroundColor = 'rgb('+
							(c[rgb[0]]*100)+'%,'+
							(c[rgb[1]]*100)+'%,'+
							(c[rgb[2]]*100)+'%)';
					}
					break;
			}
		}


		function redrawSld() {
			
			switch(modeID) {
				case 0: var yComponent = 2; break;
				case 1: var yComponent = 1; break;
			}
			var y = Math.round((1-THIS.hsv[yComponent]) * (jscolor.images.sld[1]-1));
			jscolor.picker.sldM.style.backgroundPosition =
				'0 ' + (THIS.pickerFace+THIS.pickerInset+y - Math.floor(jscolor.images.arrow[1]/2)) + 'px';
		}


		function isPickerOwner() {
			return jscolor.picker && jscolor.picker.owner === THIS;
		}


		function blurTarget() {
			if(valueElement === target) {
				THIS.importColor();
			}
			if(THIS.pickerOnfocus) {
				THIS.hidePicker();
			}
		}


		function blurValue() {
			if(valueElement !== target) {
				THIS.importColor();
			}
		}


		function setPad(e) {
			var mpos = jscolor.getRelMousePos(e);
			var x = mpos.x - THIS.pickerFace - THIS.pickerInset;
			var y = mpos.y - THIS.pickerFace - THIS.pickerInset;
			switch(modeID) {
				case 0: THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)), 1 - y/(jscolor.images.pad[1]-1), null, leaveSld); break;
				case 1: THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)), null, 1 - y/(jscolor.images.pad[1]-1), leaveSld); break;
			}
		}


		function setSld(e) {
			var mpos = jscolor.getRelMousePos(e);
			var y = mpos.y - THIS.pickerFace - THIS.pickerInset;
			switch(modeID) {
				case 0: THIS.fromHSV(null, null, 1 - y/(jscolor.images.sld[1]-1), leavePad); break;
				case 1: THIS.fromHSV(null, 1 - y/(jscolor.images.sld[1]-1), null, leavePad); break;
			}
		}


		function dispatchImmediateChange() {
			if (THIS.onImmediateChange) {
				var callback;
				if (typeof THIS.onImmediateChange === 'string') {
					callback = new Function (THIS.onImmediateChange);
				} else {
					callback = THIS.onImmediateChange;
				}
				callback.call(THIS);
			}
		}


		var THIS = this;
		var modeID = this.pickerMode.toLowerCase()==='hvs' ? 1 : 0;
		var abortBlur = false;
		var
			valueElement = jscolor.fetchElement(this.valueElement),
			styleElement = jscolor.fetchElement(this.styleElement);
		var
			holdPad = false,
			holdSld = false,
			touchOffset = {};
		var
			leaveValue = 1<<0,
			leaveStyle = 1<<1,
			leavePad = 1<<2,
			leaveSld = 1<<3;

		
		jscolor.addEvent(target, 'focus', function() {
			if(THIS.pickerOnfocus) { THIS.showPicker(); }
		});
		jscolor.addEvent(target, 'blur', function() {
			if(!abortBlur) {
				window.setTimeout(function(){ abortBlur || blurTarget(); abortBlur=false; }, 0);
			} else {
				abortBlur = false;
			}
		});

		
		if(valueElement) {
			var updateField = function() {
				THIS.fromString(valueElement.value, leaveValue);
				dispatchImmediateChange();
			};
			jscolor.addEvent(valueElement, 'keyup', updateField);
			jscolor.addEvent(valueElement, 'input', updateField);
			jscolor.addEvent(valueElement, 'blur', blurValue);
			valueElement.setAttribute('autocomplete', 'off');
		}

		
		if(styleElement) {
			styleElement.jscStyle = {
				backgroundImage : styleElement.style.backgroundImage,
				backgroundColor : styleElement.style.backgroundColor,
				color : styleElement.style.color
			};
		}

		
		switch(modeID) {
			case 0: jscolor.requireImage('hs.png'); break;
			case 1: jscolor.requireImage('hv.png'); break;
		}
		jscolor.requireImage('cross.gif');
		jscolor.requireImage('arrow.gif');

		this.importColor();
	}

};


jscolor.install();


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  
  
  
  
  

  pvce.editorType = {
    text: 1,
    date: 2,
    structurePicker: 3,
    multiValuePicker: 4,
    longText: 5,
    currency: 6,
    multiCurrency: 7,
    gantt: 8,
    pickList: 9,
    dataPicker: 10,
    checkbox: 11,
    profile: 12,
    relationship: 13,
    colorPicker: 14,
    integer: 15,
    real: 16,
    roadmapGantt: 17,
    ipmCurrency: 20,
    ipmEffort: 21,
    ipmReal: 22,
    duration: 23
  };

  
  
  
  
  

  pvce.gridContainer = '.planview-grid';
  pvce.oneClickEditors = [];
  pvce.oneClickEditors[pvce.editorType.checkbox] = true;


  
  
  
  
  

  pvce.ICellEditor = function (spec, my) {

    
    spec = spec || {};
    my = my || {};
    
    var that = {};

    var isOpen = function () { return Planview.NotImplemented("ICellEditor.isOpen()"); };
    var open = function () { return Planview.NotImplemented("ICellEditor.open()"); };
    var close = function () { return Planview.NotImplemented("ICellEditor.close()"); };
    var getValue = function () { return Planview.NotImplemented("ICellEditor.getValue()"); };
    var getDisplayValue = function () { return Planview.NotImplemented("ICellEditor.getDisplayValue()"); };
    var setValue = function () { return Planview.NotImplemented("ICellEditor.setValue()"); };
    var isNewValue = function () { return Planview.NotImplemented("ICellEditor.isNewValue()"); };
    var bindEventHandlers = function () { return Planview.NotImplemented("ICellEditor.bindEventHandlers()"); };

    
    var create = function () { return Planview.NotImplemented("ICellEditor.create()"); };
    var init = function () { return Planview.NotImplemented("ICellEditor.init()"); };
    var setOption = function () { return Planview.NotImplemented("ICellEditor.setOption()"); };
    var destroy = function () { return Planview.NotImplemented("ICellEditor.destroy()"); };
    var resize = function () { return Planview.NotImplemented("ICellEditor.resize()"); };
    var relocate = function () { return Planview.NotImplemented("ICellEditor.relocate()"); };

    that.isOpen = isOpen;
    that.open = open;
    that.close = close;
    that.getValue = getValue;
    that.getDisplayValue = getDisplayValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.open = open;
    that.setOption = setOption;
    that.init = init;
    that.resize = resize;
    that.destroy = destroy;
    that.relocate = relocate;
    that.bindEventHandlers = bindEventHandlers;

    return that;
  };

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";

  var pvce = Planview.RegisterNamespace("Planview.CellEditors");
  var pvp = Planview.RegisterNamespace("Planview.Parsing");
  var pvf = Planview.RegisterNamespace("Planview.Formatting");
  
  pvce.AbstractCellEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    var parser = null;
    var formatter = null;
    var formatCatalog = null;

    var defaultZIndex = 20;

    var that = pvce.ICellEditor(spec, my);

    

    var isOpen = function () {
      return this._isOpen;
    };

    

    var getParser = function () {
      if (!parser) {
        parser = pvp.Parser();
      }
      return parser;
    };

    

    var getFormatter = function () {
      if (!formatter) {
        formatter = pvf.Formatter();
      }
      
      return formatter;
    };

    

    var getFormatCatalog = function () {
      if (!formatCatalog) {
        formatCatalog = Planview.Formatting.Catalog.General;
      }
      return formatCatalog;
    };

    

    var open = function () {
      this._isOpen = true;
      this._trigger("open");
      return this;
    };

    

    var close = function () {
      this._isOpen = false;
      this._trigger("close");

      return this;
    };

    

    var init = function () {
    };

    

    var setInitialValue = function (editorId, value, keyCode, shiftKey) {
      var $input = $('#' + editorId);
      var inputVal = getInitialInputValue(value, keyCode, shiftKey);
      
      $input.val(inputVal);
      if (keyCode === null) {
        $input.select();
      } else {
        Planview.Browser.setInputElementCursorPosition($input[0], 1);
      }
      $input.focus();
    };

    

    var getInitialInputValue = function(value, keyCode, shiftKey) {
      var result = keyCode !== null
        ? (shiftKey)
          ? String.fromCharCode(keyCode).toUpperCase()
          : String.fromCharCode(keyCode).toLowerCase()
        : value;
      return result;
    };

    
    
    var resize = function (args) {
      var widget = this;
      $('#' + widget.options.editorId).width(args.width + widget.options.widthExtra);
      $('#' + widget.options.editorId).height(args.height + widget.options.heightExtra);
    };

    

    var relocate = function (args) {
      var widget = this;
      var newTop = (args.top + widget.options.topExtra) + 'px';
      var newLeft = (args.left + widget.options.leftExtra);

      $('#' + widget.options.editorContainerId).css({ top: newTop });
      $('#' + widget.options.editorContainerId).css({ left: newLeft });
    };

    

    var refresh = function (args) {
      resize.call(widget, args);
      relocate.call(widget, args);
    };

    

    var bindEventHandlers = function (widget) {
      var callbacks = widget.options.callbacks;
      $('#' + widget.options.editorContainerId).on("keydown", null, { widget: widget }, callbacks.onKeyDown);
    };

    

    var getDisplayValue = function () {
      return null;
    };

    

    var handleOnKeyDown = function (e) {
      var widget = e.data.widget;
      if (Planview.hasValue(widget)) {
        
        if (e.keyCode === 27) {
          $(this.parentElement).trigger('cellEditor.close');
          return false;
        } 
        if (e.shiftKey && e.keyCode === 9) {
          $(this.parentElement).trigger('cellEditor.navigatePrevious');
          return false;
        } 
        else if (e.keyCode === 9) {
          $(this.parentElement).trigger('cellEditor.navigateNext');
          return false;
        } 
        else if (e.keyCode === 13) {
          $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
          return false;
        }
      }
      return true;
    };

    

    var validate = function () {
      
      
      
      return { error: false, message: '', accept: true };
    };


    











    var getZIndex = function () {
      var modalShieldShowing = isModalShieldShowing();
      var warningOrErrorShowing = isWarningOrErrorShowing();

      if (modalShieldShowing) {
        if (warningOrErrorShowing)
          return parseInt($('.ui-widget-overlay').css('z-index')) - defaultZIndex;
        else
          return parseInt($('.ui-widget-overlay').css('z-index')) + defaultZIndex;
      }
      else
        if (isSecondaryTrayShowing()) {
          return parseInt($("#secondaryTrayDialog").css('z-index')) + defaultZIndex;
        }
        else {
          return defaultZIndex;
        }
    };

    

    var isModalShieldShowing = function () {
      return $('.ui-widget-overlay').length !== 0;
    };

    

    var isWarningOrErrorShowing = function () {
      return Planview.Core.isWarningOrErrorDialogShowing();
    };

    var isSecondaryTrayShowing = function () {
      return $("#secondaryTrayDialog:visible").length > 0;
    };

    

    var getBaseOptions = function () {
      var baseOptions = {
        editorId: "editorInput",
        editorContainerId: "editorInputContainer",
        leftExtra: 0,
        topExtra: 0,
        widthExtra: 0,
        heightExtra: 0,
        height: 25,
        width: 40,
        left: 0,
        top: 0,
        value: "",
        keyCode: null,
        align: 'left',
        callbacks: {
          onKeyDown: that.handleOnKeyDown
        }
      };
      return baseOptions;
    };

    

    var destroy = function () {
      var $el;

      $el = $('#' + this.options.editorContainerId).parent();
      $el.find('*').off().removeData().hide();
      $el.off().removeData().hide();
      $el.empty();
    };

    

    my.getZIndex = getZIndex;
    my.getParser = getParser;
    my.getFormatter = getFormatter;
    my.getFormatCatalog = getFormatCatalog;

    that.isOpen = isOpen;
    that.open = open;
    that.close = close;
    that.init = init;
    that.resize = resize;
    that.relocate = relocate;
    that.refresh = refresh;
    that.handleOnKeyDown = handleOnKeyDown;
    that.bindEventHandlers = bindEventHandlers;
    that.validate = validate;
    that.getDisplayValue = getDisplayValue;
    that.getBaseOptions = getBaseOptions;
    that.setInitialValue = setInitialValue;
    that.destroy = destroy;

    return that;
  };
})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.checkbox = function (spec, my) {
    spec = spec || {};
    my = my || {};

    var options, grid;
    var that = pvce.AbstractCellEditor(spec, my);

    

    var create = function () {
      options = this.options;
      grid = options.grid;
    };

    

    var destroy = function () {
      $('#checkBoxEditor').remove();
    };

    

    var isOpen = function () {
      return true;
    };

    

    var isNewValue = function () {
      return true;
    };

    

    var getValue = function () {
      


      var val = options.value;
      var ret = undefined;
      
      if (typeof val === 'string') {
        var tempV = parseInt(val);
        if (isNaN(tempV)) {
          if (val.toUpperCase() === 'YES') {
            ret = 'NO';
          } else if (val.toUpperCase() === 'NO') {
            ret = 'YES';
          }
        } else {
          val = tempV;
        }
      }
      else if (typeof val === 'boolean') {
        ret = !val;
      }
      
      if (typeof val === 'number') {
        switch (val) {
          case 0:
            ret = 1;
            break;
          case 1:
            ret = 0;
            break;
          case 2:
            ret = 2;
            break;
          case 3:
            ret = 3;
            break;
          default:
            throw ('value out of range for integers [0-3]');
        }
      }

      return ret;
    };

    

    var setValue = function (value) {
      options.value = value;
    };

    

    that.isNewValue = isNewValue;
    that._create = create;
    that.isOpen = isOpen;
    that.setValue = setValue;
    that.getValue = getValue;
    that.destroy = destroy;

    return that;
  };

  var cbEditor = pvce.checkbox();

  $.widget('Planview.checkboxEditorWidget', cbEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  
  
  

  pvce.colorPicker = function (spec, my) {
    spec = spec || {};
    my = my || {};

    var grid;
    var $el;
    var colPicker;

    var that = pvce.AbstractCellEditor(spec, my);

    

    var options = that.getBaseOptions();
    options.editorId = "colorPickerText",
    options.editorContainerId = "colorPickerDiv",
    options.widthExtra = -2;
    options.heightExtra = -5;
    options.shiftKey = null;

    
    
    

    var setInitialValue = function () {
      options.originalValue = options.value;

      var inputVal = '#7E93AB';
      if (options.value.color !== undefined) {
        inputVal = options.value.color;
      }

      
      $el = $('#' + options.editorId)[0];
      $el.value = inputVal;
    };

    
    
    

    var create = function () {
      this._isOpen = false;
      options = this.options;
      grid = options.grid;

      
      options.value = options.value || "";

      this.element.append(createMarkup());
      setInitialValue();


      
      setTimeout(function () {
        $('#' + options.editorId).focus();
      }, 1);

      
      var editorWidget = $(this.element).data().colorPickerEditorWidget;
      bindEventHandlers(editorWidget);

    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" style="',
          '"position:relative;z-index:' + zIndex + ';',
          'background: white; ',
          'height: ' + (options.height - 1) + 'px; ',
          'width: ' + (options.width + options.widthMod) + 'px; ',
          'left: ' + (options.left + options.leftExtra) + 'px; ',
          'top: ' + (options.top + options.topExtra) + 'px; ',
          'border: 1px solid #ccc;">',
          '<input type="text" id="' + options.editorId + '" style="',
            'margin: 2px 0px 2px 2px; ',
            'width: ' + (options.width + options.inputWidthMod) + 'px; ',
            'height: ' + (options.height + options.heightExtra - 6) + 'px; ',
            'font-size:11px; ',
            'position:relative; ',
          '" value="">',
          '<div class="grid-colorpicker-container"></div>',
        '</div>'
      ].join('');
      return markup;
    };

    var bindEventHandlers = function (widget) {
      var callbacks = widget.options.callbacks;
      showColorPicker();
      $('#' + options.editorContainerId).on("keydown", null, { widget: widget }, callbacks.onKeyDown);
    };
    

    var showColorPicker = function () {
      colPicker = new jscolor.color($el, { pickerBorder: 1, pickerInset: 1, pickerOnfocus: false, pickerClosable: false, pickerFaceColor: '#C2D1D8' });
      colPicker.pickerZIndex = my.getZIndex();
      colPicker.showPicker();
    };

    

    var getValue = function () {
      var val = '#' + $el.value;
      options.value.color = val;
      return options.value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var origValue = '';
      if (options.originalValue.color !== undefined) {
        origValue = options.originalValue.color;
      }

      var isnewValue = (newValue !== origValue);
      return isnewValue;
    };

    

    var setValue = function (value) {
      options.value = value;
      return value;
    };

    

    var destroy = function () {
      if ($el === undefined || colPicker === undefined) {
        return;
      }

      colPicker.hidePicker();

      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);

      $el = undefined;
      colPicker = undefined;
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that._create = create;
    that.destroy = destroy;
    that.options = options;
    that.isNewValue = isNewValue;

    return that;
  };

  var colorPickerEditor = pvce.colorPicker();

  $.widget('Planview.colorPickerEditorWidget', colorPickerEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.textEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    
    var that = pvce.AbstractCellEditor(spec, my);
    var options = that.getBaseOptions();
    options.editorId = "textEditorInput";
    options.widthExtra = -2;
    options.heightExtra = -5;
    options.shiftKey = null;

    
    
    

    
    
    


    var create = function () {
      this._isOpen = false;
      options = this.options;

      
      options.value = options.value || "";

      this.element.append(createMarkup());
      options.originalValue = options.value;
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);

      var editorWidget = $(this.element).data().textEditorWidget;
      that.bindEventHandlers(editorWidget);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px;' +
                      'width:' + (options.width + options.widthExtra) + 'px;">',
        '    <input id="' + options.editorId + '" ',
                        options.hasMaxLength ? 'maxLength="' + options.maxLength + '" ' : '',
                        'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'text-align: ' + options.align + '; ',
                              'height:' + (options.height + options.heightExtra) + 'px;font-size:11px;"/>',
        '</div>'
      ].join('');

      return markup;
    };

    

    var getValue = function () {
      var value;
      value = $('#' + options.editorId).val();
      return value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = (newValue !== options.originalValue);
      return isnewValue;
    };

    

    var setValue = function (value) {

      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();

      return value;
    };

    

    var setOption = function (name, value) {
      if (name === "value" && value === null) {
        this.options.value = "";
      }
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that._create = create;
    that.destroy = destroy;
    that.setOption = setOption;
    that.options = options;
    that.isNewValue = isNewValue;

    return that;
  };

  var textEditor = pvce.textEditor();

  $.widget('Planview.textEditorWidget', textEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  pvce.longTextEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    
    var that = pvce.AbstractCellEditor(spec, my);

    var options = that.getBaseOptions();
    options.editorId = "longTextEditorInput";
    options.topExtra = 1;
    options.defaultWidth = 300;
    options.defaultHeight = 130;
    options.buttonRowHeight = 30;
    options.minHeight = 50;

    

    var create = function () {
      this._isOpen = false;
      options = this.options;
      
      

      options.editorContainerId = options.id + "container";
      options.textAreaContainerId = options.id + "long-text-area-button-container";
      options.buttonContainerId = options.id + "long-text-button-container";
      options.buttonRowId = options.id + "long-text-button-row";
      options.okButtonId = options.id + "longTextOkButtonId";
      options.cancelButtonId = options.id + "longTextCancelButtonId";

      options.value = (options.keyCode !== null)
                      ? (options.shiftKey)
                        ? String.fromCharCode(options.keyCode).toUpperCase()
                        : String.fromCharCode(options.keyCode).toLowerCase()
                      : options.value === null
                        ? ""
                        : options.value;

      options.originalValue = options.value;


      this.element.append(createMarkup());

      $('#' + options.editorId).val(options.value);

      setTimeout(function () {
        $('#' + options.editorId).focus();
      }, 1);

      keepOnScreen();
      bindEventHandlers(this);
      
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);
    };

    

    var bindEventHandlers = function (widget) {
      var callbacks = widget.options.callbacks;
      $('#' + options.editorContainerId).on("keydown", null, widget, longTextHandleOnKeyDown);
      $('#' + options.okButtonId).on("click", null, widget, okButtonClick);
      $('#' + options.cancelButtonId).on("click", null, widget, cancelButtonClick);
    };

    

    var longTextHandleOnKeyDown = function (e) {
      if (e.keyCode !== 13) {
        that.handleOnKeyDown(e);
      }
    };

    

    var okButtonClick = function () {
      $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
    };

    

    var cancelButtonClick = function () {
      $(this.parentElement).trigger('cellEditor.close');
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px;' +
                      'width:' + (options.defaultWidth + 7) + 'px;' +
                      'height:' + (options.defaultHeight + 36) + 'px;' +
                      'background-color: lightgray;"',
                      'overflow:scroll;>',

            '<textarea id="' + options.editorId + '"',
                           'style="resize:none;',
                           'width:100%;',
                           'height: ' + options.defaultHeight + 'px;',
                           'box-sizing: border-box;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;"',
            '>',
            '</textarea>',
          '<div id="' + options.buttonRowId + '" style="height:' + options.buttonRowHeight + 'px;padding-bottom:2px;" >',
            '<div id="' + options.buttonContainerId + '" style="float:right;">',
              '<button id="' + options.cancelButtonId + '" style="" type="button" class="button11 gray-button">',
                Planview.ResourceManager.GetString("Common.CancelButton"),
              '</button>',
              '<button id="' + options.okButtonId + '" style="margin-bottom:2px;" type="button" class="button11 green-button">',
                Planview.ResourceManager.GetString("Common.OKButton"),
              '</button>',
            '</div>',
          '</div>',
        '</div>'
      ].join('');
      return markup;
    };

    

    var relocate = function (args) {
      var widget = this;
      my.relocate.call(widget, args);
      keepOnScreen();
    };

    

    var keepOnScreen = function () {
      var $editorDiv, off, width, height, windowWidth, windowHeight,
          windowTopScroll, windowLeftScroll, $gridContainer, gridContainerHeight,
          gridContainerWidth, gridContainerOffset,
          getHeaderOffset;

      sizeToAvailableSpace();

      $editorDiv = $('#' + options.editorContainerId);
      $gridContainer = $editorDiv.closest(".gridContainer");
      gridContainerHeight = $gridContainer.height();
      gridContainerWidth = $gridContainer.width();
      gridContainerOffset = $gridContainer.offset();
      off = $editorDiv.offset();
      width = $editorDiv.width();
      height = $editorDiv.height();
      
      
      
      


      getHeaderOffset = function ($gridContainer) {
        var headerOffset, $headers;

        headerOffset = 0;

        $headers = $(".slick-pane-header", $gridContainer);
        $headers.each(function (idx, el) {
          var hOffset, $el;
          $el = $(el);
          hOffset = $el.offset().top + $el.outerHeight(true);
          headerOffset = Math.max(headerOffset, hOffset);
        });
        return headerOffset;
      };

      if (options.left + width > gridContainerWidth) {
        off.left = Math.max(0, off.left - ((options.left + width) - gridContainerWidth));
      }

      if (options.top + height > gridContainerHeight) {
        off.top = Math.max(getHeaderOffset($gridContainer), off.top - ((options.top + height) - gridContainerHeight));
      }
      $editorDiv.offset(off);



      
      
      
      
      

      
      
      
      
      
      

      
    };

    
    
    
    var sizeToAvailableSpace = function () {
      var $editorDiv, editorHeight,
          $gridContainer, containerHeight, newContainerHeight,
          availableHeight, heightDiff, buttonRowHeight,
          $textArea, newTextAreaHeight, minTextAreaHeight;


      minTextAreaHeight = 20;
      $editorDiv = $('#' + options.editorContainerId);
      buttonRowHeight = $("#" + options.buttonRowId, $editorDiv).outerHeight(true);
      editorHeight = $editorDiv.outerHeight(true);
      $gridContainer = $editorDiv.closest(".gridContainer");
      containerHeight = $gridContainer.height();
      availableHeight = Math.max(options.minHeight, containerHeight - (options.top + options.topExtra));

      if (editorHeight > availableHeight) {
        $textArea = $("#" + options.editorId, $editorDiv);

        heightDiff = containerHeight - availableHeight;
        newContainerHeight = Math.max(options.minHeight, containerHeight - (heightDiff + 3));
        newTextAreaHeight = Math.max(minTextAreaHeight, Math.min(options.defaultHeight, newContainerHeight - buttonRowHeight));
        $editorDiv.height(newContainerHeight);
        $("#" + options.editorContainerId).height(newContainerHeight);
        $textArea.height(newTextAreaHeight);
      }
    };

    

    var getDisplayValue = function () {
      return getValue();
    };

    

    var getValue = function () {
      var newValue = $('#' + options.editorId).val();

      
      options.value = newValue.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
      return options.value;
    };

    

    var setValue = function (value) {
      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = (newValue !== options.originalValue);
      return isnewValue;
    };
    

    var setOption = function () {
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    my.relocate = that.relocate;

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that.getDisplayValue = getDisplayValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.relocate = relocate;
    that.destroy = destroy;
    that.setOption = setOption;
    that.options = options;

    return that;
  };

  var longTextEditor = pvce.longTextEditor();

  $.widget('Planview.longTextEditorWidget', longTextEditor);
  
})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.dateEditor = function (spec, my) {
    spec = spec || {};
    my = my || {};

    

    var that = pvce.AbstractCellEditor(spec, my);

    

    var handleOnKeyDown = function (e) {
      var widget = e.data.widget;
      if (Planview.hasValue(widget)) {
        var $focusedElement = $(this).find(':focus');
        
        if (e.keyCode === 27) {
          $(this.parentElement).trigger('cellEditor.close');
          return false;
        } 
        if (e.shiftKey && e.keyCode === 9) {
          if ($focusedElement.is($(this).find('.ui-datepicker-trigger'))) {
            return true;
          }
          $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
          $(this.parentElement).trigger('cellEditor.navigatePrevious');
          return false;
        } 
        else if (e.keyCode === 9) {
          if ($focusedElement.is($(this).find('#' + options.editorId))) {
            return true;
          }
          $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
          $(this.parentElement).trigger('cellEditor.navigateNext');
          return false;
        } 
        else if (e.keyCode === 13) {
          if ($focusedElement.is($(this).find('.ui-datepicker-trigger'))) {
            return true;
          }
          $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
          return false;
        }
      }
    };

    

    var options = that.getBaseOptions();
    options.heightExtra = -5;
    options.editorId = spec.editorId || "datepicker";
    options.editorContainerId = spec.editorContainerId || "gridDatePicker";
    options.showTime = false;
    options.callbacks.onKeyDown = handleOnKeyDown,
    options.callbacks.onMouseDown = function () {
      if ($('#' + options.editorId).data('datepicker')) {
        $('#' + options.editorId).datepicker('hide');
      }
    };
    options.widthMod = -2;
    options.inputWidthMod = -32;

    var datepickerFormat;

    

    var create = function () {
      this._isOpen = false;
      options = this.options;
      options.originalValue = options.value;

      setupDatePicker(this.element);

      var editorWidget = $(this.element).data().dateEditorWidget;
      bindEventHandlers(editorWidget);
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);
    };

    

    var setupDatePicker = function ($element) {

      
      $element.append(createMarkup());
      setTimeout(function () {
        $('#' + options.editorId).focus();
      }, 1);
      $('#' + options.editorId).val(options.value);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="date-editor-widget ui-editor" style="',
          'z-index:' + zIndex + ';',
          'position:relative;',
          'background: white; ',
          'height: ' + (options.height - 1) + 'px; ',
          'width: ' + (options.width + options.widthMod) + 'px; ',
          'left: ' + (options.left + options.leftExtra) + 'px; ',
          'top: ' + (options.top + options.topExtra) + 'px; ',
          'border: 1px solid #ccc;">',
          '<input type="text" id="' + options.editorId + '" style="',
            'margin: 2px 0px 2px 2px; ',
            'width: ' + (options.width + options.inputWidthMod) + 'px; ',
            'height: ' + (options.height + options.heightExtra - 6) + 'px; ',
            'font-size:11px; ',
            'position:relative; ',
          '" value="' + options.value + '">',
          '<div class="grid-datepicker-container"></div>',
        '</div>'
      ].join('');
      return markup;
    };

    

    var bindEventHandlers = function (widget) {
      var callbacks = widget.options.callbacks;
      showDatePicker();
      $('#' + options.editorContainerId).on("keydown", null, { widget: widget }, callbacks.onKeyDown);
    };

    
    
    
    var translateDateFormat = function (dotNetFormat) {
      var datepickerMask = dotNetFormat,
          theDs = dotNetFormat.match(/d+/g) || [],
          theMs = dotNetFormat.match(/M+/g) || [],
          theYs = dotNetFormat.match(/y+/g) || [],
          translator = {
            d: 'd', dd: 'dd', ddd: 'D', dddd: 'DD',
            M: 'm', MM: 'mm', MMM: 'M', MMMM: 'MM',
            yy: 'y', yyyy: 'yy'
          },
          error = function (timeUnit, expected) {
            throw "Could not resolve the " + timeUnit + " component in the mask '" + dotNetFormat + "'. " +
              "Expected one of " + expected + ".";
          };

      if ((theDs.length === 1 && Planview.hasValue(translator[theDs[0]])) || error("Day", "['d', 'dd', 'ddd', 'dddd']"))
        datepickerMask = datepickerMask.replace(theDs[0], translator[theDs[0]]);

      if ((theMs.length === 1 && Planview.hasValue(translator[theMs[0]])) || error("Month", "['M', 'MM', 'MMM', 'MMMM']"))
        datepickerMask = datepickerMask.replace(theMs[0], translator[theMs[0]]);

      if ((theYs.length === 1 && Planview.hasValue(translator[theYs[0]])) || error("Year", "['yy', 'yyyy']"))
        datepickerMask = datepickerMask.replace(theYs[0], translator[theYs[0]]);

      return datepickerMask;
    };

    

    var getDateFormat = function () {
      
      
      if (!Planview.hasValue(datepickerFormat)) {
        try {
          var datePlaceHolder = /!?d!?/,
            dateFormat = my.getFormatCatalog().DateFormat,
            dateAndTimeFormat = my.getFormatCatalog().DateAndTimeDisplayMode;
          dateAndTimeFormat = dateAndTimeFormat.replace(
            datePlaceHolder,
            dateFormat
          );
          datepickerFormat = translateDateFormat(dateAndTimeFormat);
        } catch (e) {
          var message = (Planview.isFunction(e.toString)) ? e.toString() : JSON.stringify(e);
          console.error('Error in Planview.dateEditorWidget.translateDateMask: ' + message);
          datepickerFormat = $.datepicker.ISO_8601;
        }
      }
      return datepickerFormat;
    };

    

    var showDatePicker = function () {

      
      var $el = $('#' + options.editorId);
      if ($el.hasClass('hasDatepicker')) {
        $el.datepicker("hide");
      } else {
        var dateFormat = getDateFormat();
        var timeFormat = (dateFormat.indexOf('hh') != -1) ? dateFormat.substring(dateFormat.indexOf('hh')) : (dateFormat.indexOf('HH') != -1) ? dateFormat.substring(dateFormat.indexOf('HH')) : '';
        var dateOnlyFormat = (dateFormat.indexOf('hh') != -1) ? dateFormat.substring(0, dateFormat.indexOf('hh') - 1) : (dateFormat.indexOf('HH') != -1) ? dateFormat.substring(0, dateFormat.indexOf('HH') - 1) : dateFormat;
        

        $el.datetimepicker(
          {
            controlType: 'slider',
            showOn: "button",
            showTime: false,
            showHour: false,
            showMinute: false,
            showButtonPanel: false,
            dateFormat: dateOnlyFormat,
            timeFormat: timeFormat,
            onSelect: function (dateText) {
              options.value = dateText.trim();
              $el.datepicker("hide");
              setTimeout(function () {
                
                $el.val(options.value);
                $el.focus();
                
              }, 1);
            }
          }
        );
        











      }
    };

    

    var getValue = function () {
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var setValue = function (value) {
      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var isNewValue = function () {
      var newValue = $('#' + options.editorId).val();
      var isnewValue = (newValue !== options.originalValue);
      return isnewValue;
    };

    

    var setOption = function (k, v) {
      var widget = this;
      if (k === 'showTime') {
        widget.options.showTime = v;
      }
    };

    

    var relocate = function () {
      var widget = this;
      $('#' + widget.options.editorContainerId).trigger('cellEditor.close', { saveValue: true });
    };

    

    var destroy = function () {

      $('#' + options.editorContainerId).off("keydown");
      $('#' + options.editorId).datepicker("hide");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    
    
    

    var validate = function (editorValues) {
      var parseResult = {};
      var value = editorValues.value;
      
      my.getParser().tryParse(value, Planview.ColumnType.DateTime, {}, parseResult);
      
      parseResult.accept = Planview.hasValue(parseResult.error)
                           ? !parseResult.error
                           : true;
      
      if (parseResult.accept === true) {
        editorValues.value = my.getFormatter().format(
          parseResult.value,
          Planview.ColumnType.DateTime,
          {},
          { dateAndTimeDisplayMode: "!d! HH:mm" }
        );
      }
      
      return parseResult;
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getDateFormat = getDateFormat;
    that.getValue = getValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.setOption = setOption;
    that.options = options;
    that.relocate = relocate;
    that.destroy = destroy;
    that.validate = validate;

    return that;
  };

  var dateEditor = pvce.dateEditor();

  $.widget('Planview.dateEditorWidget', dateEditor);
  
})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  pvce.integerEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    
    var that = pvce.AbstractCellEditor(spec, my);

    var options = that.getBaseOptions();
    options.editorId = "integerEditorInput",
    options.widthExtra = -2;
    options.heightExtra = -5;
    options.value = 0;
    options.shiftKey = null;
    options.align = 'right';

    
    
    

    
    
    


    var create = function () {
      this._isOpen = false;
      options = this.options;

      
      options.value = options.value || "";

      this.element.append(createMarkup());
      options.originalValue = options.value;
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);

      var editorWidget = $(this.element).data().integerEditorWidget;
      that.bindEventHandlers(editorWidget);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px; ',
                      'width:' + (options.width + options.widthExtra) + 'px;',
                      'height:' + (options.height + options.heightExtra) + 'px;">',
        '    <input id="' + options.editorId + '" ' + ' type="number" min="1" step="1" pattern="\d+" ',
                        options.hasMaxLength ? 'maxLength="' + options.maxLength + '" ' : '',
                        'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'text-align: ' + options.align + '; ',
                              'height:' + (options.height + options.heightExtra) + 'px;font-size:11px;"/>',
        '</div>'
      ].join('');

      return markup;
    };

    

    var getValue = function () {
      var value;
      value = $('#' + options.editorId).val();
      return value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = newValue != options.originalValue;
      return isnewValue;
    };

    var validate = function (editorValue) {
      var parseResult = {};
      var value = editorValue.value;
      my.getParser().tryParse(value, Planview.ColumnType.Integer, {}, parseResult);
      parseResult.accept = Planview.hasValue(parseResult.error)
                           ? !parseResult.error
                           : true;

      return parseResult;
    };

    

    var setValue = function (value) {

      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();

      return value;
    };

    

    var setOption = function (name, value) {
      if (name === "value" && value === null) {
        this.options.value = "";
      }
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that._create = create;
    that.destroy = destroy;
    that.setOption = setOption;
    that.options = options;
    that.isNewValue = isNewValue;
    that.validate = validate;

    return that;
  };

  var integerEditor = pvce.integerEditor();

  $.widget('Planview.integerEditorWidget', integerEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.realEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    
    var that = pvce.AbstractCellEditor(spec, my);

    var options = that.getBaseOptions();
    options.editorId = "realEditorInput",
    options.widthExtra = -2;
    options.heightExtra = -5;
    options.shiftKey = null;
    options.align = 'right';

    
    
    

    
    
    


    var create = function () {
      this._isOpen = false;
      options = this.options;

      
      options.value = options.value || "";

      this.element.append(createMarkup());
      options.originalValue = options.value;
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);

      var editorWidget = $(this.element).data().realEditorWidget;
      that.bindEventHandlers(editorWidget);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px; ',
                      'width:' + (options.width + options.widthExtra) + 'px;',
                      'height:' + (options.height + options.heightExtra) + 'px;">',
                      '<input id="' + options.editorId + '" pattern="\d+" ',
                        options.hasMaxLength ? 'maxLength="' + options.maxLength + '" ' : '',
                        'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'text-align: ' + options.align + '; ',
                              'height:' + (options.height + options.heightExtra) + 'px;font-size:11px;"/>',
        '</div>'
      ].join('');

      return markup;
    };

    

    var getValue = function () {
      var value;
      value = $('#' + options.editorId).val();
      return value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = newValue != options.originalValue;
      return isnewValue;
    };

    

    var setValue = function (value) {

      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();

      return value;
    };

    

    var setOption = function (name, value) {
      if (name === "value" && value === null) {
        this.options.value = "";
      }
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    var validate = function (editorValue) {
      var parseResult = {};
      var value = editorValue.value;
      my.getParser().tryParse(value, Planview.ColumnType.Real, {}, parseResult);
      parseResult.accept = Planview.hasValue(parseResult.error)
                           ? !parseResult.error
                           : true;

      return parseResult;
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that._create = create;
    that.destroy = destroy;
    that.setOption = setOption;
    that.options = options;
    that.isNewValue = isNewValue;
    that.validate = validate;

    return that;
  };

  var realEditor = pvce.realEditor();

  $.widget('Planview.realEditorWidget', realEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  pvce.currencyEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    var that = pvce.AbstractCellEditor(spec, my);

    

    var options = that.getBaseOptions();
    options.editorId = "currencyEditorInput",
    options.widthExtra = -3;
    options.heightExtra = -3;

    

    var create = function () {
      this._isOpen = false;
      options = this.options;
      options.rawValue = options.readOnlyObjects.cell.getRawValue();

      this.element.append(createMarkup());
      setValue(options.rawValue);

      var editorWidget = $(this.element).data().currencyEditorWidget;
      that.bindEventHandlers(editorWidget);
      options.originalValue = getValue();
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                        'left:' + (options.left + options.leftExtra) + 'px;',
                        'top:' + (options.top + options.topExtra) + 'px; ',
                        'width:' + (options.width + options.widthExtra) + 'px;',
                        'height:' + (options.height + options.heightExtra) + 'px;">',
        '    <input id="' + options.editorId + '"',
                       'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'height:' + (options.height + options.heightExtra) + 'px;font-size:11px;" value="" />',
        '</div>'
      ].join('');
      return markup;
    };

    

    var getValue = function () {
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var setValue = function (value) {
      if (Planview.hasValue(value)) {
        value = String(value);
        value = my.formatScale(value);
      } else {
        value = "";
      }

      $('#' + options.editorId).val(value);
      options.value = value;

      return options.value;
    };

    

    var formatScale = function (value) {
      var result = value;
      var decimalDivisor = 1;
      var decimalSeparator = my.getFormatCatalog().DecimalSeparatorForCurrency;

      switch (my.getFormatCatalog().CurrencyUnit.toLowerCase()) {
        case "thousands":
          decimalDivisor = 1000;
          break;
        case "millions":
          decimalDivisor = 1000000;
          break;
        case "billions":
          decimalDivisor = 1000000000;
          break;
        default:
      }
      result = result.replace(decimalSeparator, '.');
      var floatResult = parseFloat(result);
      floatResult = floatResult / decimalDivisor;
      result = "" + floatResult;
      result = result.replace('.', decimalSeparator);
      return result;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = newValue !== options.originalValue;
      return isnewValue;
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.destroy = destroy;
    that.options = options;
    my.formatScale = formatScale;

    return that;
  };

  var currencyEditor = pvce.currencyEditor();

  $.widget('Planview.currencyEditorWidget', currencyEditor);
  
})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.multiCurrencyEditor = function (spec, my) {
    spec = spec || {};
    my = my || {};

    var that = pvce.currencyEditor(spec, my);

    var handleOnKeyDown = function (e) {
      var widget = e.data.widget,
         nextElement;
      if (Planview.hasValue(widget)) {
        
        if (e.keyCode === 27) {
          $(this.parentElement).trigger('cellEditor.close');
          return false;
        } 
        if (e.shiftKey && e.keyCode === 9) {
          nextElement = $(e.target).prev();

          if (nextElement.length > 0) {
            nextElement.focus();
          } else {
            $(this.parentElement).trigger('cellEditor.navigatePrevious');
          }
          return false;
        } 
        else if (e.keyCode === 9) {
          nextElement = $(e.target).next();

          if (nextElement.length > 0) {
            nextElement.focus();
          } else {
            $(this.parentElement).trigger('cellEditor.navigateNext');
          }
          return false;
        } 
        else if (e.keyCode === 13) {
          $(this.parentElement).trigger('cellEditor.close', { saveValue: true });
          return false;
        }
      }
      return true;
    };

    

    var options = that.getBaseOptions();
    options.editorId = "multiCurrencyEditorInput",
    options.multiCurrencyEditorDropdownId = "multiCurrencyEditorDropdown";
    options.leftExtra = 1;
    options.widthExtra = -2;
    options.heightExtra = -3;
    options.dropdownWidth = 60;
    options.rawValue = null;

    

    var create = function () {
      this._isOpen = false;
      options = this.options;

      options.rawValue = options.readOnlyObjects.cell.getRawValue();

      this.element.append(createMarkup());
      var inputValue = setValue(options.rawValue);
      var editorWidget = $(this.element).data().multiCurrencyEditorWidget;
      that.bindEventHandlers(editorWidget);
      that.setInitialValue(options.editorId, inputValue, options.keyCode, options.shiftKey);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();
      var startingCurrencyCode = getStartingCurrencyCode();

      var optionMarkup = getOptionMarkup(startingCurrencyCode);

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + '; background: white; width:' + (options.width + options.widthExtra + options.dropdownWidth + 10) + 'px; ',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra + 1) + 'px;',
                      'width:' + (options.width + options.widthExtra + options.dropdownWidth + 10) + 'px;',
                      'height:' + (options.height + options.heightExtra) + 'px;',
                      'border: 1px solid rgb(204, 204, 204);">',
        '    <input id="' + options.editorId + '"',
                       'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'height:' + (options.height + options.heightExtra - 8) + 'px;font-size:11px; margin: 2px 0px 2px 2px;" value="" />',
        '    <select id="' + options.multiCurrencyEditorDropdownId + '"',
                       'style="width:' + (options.dropdownWidth) + 'px;height: ' + (options.height + options.heightExtra - 4) + 'px;',
                       'font-size:11px;" value=" ' + '$' + '" >',
                       optionMarkup,
                       '</select>',
        '</div>'
      ].join('');
      return markup;
    };

    

    var getStartingCurrencyCode = function () {
      var result = "";
      try {
        result = options.rawValue.split('|')[1];
      }
      catch (e) {

      }
      if (result == undefined || result === "" || Planview.GlobalOptions.EnableMultipleCurrencyUse === false) {
        result = my.getFormatCatalog().DefaultCurrencyCode;
      }
      return result;
    };

    

    var getOptionMarkup = function (startingCurrencyCode) {
      var currencyFormatObject = my.getFormatCatalog().CurrencyFormatDataByCurrencyCode;
      
      
      
      var defaultMarkup = $.map(
        currencyFormatObject,
        function (val, key) {
          if (startingCurrencyCode === key) {
            return '<option value="' + key + '">' + key + '</option>';
          } else {
            return '';
          }
        }
      ).join('');

      
      var otherMarkup = "";
      
      if (Planview.GlobalOptions.EnableMultipleCurrencyUse === true) {
        otherMarkup = $.map(
          currencyFormatObject,
          function (val, key) {
            if (startingCurrencyCode !== key) {
              return '<option value="' + key + '">' + key + '</option>';
            } else {
              return '';
            }
          }
        ).join('');
      }

      return [defaultMarkup, otherMarkup].join('');

    };

    

    var getValue = function () {
      var multiCurrencyValue,
          currencyCode = $('#' + options.multiCurrencyEditorDropdownId).val(),
          value = $('#' + options.editorId).val() || 0;

      multiCurrencyValue = value + '|' + currencyCode;

      return multiCurrencyValue;
    };

    

    var setValue = function (multiCurrencyValue) {
      var value = multiCurrencyValue ? multiCurrencyValue.split('|')[0] : "",
          currencyCode = multiCurrencyValue
            ? multiCurrencyValue.split('|')[1]
            : my.getFormatCatalog().DefaultCurrencyCode;
      value = my.formatScale(value);
      $('#' + options.editorId).val(value);
      $('#' + options.multiCurrencyEditorDropdownId).val(currencyCode);

      return value;
    };

    

    var isNewValue = function () {
      var newValue = getValue(),
      parseResult = {};

      my.getParser().tryParse(newValue, Planview.ColumnType.MultiCurrency, {}, parseResult);
      var isnewValue = parseResult.value !== options.rawValue;
      return isnewValue;
    };

    var validate = function (value) {
      var parseResult = {};

      my.getParser().tryParse(value, Planview.ColumnType.MultiCurrency, {}, parseResult);
      parseResult.accept = Planview.hasValue(parseResult.error)
                           ? !parseResult.error
                           : true;
      return parseResult;
    };

    

    that.getValue = getValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that.validate = validate;
    that._create = create;
    that.options = options;
    that.handleOnKeyDown = handleOnKeyDown;

    return that;
  };

  var multiCurrencyEditor = pvce.multiCurrencyEditor();

  $.widget('Planview.multiCurrencyEditorWidget', multiCurrencyEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  pvce.durationEditor = function (spec, my) {

    spec = spec || {};
    my = my || {};

    
    var that = pvce.AbstractCellEditor(spec, my);
    var options = that.getBaseOptions();
    options.editorId = "durationEditorInput";
    options.widthExtra = -2;
    options.heightExtra = -5;
    options.shiftKey = null;

    
    
    

    
    
    


    var create = function () {
      this._isOpen = false;
      options = this.options;

      
      options.value = options.value || "";

      this.element.append(createMarkup());
      options.originalValue = options.value;
      that.setInitialValue(options.editorId, options.value, options.keyCode, options.shiftKey);

      var editorWidget = $(this.element).data().durationEditorWidget;
      that.bindEventHandlers(editorWidget);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px;' +
                      'width:' + (options.width + options.widthExtra) + 'px;">',
        '    <input id="' + options.editorId + '" ',
                        options.hasMaxLength ? 'maxLength="' + options.maxLength + '" ' : '',
                        'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'text-align: ' + options.align + '; ',
                              'height:' + (options.height + options.heightExtra) + 'px;font-size:11px;"/>',
        '</div>'
      ].join('');

      return markup;
    };

    

    var getValue = function () {
      var value;
      value = $('#' + options.editorId).val();
      return value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = (newValue !== options.originalValue);
      return isnewValue;
    };

    

    var setValue = function (value) {

      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();

      return value;
    };

    

    var setOption = function (name, value) {
      if (name === "value" && value === null) {
        this.options.value = "";
      }
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    
    
    var validate = function (value) {
      var parseResult = {};
      var parseSpec = {

      };

      my.getParser().tryParse(
        value.value,
        Planview.ColumnType.Duration,
        parseSpec,
        parseResult
      );

      parseResult.accept = Planview.hasValue(parseResult.error)
        ? !parseResult.error
        : true;
      return parseResult;
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that._create = create;
    that.destroy = destroy;
    that.setOption = setOption;
    that.options = options;
    that.isNewValue = isNewValue;
    that.validate = validate;

    return that;
  };

  var durationEditor = pvce.durationEditor();

  $.widget('Planview.durationEditorWidget', durationEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.pickListEditor = function (spec, my) {
  spec = spec || {};
  my = my || {};

  var that = pvce.AbstractCellEditor(spec, my);
  var options = that.getBaseOptions();
  options.editorId = "comboboxInput";
  options.value = " ";
  options.choices = "";
  options.originalValue = " ";

  
  
  

  var setSelectedOption = function (valueText) {
    var value = undefined;

    if (!Planview.hasValue(valueText)) { return; }
    var splitString = valueText.split("|");
    if (splitString.length === 1) {
      $.each(options.choices, function (i, v) {
        if (v.Text === valueText) {
          value = v.Value;
        }
      });
    } else {
      value = splitString[0];
    }

    if (Planview.hasValue(value)) {
      
      $("#" + options.editorId).val(value);
    }
  };

  
  
  

  var create = function () {
    this._isOpen = false;
    options = this.options;

    if (!Planview.hasValue(options.choices)) { return; }
    

    this.element.append(createMarkup());

    
    for (var i = 0; i < options.choices.length; i++) {
      $('#' + options.editorId).append('<option value="'
                        + options.choices[i].Value + '">'
                        + options.choices[i].Text + '</option>');
    }

    
    if (!Planview.hasValue(options.value)) {
      options.value = "";
    }
    setSelectedOption(options.value);
    options.originalValue = getValue();

    
    setTimeout(function () {
      $('#' + options.editorId).focus();
    }, 1);

    
    var editorWidget = $(this.element).data().pickListEditorWidget;
    that.bindEventHandlers(editorWidget);
  };

  

  var createMarkup = function () {

    var zIndex = my.getZIndex();

    
    var markup = [
      '<div id="' + options.editorContainerId + '" class="ui-editor" ',
            'style="position:relative;z-index:' + zIndex + ';',
                    'left:' + (options.left + options.leftExtra) + 'px;',
                    'top:' + (options.top + options.topExtra) + 'px;' +
                    'width:' + (options.width + options.widthExtra) + 'px;',
                    'height:' + (options.height + options.heightExtra) + 'px;">',
      '    <select id="' + options.editorId + '" tabIndex="1" title="options"',
                     'style="width:' + (options.width + options.widthExtra) + 'px;',
                            'height:' + (options.height + options.heightExtra) + 'px; font-size:11px;" value="' + options.value + '">',
          '</select>',
      '</div>'
    ].join('');


    return markup;
  };

  

  var getValue = function () {

    if (!Planview.hasValue(options.choices) || !Planview.hasValue(options.value)) {
      return undefined;
    }

    options.value = $('#' + options.editorId + ' option:selected').val();
    return options.value;
  };

  

  var getDisplayValue = function () {
    var text;
    $.each(options.choices, function (i, v) {
      if (Planview.hasValue(v.Value)) {
        if (v.Value === options.value) {
          text = v.Text;
        }
      }
    });
    return text;
  };

  

  var isNewValue = function () {
    var newValue = getValue();
    var isnewValue = newValue !== options.originalValue;
    return isnewValue;
  };

  

  var setValue = function (value) {
    $('#' + options.editorId).val(value);
    options.value = $('#' + options.editorId).val();
    return options.value;
  };

  

  var destroy = function () {
    $('#' + options.editorContainerId).off("keydown");
    $.Widget.prototype.destroy.call(this);
    mySuper.destroy.call(this);
  };

  


  var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.getDisplayValue = getDisplayValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.options = options;
    that.destroy = destroy;
    that.close = close;
    return that;
  };

  

  var pickListEditor = pvce.pickListEditor();

  $.widget('Planview.pickListEditorWidget', pickListEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  pvce.dataPickerEditor = function (spec, my) {
    
    
    
    
    
    spec = spec || {};
    my = my || {};


    var that = pvce.AbstractCellEditor(spec, my);
    var options = that.getBaseOptions();
    options.topExtra = -1;
    options.widthExtra = 21;
    options.heightExtra = 5;
    options.value = " ";
    options.editorId = "dataPicker";
    options.editorContainerId = ""; // You have to set this in the CellEditorsFactory or the data picker won't get this value.
    options.container = {};

    var $input, $ddBtn, $regularDisplay, $baseContainer;
    var structureCode, structureName, structureProvider, name;
    var defaultValue, currentValue;

    
    
    

    var onKey = function (evt) {
      var keyCode = evt.keyCode;
      
      if (keyCode == 13 || keyCode == 115) {
        onClick();
      }
    };

    

    var onClick = function () {
      $(window).off("keydown", onKey);
      if ($input) $input.remove();
      var dppEditor = DataPickerPlus.CreateDHTMLPicker("GridDataPickerEditor");
      $(dppEditor).appendTo($baseContainer);
      $input = $baseContainer.find("#GridDataPickerEditor_selectBox");
      $input[0].focus();
      $input.css("width", "100%"); 
      $input.width($input.width() - 92);
      $input.css('top', "0px");

      var $buttons = $input.siblings('span[id^="GridDataPickerEditor"]');
      $input.add($buttons).on('keydown.nav', function (e) {
        var $this = $(this);
        switch (e.keyCode) {
          case $.ui.keyCode.LEFT:
          case $.ui.keyCode.RIGHT:
            e.stopImmediatePropagation();
            break;
          case $.ui.keyCode.ENTER:
            if ($this[0] !== $input[0]) e.stopImmediatePropagation();
            break;
          case $.ui.keyCode.TAB:
            e.stopImmediatePropagation();

            if ($this[0] === $buttons.last()[0] && !e.shiftKey) {
              $(this.parentElement).trigger('cellEditor.navigateNext');
              return false;
            } else if ($this[0] === $input[0] && e.shiftKey) {
              $(this.parentElement).trigger('cellEditor.navigatePrevious');
              return false;
            }

            break;
        }
        return true;
      });

      $regularDisplay.hide(); 
      
      var splitValue = defaultValue.split("|");
      var selectionKey = "";
      var selectionDescription = "";
      if (splitValue.length == 2) {
        selectionKey = splitValue[0];
        selectionDescription = splitValue[1];
      }
      that.setInitialValue("GridDataPickerEditor_selectBox", selectionDescription, options.keyCode, options.shiftKey);
      $baseContainer.find('#GridDataPickerEditor_hiddenSelectionKey').val(selectionKey);
      $baseContainer.find('#GridDataPickerEditor_hiddenSelectionText').val(selectionDescription);
    };

    
    
    

    var openFull = function () {
      setTimeout(function () {
        return DataPickerPlus.OpenFullDataPicker("GridDataPickerEditor_selectBox");
      }, 1);

    };

    

    var create = function () {
      this._isOpen = false;
      options = this.options;

      
      name = options.column.name;
      structureCode = options.column.id;
      structureProvider = options.column.pickDataProvider;
      var pickStructureName = options.column.pickStructureName;
      structureName = pickStructureName;
      if (structureName == "" || structureName == undefined) {
        structureName = structureCode;
      }
      structureName = structureName.replace(/(_PLAN|_PROD|_STRAT)$/, "");

      
      createMarkup.call(this);

      setTimeout(onClick, 1);
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      
      var markup = [
        '<div id="pv_datapickerplus_editor_div" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';margin-top:1px;',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px;',
                      'width:' + (options.width + options.widthExtra) + 'px;',
                      'height:' + (options.height + options.heightExtra) + 'px;">',
        '</div>'
      ].join('');

      this.element.append(markup);
      $baseContainer = $('#' + options.editorContainerId);

      $regularDisplay = $("<div></div>");
      $regularDisplay.appendTo($baseContainer);
      $regularDisplay.css("position", "absolute");
      $regularDisplay.css("width", $baseContainer.width());
      $regularDisplay.css("text-overflow", "ellipsis");
      $regularDisplay.css("margin-top", "-2px");
      $regularDisplay.css("overflow", "hidden");

      loadValue(options.value);
    };

    

    var getValue = function () {
      return currentValue;
    };

    

    var isNewValue = function () {
      return currentValue != defaultValue;
    };

    

    var loadValue = function (value) {
      
      defaultValue = (value == null) ? "" : value;

      currentValue = defaultValue;
      var splitValue = defaultValue.split("|");
      var selectionDescription = "";
      if (splitValue.length == 2) {
        selectionDescription = splitValue[1];
      }

      $regularDisplay.html(selectionDescription);
    };


    

    var setValue = function (value) {
      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var setCurrentValue = function (value) {
      currentValue = value;
    };

    

    var destroy = function () {
      if ($input) $input.remove();
      $baseContainer.remove();
    };

    

    var relocate = function () {

      $('#' + options.editorContainerId).trigger('cellEditor.close', { saveValue: true });
      
      

      
      
    };

    

    var resize = function (args) {
      $baseContainer.width(args.width + options.widthExtra);
      $baseContainer.height(args.height + options.heightExtra);

      $input = $baseContainer.find("#GridDataPickerEditor_selectBox");
      $input.css("width", "100%");  
      $input.width($input.width() - 92);
    };

    


    that.destroy = destroy;
    that.openFull = openFull;
    that.getValue = getValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.options = options;
    that.destroy = destroy;
    that.close = close;
    that.relocate = relocate;
    that.resize = resize;
    that.setCurrentValue = setCurrentValue;

    return that;
  };

  var dataPickerEditor = pvce.dataPickerEditor();

  $.widget('Planview.dataPickerEditorWidget', dataPickerEditor);

})(jQuery);

(function ($, undefined) {

  $.widget('Planview.MultiValSelect', {
    options: {
      width: 300,
      height: 50,
      value: [],
      origValue: [],
      parent: undefined,
      provider: undefined,
      handler: undefined,
      currentCode: undefined,
      boundsContainer: undefined 
    },

    _create: function () {
      var markup = this.createMarkup();
      $(this.element).append(markup);
      this.bindEvents();
      for (var i = 0; i < this.options.value.length; i++) {
        this.options.origValue.push(this.options.value[i]);
      }
      $(this.element).find('input.multival-input').focus();
    },

    destroy: function () {
      $(this.element).find('.multival-dropdown-button').off('click');
      $(this.element).off('click', '.multival-token-kill');
      $(this.element).find('.multival-input').off('keydown');
      $(this.element).find('.multival-input').off('keyup');
      $(this.element).off('click', '.multival-inputbox');
      $(this.element).off('click', '.multival-suggestions');
      $(this.element).off('click', '.multival-dropdown-datapicker-container');
    },

    createMarkup: function () {
      var tokenMarkup = '';
      if (this.options.value.length > 0) {
        for (var i = 0; i < this.options.value.length; i++) {
          tokenMarkup += '<span class="multival-token" data-val="' + this.options.value[i].value + '">';
          tokenMarkup += (this.options.value[i].token !== undefined) ? this.options.value[i].token : this.options.value[i].desc;
          tokenMarkup += '<a href="#" class="multival-token-kill">x</a></span>';
        }
      }
      var markup = [
        '<div id="multival-editor-container" class="multival-container" style="width: ' + this.options.width + '; height: ' + this.options.height + 'px;">',
          '<div class="multival-inputbox">',
            tokenMarkup,
            '<input type="text" class="multival-input" id="multival-main-input">',
          '</div>',
          '<div class="multival-dropdown-button">▼</div>',
          '<div class="multival-dropdown" style="width: ' + this.options.width + '; bottom: -' + ((this.options.height / 2 * 6) + 2) + 'px;',
            'padding-bottom: ' + (this.options.height / 2) + 'px; ',
            'height: ' + (this.options.height / 2 * 5) + 'px;">',
            '<div class="multival-dropdown-suggestions-container"></div>',
            '<div class="multival-dropdown-datapicker-container">',
            Planview.ResourceManager.GetString("Visualization\Resources.MultiValDataPicker"),
            '</div>',
          '</div>',
        '</div>'
      ].join('');
      return markup;
    },

    bindEvents: function () {
      var that = this;

      
      $(this.element).find('.multival-dropdown-button').on('click', function (e) {
        that.openCloseDropdown();
      });
      

      
      $(this.element).on('click', '.multival-token-kill', function (e) {
        that.removeToken(this);

        
        e.stopImmediatePropagation();
      });
      

      $(this.element).find('.multival-input').on('keydown', function (e) {
        if (e.keyCode == 13) {
          that.selectViaEnter(e);
        }
        that.backSpaceToken(e);
      });

      $(this.element).find('.multival-input').on('keyup', function (e) {
        if ($(that.element).find('.multival-input').val().length > 0) {
          $(that.element).find('.multival-token').removeClass('to-delete');
          if ((e.keyCode == 186) || (e.keyCode == 188)) {
            that.selectViaSemicolon(e);
          }
        } else {
          that.navigateTokens(e);
        }
        that.updateSuggestions(e);
      });

      $(this.element).on('click', '.multival-inputbox', function (e) {
        e.preventDefault();
        $(that.element).find('input.multival-input').focus();
      });

      $(this.element).on('click', '.multival-suggestions', function (e) {
        that.addToken(e);
      });

      
      
      $(this.element).on('click', '.multival-dropdown-datapicker-container', function (e) {
        var dataPickerCallback = that.options.handler;
        
        var dataPickerParameters = "structure=$Plan;selmode=All;minsellevel=ppl;maxsellevel=max;sortbyattrib=place;excludeparentsandchildrenof=" + that.options.currentCode;
        dataPickerParameters += (Planview.GlobalOptions.UseGrantedStructureProviderForCpmRelationships) ? ';usage=ReadWrite;user=' + Planview.Context.User.getUserId() + ";" : "";

        DataPicker_MultiSelect(
          'Predecessor Relationship',  
          (Planview.GlobalOptions.UseGrantedStructureProviderForCpmRelationships) ? 'GrantedStructureProvider' : 'StructureProvider',
          dataPickerParameters,
          that.getPlanningCodesFromValues(),
          dataPickerCallback,
          '../',
          that.options.rootCode,
          that.options.exclusions);
      });
      
    },
    
    
    getPlanningCodesFromValues: function () {
      var planningCodes = [];

      for (var i = 0; i < this.options.value.length; i++) {
        planningCodes.push(this.options.value[i].value);
      }

      return planningCodes;
    },

    
    
    
    
    
    
    
    
    
    
    
    
    

    selectViaEnter: function (event) {
      if ($(this.element).find('.multival-dropdown-suggestions-container .multival-suggestions.selected').length == 1) {
        event.preventDefault();
        event.stopPropagation();
        this.addToken({ target: $(this.element).find('.multival-dropdown-suggestions-container .multival-suggestions.selected') });
        $(this.element).find('.multival-input').val();
        $(this.element).find('.multival-input').focus();
      }
    },

    
    selectViaSemicolon: function (event) {
      
      
      
      
      var input = $(this.element).find('.multival-input').val();
      var trgt;
      if (input.replace(';', '').length <= 0) {
        $(this.element).find('.multival-input').val('');
        $(this.element).find('.multival-input').focus();
      } else {
        if ($(this.element).find('.multival-dropdown-suggestions-container .multival-suggestions').length == 1) {
          trgt = $(this.element).find('.multival-suggestions');
          if ($(trgt).data('token') != this.options.currentLine) {
            this.addToken({ target: trgt });
            $(this.element).find('.multival-input').val();
            $(this.element).find('.multival-input').focus();
          } else {
            
            $(this.element).find('.multival-input').val(input.replace(';', ''));
            $(this.element).find('.multival-input').focus();
          }
        } else if ($(this.element).find('.multival-dropdown-suggestions-container .multival-suggestions').length > 1) {
          
          
          var match = false,
              matchC,
              poss = $(this.element).find('.multival-suggestions');
          for (var m = 0; m < poss.length; m++) {
            if ($(poss[m]).data('token') == input.replace(';', '')) {
              
              
              if (input.replace(';', '') != this.options.currentLine) {
                match = true;
                matchC = m;
                break;
              } else {
                
                match = false;
              }
            }
            if (input.replace(';', '') == $(poss[m]).text().substring($(poss[m]).text().indexOf(':') + 1)) {
              if (match === true) {
                
                match = false;
                break;
              } else {
                match = true;
                matchC = m;
              }
            }
          }
          if (match) {
            this.addToken({ target: poss[matchC] });
            $(this.element).find('.multival-input').val();
            $(this.element).find('.multival-input').focus();
          } else {
            $(this.element).find('.multival-input').val(input.replace(';', ''));
            $(this.element).find('.multival-input').focus();
          }
        } else {
          $(this.element).find('.multival-input').val(input.replace(';', ''));
          $(this.element).find('.multival-input').focus();
        }
      }
    },
    

    backSpaceToken: function (event) {
      
      
      
      var that = this;
      if (event.keyCode == 27) {
        event.preventDefault();
        if ($(this.element).find('.multival-dropdown').is(':visible')) {
          $(this.element).find('.multival-dropdown').hide();
          $(this.element).find('.multival-input').focus();
          event.stopPropagation();
        } else if ($(this.element).find('.multival-token.to-delete').length > 0) {
          $(this.element).find('.multival-token.to-delete').removeClass('to-delete');
          event.stopPropagation();
        } else {
          this.options.value = this.options.origValue;
        }
      } else if (event.keyCode == 9) {
        
        event.preventDefault();
        
        if (event.shiftKey) {
          if ($(this.element).find('.multival-dropdown-button').hasClass('selected')) {
            
            $(this.element).find('.multival-dropdown-button').removeClass('selected');
            event.stopPropagation();
          } else {
            
            if ($(this.element).find('.multival-input').val().length === 0) {
              
              $(this.options.parent).trigger(event);
            } else {
              
              $(this.element).find('.multival-dropdown-button').removeClass('selected');
              $(this.element).find('.multival-input').focus();
              event.stopPropagation();
            }
          }
        } else {
          if ($(this.element).find('.multival-dropdown-button').hasClass('selected')) {
            
            if ($(this.element).find('.multival-input').val().length === 0) {
              
              $(this.options.parent).trigger(event);
            } else {
              
              $(this.element).find('.multival-dropdown-button').removeClass('selected');
              $(this.element).find('.multival-input').focus();
              event.stopPropagation();
            }
          } else {
            
            $(this.element).find('.multival-dropdown-button').addClass('selected');
            event.stopPropagation();
          }
        }

      }
      if ($(this.element).find('.multival-input').val().length === 0) {
        if (event.keyCode == 8) {
          if ($(this.element).find('.multival-token.to-delete').length > 0) {
            for (var i = 0; i < this.options.value.length; i++) {
              if (this.options.value[i].value == $(this.element).find('.multival-token.to-delete').data().val) {
                this.options.value.splice(i, 1);
              }
            }
            $(this.element).find('.multival-token.to-delete').remove();
          } else {
            $(this.element).find('.multival-token').each(function (x, t) {
              $(that.element).find('.multival-token').removeClass('to-delete');
              $(t).addClass('to-delete');
            });
          }
        }
      }
    },

    navigateTokens: function (event) {
      var curSel, direction;
      
      

      if ($(this.element).find('.multival-token.to-delete').length > 0) {
        direction = ((event.keyCode == 37) ? 'left' : (event.keyCode == 39) ? 'right' : false);
        curSel = -1;

        if (direction) {
          $(this.element).find('.multival-token').each(function (c, t) {
            if ($(t).hasClass('to-delete')) {
              curSel = c;
            }
          });
          var nextSel = ((direction == 'left') && (curSel > 0)) ? curSel - 1 : curSel;
          nextSel = ((direction == 'right') && (curSel < $(this.element).find('.multival-token').length - 1)) ? curSel + 1 : nextSel;
          $(this.element).find('.multival-token').removeClass('to-delete');
          $(this.element).find('.multival-token').each(function (c, t) {
            if (c == nextSel) {
              $(t).addClass('to-delete');
            }
          });
        }
      }
    },

    


    removeToken: function (token) {
      var values, tokenValueToRemove, newValues;

      
      values = this.options.value;
      
      tokenValueToRemove = $(token).parent().data().val.toString();

      
      newValues = $.grep(values, function(obj, idx) {
        return (obj.value !== tokenValueToRemove);
      });

      
      this.options.value = newValues;
      
      
      $(token).parent().remove();
      $(this.element).find('input.multival-input').focus();
    },

    openCloseDropdown: function () {
      
      
      if ($(this.element).find('.multival-dropdown').is(":visible")) {
        $(this.element).find('.multival-dropdown').hide();
        $(this.element).find('.multival-input').focus();
      } else {
        $(this.element).find('.multival-suggestions').remove();
        var vals = this.options.provider.getValues();
        var tempToken;
        for (var i = 0; i < vals.length; i++) {
          tempToken = (vals[i].token !== undefined) ? vals[i].token : vals[i].desc;
          $(this.element).find('.multival-dropdown-suggestions-container').append('<div class="multival-suggestions" data-val="' + vals[i].value + '" data-token="' + tempToken + '">' + vals[i].desc + '</div>');
        }
        this.positionDropdown();
        $(this.element).find('.multival-input').focus();
      }
    },

    addToken: function (e, that) {
      
      var tempDesc = ($(e.target).data().token !== undefined) ? $(e.target).data().token : $(e.target).text();
      var newToken = ['<span class="multival-token" data-val="',
                      $(e.target).data().val,
                      '">' + tempDesc,
                      '<a href="#" class="multival-token-kill">x</a></span>'
      ].join('');
      for (var i = 0; i < this.options.value.length; i++) {
        if (this.options.value[i].value == $(e.target).data().val) {
          return false;
        }
      }
      this.options.value.push({ desc: $(e.target).text(), token: $(e.target).data().token, value: $(e.target).data().val.toString() });
      $(this.element).find('.multival-suggestions').remove();
      $(this.element).find('.multival-dropdown').hide();
      $(this.element).find('.multival-input').before(newToken);
      $(this.element).find('.multival-input').val('');
      $(this.element).find('.multival-input').focus();

      return undefined;
    },

    updateSuggestions: function (e) {
      
      if (e.keyCode == 13) {
        
        if ($(this.element).find('.multival-dropdown-button').hasClass('selected')) {
          event.preventDefault();
          event.stopPropagation();
          this.openCloseDropdown();
          $(this.element).find('.multival-dropdown-button').removeClass('selected');
        } else if ($(this.element).find('.multival-suggestions.selected').length > 0) {
          var trgt = $(this.element).find('.multival-suggestions.selected');
          this.addToken({ target: trgt });
        }
      } else if ((e.keyCode == 38) || (e.keyCode == 40)) {
        
        e.preventDefault();
        var newSel = 0;
        if ($(this.element).find('.multival-suggestions').length <= 0) {
          this.updateFromProvider();
        }
        if (!$(this.element).find('.multival-dropdown').is(':visible')) {
          this.positionDropdown();
        }

        $(this.element).find('.multival-suggestions').each(function (i, t) {
          if ($(t).hasClass('selected')) {
            newSel = (e.keyCode == 38) ? i - 1 : i + 1;
          }
        });
        newSel = (newSel < 0) ? $(this.element).find('.multival-suggestions').length - 1 : (newSel >= $(this.element).find('.multival-suggestions').length) ? 0 : newSel;
        $(this.element).find('.multival-suggestions.selected').removeClass('selected');
        $(this.element).find('.multival-suggestions:eq(' + newSel + ')').addClass('selected');

        
        var currentSel;

        $('.multival-dropdown-suggestions-container').children('div.multival-suggestions').each(function (i, s) {
          if ($(s).hasClass('selected')) {
            currentSel = i;
          }
        });

        if (currentSel > 4) {
          $('.multival-dropdown-suggestions-container').scrollTop((currentSel - 4) * 25);
        } else {
          $('.multival-dropdown-suggestions-container').scrollTop(0);
        }

      } else {
        
        $(this.element).find('.multival-suggestions').remove();
        this.updateFromProvider();
        
        if ($(this.element).find('.multival-suggestions').length > 0) {
          this.positionDropdown();
        } else {
          $(this.element).find('.multival-dropdown').hide();
          $(this.element).find('.multival-suggestions.selected').removeClass('selected');
        }
      }
    },
    
    positionDropdown: function() {
      var editorTop = $('#' + this.options.parent.options.editorContainerId).offset().top;
      var lowerBounds;
      
      if (Planview.hasValue(this.options.boundsContainer)) {
        var boundsContainer = $(this.options.boundsContainer);
        lowerBounds = boundsContainer.offset().top + boundsContainer.height();
      }
        
      else {
        lowerBounds = $(window).height();
      }

      if (((editorTop + 204) < lowerBounds)) {
        $(this.element).find('.multival-dropdown').css('bottom', '-152px');
      } else { 
        $(this.element).find('.multival-dropdown').css('bottom', '50px');
      }

      $(this.element).find('.multival-dropdown').show();
    },

    updateFromProvider: function () {
      if (typeof this.options.provider != 'undefined') {
        var current = $(this.element).find('.multival-input').val(),
            suggestions = this.options.provider.getValues(),
            sugs = [],
            tempToken,
            addSug;
        for (var i = 0; i < suggestions.length; i++) {
          addSug = true;
          for (var v = 0; v < this.options.value.length; v++) {
            if (suggestions[i].value == this.options.value[v].value) addSug = false;
          }
          if (addSug) sugs.push(suggestions[i]);
        }
        if (current.length > 0) {
          for (var s = 0; s < sugs.length; s++) {
            if (sugs[s].desc.toLowerCase().indexOf(current.toLowerCase()) != -1) {
              tempToken = (sugs[s].token !== undefined) ? sugs[s].token : sugs[s].desc;
              $(this.element).find('.multival-dropdown-suggestions-container').append('<div class="multival-suggestions" data-val="' + sugs[s].value + '" data-token="' + tempToken + '">' + sugs[s].desc + '</div>');
            }
          }
        }
      }
    },

    setValue: function (values) {
      var newToken, tDesc;
      this.options.value = values;
      $(this.element).find('.multival-token').remove();
      for (var i = 0; i < values.length; i++) {
        tDesc = (values[i].token !== undefined) ? values[i].token : values[i].desc;
        newToken = ['<span class="multival-token" data-val="',
                      values[i].value,
                      '">' + tDesc,
                      '<a href="#" class="multival-token-kill">x</a></span>'
        ].join('');
        $(this.element).find('.multival-input').before(newToken);
      }
    },

    getValue: function () {
      return this.options.value;
    },

    _setOption: function (key, value) {
      switch (key) {
        case "clear":
          
          break;
      }
      this._super("_setOption", key, value);
    }


  });

})(jQuery);

; (function ($, undefined) {

  $.widget("Planview.defaultSelectMenuWidget",
  {
    options: {
      items: [],
      selectHandler: undefined,
      selectContext: undefined,
      selectedItem: 0,
      idPrefix: undefined,
      menuLabel: undefined
    },

    ids: {
      selectContainer: '-display-select-container', 
      menuContainer: '-display-menu-container', 
      popupContainer: '-display-menu-wrapper-' 
    },

    selectors: {
      
      selectContainer: undefined
    },

    userTriggered: true,

    





    _create: function() {

      this.ids.selectContainer = this.options.idPrefix + this.ids.selectContainer;
      this.ids.menuContainer = this.options.idPrefix + this.ids.menuContainer;
      this.ids.popupContainer = this.options.idPrefix + this.ids.popupContainer;
      this.selectors.selectContainer = "#" + this.ids.selectContainer;

      var buttonMarkup = this.createWidgetMarkup(this);

      this.element.append(buttonMarkup);

      var selectedIndex = this._getSelectedItemIndex(this.options.selectedItem);

      this.options.items[selectedIndex].selected = true;

      
      
      var selectItems = [];
      for (var i = 0; i < this.options.items.length; i++) {
        selectItems.push(this.options.items[i]);
      }
      pvSelectMenuHelper._create({
        id: this.ids.popupContainer,
        triggerEl: $(this.selectors.selectContainer, this.element),
        origins: { baseOrigin: "bottom left", popupOrigin: "top left" },
        selectItems: selectItems,
        popupCssClass: "pvPopup",
        selectCssClass: "pvSelectMenu",
        afterSelect: $.proxy(this._onAfterItemSelected, this)

      }).populateSelect();

    },

    _getSelectedItemIndex: function(selectedValue) {
      var index = 0;

      $.each(this.options.items, function(i, v) {
        if (selectedValue === v.value) {
          index = i;
          return false; 
        }
      });
      return index;
    },

    



    _onAfterItemSelected: function(selectedItem) {
      var uiHash = {
        selectedItem: selectedItem,
        userTriggered: this.userTriggered
      };

      var context = this.options.selectContext;

      this.options.selectHandler(uiHash, context);

      this.userTriggered = true;
    },

    


    reselect: function() {
      var selectedItem = pvSelectMenuHelper.selectMenus[this.ids.popupContainer].selectedItem;
      this._onAfterItemSelected.call(this, selectedItem);
    },

    getValue: function() {
      return pvSelectMenuHelper.selectMenus[this.ids.popupContainer].selectedItem.value;
    },

    setValue: function(value) {
      var items = pvSelectMenuHelper.selectMenus[this.ids.popupContainer].selectItems;
      for (var i = 0; i < items.length; i++) {
        if (items[i].value === value) {
          pvSelectMenuHelper.selectMenus[this.ids.popupContainer].setSelection(items[i]);
          break;
        }
      }
    },


    

    _init: function () {
    },

    

    destroy: function () {
      this.element.children("*").remove();

      $.Widget.prototype.destroy.call(this);
    },

    

    _setOption: function (option, value) {
      $.Widget.prototype._setOption.apply(this, arguments);
    },

    

    createWidgetMarkup: function (widget) {
      var markup;

      markup = ['<span id="' + this.ids.selectContainer + '" tabindex="0" class="pvSelectContainer form-field">',
          '   <span class="pmLabel">' + this.options.menuLabel + ':</span>',
          '   <span class="selectedText" ></span>',
          '   <span class="affordance" >&#9660;</span>',
          '</span>'].join('');

      return markup;
    },

    


    initializeWidgetInternalState: function (widget) {

    },

    

    bindEventHandlers: function (widget) {
    }


  });

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;
  
  pvce.multiValuePickerEditor = function (spec, my) {

  spec = spec || {};
  my = my || {};

  var that = pvce.AbstractCellEditor(spec, my);

  

  var options = that.getBaseOptions();
  options.editorContainerId = "multival-editor-widget-container";
  options.editorId = "multival-main-input";
  options.leftExtra = 1;
  options.widthExtra = -2;
  options.heightExtra = -3;
  options.width = 200;
  options.value = [];
  options.provider = undefined;

  

  var create = function () {
    this._isOpen = false;
    options = this.options;

    this.element.append(createMarkup());
    this.element.children('#' + options.editorContainerId)
                .MultiValSelect({ provider: options.provider, parent: this, width: options.width, height: options.height, value: options.value })
                .data().MultiValSelect;
    bindEventHandlers(this);

    setTimeout(function () {
      $(this.element).children('.multival-input').focus();
    }, 1);

    options.originalValue = this.element.children('#' + options.editorContainerId).data().MultiValSelect.getValue();
  };

  

  var bindEventHandlers = function (widget) {
    var callbacks = widget.options.callbacks;
    $('#' + options.editorContainerId).on("keydown", null, widget, callbacks.onKeyDown);
  };

  

  var createMarkup = function () {
    var zIndex = my.getZIndex();

    var markup = [
      '<div id="' + options.editorContainerId + '" ',
      'style="position: relative; z-index: ' + zIndex + '; ',
      'left: ' + (options.left + options.leftExtra) + 'px; ',
      'top: ' + (options.top + options.topExtra) + 'px; ',
      'width: ' + (options.width + options.widthExtra) + 'px; ',
      'height: ' + (options.height + options.heightExtra) + 'px; ',
      '"></div>'
    ].join('');
    return markup;
  };

  

  var getValue = function () {
    options.value = this.element.children('#' + options.editorContainerId).data().MultiValSelect.getValue();
    return options.value;
  };

  

  var setValue = function (value) {
    this.element.children('#' + options.editorContainerId).data().MultiValSelect.setValue(value);
    options.value = value;
    return options.value;
  };

  

  var isNewValue = function () {
    var newValue = this.element.children('#' + options.editorContainerId).data().MultiValSelect.getValue();
    var isnewValue = options.originalValue !== newValue;
    
    return true;
  };

  

  var resize = function (args) {
    $('#' + options.editorContainerId).width(args.width + options.widthExtra);
    $('#' + options.editorContainerId).height(args.height + options.heightExtra);
  };

  

  var relocate = function (args) {

    var newTop = (args.top + options.topExtra) + 'px';
    var newLeft = (args.left - (this.options.width) + options.leftExtra);
    $('#' + options.editorContainerId).css({ top: newTop });
    $('#' + options.editorContainerId).css({ left: newLeft });
  };

  

  var refresh = function (args) {
    resize(args);
    relocate(args);
  };

  

  var setOption = function () {
  };

  

  var destroy = function () {
    
    $('#' + options.editorContainerId).off("keydown");
    $.Widget.prototype.destroy.call(this);
    mySuper.destroy.call(this);
  };

  

  var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that.isNewValue = isNewValue;
    that._create = create;
    that.destroy = destroy;
    that.setOption = setOption;
    that.relocate = relocate;
    that.resize = resize;
    that.refresh = refresh;
    that.options = options;

    return that;
  };

  var multiValuePickerEditor = pvce.multiValuePickerEditor();

  $.widget('Planview.multiValuePickerEditorWidget', multiValuePickerEditor);

})(jQuery);


;
var Planview = Planview || {};
Planview.Utilities = Planview.Utilities || {};
Planview.debug = false;


(function ($, undefined) {
  
  "use strict";
  Planview.RegisterNamespace("Planview.CellEditors");
  Planview.RegisterNamespace("Planview.Util");
  Planview.RegisterNamespace("Planview.Parsing");

  var pvce = Planview.CellEditors;
  var pvutl = Planview.Util;
  var pvp = Planview.Parsing;

  pvce.structurePickerEditor = function (spec, my) {
    
    
    
    
    

    spec = spec || {};
    my = my || {};

    var that = pvce.AbstractCellEditor(spec, my);
    var options = that.getBaseOptions();
    options.editorId = "comboboxInput",
    options.topExtra = 1;
    options.heightExtra = -1;
    options.originalValue = " ";
    options.value = " ";
    options.choices = "";

    
    
    

    var setSelectedOption = function (valueText) {
      var value = undefined;

      if (!Planview.hasValue(valueText)) { return; }
      var splitString = valueText.split("|");
      if (splitString.length === 1) {
        $.each(options.choices, function (i, v) {
          if (v.Text === valueText) {
            value = v.Value;
          }
        });
      } else {
        value = splitString[0];
      }

      if (Planview.hasValue(value)) {
        
        $("#" + options.editorId).val(value);
      }
    };

    
    
    

    var create = function () {
      this._isOpen = false;
      options = this.options;

      if (Planview.hasValue(options.choices)) {
        
        this.element.append(createMarkup());


        
        for (var i = 0; i < options.choices.length; i++) {
          $('#' + options.editorId).append('<option value="'
            + options.choices[i].StructureCode + '">'
            + options.choices[i].Description + '</option>');
        }

        
        if (!Planview.hasValue(options.value)) {
          options.value = "";
        }
        setSelectedOption(options.value);
        options.originalValue = options.value;

        
        setTimeout(function () {
          $('#' + options.editorId).focus();
        }, 1);

        
        var editorWidget = $(this.element).data().structurePickerEditorWidget;
        that.bindEventHandlers(editorWidget);
      }
    };

    

    var createMarkup = function () {
      var zIndex = my.getZIndex();

      
      var markup = [
        '<div id="' + options.editorContainerId + '" class="ui-editor" ',
              'style="position:relative;z-index:' + zIndex + ';',
                      'left:' + (options.left + options.leftExtra) + 'px;',
                      'top:' + (options.top + options.topExtra) + 'px;' +
                      'width:' + (options.width + options.widthExtra) + 'px;',
                      'height:' + (options.height + options.heightExtra) + 'px;">',
        '    <select id="' + options.editorId + '" tabIndex="1" title="options"',
                       'style="width:' + (options.width + options.widthExtra) + 'px;',
                              'height:' + (options.height + options.heightExtra) + 'px; font-size:11px;" value="' + options.value + '">',
            '</select>',
        '</div>'
      ].join('');


      return markup;
    };

    

    var getValue = function () {

      if (Planview.hasValue(options.choices) && Planview.hasValue(options.value)) {
        var val = $('#' + options.editorId + ' option:selected').val();
        var text = $('#' + options.editorId + ' option:selected').text();
        options.value = (val === "" && text === "")
                        ? null
                        : val + "|" + text;
      }

      return options.value;
    };

    

    var isNewValue = function () {
      var newValue = getValue();
      var isnewValue = newValue !== options.originalValue;
      return isnewValue;
    };

    

    var setValue = function (value) {
      $('#' + options.editorId).val(value);
      options.value = $('#' + options.editorId).val();
      return options.value;
    };

    

    var validate = function (editorValues) {
      var colId = editorValues.field;
      if (colId === "STATUS" && Planview.WorkStatusHint.StatusConfirm &&
            Planview.WorkStatusHint.StatusConfirm != null && Planview.WorkStatusHint.StatusConfirm.indexOf("|") >= 0) {
        var hintSplit = Planview.WorkStatusHint.StatusConfirm.split("|");
        if (hintSplit[0] == "confirmRemove") {
          var valueSplit = editorValues.value.split("|")[0];
          if (!confirmChange(hintSplit, valueSplit))
            return { error: false, message: '', accept: false };;
        }
      }

      return { error: false, message: '', accept: true };
    };

    var confirmChange = function (hintSplit, value) {
      
      for (var i = 1; i < hintSplit.length; i++) {
        if (hintSplit[i] === value) { 
          if (!confirm(Planview.ResourceManager.GetString("PLP.ChangeStatusAndRemoveAssignmentAndScheduleDates"))) {
            return false;
          }
        }
      }
      return true;
    };

    

    var destroy = function () {
      $('#' + options.editorContainerId).off("keydown");
      $.Widget.prototype.destroy.call(this);
      mySuper.destroy.call(this);
    };

    

    var relocate = function () {
      $('#' + options.editorContainerId).trigger('cellEditor.close', { saveValue: true });
    };

    

    var mySuper = {};
    mySuper.destroy = that.destroy;

    that.destroy = destroy;
    that.getValue = getValue;
    that.setValue = setValue;
    that.validate = validate;
    that.isNewValue = isNewValue;
    that._create = create;
    that.options = options;
    that.destroy = destroy;
    that.relocate = relocate;
    return that;
  };

  var structurePickerEditor = pvce.structurePickerEditor();

  $.widget('Planview.structurePickerEditorWidget', structurePickerEditor);

})(jQuery);

